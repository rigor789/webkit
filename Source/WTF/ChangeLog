2018-08-02  Babak Shafiei  <bshafiei@apple.com>

        Cherry-pick r234528. rdar://problem/42883788

    Source/JavaScriptCore:
    Reading instructionPointer from PlatformRegisters may fail when using pointer profiling
    https://bugs.webkit.org/show_bug.cgi?id=188271
    <rdar://problem/42850884>
    
    Reviewed by Michael Saboff.
    
    This patch defends against the instructionPointer containing garbage bits.
    See radar for details.
    
    * runtime/MachineContext.h:
    (JSC::MachineContext::instructionPointer):
    * runtime/SamplingProfiler.cpp:
    (JSC::SamplingProfiler::takeSample):
    * runtime/VMTraps.cpp:
    (JSC::SignalContext::SignalContext):
    (JSC::SignalContext::tryCreate):
    * tools/CodeProfiling.cpp:
    (JSC::profilingTimer):
    * tools/SigillCrashAnalyzer.cpp:
    (JSC::SignalContext::SignalContext):
    (JSC::SignalContext::tryCreate):
    (JSC::SignalContext::dump):
    (JSC::installCrashHandler):
    * wasm/WasmFaultSignalHandler.cpp:
    (JSC::Wasm::trapHandler):
    
    Source/WTF:
    Reading instructionPointer from PlatformRegisters may fail when using pointer tagging
    https://bugs.webkit.org/show_bug.cgi?id=188271
    <rdar://problem/42850884>
    
    Reviewed by Michael Saboff.
    
    * wtf/PtrTag.h:
    (WTF::isTaggedWith):
    (WTF::usesPointerTagging):
    
    
    git-svn-id: https://svn.webkit.org/repository/webkit/trunk@234528 268f45cc-cd09-0410-ab3c-d52691b4dbfc

    2018-08-02  Saam Barati  <sbarati@apple.com>

            Reading instructionPointer from PlatformRegisters may fail when using pointer tagging
            https://bugs.webkit.org/show_bug.cgi?id=188271
            <rdar://problem/42850884>

            Reviewed by Michael Saboff.

            * wtf/PtrTag.h:
            (WTF::isTaggedWith):
            (WTF::usesPointerTagging):

2018-07-29  Babak Shafiei  <bshafiei@apple.com>

        Cherry-pick r234330. rdar://problem/42721217

    Be more conservative with compositing layer creation when memory is low
    https://bugs.webkit.org/show_bug.cgi?id=187866
    rdar://problem/42366345
    
    Reviewed by Zalan Bujtas.
    
    Source/WebCore:
    
    When process physical footprint is above a fraction of the jetsam limit, be more conservative in making
    compositing layers. We avoid compositing for these situations:
    1. Layers with 3D transforms which are affine (like translateZ(0)).
    2. Layers with will-change
    3. Layers for canvases (other than WebGL/WebGPU)
    
    We reuse some macOS code in MemoryPressureHandler() but choose different thresholds for iOS,
    falling into "conservative mode" at 50% of jetsam limit, and "strict mode" at 65%.
    Compositing chooses to be more conservative in either "conservative" or "strict" memory modes.
    
    Plumb through a "compositingPolicyOverride" both so that on-device testing isn't
    flakily falling into a different mode, and so that we can impose the conservative
    mode for testing.
    
    Test: compositing/layer-creation/compositing-policy.html
    
    * page/Page.h:
    (WebCore::Page::compositingPolicyOverride const):
    (WebCore::Page::setCompositingPolicyOverride):
    * platform/graphics/transforms/Matrix3DTransformOperation.cpp:
    (WebCore::Matrix3DTransformOperation::isRepresentableIn2D const):
    * platform/graphics/transforms/Matrix3DTransformOperation.h:
    * platform/graphics/transforms/PerspectiveTransformOperation.h:
    * platform/graphics/transforms/RotateTransformOperation.h:
    * platform/graphics/transforms/ScaleTransformOperation.h:
    * platform/graphics/transforms/TransformOperation.h:
    (WebCore::TransformOperation::isRepresentableIn2D const):
    * platform/graphics/transforms/TransformOperations.h:
    (WebCore::TransformOperations::has3DOperation const):
    (WebCore::TransformOperations::isRepresentableIn2D const):
    * platform/graphics/transforms/TranslateTransformOperation.h:
    * rendering/RenderLayerBacking.cpp:
    (WebCore::RenderLayerBacking::updateGeometry):
    * rendering/RenderLayerCompositor.cpp:
    (WebCore::RenderLayerCompositor::cacheAcceleratedCompositingFlags):
    (WebCore::RenderLayerCompositor::updateCompositingPolicy):
    (WebCore::RenderLayerCompositor::updateCompositingLayers):
    (WebCore::RenderLayerCompositor::requiresCompositingForTransform const):
    (WebCore::RenderLayerCompositor::requiresCompositingForVideo const):
    (WebCore::RenderLayerCompositor::requiresCompositingForCanvas const):
    (WebCore::RenderLayerCompositor::requiresCompositingForPlugin const):
    (WebCore::RenderLayerCompositor::requiresCompositingForWillChange const):
    (WebCore::RenderLayerCompositor::needsFixedRootBackgroundLayer const):
    (WebCore::operator<<):
    * rendering/RenderLayerCompositor.h:
    * testing/Internals.cpp:
    (WebCore::Internals::setCompositingPolicyOverride):
    (WebCore::Internals::compositingPolicyOverride const):
    * testing/Internals.h:
    * testing/Internals.idl:
    
    Source/WebKit:
    
    When process physical footprint is above a fraction of the jetsam limit, be more conservative in making
    compositing layers. We avoid compositing for these situations:
    1. Layers with 3D transforms which are affine (like translateZ(0)).
    2. Layers with will-change
    3. Layers for canvases (other than WebGL/WebGPU)
    
    We reuse some macOS code in MemoryPressureHandler() but choose different thresholds for iOS,
    falling into "conservative mode" at 50% of jetsam limit, and "strict mode" at 65%.
    Compositing chooses to be more conservative in either "conservative" or "strict" memory modes.
    
    Plumb through a "compositingPolicyOverride" both so that on-device testing isn't
    flakily falling into a different mode, and so that we can impose the conservative
    mode for testing.
    
    * WebProcess/InjectedBundle/API/c/WKBundlePage.cpp:
    (WKBundlePageSetCompositingPolicyOverride):
    * WebProcess/InjectedBundle/API/c/WKBundlePagePrivate.h:
    
    Source/WTF:
    
    When process physical footprint is above a fraction of the jetsam limit, be more conservative in making
    compositing layers. We avoid compositing for these situations:
    1. Layers with 3D transforms which are affine (like translateZ(0)).
    2. Layers with will-change
    3. Layers for canvases (other than WebGL/WebGPU)
    
    We reuse some macOS code in MemoryPressureHandler() but choose different thresholds for iOS,
    falling into "conservative mode" at 50% of jetsam limit, and "strict mode" at 65%.
    Compositing chooses to be more conservative in either "conservative" or "strict" memory modes.
    
    Plumb through a "compositingPolicyOverride" both so that on-device testing isn't
    flakily falling into a different mode, and so that we can impose the conservative
    mode for testing.
    
    * wtf/MemoryPressureHandler.cpp:
    (WTF::thresholdForPolicy):
    (WTF::MemoryPressureHandler::currentMemoryUsagePolicy):
    * wtf/MemoryPressureHandler.h:
    
    Tools:
    
    When process physical footprint is above a fraction of the jetsam limit, be more conservative in making
    compositing layers. We avoid compositing for these situations:
    1. Layers with 3D transforms which are affine (like translateZ(0)).
    2. Layers with will-change
    3. Layers for canvases (other than WebGL/WebGPU)
    
    We reuse some macOS code in MemoryPressureHandler() but choose different thresholds for iOS,
    falling into "conservative mode" at 50% of jetsam limit, and "strict mode" at 65%.
    Compositing chooses to be more conservative in either "conservative" or "strict" memory modes.
    
    Plumb through a "compositingPolicyOverride" both so that on-device testing isn't
    flakily falling into a different mode, and so that we can impose the conservative
    mode for testing.
    
    * WebKitTestRunner/InjectedBundle/InjectedBundlePage.cpp:
    (WTR::InjectedBundlePage::prepare):
    
    LayoutTests:
    
    * compositing/layer-creation/compositing-policy-expected.txt: Added.
    * compositing/layer-creation/compositing-policy.html: Added.
    
    git-svn-id: https://svn.webkit.org/repository/webkit/trunk@234330 268f45cc-cd09-0410-ab3c-d52691b4dbfc

    2018-07-27  Simon Fraser  <simon.fraser@apple.com>

            Be more conservative with compositing layer creation when memory is low
            https://bugs.webkit.org/show_bug.cgi?id=187866
            rdar://problem/42366345

            Reviewed by Zalan Bujtas.

            When process physical footprint is above a fraction of the jetsam limit, be more conservative in making
            compositing layers. We avoid compositing for these situations:
            1. Layers with 3D transforms which are affine (like translateZ(0)).
            2. Layers with will-change
            3. Layers for canvases (other than WebGL/WebGPU)

            We reuse some macOS code in MemoryPressureHandler() but choose different thresholds for iOS,
            falling into "conservative mode" at 50% of jetsam limit, and "strict mode" at 65%.
            Compositing chooses to be more conservative in either "conservative" or "strict" memory modes.

            Plumb through a "compositingPolicyOverride" both so that on-device testing isn't
            flakily falling into a different mode, and so that we can impose the conservative
            mode for testing.

            * wtf/MemoryPressureHandler.cpp:
            (WTF::thresholdForPolicy):
            (WTF::MemoryPressureHandler::currentMemoryUsagePolicy):
            * wtf/MemoryPressureHandler.h:

2018-07-26  Babak Shafiei  <bshafiei@apple.com>

        Cherry-pick r234272. rdar://problem/42645434

    Unreviewed, rolling out r234181 and r234189.
    https://bugs.webkit.org/show_bug.cgi?id=188075
    
    These are not needed right now (Requested by thorton on
    #webkit).
    
    Reverted changesets:
    
    "Enable Web Content Filtering on watchOS"
    https://bugs.webkit.org/show_bug.cgi?id=187979
    https://trac.webkit.org/changeset/234181
    
    "HAVE(PARENTAL_CONTROLS) should be true on watchOS"
    https://bugs.webkit.org/show_bug.cgi?id=187985
    https://trac.webkit.org/changeset/234189
    
    git-svn-id: https://svn.webkit.org/repository/webkit/trunk@234272 268f45cc-cd09-0410-ab3c-d52691b4dbfc

    2018-07-26  Commit Queue  <commit-queue@webkit.org>

            Unreviewed, rolling out r234181 and r234189.
            https://bugs.webkit.org/show_bug.cgi?id=188075

            These are not needed right now (Requested by thorton on
            #webkit).

            Reverted changesets:

            "Enable Web Content Filtering on watchOS"
            https://bugs.webkit.org/show_bug.cgi?id=187979
            https://trac.webkit.org/changeset/234181

            "HAVE(PARENTAL_CONTROLS) should be true on watchOS"
            https://bugs.webkit.org/show_bug.cgi?id=187985
            https://trac.webkit.org/changeset/234189

2018-07-25  Babak Shafiei  <bshafiei@apple.com>

        Cherry-pick r234189. rdar://problem/42604524

    HAVE(PARENTAL_CONTROLS) should be true on watchOS
    https://bugs.webkit.org/show_bug.cgi?id=187985
    <rdar://problem/42559346>
    
    Reviewed by Andy Estes.
    
    * wtf/Platform.h:
    
    
    git-svn-id: https://svn.webkit.org/repository/webkit/trunk@234189 268f45cc-cd09-0410-ab3c-d52691b4dbfc

    2018-07-24  Tim Horton  <timothy_horton@apple.com>

            HAVE(PARENTAL_CONTROLS) should be true on watchOS
            https://bugs.webkit.org/show_bug.cgi?id=187985
            <rdar://problem/42559346>

            Reviewed by Andy Estes.

            * wtf/Platform.h:

2018-07-14  Kocsen Chung  <kocsen_chung@apple.com>

        Ensure WebKit stack is ad-hoc signed
        https://bugs.webkit.org/show_bug.cgi?id=187667

        Reviewed by Alexey Proskuryakov.

        * Configurations/Base.xcconfig:

2018-07-14  David Kilzer  <ddkilzer@apple.com>

        Replace TR2_OPTIONAL_ASSERTED_EXPRESSION macro in <wtf/Optional.h>
        <https://webkit.org/b/187672>

        Reviewed by Frédéric Wang.

        * wtf/Optional.h:
        (std::optional::operator -> const):
        (std::optional::operator * const):
        (std::optional<T::operator-> const):
        (std::optional<T::operator* const):
        - Replace TR2_OPTIONAL_ASSERTED_EXPRESSION macro with
          ASSERT_UNDER_CONSTEXPR_CONTEXT macro and return statement.

2018-07-13  Mark Lam  <mark.lam@apple.com>

        Signal.cpp's activeThreads() should only create its ThreadGroup once.
        https://bugs.webkit.org/show_bug.cgi?id=187634
        <rdar://problem/40662311>

        Reviewed by Yusuke Suzuki.

        registerThreadForMachExceptionHandling() is relying on the activeThreads()
        ThreadGroup being a singleton.

        * wtf/threads/Signals.cpp:
        (WTF::activeThreads):

2018-07-12  David Kilzer  <ddkilzer@apple.com>

        Revert: iOS port should define HAVE_RUNLOOP_TIMER
        <https://webkit.org/b/187370>

        * wtf/Platform.h: This is only needed on macOS when using
        -[WebView scheduleInRunLoop:forMode:] and
        -[WebView unscheduleFromRunLoop:forMode:] to make WK1 WebViews
        load synchronously using -loadHTMLString: or -loadData:.

2018-07-12  Per Arne Vollan  <pvollan@apple.com>

        Add compile guard for enabling NSRunLoop in the WebContent process.
        https://bugs.webkit.org/show_bug.cgi?id=187563

        Reviewed by Chris Dumez.

        * wtf/FeatureDefines.h:

2018-07-09  Zan Dobersek  <zdobersek@igalia.com>

        Unreviewed follow-up to r233660.

        * wtf/linux/MemoryFootprintLinux.cpp:
        (WTF::memoryFootprint): Revert accidental change of logical OR into a bitwise OR.

2018-07-09  Youenn Fablet  <youenn@apple.com>

        StringView operator==(char*) should check the length of the string
        https://bugs.webkit.org/show_bug.cgi?id=187422

        Reviewed by Chris Dumez.

        Update StringView operator== to ensure that any character raw pointer comparison actually check the length of the raw pointer string.
        This patch mimicks the behavior of String.
        For instance, comparing a StringView with "he\0llo" and "he" will give the same result.

        * wtf/linux/MemoryFootprintLinux.cpp:
        (WTF::memoryFootprint):
        * wtf/text/StringView.h:
        (WTF::operator==):
        (WTF::operator!=):
        (WTF::equal):
        (WTF::StringView::stripLeadingAndTrailingMatchedCharacters):

2018-07-09  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Annotate RunLoop::Timer fast-allocated
        https://bugs.webkit.org/show_bug.cgi?id=187473

        Reviewed by Saam Barati.

        It is allocated by std::unique_ptr for MemoryPressureHandler. And it uses system malloc now.

        * wtf/RunLoop.h:

2018-07-08  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Optimize padding of UnlinkedCodeBlock to shrink
        https://bugs.webkit.org/show_bug.cgi?id=187448

        Reviewed by Saam Barati.

        * wtf/TriState.h:

2018-07-07  David Kilzer  <ddkilzer@apple.com>

        iOS port should define HAVE_RUNLOOP_TIMER
        <https://webkit.org/b/187370>

        Reviewed by Simon Fraser.

        * wtf/Platform.h:
        (HAVE_DTRACE): Remove unused macro since r200568.
        (HAVE_RUNLOOP_TIMER): Define for PLATFORM(COCOA), not just
        PLATFORM(MAC).  Alphabetize macros.

2018-07-07  Yusuke Suzuki  <utatane.tea@gmail.com>

        [linux] ASSERT: Using an alternative signal stack is not supported. Consider disabling the concurrent GC.
        https://bugs.webkit.org/show_bug.cgi?id=187297

        Reviewed by Mark Lam.

        This patch relaxes the JSC's limitation: accepting an alternative signal stack mechanism.

        * wtf/ThreadingPthreads.cpp:
        (WTF::getApproximateStackPointer):
        Fix approximate stack pointer function to make it valid.

        (WTF::Thread::signalHandlerSuspendResume):
        Use StackBounds::contains to check whether the given stack pointer is in range of StackBounds.
        If it is out of range, it seems that this stack pointer is pointing an alternative signal stack.

        (WTF::Thread::suspend):
        Repeatedly retry suspension by using Thread::yield().

        (WTF::isOnAlternativeSignalStack): Deleted.

2018-07-06  Frederic Wang  <fwang@igalia.com>

        WTF's internal std::optional implementation should abort() on bad optional access
        https://bugs.webkit.org/show_bug.cgi?id=186536

        Reviewed by Michael Catanzaro.

        Currently, some ports built with recent compilers will cause the program to abort when one
        tries to access the value of an unset std:optional (i.e. std::nullopt) as specified by C++17.
        However, most ports still use WTF's internal std::optional implementation, which does not
        verify illegal access. Hence it's not possible for developers working on these ports to
        detect issues like bugs #186189, #186535, #186752, #186753, #187139, #187145, #187243 or
        #187382.
        WTF's version of std::optional was introduced in bug #164199 but it was not possible to
        verify the availability of the value inside constexpr member functions because the assert
        might involve asm declarations. This commit introduces a new ASSERT_UNDER_CONSTEXPR_CONTEXT
        macro (a simplified version of ASSERT that can be used in constexpr context) and uses it in
        WTF's implementation of std::optional.

        * wtf/Assertions.h: Define ASSERT_UNDER_CONSTEXPR_CONTEXT as a version of ASSERT that can be
        used in constexpr context (in particular avoids asm declarations).
        * wtf/Optional.h:
        (std::optional::operator ->): Add an assert to ensure the optional value is available.
        (std::optional::operator *): Ditto.
        (std::optional::value const): Ditto.
        (std::optional::value): Ditto.
        (std::optional<T::value const): Ditto.

2018-07-05  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r233417 and r233418.
        https://bugs.webkit.org/show_bug.cgi?id=187364

        Introduced an occasional crash on Google Drive (Requested by
        rniwa on #webkit).

        Reverted changesets:

        "WTF's internal std::optional implementation should abort() on
        bad optional access"
        https://bugs.webkit.org/show_bug.cgi?id=186536
        https://trac.webkit.org/changeset/233417

        "WTF's internal std::optional implementation should abort() on
        bad optional access"
        https://bugs.webkit.org/show_bug.cgi?id=186536
        https://trac.webkit.org/changeset/233418

2018-07-04  Guillaume Emont  <guijemont@igalia.com>

        FunctionTraits: Make cCallArity() constant on 32-bits.
        https://bugs.webkit.org/show_bug.cgi?id=187292

        Reviewed by Yusuke Suzuki.

        On X86, in Source/JavaScriptCore/jit/CCallHelpers.h we have a
        static_assert that uses cCallArity(), so it needs to be constant to
        avoid a compilation error. This is achieved by changing an ASSERT into
        a static_assert.


        * wtf/FunctionTraits.h:
        (WTF::slotsForCCallArgument):

2018-07-04  Tim Horton  <timothy_horton@apple.com>

        Introduce PLATFORM(IOSMAC)
        https://bugs.webkit.org/show_bug.cgi?id=187315

        Reviewed by Dan Bernstein.

        * Configurations/Base.xcconfig:
        * wtf/FeatureDefines.h:
        * wtf/Platform.h:

2018-07-02  Alicia Boya García  <aboya@igalia.com>

        [Linux] Fix memory leak in WTF::forEachLine()
        https://bugs.webkit.org/show_bug.cgi?id=187174

        Reviewed by Žan Doberšek.

        * wtf/linux/MemoryFootprintLinux.cpp:
        (WTF::forEachLine):

2018-07-02  Frederic Wang  <fwang@igalia.com>

        WTF's internal std::optional implementation should abort() on bad optional access
        https://bugs.webkit.org/show_bug.cgi?id=186536

        Reviewed by Michael Catanzaro.

        Currently, some ports built with recent compilers will cause the program to abort when one
        tries to access the value of an unset std:optional (i.e. std::nullopt) as specified by C++17.
        However, most ports still use WTF's internal std::optional implementation, which does not
        verify illegal access. Hence it's not possible for developers working on these ports to
        detect issues like bugs #186189, #186535, #186752, #186753, #187139, #187145 or #187243.
        WTF's version of std::optional was introduced in bug #164199 but it was not possible to
        verify the availability of the value inside constexpr member functions because the assert
        might involve asm declarations. This commit introduces a new
        RELEASE_ASSERT_UNDER_CONSTEXPR_CONTEXT macro (a simplified version of RELEASE_ASSERT that can
        be used in constexpr context) and uses it in WTF's implementation of std::optional.

        * wtf/Assertions.h: Define RELEASE_ASSERT_UNDER_CONSTEXPR_CONTEXT as a version of
        RELEASE_ASSERT that can be used in constexpr context (in particular avoids asm declarations).
        * wtf/Optional.h:
        (std::optional::operator ->): Add an assert to ensure the optional value is available.
        (std::optional::operator *): Ditto.
        (std::optional::value const): Ditto.
        (std::optional::value): Ditto.
        (std::optional<T::value const): Ditto.

2018-07-01  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] RandomDevice should be initialized inside std::call_once
        https://bugs.webkit.org/show_bug.cgi?id=186017

        Reviewed by Darin Adler.

        While Linux ports uses mutex-guarded static variables, Mac ports do not.
        So we should guard static variables' initialization by using std::call_once.
        This patch does it for RandomDevice.

        * wtf/OSRandomSource.cpp:
        (WTF::cryptographicallyRandomValuesFromOS):
        * wtf/RandomDevice.h: Small fix for OS(FUCHSIA).

2018-07-01  Myles C. Maxfield  <mmaxfield@apple.com>

        [Cocoa] LastResort in the font family list causes emoji with joiners to be rendered as multiple .notdef characters
        https://bugs.webkit.org/show_bug.cgi?id=187209
        <rdar://problem/40920785>

        Reviewed by Darin Adler.

        * wtf/unicode/CharacterNames.h:

2018-06-23  Darin Adler  <darin@apple.com>

        [Cocoa] Improve ARC compatibility of more code in JavaScriptCore
        https://bugs.webkit.org/show_bug.cgi?id=186973

        Reviewed by Dan Bernstein.

        * WTF.xcodeproj/project.pbxproj: Added CFXPCBridgeSPI.h, fixed a few
        other small problems in the project file, and let Xcode fix a few too.

        * wtf/cocoa/Entitlements.h: Added hasEntitlement function with overloads
        for an audit token and an XPC connection.
        * wtf/cocoa/Entitlements.mm:
        (WTF::hasEntitlement): Added, with overloads for a SecTask, an audit token,
        and an XPC connection.
        (WTF::processHasEntitlement): Refactored to use the function above.

        * wtf/spi/cocoa/CFXPCBridgeSPI.h: Added.

2018-06-30  Adam Barth  <abarth@webkit.org>

        Port JavaScriptCore to OS(FUCHSIA)
        https://bugs.webkit.org/show_bug.cgi?id=187223

        Reviewed by Daniel Bates.

        * wtf/Platform.h: Fuchsia uses mcontext_t to provide machine context.

2018-06-30  Adam Barth  <abarth@webkit.org>

        Port WTF to OS(FUCHSIA)
        https://bugs.webkit.org/show_bug.cgi?id=187221

        Reviewed by Yusuke Suzuki.

        * wtf/FastMalloc.cpp: Fuchsia does not have resource.h
        (WTF::fastMallocStatistics): Skip collecting stats without resource.h
        * wtf/InlineASM.h: Fuchsia uses ELF
        * wtf/Platform.h: Define OS(FUCHSIA) as an OS(UNIX) variant
        * wtf/RandomDevice.cpp: Call zx_cprng_draw for crypographic randomness
        (WTF::RandomDevice::cryptographicallyRandomValues):
        * wtf/ThreadingPthreads.cpp: Fuchsia does not have pthread_setschedparam
        (WTF::Thread::changePriority):
        * wtf/unix/CPUTimeFuchsia.cpp: Added.

2018-06-30  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r233391.
        https://bugs.webkit.org/show_bug.cgi?id=187217

        This patch broke Windows ports (Requested by fredw on
        #webkit).

        Reverted changeset:

        "WTF's internal std::optional implementation should abort() on
        bad optional access"
        https://bugs.webkit.org/show_bug.cgi?id=186536
        https://trac.webkit.org/changeset/233391

2018-06-29  Frederic Wang  <fwang@igalia.com>

        WTF's internal std::optional implementation should abort() on bad optional access
        https://bugs.webkit.org/show_bug.cgi?id=186536

        Reviewed by Michael Catanzaro.

        Currently, some ports built with recent compilers will cause the program to abort when one
        tries to access the value of an unset std:optional (i.e. std::nullopt) as specified by C++17.
        However, most ports still use WTF's internal std::optional implementation, which does not
        verify illegal access. Hence it's not possible for developers working on these ports to
        detect issues like bugs #186189, #186535, #186752, #186753, #187139 or #187145. WTF's version
        of std::optional was introduced in bug #164199 but it was not possible to verify the
        availability of the value inside constexpr member functions because the assert might involve
        asm declarations. This commit introduces a new RELEASE_ASSERT_UNDER_CONSTEXPR_CONTEXT macro
        (a simplified version of RELEASE_ASSERT that can be used in constexpr context) and uses it in
        WTF's implementation of std::optional.

        * wtf/Assertions.h: Define RELEASE_ASSERT_UNDER_CONSTEXPR_CONTEXT as a version of
        RELEASE_ASSERT that can be used in constexpr context (in particular avoids asm declarations).
        * wtf/Optional.h:
        (std::optional::operator ->): Add an assert to ensure the optional value is available.
        (std::optional::operator *): Ditto.
        (std::optional::value const): Ditto. 
        (std::optional::value): Ditto.
        (std::optional<T::value const): Ditto.

2018-06-29  Darin Adler  <darin@apple.com>

        [Cocoa] reduce unnecessary use of .mm source files in WTF, spruce up some implementation details
        https://bugs.webkit.org/show_bug.cgi?id=186924

        Reviewed by Anders Carlsson.

        * WTF.xcodeproj/project.pbxproj: Update for file and directory renames, file type changes,
        and deletions.

        * wtf/MemoryPressureHandler.cpp:
        (WTF::MemoryPressureHandler::holdOff): Deleted empty placeholder; this one is not needed.

        * wtf/PlatformMac.cmake: Update for file and directory renames, file type changes,
        and deletions.

        * wtf/cocoa/CPUTimeCocoa.cpp: Renamed from Source/WTF/wtf/cocoa/CPUTimeCocoa.mm.

        * wtf/text/cocoa/StringImplCocoa.mm: Renamed from Source/WTF/wtf/text/mac/StringImplMac.mm.
        Also removed an unneeded include.

        * wtf/text/cocoa/StringViewCocoa.mm: Renamed from Source/WTF/wtf/text/mac/StringViewObjC.mm.

        * wtf/text/cocoa/TextBreakIteratorInternalICUCocoa.cpp: Renamed from
        Source/WTF/wtf/text/mac/TextBreakIteratorInternalICUMac.mm.

2018-06-28  Olivia Barnett  <obarnett@apple.com>

        Find in page for typographic quotes does not find low (German) quotes
        https://bugs.webkit.org/show_bug.cgi?id=187164
        <rdar://problem/29612785>

        Reviewed by Tim Horton.

        Added Unicode definitions for German quotation marks.

        * wtf/unicode/CharacterNames.h:

2018-06-27  Jonathan Bedard  <jbedard@apple.com>

        Enable WebKit iOS 12 build
        https://bugs.webkit.org/show_bug.cgi?id=187024
        <rdar://problem/39759057>

        Reviewed by David Kilzer.

        * wtf/spi/darwin/XPCSPI.h: Add endpoint and connection declarations.

2018-06-25  David Fenton  <david_fenton@apple.com>

        Unreviewed, rolling out r233120.

        caused regression in ios API tests

        Reverted changeset:

        "[Cocoa] reduce unnecessary use of .mm source files in WTF,
        spruce up some implementation details"
        https://bugs.webkit.org/show_bug.cgi?id=186924
        https://trac.webkit.org/changeset/233120

2018-06-25  Alicia Boya García  <aboya@igalia.com>

        Fix ASAN_ENABLED in GCC
        https://bugs.webkit.org/show_bug.cgi?id=186957

        Reviewed by Michael Catanzaro.

        ASAN_ENABLED used to rely on Clang-specific features for detection.
        This patch enables ASAN_ENABLED to work on GCC too.

        It also fixes compilation errors and warnings that were triggered when
        compiling code guarded by ASAN_ENABLED in gcc.

        * wtf/Compiler.h:
        * wtf/Vector.h:
        (WTF::VectorBuffer::endOfBuffer):

2018-06-22  Darin Adler  <darin@apple.com>

        [Cocoa] Convert the small bit of Objective-C++ code in WTF to ARC
        https://bugs.webkit.org/show_bug.cgi?id=186961

        Reviewed by Anders Carlsson.

        * Configurations/Base.xcconfig: Turn on ARC.

        * wtf/cocoa/MemoryPressureHandlerCocoa.mm:
        (WTF::MemoryPressureHandler::uninstall): Remove calls to dispatch_release.
        (WTF::MemoryPressureHandler::holdOff): Ditto.

        * wtf/mac/MainThreadMac.mm:
        (WTF::initializeMainThreadPlatform): Remove call to retain.
        (WTF::initializeWebThreadPlatform): Ditto.

2018-06-22  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Use Ref<> for the result type of non-failing factory functions
        https://bugs.webkit.org/show_bug.cgi?id=186920

        Reviewed by Darin Adler.

        Use Ref<> instead of RefPtr<> if the `create` function do not return nullptr.

        * wtf/AutomaticThread.cpp:
        (WTF::AutomaticThreadCondition::create):
        (WTF::AutomaticThread::AutomaticThread):
        * wtf/AutomaticThread.h:
        * wtf/ParallelHelperPool.cpp:
        (WTF::ParallelHelperPool::Thread::Thread):
        * wtf/ParallelHelperPool.h:
        * wtf/WorkerPool.cpp:
        (WTF::WorkerPool::WorkerPool):
        * wtf/WorkerPool.h:
        * wtf/win/WorkQueueWin.cpp:
        (WTF::TimerContext::create):
        (WTF::WorkQueue::dispatchAfter):

2018-06-23  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Add user-defined literal for ASCIILiteral
        https://bugs.webkit.org/show_bug.cgi?id=186839

        Reviewed by Darin Adler.

        This patch adds user-defined literal for ASCIILiteral. We can create ASCIILiteral in the form of `"Hello World"_s`.
        And we remove public ASCIILiteral constructor. This change ensures that ASCIILiteral is created from literal.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Indenter.h:
        (WTF::Indenter::Indenter):
        * wtf/Logger.h:
        (WTF::LogArgument::toString):
        * wtf/MediaTime.cpp:
        (WTF::toJSONStringInternal):
        (WTF::MediaTimeRange::toJSONString const):
        * wtf/linux/MemoryFootprintLinux.cpp:
        (WTF::memoryFootprint):
        * wtf/text/ASCIILiteral.cpp: Copied from Source/WebCore/css/CSSUnsetValue.cpp.
        (WTF::ASCIILiteral::dump const):
        * wtf/text/ASCIILiteral.h: Copied from Source/WTF/wtf/Indenter.h.
        (WTF::ASCIILiteral::operator const char* const):
        (WTF::ASCIILiteral::fromLiteralUnsafe):
        (WTF::ASCIILiteral::null):
        (WTF::ASCIILiteral::characters const):
        (WTF::ASCIILiteral::ASCIILiteral):
        (WTF::StringLiterals::operator _s):
        * wtf/text/WTFString.cpp:
        (asciiDebug):
        * wtf/text/WTFString.h:
        (WTF::operator==):
        (WTF::operator!=):
        (WTF::ASCIILiteral::ASCIILiteral): Deleted.
        (WTF::ASCIILiteral::operator const char*): Deleted.
        * wtf/unix/LanguageUnix.cpp:
        (WTF::platformLanguage):

2018-06-22  Darin Adler  <darin@apple.com>

        [Cocoa] reduce unnecessary use of .mm source files in WTF, spruce up some implementation details
        https://bugs.webkit.org/show_bug.cgi?id=186924

        Reviewed by Anders Carlsson.

        * WTF.xcodeproj/project.pbxproj: Update for file and directory renames, file type changes,
        and deletions.

        * wtf/MemoryPressureHandler.cpp:
        (WTF::MemoryPressureHandler::holdOff): Deleted empty placeholder; this one is not needed.

        * wtf/PlatformMac.cmake: Update for file and directory renames, file type changes,
        and deletions.

        * wtf/cocoa/CPUTimeCocoa.cpp: Renamed from Source/WTF/wtf/cocoa/CPUTimeCocoa.mm.
        Reworked math to make better use of the Seconds class.

        * wtf/text/WTFString.h: Added a new inline version of the constructor that takes an NSString.
        This is identical to the one that takes a CFStringRef, so no need to keep both.

        * wtf/text/cocoa/StringImplCocoa.mm: Renamed from Source/WTF/wtf/text/mac/StringImplMac.mm.
        Also removed an unneeded include.

        * wtf/text/cocoa/StringViewCocoa.mm: Renamed from Source/WTF/wtf/text/mac/StringViewObjC.mm.

        * wtf/text/cocoa/TextBreakIteratorInternalICUCocoa.cpp: Renamed from
        Source/WTF/wtf/text/mac/TextBreakIteratorInternalICUMac.mm.

        * wtf/text/mac/StringMac.mm: Removed.

2018-06-21  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GLIB] improve get_type() fast path in WEBKIT_DEFINE_TYPE
        https://bugs.webkit.org/show_bug.cgi?id=186885

        Reviewed by Anders Carlsson.

        This is a backport of glib commit
        https://gitlab.gnome.org/GNOME/glib/commit/e924f777369710221c3e0a9d7bf40392a27d1fa4

        "The -fstack-protector-strong used in many distributions by default has a
        rather drastic slowdown of the fast path in generated _get_type()
        functions using G_DEFINE_* macros. The amount can vary by architecture,
        GCC version, and compiler flags.

        To work around this, and ensure a higher probability that our fast-path
        will match what we had previously, we need to break out the slow-path
        (registering the type) into a secondary function that is not a candidate
        for inlining.

        This ensures that the common case (type registered, return the GType id)
        is the hot path and handled in the prologue of the generated assembly even
        when -fstack-protector-strong is enabled."

        * wtf/glib/WTFGType.h:

2018-06-20  Yusuke Suzuki  <utatane.tea@gmail.com>

        [GTK][WPE][Nicosia] Add name for Nicosia Painting Threads
        https://bugs.webkit.org/show_bug.cgi?id=186836

        Reviewed by Carlos Garcia Campos.

        AutomaticThread can take a name for the generated threads now.
        This patch adds the above ability to WorkerPool.

        * wtf/WorkerPool.cpp:
        (WTF::WorkerPool::WorkerPool):
        * wtf/WorkerPool.h:
        (WTF::WorkerPool::create):
        (WTF::WorkerPool::name const):

2018-06-18  Jiewen Tan  <jiewen_tan@apple.com>

        Add a graceful exit for AuthenticationManager::initializeConnection
        https://bugs.webkit.org/show_bug.cgi?id=186632
        <rdar://problem/41041033>

        Reviewed by Brent Fulgham.

        * wtf/spi/darwin/XPCSPI.h:

2018-06-18  Carlos Alberto Lopez Perez  <clopez@igalia.com>

        [WTF] Remove workarounds needed to support libstdc++-4
        https://bugs.webkit.org/show_bug.cgi?id=186762

        Reviewed by Michael Catanzaro.

        Revert r226299, r226300 r226301 and r226302-

        * wtf/StdLibExtras.h:

2018-06-12  Darin Adler  <darin@apple.com>

        [Cocoa] Make some RetainPtr refinements to get more ready for ARC
        https://bugs.webkit.org/show_bug.cgi?id=186526

        Reviewed by Anders Carlsson.

        * wtf/RetainPtr.h: Improved the definition of autorelease so it does
        the right thing for both Objective-C types and non-Objective-C types.
        Also added bridgingAutorelease for when we want to autorelease as
        part of converting from a CF type to an Objective-C type. The two
        advantages of bridgingAutorelease are that it does not require an
        additional explicit __bridge cast and that it does not prevent the
        ARC objc_autoreleaseReturnValue optimization the way that doing an
        autorelease on the CF type would.

        * wtf/text/mac/StringImplMac.mm:
        (WTF::StringImpl::operator NSString *): Use bridgingAutorelease.

2018-06-15  Basuke Suzuki  <Basuke.Suzuki@sony.com>

        [WinCairo] Move unrelated features of WorkQueueWin into IPC::Connection
        https://bugs.webkit.org/show_bug.cgi?id=186582

        Remove unrelated feature from WorkQueueWin.

        Reviewed by Brent Fulgham.

        * wtf/PlatformWin.cmake: Remove WorkItemContext.*
        * wtf/WorkQueue.cpp:
        * wtf/WorkQueue.h:
        * wtf/win/Win32Handle.h:
        * wtf/win/WorkItemContext.cpp: Removed.
        * wtf/win/WorkItemContext.h: Removed.
        * wtf/win/WorkQueueWin.cpp:
        (WTF::WorkQueue::handleCallback): Deleted.
        (WTF::WorkQueue::registerHandle): Deleted.
        (WTF::WorkQueue::unregisterAndCloseHandle): Deleted.
        (WTF::WorkQueue::unregisterWaitAndDestroyItemSoon): Deleted.
        (WTF::WorkQueue::unregisterWaitAndDestroyItemCallback): Deleted.

2018-06-13  Keith Miller  <keith_miller@apple.com>

        AutomaticThread should have a way to provide a thread name
        https://bugs.webkit.org/show_bug.cgi?id=186604

        Reviewed by Filip Pizlo.

        AutomaticThread now has a virtual method to get a name, which can be
        overridden to provide a custom name to the thread.

        * wtf/AutomaticThread.cpp:
        (WTF::AutomaticThread::start):
        * wtf/AutomaticThread.h:
        * wtf/WorkerPool.cpp:

2018-06-11  Saam Barati  <sbarati@apple.com>

        The NaturalLoops algorithm only works when the list of blocks in a loop is de-duplicated
        https://bugs.webkit.org/show_bug.cgi?id=184829

        Reviewed by Michael Saboff.

        This patch switches NaturalLoops to walking over a block's predecessors
        instead of successors when building the initial list of loops and their
        headers. The algorithm broke down when we had a footer block with multiple
        control flow edges pointing to the same header. This made the loop data
        structure contain multiple entries for the same basic block. The algorithm
        breaks down when we end up in this state, since it means our way of detecting
        what loop is more inner is broken, since that check uses a loop's size.

        * wtf/NaturalLoops.h:
        (WTF::NaturalLoop::addBlock):
        (WTF::NaturalLoops::NaturalLoops):

2018-06-11  Keith Rollin  <krollin@apple.com>

        Add logging around internalError(const URL&)
        https://bugs.webkit.org/show_bug.cgi?id=186369
        <rdar://problem/40872046>

        Reviewed by Brent Fulgham.

        There are times when we receive bug reports where the user says that
        they are simply shown a page saying an internal error occurred. To
        help understand the circumstances of that error, add some logging to
        internalError() in WebErrors.cpp. This logging logs at the Error level
        that internalError() was called and then logs a backtrace.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h:

2018-06-11  Michael Saboff  <msaboff@apple.com>

        JavaScriptCore: Disable 32-bit JIT on Windows
        https://bugs.webkit.org/show_bug.cgi?id=185989

        Reviewed by Mark Lam.

        Fixed the CLOOP so it can work when COMPUTED_GOTOs are not supported.

        * wtf/Platform.h:

2018-06-09  Dan Bernstein  <mitz@apple.com>

        [Xcode] Clean up and modernize some build setting definitions
        https://bugs.webkit.org/show_bug.cgi?id=186463

        Reviewed by Sam Weinig.

        * Configurations/Base.xcconfig: Removed definition for macOS 10.11.
        * Configurations/DebugRelease.xcconfig: Ditto.

2018-06-08  Darin Adler  <darin@apple.com>

        [Cocoa] Remove all uses of NSAutoreleasePool as part of preparation for ARC
        https://bugs.webkit.org/show_bug.cgi?id=186436

        Reviewed by Anders Carlsson.

        * WTF.xcodeproj/project.pbxproj: Added FoundationSPI.h.

        * wtf/AutodrainedPool.h: Streamlined header a bit, added some comments.

        * wtf/PlatformMac.cmake: Added FoundationSPI.h.

        * wtf/cocoa/AutodrainedPool.cpp: Moved here from AutodrainedPoolMac.mm.
        (WTF::AutodrainedPool::AutodrainedPool): Use objc_autoreleasePoolPush/Pop instead of
        the NSAutoreleasePool class.
        (WTF::AutodrainedPool::~AutodrainedPool): Ditto.

         * wtf/spi/cocoa/FoundationSPI.h: Moved from Source/WebCore/PAL/pal/spi/cocoa/FoundationSPI.h.
         Changed both include and declarations so it's the objc_autoreleasePoolPush/Pop instead
         of the higher level NS functions that call them.

2018-06-08  Brian Burg  <bburg@apple.com>

        [Cocoa] Web Automation: include browser name and version in listing for automation targets
        https://bugs.webkit.org/show_bug.cgi?id=186204
        <rdar://problem/36950423>

        Reviewed by Darin Adler.

        * wtf/spi/cf/CFBundleSPI.h: Add needed infoDictionary key values.

2018-06-07  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Add WorkerPool
        https://bugs.webkit.org/show_bug.cgi?id=174569

        Reviewed by Carlos Garcia Campos.

        This patch adds WorkerPool, which is a thread pool that consists of AutomaticThread.
        Since it is based on AutomaticThread, this WorkerPool can take `timeout`: once `timeout`
        passes without any tasks, threads in WorkerPool will be destroyed.

        We add shouldSleep handler to AutomaticThread to make destruction of threads in WorkerPool moderate.
        Without this, all threads are destroyed at once after `timeout` passes.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/AutomaticThread.cpp:
        (WTF::AutomaticThread::AutomaticThread):
        (WTF::AutomaticThread::start):
        * wtf/AutomaticThread.h:
        * wtf/CMakeLists.txt:
        * wtf/WorkerPool.cpp: Added.
        (WTF::WorkerPool::WorkerPool):
        (WTF::WorkerPool::~WorkerPool):
        (WTF::WorkerPool::shouldSleep):
        (WTF::WorkerPool::postTask):
        * wtf/WorkerPool.h: Added.
        (WTF::WorkerPool::create):

2018-06-07  Chris Dumez  <cdumez@apple.com>

        Add base class to get WeakPtrFactory member and avoid some boilerplate code
        https://bugs.webkit.org/show_bug.cgi?id=186407

        Reviewed by Brent Fulgham.

        Add CanMakeWeakPtr base class to get WeakPtrFactory member and its getter, in
        order to avoid some boilerplate code in every class needing a WeakPtrFactory.
        This also gets rid of old-style createWeakPtr() methods in favor of the newer
        makeWeakPtr().

        * wtf/WeakPtr.h:
        (WTF::CanMakeWeakPtr::weakPtrFactory const):
        (WTF::CanMakeWeakPtr::weakPtrFactory):

2018-06-07  Tadeu Zagallo  <tzagallo@apple.com>

        Don't try to allocate JIT memory if we don't have the JIT entitlement
        https://bugs.webkit.org/show_bug.cgi?id=182605
        <rdar://problem/38271229>

        Reviewed by Mark Lam.

        Move processHasEntitlement from Source/WebKit/Shared/mac/SandboxUtilities.h
        into WTF so JavaScriptCore can also use it.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/PlatformMac.cmake:
        * wtf/cocoa/Entitlements.cpp:
        (WTF::processHasEntitlement):
        * wtf/cocoa/Entitlements.h:
        * wtf/spi/cocoa/SecuritySPI.h:

2018-06-05  Darin Adler  <darin@apple.com>

        [Cocoa] Retire DispatchPtr, and add more move semantics and simpler #ifs to other smart pointers
        https://bugs.webkit.org/show_bug.cgi?id=186324

        Reviewed by Anders Carlsson.

        * WTF.xcodeproj/project.pbxproj: Removed DispatchPtr.h.
        * wtf/BlockPtr.h: Remove unneeded checks for __OBJC__. Added some use
        of WTFMove.
        * wtf/CMakeLists.txt: Removed DispatchPtr.h.
        * wtf/DispatchPtr.h: Removed. We no longer need to support Mavericks.
        * wtf/OSObjectPtr.h: Remove unneeded checks for __OBJC__. Added some use
        of WTFMove.

2018-06-05  Darin Adler  <darin@apple.com>

        [Cocoa] More preparation for ARC, focusing on WebKit and smart pointers
        https://bugs.webkit.org/show_bug.cgi?id=186314

        Reviewed by Anders Carlsson.

        * wtf/BlockPtr.h: Put Block_copy/release calls into #if since they are
        not needed under ARC.

        * wtf/OSObjectPtr.h: Added constructor and assignment operator so we can
        work with OS objects without adopting them.

2018-06-05  Darin Adler  <darin@apple.com>

        [Cocoa] Improve some soft linking compatibility with ARC
        https://bugs.webkit.org/show_bug.cgi?id=186309

        Reviewed by Anders Carlsson.

        * wtf/cocoa/SoftLinking.h: Updated the SOFT_LINK_CONSTANT family of
        macros to use a const type. This increases the chance that they will
        work without triggering ARC compilation errors since it's easier to
        get the type right for read-only access than for read/write.

2018-06-05  Youenn Fablet  <youenn@apple.com>

        ServiceWorker registration should store any script fetched through importScripts
        https://bugs.webkit.org/show_bug.cgi?id=182444
        <rdar://problem/37164835>

        Reviewed by Chris Dumez.

        * wtf/persistence/PersistentCoders.h:

2018-06-04  Darin Adler  <darin@apple.com>

        [Cocoa] Improve smart pointer support for ARC (OSObjectPtr/DispatchPtr)
        https://bugs.webkit.org/show_bug.cgi?id=186300

        Reviewed by Daniel Bates.

        * wtf/DispatchPtr.h: Don't call dispatch_retain or dispatch_release
        since ARC will automatically do it for us in the same places we are
        doing it here.

        * wtf/OSObjectPtr.h:
        (WTF::retainOSObject): Don't call os_retain since ARC will do it.
        (WTF::releaseOSObject): Don't call os_release since ARC will do it.

2018-05-31  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r232212.
        https://bugs.webkit.org/show_bug.cgi?id=186153

        broke build (Requested by alexchristensen on #webkit).

        Reverted changeset:

        "JavaScriptCore: Disable 32-bit JIT on Windows"
        https://bugs.webkit.org/show_bug.cgi?id=185989
        https://trac.webkit.org/changeset/232212

2018-05-30  Keith Miller  <keith_miller@apple.com>

        LLInt get_by_id prototype caching doesn't properly handle changes
        https://bugs.webkit.org/show_bug.cgi?id=186112

        Reviewed by Filip Pizlo.

        Mark some methods const.

        * wtf/Bag.h:
        (WTF::Bag::begin const):
        (WTF::Bag::end const):
        (WTF::Bag::unwrappedHead const):
        (WTF::Bag::end): Deleted.
        (WTF::Bag::unwrappedHead): Deleted.

2018-05-30  Alex Christensen  <achristensen@webkit.org>

        Reduce String allocations
        https://bugs.webkit.org/show_bug.cgi?id=186059

        Reviewed by Darin Adler.

        * wtf/text/StringView.cpp:
        (WTF::convertASCIICase):
        (WTF::StringView::convertToASCIILowercase const):
        (WTF::StringView::convertToASCIIUppercase const):
        * wtf/text/StringView.h:
        * wtf/text/cf/StringViewCF.cpp:
        (WTF::StringView::createCFString const):

2018-05-30  Dominik Infuehr  <dinfuehr@igalia.com>

        [MIPS] Fix build on MIPS32r1
        https://bugs.webkit.org/show_bug.cgi?id=185944

        Reviewed by Yusuke Suzuki.

        Added WTF_MIPS_ISA_REV_AT_LEAST to test for certain release or later.

        * wtf/Platform.h:

2018-05-29  Tim Horton  <timothy_horton@apple.com>

        Fix the build
        https://bugs.webkit.org/show_bug.cgi?id=186078

        Unreviewed build fix.

        * wtf/Platform.h:

2018-05-29  Saam Barati  <sbarati@apple.com>

        JSC should put bmalloc's scavenger into mini mode
        https://bugs.webkit.org/show_bug.cgi?id=185988

        Reviewed by Michael Saboff.

        * wtf/FastMalloc.cpp:
        (WTF::fastEnableMiniMode):
        * wtf/FastMalloc.h:

2018-05-29  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, follow-up after r232244
        https://bugs.webkit.org/show_bug.cgi?id=186023

        _BitScanReverse64 is available only in X86_64 and ARM.

        * wtf/MathExtras.h:
        (WTF::clz64):

2018-05-27  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Add clz32 / clz64 for MSVC
        https://bugs.webkit.org/show_bug.cgi?id=186023

        Reviewed by Daniel Bates.

        This patch adds efficient implementations of clz32 and clz64 for MSVC.
        While MSVC has _lzcnt intrinsic, it is only valid if the CPU has lzcnt instruction.
        Instead of checking cpuid here, we just use _BitScanReverse and _BitScanReverse64.

        * wtf/MathExtras.h:
        (WTF::clz32):
        (WTF::clz64):

2018-05-26  Filip Pizlo  <fpizlo@apple.com>

        testair sometimes crashes due to races in initialization of ARC4RandomNumberGenerator
        https://bugs.webkit.org/show_bug.cgi?id=186014

        Reviewed by Yusuke Suzuki.
        
        testair launches a bunch of threads and the threads do B3 things that use random numbers.
        Sometimes two threads will initialize the random number generator at the same time, because
        that's what happens when you use static NeverDestroyed<>.
        
        This changes that code to use std::call_once to initialize the shared
        ARC4RandomNumberGenerator.
        
        Also, this adds a diagnostic message to the lock's assertion. This assertion was the symptom
        of the race, and knowing the state of the lock when the assertion fired gave a darn good clue
        about what was going on: the lock's value was 0 at time of unlock, implying that another
        thread reinitialized the lock to zero by rerunning the constructor.

        * wtf/CryptographicallyRandomNumber.cpp:
        * wtf/LockAlgorithmInlines.h:
        (WTF::Hooks>::unlockSlow):

2018-05-25  Michael Saboff  <msaboff@apple.com>

        JavaScriptCore: Disable 32-bit JIT on Windows
        https://bugs.webkit.org/show_bug.cgi?id=185989

        Reviewed by Saam Barati.

        * wtf/Platform.h:

2018-05-24  Carlos Alberto Lopez Perez  <clopez@igalia.com>

        [GTK][WPE] Memory pressure monitor doesn't reliable notify all the subprocesses
        https://bugs.webkit.org/show_bug.cgi?id=184261

        Reviewed by Carlos Garcia Campos.

        Receive the memory pressure notifications from the UIProcess memory monitor via WebKit IPC.

        * wtf/MemoryPressureHandler.h:
        * wtf/linux/MemoryPressureHandlerLinux.cpp:
        (WTF::MemoryPressureHandler::triggerMemoryPressureEvent):
        (WTF::MemoryPressureHandler::install):
        (WTF::MemoryPressureHandler::uninstall):

2018-05-24  Jiewen Tan  <jiewen_tan@apple.com>

        Adopt SecKeyProxy SPI in certificate based challenge response code
        https://bugs.webkit.org/show_bug.cgi?id=185848
        <rdar://problem/34586181>

        Reviewed by Alex Christensen.

        Add a condition macro to determine if SecKeyProxy SPI exists.

        * wtf/Platform.h:

2018-05-23  Eric Carlson  <eric.carlson@apple.com>

        Avoid loading AVFoundation to check supported MIME types if possible
        https://bugs.webkit.org/show_bug.cgi?id=185839
        <rdar://problem/40182010>

        Reviewed by Jer Noble.

        * wtf/cocoa/SoftLinking.h: Add SOFT_LINK_FRAMEWORK_OPTIONAL_PREFLIGHT.

2018-05-23  Filip Pizlo  <fpizlo@apple.com>

        Speed up JetStream/base64
        https://bugs.webkit.org/show_bug.cgi?id=185914

        Reviewed by Michael Saboff.
        
        Make Vector<>::append ALWAYS_INLINE.

        * wtf/Vector.h:
        (WTF::Vector::append):
        (WTF::minCapacity>::expandCapacity):
        (WTF::minCapacity>::append):
        (WTF::minCapacity>::tryAppend):

2018-05-23  Michael Saboff  <msaboff@apple.com>

        Date.parse() doesn't properly handle input outside of ES Spec limits
        https://bugs.webkit.org/show_bug.cgi?id=185868

        Reviewed by Mark Lam.

        Clamped date creation to +/-100,000,000 days relative to midnight at the beginning
        of 01 January, 1970 UTC as per ecma262/#sec-time-values-and-time-range and
        ecma262/#sec-date-time-string-format.

        * wtf/DateMath.cpp:
        (WTF::ymdhmsToSeconds):
        (WTF::parseES5DateFromNullTerminatedCharacters):

2018-05-22  Michael Catanzaro  <mcatanzaro@igalia.com>

        Prohibit shrinking the FastBitVector
        https://bugs.webkit.org/show_bug.cgi?id=181020

        Reviewed by Oliver Hunt.

        Prohibit shrinking the FastBitVector. It's not prepared for this and the current usage does
        not require it.

        * wtf/FastBitVector.cpp:
        (WTF::FastBitVectorWordOwner::resizeSlow):

2018-05-22  Mark Lam  <mark.lam@apple.com>

        StringImpl utf8 conversion should not fail silently.
        https://bugs.webkit.org/show_bug.cgi?id=185888
        <rdar://problem/40464506>

        Reviewed by Filip Pizlo.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/PrintStream.cpp:
        (WTF::printExpectedCStringHelper):
        (WTF::printInternal):
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::utf8Impl):
        (WTF::StringImpl::utf8ForCharacters):
        (WTF::StringImpl::tryUtf8ForRange const):
        (WTF::StringImpl::tryUtf8 const):
        (WTF::StringImpl::utf8 const):
        (WTF::StringImpl::utf8ForRange const): Deleted.
        * wtf/text/StringImpl.h:
        * wtf/text/StringView.cpp:
        (WTF::StringView::tryUtf8 const):
        (WTF::StringView::utf8 const):
        * wtf/text/StringView.h:
        * wtf/text/UTF8ConversionError.h: Added.
        * wtf/text/WTFString.cpp:
        (WTF::String::tryUtf8 const):
        (WTF::String::utf8 const):
        * wtf/text/WTFString.h:

2018-05-22  Chris Dumez  <cdumez@apple.com>

        Regression(AsyncPolicyDelegates): Box.app login Window is blank
        https://bugs.webkit.org/show_bug.cgi?id=185832
        <rdar://problem/40307871>

        Reviewed by Geoffrey Garen.

        Moved WeakObjCPtr.h from WebKit2 to WTF with RetainPtr.h, so that it can be used
        in WebKitLegacy code.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/WeakObjCPtr.h: Renamed from Source/WebKit/Shared/mac/WeakObjCPtr.h.

2018-05-22  Filip Pizlo  <fpizlo@apple.com>

        Get rid of TLCs
        https://bugs.webkit.org/show_bug.cgi?id=185846

        Rubber stamped by Geoffrey Garen.

        * wtf/Platform.h:

2018-05-22  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r232052.

        Breaks internal builds.

        Reverted changeset:

        "Use more C++17"
        https://bugs.webkit.org/show_bug.cgi?id=185176
        https://trac.webkit.org/changeset/232052

2018-05-21  Yusuke Suzuki  <utatane.tea@gmail.com>

        Use more C++17
        https://bugs.webkit.org/show_bug.cgi?id=185176

        Reviewed by JF Bastien.

        * Configurations/Base.xcconfig:
        * wtf/StdLibExtras.h:

2018-05-18  Filip Pizlo  <fpizlo@apple.com>

        DFG should inline InstanceOf ICs
        https://bugs.webkit.org/show_bug.cgi?id=185695

        Reviewed by Yusuke Suzuki.
        
        I found myself needing a way to represent bottom/false/true/top, so I created it.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/BooleanLattice.h: Added.
        (WTF::lubBooleanLattice):
        (WTF::printInternal):
        * wtf/CMakeLists.txt:

2018-05-17  Jiewen Tan  <jiewen_tan@apple.com>

        Convert CertificateInfo into Credential in UI Process instead of Networking Process
        https://bugs.webkit.org/show_bug.cgi?id=185662
        <rdar://problem/40275561>

        Reviewed by Alex Christensen.

        Remove marco HAVE_SEC_IDENTITY since it is no longer useful.

        * wtf/Platform.h:

2018-05-17  Zalan Bujtas  <zalan@apple.com>

        Add ASSERT_NOT_IMPLEMENTED_YET() macro
        https://bugs.webkit.org/show_bug.cgi?id=185713

        Reviewed by Antti Koivisto.

        To mark unimplemented code paths.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h:

2018-05-16  Andy VanWagoner  <andy@vanwagoner.family>

        Add support for Intl NumberFormat formatToParts
        https://bugs.webkit.org/show_bug.cgi?id=185375

        Reviewed by Yusuke Suzuki.

        Add flag for NumberFormat formatToParts.

        * wtf/FeatureDefines.h:

2018-05-16  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, follow-up after r231762
        https://bugs.webkit.org/show_bug.cgi?id=185589

        Addresses darin's suggestions to improve timeClip.

        * wtf/DateMath.cpp:
        (WTF::timeClip):

2018-05-14  Yusuke Suzuki  <utatane.tea@gmail.com>

        [Win] Use C++17 in MSVC
        https://bugs.webkit.org/show_bug.cgi?id=185232

        Reviewed by Alex Christensen.

        Disable some WebKit defined C++17 features for MSVC.

        * wtf/StdLibExtras.h:

2018-05-14  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] timeClip(-0) should produce +0
        https://bugs.webkit.org/show_bug.cgi?id=185589

        Reviewed by Saam Barati.

        According to the spec[1], timeClip(-0) should produce +0.
        We achieve this by adding 0.0 to the result of trunc(t).

        [1]: https://tc39.github.io/ecma262/#sec-timeclip

        * wtf/DateMath.cpp:
        (WTF::timeClip):

2018-05-13  Geoffrey Garen  <ggaren@apple.com>

        Simplified Mach exception handling
        https://bugs.webkit.org/show_bug.cgi?id=185595

        Reviewed by Keith Miller.

        * wtf/threads/Signals.cpp:
        (WTF::startMachExceptionHandlerThread): Use mach_msg_server_once instead
        of duplicating its functionality. Separate error handling logic from
        program logic to help program logic stand out. Use
        DISPATCH_TARGET_QUEUE_* instead of explicitly fetching a queue.

        Also, we don't need the high priority queue. The kernel donates a
        priority voucher from the exception thread to the receiver thread, and
        mach_msg_server_once takes care to forward that voucher.

2018-05-14  Zan Dobersek  <zdobersek@igalia.com>

        [GTK] REGRESSION(r231170) Build broken with Clang 5.0
        https://bugs.webkit.org/show_bug.cgi?id=185198

        Reviewed by Michael Catanzaro.

        * wtf/Compiler.h:
        * wtf/Forward.h: Delete the std::optional forward declaration that is
        potentially incompatible with definition provided by the standard library.
        * wtf/Hasher.h:
        * wtf/StdLibExtras.h: In addition to the remaining C++14 configurations,
        also use custom std::in_place_t implementation when compiling with
        libstdc++ 6.x, which doesn't provide its own.

2018-05-13  Filip Pizlo  <fpizlo@apple.com>

        Disable pointer poisoning
        https://bugs.webkit.org/show_bug.cgi?id=185586

        Reviewed by Yusuke Suzuki.
        
        This seems like a 0.3% speed-up on microbenchmarks. It seems like it may be a small speed-up on
        other tests, too.

        * wtf/Platform.h:

2018-05-11  Chris Dumez  <cdumez@apple.com>

        REGRESSION (async policy delegate): Revoking an object URL immediately after triggering download breaks file download
        https://bugs.webkit.org/show_bug.cgi?id=185531
        <rdar://problem/39909589>

        Reviewed by Geoffrey Garen.

        Add a default constructor for CompletionHandlerCallingScope, for convenience.

        * wtf/CompletionHandler.h:

2018-05-11  Saam Barati  <sbarati@apple.com>

        Don't allocate value profiles when the JIT is disabled
        https://bugs.webkit.org/show_bug.cgi?id=185525

        Reviewed by Michael Saboff.

        * wtf/RefCountedArray.h:
        (WTF::RefCountedArray::RefCountedArray):

2018-05-10  Tim Horton  <timothy_horton@apple.com>

        Fix the build after r231393
        https://bugs.webkit.org/show_bug.cgi?id=185519
        <rdar://problem/40131741>

        Reviewed by Simon Fraser.

        * wtf/Platform.h:

2018-05-09  Michael Catanzaro  <mcatanzaro@igalia.com>

        [WPE] Build cleanly with GCC 8 and ICU 60
        https://bugs.webkit.org/show_bug.cgi?id=185462

        Reviewed by Carlos Alberto Lopez Perez.

        * wtf/HashTable.h:
        (WTF::HashTableBucketInitializer<true>::initialize): Since -Wclass-memaccess warning. This
        is probably safe enough, since it's for an empty bucket.
        * wtf/StdLibExtras.h:
        (WTF::bitwise_cast): Silence -Wclass-memaccess as we use type traits to ensure safety here.
        * wtf/Vector.h: Ditto, all uses are safe.
        * wtf/glib/WTFGType.h: Silence -Wcast-function-type.

2018-05-09  Yusuke Suzuki  <utatane.tea@gmail.com>

        [ARMv7] Drop ARMv7 disassembler in favor of capstone
        https://bugs.webkit.org/show_bug.cgi?id=185423

        Reviewed by Michael Catanzaro.

        Remove USE_ARMV7_DISASSEMBLER. Just use Capstone.

        * wtf/Platform.h:

2018-05-06  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC][GTK][JSCONLY] Use capstone disassembler
        https://bugs.webkit.org/show_bug.cgi?id=185283

        Reviewed by Michael Catanzaro.

        Add USE_CAPSTONE used for MIPS and ARM.

        * wtf/Platform.h:

2018-05-09  Antti Koivisto  <antti@apple.com>

        Add OptionSet::operator& and operator bool
        https://bugs.webkit.org/show_bug.cgi?id=185306

        Reviewed by Anders Carlsson.

        This is primarily to allow writing

            if (options & Option:A)

        instead of

            if (options.contains(Option:A))

        This is consistent with other OptionSet operators.

        * wtf/OptionSet.h:
        (WTF::OptionSet::operator bool):
        (WTF::OptionSet::operator&):

        Also remove T versions of operator| and operator-, they are not needed due to
        implicit conversion from T to OptionSet<T>.

2018-05-06  Filip Pizlo  <fpizlo@apple.com>

        InPlaceAbstractState::beginBasicBlock shouldn't have to clear any abstract values
        https://bugs.webkit.org/show_bug.cgi?id=185365

        Reviewed by Saam Barati.
        
        Fix some inlining goof-ups.
        
        Rolling back in after fixing cloop build.

        * wtf/TinyPtrSet.h:
        (WTF::TinyPtrSet::add):
        (WTF::TinyPtrSet::merge):
        (WTF::TinyPtrSet::addOutOfLine):
        (WTF::TinyPtrSet::mergeOtherOutOfLine):

2018-05-08  Dean Jackson  <dino@apple.com>

        Use thumbnails in System Previews
        https://bugs.webkit.org/show_bug.cgi?id=185397
        <rdar://problem/40039376>

        Reviewed by Jon Lee.

        SYSTEM_PREVIEW is only available on some platforms.

        * wtf/Platform.h:

2018-05-08  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r231468.

        Broke the CLoop build

        Reverted changeset:

        "InPlaceAbstractState::beginBasicBlock shouldn't have to clear
        any abstract values"
        https://bugs.webkit.org/show_bug.cgi?id=185365
        https://trac.webkit.org/changeset/231468

2018-05-07  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSCONLY] Enable ARMv7 DFG
        https://bugs.webkit.org/show_bug.cgi?id=185415

        Reviewed by Mark Lam.

        Enable ARMv7 DFG JIT by default on Linux and FreeBSD.

        * wtf/Platform.h:

2018-05-06  Filip Pizlo  <fpizlo@apple.com>

        InPlaceAbstractState::beginBasicBlock shouldn't have to clear any abstract values
        https://bugs.webkit.org/show_bug.cgi?id=185365

        Reviewed by Saam Barati.
        
        Fix some inlining goof-ups.

        * wtf/TinyPtrSet.h:
        (WTF::TinyPtrSet::add):
        (WTF::TinyPtrSet::merge):
        (WTF::TinyPtrSet::addOutOfLine):
        (WTF::TinyPtrSet::mergeOtherOutOfLine):

2018-05-06  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Embed default atomic string table in Thread
        https://bugs.webkit.org/show_bug.cgi?id=185349

        Reviewed by Darin Adler.

        Do not need to allocate AtomicStringTable separate from Thread
        since the table's lifetime is completely the same as Thread.

        This patch just embeds it as a data member of Thread.

        * wtf/Threading.cpp:
        (WTF::Thread::initializeInThread):
        (WTF::Thread::didExit):
        * wtf/Threading.h:
        * wtf/text/AtomicStringTable.cpp:
        (WTF::AtomicStringTable::create): Deleted.
        (WTF::AtomicStringTable::destroy): Deleted.
        * wtf/text/AtomicStringTable.h:

2018-05-06  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Use static initializers for WTF::Mutex and WTF::ThreadCondition
        https://bugs.webkit.org/show_bug.cgi?id=185361

        Reviewed by Sam Weinig.

        Use static initializers for WTF::Mutex and WTF::ThreadCondition to make
        constructors of them simple and constexpr.

        * wtf/ThreadingPrimitives.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::Mutex::Mutex): Deleted.
        (WTF::ThreadCondition::ThreadCondition): Deleted.
        * wtf/ThreadingWin.cpp:
        (WTF::Mutex::Mutex): Deleted.
        (WTF::ThreadCondition::ThreadCondition): Deleted.

2018-05-04  Tim Horton  <timothy_horton@apple.com>

        Shift to a lower-level framework for simplifying URLs
        https://bugs.webkit.org/show_bug.cgi?id=185334

        Reviewed by Dan Bernstein.

        * wtf/Platform.h:

2018-05-04  Eric Carlson  <eric.carlson@apple.com>

        Log media time range as JSON
        https://bugs.webkit.org/show_bug.cgi?id=185321
        <rdar://problem/39986746>

        Reviewed by Youenn Fablet.

        * wtf/MediaTime.cpp:
        (WTF::toJSONStringInternal): Extract guts of MediaTime::toJSONString to this static function
        so it can be used by MediaTimeRange::toJSONString as well.
        (WTF::MediaTime::toJSONString const):
        (WTF::MediaTimeRange::toJSONString const):
        * wtf/MediaTime.h:

2018-05-04  Antti Koivisto  <antti@apple.com>

        OptionsSet initializer list constructor should be constexpr
        https://bugs.webkit.org/show_bug.cgi?id=185298

        Reviewed by Anders Carlsson.

        * wtf/OptionSet.h:
        (WTF::OptionSet::OptionSet):

2018-05-03  Yusuke Suzuki  <utatane.tea@gmail.com>

        Use default std::optional if it is provided
        https://bugs.webkit.org/show_bug.cgi?id=185159

        Reviewed by Michael Catanzaro.

        * wtf/Expected.h:
        * wtf/Optional.h:
        Do not use <optional> for clang currently.
        (WTF::valueOrCompute):

2018-05-03  Filip Pizlo  <fpizlo@apple.com>

        Strings should not be allocated in a gigacage
        https://bugs.webkit.org/show_bug.cgi?id=185218

        Reviewed by Saam Barati.
        
        * WTF.xcodeproj/project.pbxproj:
        * wtf/Deque.h:
        * wtf/Forward.h:
        * wtf/Gigacage.h:
        (Gigacage::name):
        (Gigacage::basePtr):
        * wtf/Vector.h:
        (WTF::VectorBufferBase::allocateBuffer):
        (WTF::VectorBufferBase::tryAllocateBuffer):
        (WTF::VectorBufferBase::reallocateBuffer):
        (WTF::VectorBufferBase::deallocateBuffer):
        (WTF::minCapacity>::Vector):
        (WTF::=):
        (WTF::minCapacity>::contains const):
        (WTF::minCapacity>::findMatching const):
        (WTF::minCapacity>::find const):
        (WTF::minCapacity>::reverseFind const):
        (WTF::minCapacity>::appendIfNotContains):
        (WTF::minCapacity>::fill):
        (WTF::minCapacity>::appendRange):
        (WTF::minCapacity>::expandCapacity):
        (WTF::minCapacity>::tryExpandCapacity):
        (WTF::minCapacity>::resize):
        (WTF::minCapacity>::resizeToFit):
        (WTF::minCapacity>::shrink):
        (WTF::minCapacity>::grow):
        (WTF::minCapacity>::asanSetInitialBufferSizeTo):
        (WTF::minCapacity>::asanSetBufferSizeToFullCapacity):
        (WTF::minCapacity>::asanBufferSizeWillChangeTo):
        (WTF::minCapacity>::reserveCapacity):
        (WTF::minCapacity>::tryReserveCapacity):
        (WTF::minCapacity>::reserveInitialCapacity):
        (WTF::minCapacity>::shrinkCapacity):
        (WTF::minCapacity>::append):
        (WTF::minCapacity>::tryAppend):
        (WTF::minCapacity>::constructAndAppend):
        (WTF::minCapacity>::tryConstructAndAppend):
        (WTF::minCapacity>::appendSlowCase):
        (WTF::minCapacity>::constructAndAppendSlowCase):
        (WTF::minCapacity>::tryConstructAndAppendSlowCase):
        (WTF::minCapacity>::uncheckedAppend):
        (WTF::minCapacity>::appendVector):
        (WTF::minCapacity>::insert):
        (WTF::minCapacity>::insertVector):
        (WTF::minCapacity>::remove):
        (WTF::minCapacity>::removeFirst):
        (WTF::minCapacity>::removeFirstMatching):
        (WTF::minCapacity>::removeAll):
        (WTF::minCapacity>::removeAllMatching):
        (WTF::minCapacity>::reverse):
        (WTF::minCapacity>::map const):
        (WTF::minCapacity>::releaseBuffer):
        (WTF::minCapacity>::checkConsistency):
        (WTF::swap):
        (WTF::operator==):
        (WTF::operator!=):
        (WTF::removeRepeatedElements):
        (WTF::Malloc>::Vector): Deleted.
        (WTF::Malloc>::contains const): Deleted.
        (WTF::Malloc>::findMatching const): Deleted.
        (WTF::Malloc>::find const): Deleted.
        (WTF::Malloc>::reverseFind const): Deleted.
        (WTF::Malloc>::appendIfNotContains): Deleted.
        (WTF::Malloc>::fill): Deleted.
        (WTF::Malloc>::appendRange): Deleted.
        (WTF::Malloc>::expandCapacity): Deleted.
        (WTF::Malloc>::tryExpandCapacity): Deleted.
        (WTF::Malloc>::resize): Deleted.
        (WTF::Malloc>::resizeToFit): Deleted.
        (WTF::Malloc>::shrink): Deleted.
        (WTF::Malloc>::grow): Deleted.
        (WTF::Malloc>::asanSetInitialBufferSizeTo): Deleted.
        (WTF::Malloc>::asanSetBufferSizeToFullCapacity): Deleted.
        (WTF::Malloc>::asanBufferSizeWillChangeTo): Deleted.
        (WTF::Malloc>::reserveCapacity): Deleted.
        (WTF::Malloc>::tryReserveCapacity): Deleted.
        (WTF::Malloc>::reserveInitialCapacity): Deleted.
        (WTF::Malloc>::shrinkCapacity): Deleted.
        (WTF::Malloc>::append): Deleted.
        (WTF::Malloc>::tryAppend): Deleted.
        (WTF::Malloc>::constructAndAppend): Deleted.
        (WTF::Malloc>::tryConstructAndAppend): Deleted.
        (WTF::Malloc>::appendSlowCase): Deleted.
        (WTF::Malloc>::constructAndAppendSlowCase): Deleted.
        (WTF::Malloc>::tryConstructAndAppendSlowCase): Deleted.
        (WTF::Malloc>::uncheckedAppend): Deleted.
        (WTF::Malloc>::appendVector): Deleted.
        (WTF::Malloc>::insert): Deleted.
        (WTF::Malloc>::insertVector): Deleted.
        (WTF::Malloc>::remove): Deleted.
        (WTF::Malloc>::removeFirst): Deleted.
        (WTF::Malloc>::removeFirstMatching): Deleted.
        (WTF::Malloc>::removeAll): Deleted.
        (WTF::Malloc>::removeAllMatching): Deleted.
        (WTF::Malloc>::reverse): Deleted.
        (WTF::Malloc>::map const): Deleted.
        (WTF::Malloc>::releaseBuffer): Deleted.
        (WTF::Malloc>::checkConsistency): Deleted.
        * wtf/text/AtomicStringImpl.h:
        * wtf/text/CString.cpp:
        (WTF::CStringBuffer::createUninitialized):
        * wtf/text/CString.h:
        * wtf/text/StringBuffer.h:
        (WTF::StringBuffer::StringBuffer):
        (WTF::StringBuffer::~StringBuffer):
        (WTF::StringBuffer::resize):
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::~StringImpl):
        (WTF::StringImpl::destroy):
        (WTF::StringImpl::createUninitializedInternalNonEmpty):
        (WTF::StringImpl::reallocateInternal):
        (WTF::StringImpl::releaseAssertCaged const): Deleted.
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::createSubstringSharingImpl):
        (WTF::StringImpl::tryCreateUninitialized):
        (WTF::StringImpl::adopt):
        (WTF::StringImpl::assertCaged const): Deleted.
        * wtf/text/StringMalloc.cpp: Removed.
        * wtf/text/StringMalloc.h: Removed.
        * wtf/text/StringVector.h: Removed.
        * wtf/text/SymbolImpl.h:
        * wtf/text/UniquedStringImpl.h:
        * wtf/text/WTFString.h:
        (WTF::String::adopt):
        (WTF::String::assertCaged const): Deleted.
        (WTF::String::releaseAssertCaged const): Deleted.

2018-05-03  Wenson Hsieh  <wenson_hsieh@apple.com>

        Ads in NYTimes app are shifted downwards by the scroll view's top content inset
        https://bugs.webkit.org/show_bug.cgi?id=185251
        <rdar://problem/39062357>

        Reviewed by Tim Horton.

        Add a new DYLD_IOS_VERSION macro definition for previous or non-internal SDKs.

        * wtf/spi/darwin/dyldSPI.h:

2018-05-03  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r231197.

        The test added with this change crashes on the 32-bit JSC bot.

        Reverted changeset:

        "Correctly detect string overflow when using the 'Function'
        constructor"
        https://bugs.webkit.org/show_bug.cgi?id=184883
        https://trac.webkit.org/changeset/231197

2018-05-03  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r231223 and r231288.
        https://bugs.webkit.org/show_bug.cgi?id=185256

        The change in r231223 breaks internal builds, and r231288 is a
        dependent change. (Requested by ryanhaddad on #webkit).

        Reverted changesets:

        "Use default std::optional if it is provided"
        https://bugs.webkit.org/show_bug.cgi?id=185159
        https://trac.webkit.org/changeset/231223

        "Use pointer instead of
        std::optional<std::reference_wrapper<>>"
        https://bugs.webkit.org/show_bug.cgi?id=185186
        https://trac.webkit.org/changeset/231288

2018-05-02  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r231251.
        https://bugs.webkit.org/show_bug.cgi?id=185229

        __cpp_lib_optional should be used after including <optional>
        since it is defined in <optional> (Requested by yusukesuzuki
        on #webkit).

        Reverted changeset:

        "Follow-up build fix for r231223"
        https://bugs.webkit.org/show_bug.cgi?id=185159
        https://trac.webkit.org/changeset/231251

2018-05-02  Jonathan Bedard  <jbedard@apple.com>

        Follow-up build fix for r231223
        https://bugs.webkit.org/show_bug.cgi?id=185159
        <rdar://problem/39891074>

        Unreviewed build fix.

        We should be consistent about when we include <optional> vs define our own.

        * wtf/Optional.h:

2018-05-02  Jer Noble  <jer.noble@apple.com>

        Enable HAVE_AVKIT for the MINIMAL_SIMULATOR
        https://bugs.webkit.org/show_bug.cgi?id=185183

        Reviewed by Daniel Bates.

        * wtf/Platform.h:

2018-05-01  Yusuke Suzuki  <utatane.tea@gmail.com>

        Use default std::optional if it is provided
        https://bugs.webkit.org/show_bug.cgi?id=185159

        Reviewed by JF Bastien.

        Now C++17 flag is enabled. It means that any standard libraries can use <optional> internally.
        If we define std::optional regardless of the existence of the standard library's <optional>,
        it causes compile errors. For example, in GCC 7 (specifically GCC 7.3.0) environment,
        <optional> is included in <unordered_map>.
        We do not define std::optional in WebKit side if <optional> is offered.

        And we also remove std::optional<T&> use since this is not accepted in C++17. Use
        std::optional<std::reference_wrapper<T>> instead.

        * wtf/Expected.h:
        constexpr does not mean const in C++17.

        * wtf/Optional.h:
        Do not define std::optional if <optional> is provided.

        (WTF::valueOrCompute):

2018-05-01  Robin Morisset  <rmorisset@apple.com>

        Correctly detect string overflow when using the 'Function' constructor
        https://bugs.webkit.org/show_bug.cgi?id=184883
        <rdar://problem/36320331>

        Reviewed by Filip Pizlo.

        I added new tryAppend methods alongside the old append methods in StringBuilder, that return a boolean (true means success, false means an overflow happened).
        I made new methods instead of just adapting the existing ones (and reverted such a change on appendQuotedJSONString) so that callers that rely on the old behaviour (a hard CRASH() on overflow) don't silently start failing.

        * wtf/text/StringBuilder.cpp:
        (WTF::StringBuilder::allocateBufferUpConvert):
        (WTF::StringBuilder::tryAllocateBufferUpConvert):
        (WTF::StringBuilder::appendUninitialized):
        (WTF::StringBuilder::append):
        (WTF::StringBuilder::tryAppend):
        * wtf/text/StringBuilder.h:
        (WTF::StringBuilder::tryAppend):
        (WTF::StringBuilder::append):
        (WTF::StringBuilder::tryAppendLiteral):
        * wtf/text/StringBuilderJSON.cpp:
        (WTF::StringBuilder::appendQuotedJSONString):
        (WTF::StringBuilder::tryAppendQuotedJSONString):

2018-04-30  Mark Lam  <mark.lam@apple.com>

        Apply PtrTags to the MetaAllocator and friends.
        https://bugs.webkit.org/show_bug.cgi?id=185110
        <rdar://problem/39533895>

        Reviewed by Saam Barati.

        1. Introduce a MetaAllocatorPtr smart pointer to do pointer tagging.
        2. Use MetaAllocatorPtr in MetaAllocator and MetaAllocatorHandle.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/MetaAllocator.cpp:
        (WTF::MetaAllocator::release):
        (WTF::MetaAllocatorHandle::MetaAllocatorHandle):
        (WTF::MetaAllocatorHandle::shrink):
        (WTF::MetaAllocatorHandle::dump const):
        (WTF::MetaAllocator::allocate):
        (WTF::MetaAllocator::findAndRemoveFreeSpace):
        (WTF::MetaAllocator::addFreeSpaceFromReleasedHandle):
        (WTF::MetaAllocator::addFreshFreeSpace):
        (WTF::MetaAllocator::debugFreeSpaceSize):
        (WTF::MetaAllocator::addFreeSpace):
        (WTF::MetaAllocator::allocFreeSpaceNode):
        * wtf/MetaAllocator.h:
        (WTF::MetaAllocatorTracker::find):
        (WTF::MetaAllocator::FreeSpaceNode::FreeSpaceNode):
        (WTF::MetaAllocator::FreeSpaceNode::sizeInBytes):
        (WTF::MetaAllocator::FreeSpaceNode::key):
        * wtf/MetaAllocatorHandle.h:
        (WTF::MetaAllocatorHandle::start const):
        (WTF::MetaAllocatorHandle::end const):
        (WTF::MetaAllocatorHandle::startAsInteger const):
        (WTF::MetaAllocatorHandle::endAsInteger const):
        (WTF::MetaAllocatorHandle::sizeInBytes const):
        (WTF::MetaAllocatorHandle::containsIntegerAddress const):
        (WTF::MetaAllocatorHandle::key):
        * wtf/MetaAllocatorPtr.h: Added.
        (WTF::MetaAllocatorPtr::MetaAllocatorPtr):
        (WTF::MetaAllocatorPtr:: const):
        (WTF::MetaAllocatorPtr::operator bool const):
        (WTF::MetaAllocatorPtr::operator! const):
        (WTF::MetaAllocatorPtr::operator== const):
        (WTF::MetaAllocatorPtr::operator!= const):
        (WTF::MetaAllocatorPtr::operator+ const):
        (WTF::MetaAllocatorPtr::operator- const):
        (WTF::MetaAllocatorPtr::operator+=):
        (WTF::MetaAllocatorPtr::operator-=):
        (WTF::MetaAllocatorPtr::isEmptyValue const):
        (WTF::MetaAllocatorPtr::isDeletedValue const):
        (WTF::MetaAllocatorPtr::hash const):
        (WTF::MetaAllocatorPtr::emptyValue):
        (WTF::MetaAllocatorPtr::deletedValue):
        (WTF::MetaAllocatorPtrHash::hash):
        (WTF::MetaAllocatorPtrHash::equal):
        * wtf/PtrTag.h:

2018-04-30  JF Bastien  <jfbastien@apple.com>

        Use some C++17 features
        https://bugs.webkit.org/show_bug.cgi?id=185135

        Reviewed by Alex Christensen.

        * wtf/StdLibExtras.h: libstdc++ doesn't say it's C++17 when it
        defines std::conjunction. Use the feature test macro instead.

2018-04-30  Yusuke Suzuki  <utatane.tea@gmail.com>

        Use WordLock instead of std::mutex for Threading
        https://bugs.webkit.org/show_bug.cgi?id=185121

        Reviewed by Geoffrey Garen.

        Before r231151, WordLock depends on ThreadSpecific. It means that our Threading implementation
        cannot use this lock since Threading primitives could touch these locks after ThreadSpecific
        for that WordLock is destroyed.

        Now WordLock is changed not to use ThreadSpecific. So it does not depend on our Threading
        mechanism and our Threading can start using WordLock internally.

        This patch changes WTF::Thread and WTF::ThreadGroup to use WordLock instead of std::mutex.

        And add constexpr to explicitly describe that Lock, Condition, and WordLock constructors are constexpr.

        * wtf/Condition.h:
        * wtf/Lock.h:
        * wtf/ThreadGroup.h:
        (WTF::ThreadGroup::getLock):
        * wtf/Threading.cpp:
        (WTF::Thread::didExit):
        (WTF::Thread::addToThreadGroup):
        (WTF::Thread::removeFromThreadGroup):
        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::changePriority):
        (WTF::Thread::waitForCompletion):
        (WTF::Thread::detach):
        (WTF::Thread::signal):
        (WTF::Thread::establishPlatformSpecificHandle):
        * wtf/ThreadingWin.cpp:
        (WTF::Thread::changePriority):
        (WTF::Thread::waitForCompletion):
        (WTF::Thread::detach):
        (WTF::Thread::establishPlatformSpecificHandle):
        (WTF::Thread::initializeTLSKey):
        (WTF::Thread::currentDying):
        (WTF::Thread::get):
        (WTF::Thread::initializeTLS):
        (WTF::Thread::destructTLS):
        (WTF::threadMapMutex): Deleted.
        * wtf/WordLock.h:

2018-04-29  Michael Catanzaro  <mcatanzaro@igalia.com>

        [CMake] Require GCC 6
        https://bugs.webkit.org/show_bug.cgi?id=184985

        Reviewed by Alex Christensen.

        Stop enforcing GCC version in Compiler.h. It's better to do this in the build system. And I
        don't like having the same check in two different places.

        * wtf/Compiler.h:

2018-04-29  Geoffrey Garen  <ggaren@apple.com>

        WordLock doesn't need per-thread data
        https://bugs.webkit.org/show_bug.cgi?id=185119

        Reviewed by Yusuke Suzuki.

        The stack is per-thread data, so we can stack-allocate our ThreadData.

        This eliminates malloc() and high-level WTF threading primitives from
        WordLock, making WordLock more portable to non-WTF code, including
        bmalloc.

        (NOTE: This patch makes the bug fixed in r231148 100% reproducible.)

        * wtf/WordLock.cpp:
        (WTF::WordLock::lockSlow): Allocate ThreadData on the stack.

2018-04-28  Geoffrey Garen  <ggaren@apple.com>

        Fixed a very unlikely race condition in WTF::WordLock
        https://bugs.webkit.org/show_bug.cgi?id=185117

        Reviewed by Saam Barati.

        The race goes like this:

        Thread L is in lockSlowCase() and thread U is in unlockSlowCase();

        - U acquires queueHead->parkingLock.
        - U sets queueHead->shouldPark = false
        - U releases queueHead->parkingLock.
        - L spuriously wakes up from queueHead->parkingLock.wait()
        - L acquires queueHead->parkingLock.
        - L notices that queueHead->shouldPark = false, and acquires the WordLock
        - L finishes all its work and exits, freeing queueHead
        - U notifies queueHead->parkingLock (after free) and crashes or deadlocks

        These conditions are currently so unlikely that I don't know how to test
        them. I noticed this race because I changed WordLock's allocation pattern
        to allow queueHead to be freed more often, and I crashed / deadlocked 100%.

        Shout out to <http://en.cppreference.com/w/cpp/thread/condition_variable/notify_one>
        for explaining this.

        * benchmarks/ToyLocks.h: Fixed build.

        * wtf/WordLock.cpp:
        (WTF::WordLock::unlockSlow): Hold the lock a little longer to avoid
        this race.

2018-04-27  David Kilzer  <ddkilzer@apple.com>

        Add logging when SpringBoard enables WebThread
        <https://webkit.org/b/185100>
        <rdar://problem/39746542>

        Reviewed by Daniel Bates.

        * wtf/Assertions.h:
        (RELEASE_LOG_FAULT): Add macro to call os_log_fault().
        * wtf/Platform.h: Drive-by fix to enable USE(OS_LOG) on
        public iOS SDKs since <rdar://problem/27758343> was
        fixed in iOS 11.0.

2018-04-26  Mark Lam  <mark.lam@apple.com>

        Gardening: Speculative build fix for Windows.
        https://bugs.webkit.org/show_bug.cgi?id=184976
        <rdar://problem/39723901>

        Not reviewed.

        * wtf/PtrTag.h:
        (WTF::makePtrTagHash): Undo last speculative build fix that did not work for 64-bit.

2018-04-26  Andy VanWagoner  <thetalecrafter@gmail.com>

        [INTL] Implement Intl.PluralRules
        https://bugs.webkit.org/show_bug.cgi?id=184312

        Reviewed by JF Bastien.

        Added Intl.PluralRules feature flag.

        * wtf/FeatureDefines.h:

2018-04-25  Mark Lam  <mark.lam@apple.com>

        Gardening: Speculative build fix for Windows 32-bit to compensate for MSVC's lack of smarts.
        https://bugs.webkit.org/show_bug.cgi?id=184976
        <rdar://problem/39723901>

        Not reviewed.

        According to https://stackoverflow.com/questions/37658794/integer-constant-overflow-warning-in-constexpr,
        disabling the warning around the definition of the function will not disable it
        for all clients of the function.

        * wtf/PtrTag.h:
        (WTF::makePtrTagHash):

2018-04-25  Mark Lam  <mark.lam@apple.com>

        Push the definition of PtrTag down to the WTF layer.
        https://bugs.webkit.org/show_bug.cgi?id=184976
        <rdar://problem/39723901>

        Reviewed by Saam Barati.

        This is in preparation for doing pointer profiling at the WTF layer as well.
        Also deleted an unused ptrTag() function.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/PtrTag.h: Copied from Source/JavaScriptCore/runtime/PtrTag.h.
        (WTF::makePtrTagHash):
        (JSC::ptrTagName): Deleted.
        (JSC::tagForPtr): Deleted.
        (JSC::ptrTag): Deleted.
        (JSC::tagCodePtr): Deleted.
        (JSC::untagCodePtr): Deleted.
        (JSC::retagCodePtr): Deleted.
        (JSC::removeCodePtrTag): Deleted.
        (JSC::tagCFunctionPtr): Deleted.
        (JSC::untagCFunctionPtr): Deleted.
        (JSC::assertIsCFunctionPtr): Deleted.
        (JSC::assertIsNullOrCFunctionPtr): Deleted.
        (JSC::assertIsNotTagged): Deleted.
        (JSC::assertIsTagged): Deleted.
        (JSC::assertIsNullOrTagged): Deleted.
        (JSC::assertIsTaggedWith): Deleted.
        (JSC::assertIsNullOrTaggedWith): Deleted.

2018-04-25  Dean Jackson  <dino@apple.com>

        Make a better flag for system preview, and disable it where necessary
        https://bugs.webkit.org/show_bug.cgi?id=184968
        <rdar://problem/39686506>

        Reviewed by Eric Carlson.

        Add a new USE(SYSTEM_PREVIEW).

        * wtf/Platform.h:

2018-04-24  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r230971.
        https://bugs.webkit.org/show_bug.cgi?id=184939

        This fix was not appropriate (Requested by n_wang on #webkit).

        Reverted changeset:

        "AX: soft link libAccessibility.dylb"
        https://bugs.webkit.org/show_bug.cgi?id=184919
        https://trac.webkit.org/changeset/230971

2018-04-24  Nan Wang  <n_wang@apple.com>

        AX: soft link libAccessibility.dylb
        https://bugs.webkit.org/show_bug.cgi?id=184919

        Reviewed by Chris Fleizach.

        * wtf/cocoa/SoftLinking.h:

2018-04-23  Zalan Bujtas  <zalan@apple.com>

        [LayoutFormattingContext] Initial commit.
        https://bugs.webkit.org/show_bug.cgi?id=184896

        Reviewed by Antti Koivisto.

        * wtf/FeatureDefines.h:

2018-04-23  Per Arne Vollan  <pvollan@apple.com>

        Deactivate the WindowServer connection for the WebContent process.
        https://bugs.webkit.org/show_bug.cgi?id=184451
        <rdar://problem/38313938>

        Reviewed by Brent Fulgham.

        Defining ENABLE_WEBPROCESS_WINDOWSERVER_BLOCKING as 1 will deactivate the WindowServer connection
        for the WebContent process by enabling the call to 'CGSSetDenyWindowServerConnections(true)' on
        process startup. After calling this function, every attempt to establish a connection to the
        WindowServer from the WebContent process will fail, except for CA render server connections.

        * wtf/FeatureDefines.h:

2018-04-20  JF Bastien  <jfbastien@apple.com>

        Handle more JSON stringify OOM
        https://bugs.webkit.org/show_bug.cgi?id=184846
        <rdar://problem/39390672>

        Reviewed by Mark Lam.

        JSON stringification can OOM easily. Here's another case.

        * wtf/text/StringBuilderJSON.cpp:
        (WTF::StringBuilder::appendQuotedJSONString):

2018-04-18  Jer Noble  <jer.noble@apple.com>

        Don't put build products into WK_ALTERNATE_WEBKIT_SDK_PATH for engineering builds
        https://bugs.webkit.org/show_bug.cgi?id=184762

        Reviewed by Dan Bernstein.

        * Configurations/Base.xcconfig:

2018-04-20  Daniel Bates  <dabates@apple.com>

        Remove code for compilers that did not support NSDMI for aggregates
        https://bugs.webkit.org/show_bug.cgi?id=184599

        Reviewed by Per Arne Vollan.

        Remove workaround for earlier Visual Studio versions that did not support non-static data
        member initializers (NSDMI) for aggregates. We have since updated all the build.webkit.org
        and EWS bots to a newer version that supports this feature.

        * wtf/Compiler.h:

2018-04-19  David Kilzer  <ddkilzer@apple.com>

        Enable Objective-C weak references
        <https://webkit.org/b/184789>
        <rdar://problem/39571716>

        Reviewed by Dan Bernstein.

        * Configurations/Base.xcconfig:
        (CLANG_ENABLE_OBJC_WEAK): Enable.

2018-04-19  Brady Eidson  <beidson@apple.com>

        Add globally-unique HistoryItem identifiers (and have WebKit2 adopt them).
        <rdar://problem/39533949> and https://bugs.webkit.org/show_bug.cgi?id=184750

        Reviewed by Ryosuke Niwa.

        * wtf/DebugUtilities.h:
        (WTF::debugString):

2018-04-19  Per Arne Vollan  <pvollan@apple.com>

        Unreviewed, rolling out r230677.

        Introduced Netflix problems.

        Reverted changeset:

        "Deactivate the WindowServer connection for the WebContent process."
        https://bugs.webkit.org/show_bug.cgi?id=184451
        https://trac.webkit.org/changeset/230677

2018-04-19  Nan Wang  <n_wang@apple.com>

        AX: AOM: respect the accessibility setting for dispatching the accessible events
        https://bugs.webkit.org/show_bug.cgi?id=184619

        Reviewed by Ryosuke Niwa.

        * wtf/Platform.h:

2018-04-18  Ross Kirsling  <ross.kirsling@sony.com>

        [Win] Layout Test js/date-constructor.html is failing
        https://bugs.webkit.org/show_bug.cgi?id=140945

        Reviewed by Per Arne Vollan.

        * wtf/DateMath.cpp:
        (WTF::calculateDSTOffset):
        Move all shared calculations outside of the #if -- including the "jump forward a day" case that had been overlooked.

2018-04-17  Saam Barati  <sbarati@apple.com>

        Add system trace points for process launch and for initializeWebProcess
        https://bugs.webkit.org/show_bug.cgi?id=184669

        Reviewed by Simon Fraser.

        This patch adds TracePointCodes to measure process launch time and
        WebProcess::initializeWebProcess time.
        
        It also renames the TracePoint function to tracePoint since WebKit style
        does not capitalize the first letter in function names.

        * wtf/SystemTracing.h:
        (WTF::tracePoint):
        (WTF::TraceScope::TraceScope):
        (WTF::TraceScope::~TraceScope):
        (WTF::TracePoint): Deleted.

2018-04-16  Andy Estes  <aestes@apple.com>

        [iOS] Enable WKPDFView by default
        https://bugs.webkit.org/show_bug.cgi?id=184675
        <rdar://problem/27885452>

        Reviewed by Darin Adler.

        * wtf/FeatureDefines.h:

2018-04-16  Per Arne Vollan  <pvollan@apple.com>

        Deactivate the WindowServer connection for the WebContent process.
        https://bugs.webkit.org/show_bug.cgi?id=184451
        <rdar://problem/38313938>

        Reviewed by Brent Fulgham.

        Defining ENABLE_WEBPROCESS_WINDOWSERVER_BLOCKING as 1 will deactivate the WindowServer connection
        for the WebContent process by enabling the call to 'CGSSetDenyWindowServerConnections(true)' on
        process startup. After calling this function, every attempt to establish a connection to the
        WindowServer from the WebContent process will fail, except for CA render server connections.

        * wtf/FeatureDefines.h:

2018-04-14  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r230659.
        https://bugs.webkit.org/show_bug.cgi?id=184633

        Landed prematurely (Requested by ap on #webkit).

        Reverted changeset:

        "Deactivate the WindowServer connection for the WebContent
        process."
        https://bugs.webkit.org/show_bug.cgi?id=184451
        https://trac.webkit.org/changeset/230659

2018-04-14  Per Arne Vollan  <pvollan@apple.com>

        Deactivate the WindowServer connection for the WebContent process.
        https://bugs.webkit.org/show_bug.cgi?id=184451
        <rdar://problem/38313938>

        Reviewed by Brent Fulgham.

        Defining ENABLE_WEBPROCESS_WINDOWSERVER_BLOCKING as 1 will deactivate the WindowServer connection
        for the WebContent process by enabling the call to 'CGSSetDenyWindowServerConnections(true)' on
        process startup. After calling this function, every attempt to establish a connection to the
        WindowServer from the WebContent process will fail, except for CA render server connections.

        * wtf/FeatureDefines.h:

2018-04-13  Chris Dumez  <cdumez@apple.com>

        Split WindowProxy handling out of ScriptController and into a new class owned by AbstractFrame
        https://bugs.webkit.org/show_bug.cgi?id=184591

        Reviewed by Sam Weinig.

        Add isEmpty() convenience method to SizedIteratorRange.

        * wtf/IteratorRange.h:
        (WTF::SizedIteratorRange::isEmpty const):

2018-04-13  Brady Eidson  <beidson@apple.com>

        Introduce SuspendedPageProxy to keep old web processes around after their WebPageProxy has been swapped to a new one.
        https://bugs.webkit.org/show_bug.cgi?id=184559

        Reviewed by Alex Christensen.

        * wtf/DebugUtilities.h:
        (WTF::debugString): Add a debug utility to easily construct a "const char*" that is released after a spin of the run loop.
          This greatly eases uses our String classes and functions inside of "%s" style environments like printf and LOG.

2018-04-12  Michael Catanzaro  <mcatanzaro@igalia.com>

        Remove unused crash hook functionality
        https://bugs.webkit.org/show_bug.cgi?id=183369

        Reviewed by Alexey Proskuryakov.

        WTFSetCrashHook and WTFInstallReportBacktraceOnCrashHook are not used on any platforms and
        can be removed.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h:

2018-04-11  Said Abou-Hallawa  <sabouhallawa@apple.com>

        Unreviewed, rolling out r230523.

        Introduced MotionMark regression

        Reverted changeset:

        "Deactivate the WindowServer connection for the WebContent
        process."
        https://bugs.webkit.org/show_bug.cgi?id=184451
        https://trac.webkit.org/changeset/230523

2018-04-11  Per Arne Vollan  <pvollan@apple.com>

        Deactivate the WindowServer connection for the WebContent process.
        https://bugs.webkit.org/show_bug.cgi?id=184451
        <rdar://problem/38313938>

        Reviewed by Brent Fulgham.

        Defining ENABLE_WEBPROCESS_WINDOWSERVER_BLOCKING as 1 will deactivate the WindowServer connection
        for the WebContent process by enabling the call to 'CGSSetDenyWindowServerConnections(true)' on
        process startup. After calling this function, every attempt to establish a connection to the
        WindowServer from the WebContent process will fail, except for CA render server connections.

        * wtf/FeatureDefines.h:

2018-04-10  Andy Estes  <aestes@apple.com>

        [iOS] Use PDFKit to render PDFs in WKWebView
        https://bugs.webkit.org/show_bug.cgi?id=184387

        Reviewed by Beth Dakin.

        * wtf/FeatureDefines.h: Defined ENABLE_WKLEGACYPDFVIEW and ENABLE_WKPDFVIEW.

2018-04-09  Mark Lam  <mark.lam@apple.com>

        Decorate method table entries to support pointer profiling.
        https://bugs.webkit.org/show_bug.cgi?id=184430
        <rdar://problem/39296190>

        Reviewed by Saam Barati.

        * wtf/PointerPreparations.h:

2018-04-08  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, use alignas(void*)
        https://bugs.webkit.org/show_bug.cgi?id=183508

        Very large alignment is not supported in MSVC.

        * wtf/Gigacage.cpp:
        * wtf/Gigacage.h:

2018-04-08  Yusuke Suzuki  <utatane.tea@gmail.com>

        Use alignas instead of compiler-specific attributes
        https://bugs.webkit.org/show_bug.cgi?id=183508

        Reviewed by Mark Lam.

        Use alignas for g_gigacageBasePtr. We also add reinterpret_cast to fix
        compile errors in ARMv7 and MIPS JSCOnly ports.

        * wtf/Gigacage.cpp:
        * wtf/Gigacage.h:
        (Gigacage::basePtrs):

2018-04-06  Saam Barati  <sbarati@apple.com>

        bmalloc's tryLargeZeroedMemalignVirtual shouldn't treat the entire virtual size as dirty towards its footprint
        https://bugs.webkit.org/show_bug.cgi?id=184207

        Reviewed by Mark Lam.

        * wtf/Gigacage.cpp:
        (Gigacage::freeVirtualPages):

2018-04-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Remove StaticLock
        https://bugs.webkit.org/show_bug.cgi?id=184332

        Reviewed by Mark Lam.

        Now, WTF::StaticLock is `using StaticLock = Lock`. Lock just works
        in either static storage and dynamic storage. Remove StaticLock and
        always use Lock.

        We also remove StaticWordLock and StaticReadWriteLock. And we add
        WTF::RecursiveLock, which is RecursiveLockAdapter<Lock>.

        * wtf/HashTable.cpp:
        (WTF::HashTableStats::recordCollisionAtCount):
        (WTF::HashTableStats::dumpStats):
        * wtf/Language.cpp:
        (WTF::userPreferredLanguages):
        * wtf/Lock.h:
        * wtf/MainThread.cpp:
        (WTF::dispatchFunctionsFromMainThread):
        (WTF::callOnMainThread):
        * wtf/ParkingLot.cpp:
        * wtf/ReadWriteLock.h:
        * wtf/RecursiveLockAdapter.h:
        * wtf/StackStats.cpp:
        (WTF::StackStats::CheckPoint::CheckPoint):
        (WTF::StackStats::CheckPoint::~CheckPoint):
        (WTF::StackStats::probe):
        (WTF::StackStats::LayoutCheckPoint::LayoutCheckPoint):
        (WTF::StackStats::LayoutCheckPoint::~LayoutCheckPoint):
        * wtf/StackStats.h:
        * wtf/ThreadMessage.cpp:
        (WTF::sendMessageScoped):
        * wtf/ThreadingPthreads.cpp:
        * wtf/ThreadingWin.cpp:
        * wtf/WordLock.h:
        * wtf/cf/LanguageCF.cpp:
        (WTF::languagePreferencesDidChange):
        (WTF::platformUserPreferredLanguages):
        * wtf/dtoa.cpp:
        * wtf/text/AtomicStringImpl.cpp:
        * wtf/text/StringView.cpp:
        (WTF::StringView::invalidate):
        (WTF::StringView::adoptUnderlyingString):
        (WTF::StringView::setUnderlyingString):
        * wtf/unicode/icu/CollatorICU.cpp:
        (WTF::Collator::Collator):
        (WTF::Collator::~Collator):
        * wtf/win/LanguageWin.cpp:
        (WTF::platformLanguage):

2018-04-04  Brent Fulgham  <bfulgham@apple.com>

        Failures from mach port reference handling should be fatal
        https://bugs.webkit.org/show_bug.cgi?id=184202
        <rdar://problem/37771114>

        Reviewed by Anders Carlsson.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/MachSendRight.h: Copied from WebCore/platform/cocoa/MachSendRight.h.
        (WebCore::MachSendRight::operator bool const): Deleted.
        (WebCore::MachSendRight::sendRight const): Deleted.
        * wtf/PlatformMac.cmake:
        * wtf/cocoa/CPUTimeCocoa.mm:
        (WTF::CPUTime::forCurrentThread): Do proper cleanup if the port is invalid.
        * wtf/cocoa/MachSendRight.cpp: Copied from WebCore/platform/cocoa/MachSendRight.cpp.
        (WTF::retainSendRight):
        (WTF::releaseSendRight):
        (WTF::deallocateSendRightSafely):
        (WebCore::retainSendRight): Deleted.
        (WebCore::releaseSendRight): Deleted.
        (WebCore::MachSendRight::adopt): Deleted.
        (WebCore::MachSendRight::create): Deleted.
        (WebCore::MachSendRight::MachSendRight): Deleted.
        (WebCore::MachSendRight::~MachSendRight): Deleted.
        (WebCore::MachSendRight::operator=): Deleted.
        (WebCore::MachSendRight::copySendRight const): Deleted.
        (WebCore::MachSendRight::leakSendRight): Deleted.

2018-04-04  Youenn Fablet  <youenn@apple.com>

        Introduce a ThreadSafeRefCounted parameter to ensure being destroyed on the main thread
        https://bugs.webkit.org/show_bug.cgi?id=183988

        Reviewed by Darin Adler.

        * wtf/ThreadSafeRefCounted.h:
        (WTF::ThreadSafeRefCounted::deref const):

2018-04-04  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Remove Atomics.cpp
        https://bugs.webkit.org/show_bug.cgi?id=184300

        Reviewed by Konstantin Tokarev.

        This Atomics.cpp is a workaround for GCC which version is < 4.8.
        Our compiler requirement is now 5.0.0. This workaround is no
        longer necessary.

        * wtf/Atomics.cpp: Removed.
        * wtf/CMakeLists.txt:

2018-04-03  Tomas Popela  <tpopela@redhat.com>

        Unreviewed, mute the unused parameter compilation warning

        Triggered on the PPC64 machine.

        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::signalHandlerSuspendResume):

2018-04-03  Tomas Popela  <tpopela@redhat.com>

        Unreviewed, fix the unused variable compilation warning

        Move the ucontext_t code under the HAVE(MACHINE_CONTEXT). Triggered
        on the PPC64 machine.

        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::signalHandlerSuspendResume):

2018-04-02  Saam Barati  <sbarati@apple.com>

        bmalloc should compute its own estimate of its footprint
        https://bugs.webkit.org/show_bug.cgi?id=184121

        Reviewed by Filip Pizlo.

        * wtf/FastMalloc.cpp:
        (WTF::fastCommitAlignedMemory):
        (WTF::fastDecommitAlignedMemory):
        * wtf/FastMalloc.h:

2018-03-30  Filip Pizlo  <fpizlo@apple.com>

        Strings and Vectors shouldn't do index masking
        https://bugs.webkit.org/show_bug.cgi?id=184193

        Reviewed by Mark Lam.

        * wtf/SizeLimits.cpp:
        * wtf/Vector.h:
        (WTF::VectorBufferBase::allocateBuffer):
        (WTF::VectorBufferBase::tryAllocateBuffer):
        (WTF::VectorBufferBase::reallocateBuffer):
        (WTF::VectorBufferBase::deallocateBuffer):
        (WTF::VectorBufferBase::releaseBuffer):
        (WTF::VectorBufferBase::VectorBufferBase):
        (WTF::VectorBuffer::allocateBuffer):
        (WTF::VectorBuffer::tryAllocateBuffer):
        (WTF::VectorBuffer::swap):
        (WTF::VectorBuffer::restoreInlineBufferIfNeeded):
        (WTF::Vector::at):
        (WTF::Vector::at const):
        (WTF::VectorBufferBase::updateMask): Deleted.
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::flagIsSymbol):
        (WTF::StringImpl::length const):
        (WTF::StringImplShape::StringImplShape):
        (WTF::StringImpl::at const):
        (WTF::StringImpl::tailOffset):
        (WTF::StringImpl::maskOffset): Deleted.
        (WTF::StringImpl::mask const): Deleted.
        * wtf/text/StringView.h:
        (WTF::StringView::StringView):
        (WTF::StringView::operator=):
        (WTF::StringView::initialize):
        (WTF::StringView::clear):
        (WTF::StringView::operator[] const):
        * wtf/text/WTFString.h:
        (WTF::String::length const):
        (WTF::String::mask const): Deleted.

2018-03-30  Mark Lam  <mark.lam@apple.com>

        Add pointer profiling support in baseline JIT and supporting files.
        https://bugs.webkit.org/show_bug.cgi?id=184200
        <rdar://problem/39057300>

        Reviewed by Filip Pizlo.

        * wtf/PointerPreparations.h:
        - Remove WTF_PREPARE_FUNCTION_POINTER_FOR_EXECUTION.  It is no longer needed.

2018-03-30  JF Bastien  <jfbastien@apple.com>

        WorkQueueWin: don't move rvalues
        https://bugs.webkit.org/show_bug.cgi?id=184190
        <rdar://problem/39049850>

        Reviewed by Mark Lam.

        As part of #184167 optional is now more frequently an rvalue
        reference, and moving its .value() is not a thing that should be
        done anymore.

        * wtf/win/WorkQueueWin.cpp:
        (WTF::WorkQueue::unregisterAndCloseHandle):

2018-03-30  JF Bastien  <jfbastien@apple.com>

        Remove CXX_REFERENCE_QUALIFIED_FUNCTIONS and optional's equivalent
        https://bugs.webkit.org/show_bug.cgi?id=184167
        <rdar://problem/39023130>

        Reviewed by Yusuke Suzuki.

        Remove COMPILER_SUPPORTS(CXX_REFERENCE_QUALIFIED_FUNCTIONS), it's
        supported by all compilers WebKit supports (it's a C++11 feature,
        *detection* of it with __has_extension was added to clang on May
        13th 2011, and VS2015 / GCC support it).

        Optional.h had a similar thing, ditch it too.

        * wtf/Compiler.h:
        * wtf/Optional.h:
        (std::optional::contained_val const):
        (std::optional::contained_val):
        * wtf/Ref.h:
        * wtf/RefPtr.h:
        * wtf/text/WTFString.cpp:
        * wtf/text/WTFString.h:

2018-03-30  JF Bastien  <jfbastien@apple.com>

        Introduce WTF_LAZY_INSTANTIATE
        https://bugs.webkit.org/show_bug.cgi?id=184169
        <rdar://problem/39023385>

        Reviewed by Mark Lam.

        As part of #184164 I'm adding some forwarding methods to
        WTF::String. These need to forward RetainPtr and CString, and
        usually that would require #include'ing RetainPtr.h and CString.h
        to WTFString.h which isn't really something we should do.

        Introduce WTF_LAZY_INSTANTIATE to forward-declare functions which
        just pass parameters to another function, and return whatever that
        other function returned, without having to include the return's /
        parameters' type header.

        Try it out here: godbolt.org/g/oV8G5Q

        * wtf/Forward.h:

2018-03-29  JF Bastien  <jfbastien@apple.com>

        Use Forward.h instead of forward-declaring WTF::String
        https://bugs.webkit.org/show_bug.cgi?id=184172
        <rdar://problem/39026146>

        Reviewed by Yusuke Suzuki.

        As part of #184164 I'm changing WTF::String, and the forward
        declarations are just wrong because I'm making it templated. We
        should use Forward.h anyways, so do that instead.

        * wtf/Forward.h:
        * wtf/HashTraits.h:
        * wtf/PrintStream.h:

2018-03-29  Yusuke Suzuki  <utatane.tea@gmail.com>

        Remove WTF_EXPORTDATA and JS_EXPORTDATA
        https://bugs.webkit.org/show_bug.cgi?id=184170

        Reviewed by JF Bastien.

        Replace WTF_EXPORTDATA and JS_EXPORTDATA with
        WTF_EXPORT_PRIVATE and JS_EXPORT_PRIVATE respectively.

        * wtf/ExportMacros.h:
        * wtf/Gigacage.h:
        * wtf/HashTable.h:
        * wtf/Threading.h:
        * wtf/text/AtomicString.cpp:
        * wtf/text/AtomicString.h:
        * wtf/text/StringImpl.h:

2018-03-29  Ross Kirsling  <ross.kirsling@sony.com>

        MSVC __forceinline slows down JSC release build fivefold after r229391
        https://bugs.webkit.org/show_bug.cgi?id=184062

        Reviewed by Alex Christensen.

        * wtf/Compiler.h:
        Add ALWAYS_INLINE_EXCEPT_MSVC to support MSVC optimizer sensitivities.

2018-03-29  JF Bastien  <jfbastien@apple.com>

        Remove WTF_EXPORT_STRING_API
        https://bugs.webkit.org/show_bug.cgi?id=184168
        <rdar://problem/39023253>

        Reviewed by Yusuke Suzuki.

        Remove WTF_EXPORT_STRING_API as requested by a FIXME, and use
        WTF_EXPORT_PRIVATE instead.

        * wtf/ExportMacros.h:
        * wtf/text/AtomicString.h:
        * wtf/text/AtomicStringImpl.h:
        * wtf/text/StringImpl.h:
        * wtf/text/StringView.h:
        * wtf/text/SymbolImpl.h:
        * wtf/text/WTFString.h:

2018-03-29  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r230062.
        https://bugs.webkit.org/show_bug.cgi?id=184128

        Broke mac port. web content process crashes while loading any
        web page (Requested by rniwa on #webkit).

        Reverted changeset:

        "MSVC __forceinline slows down JSC release build fivefold
        after r229391"
        https://bugs.webkit.org/show_bug.cgi?id=184062
        https://trac.webkit.org/changeset/230062

2018-03-28  Ross Kirsling  <ross.kirsling@sony.com>

        MSVC __forceinline slows down JSC release build fivefold after r229391
        https://bugs.webkit.org/show_bug.cgi?id=184062

        Reviewed by Alex Christensen.

        * wtf/Compiler.h:
        Add ALWAYS_INLINE_EXCEPT_MSVC to support MSVC optimizer sensitivities.

2018-03-28  Fujii Hironori  <Hironori.Fujii@sony.com>

        [Win] Assertions.h: VC doesn't support GCC extension ##__VA_ARGS__
        https://bugs.webkit.org/show_bug.cgi?id=184076

        Reviewed by Alex Christensen.

        ##__VA_ARGS__ is used to define RELEASE_LOG, RELEASE_LOG_ERROR,
        RELEASE_LOG_IF, RELEASE_LOG_ERROR_IF, RELEASE_LOG_WITH_LEVEL,
        RELEASE_LOG_WITH_LEVEL_IF and RELEASE_LOG_INFO_IF.

        A macro using ##__VA_ARGS__,

          #define foo(format, ...) bar(format, ##__VA_ARGS__)

        can be defined without ##__VA_ARGS__:

          #define foo(...) bar(__VA_ARGS__)

        * wtf/Assertions.h: Use __VA_ARGS__ instead of ##__VA_ARGS__.

2018-03-28  Brent Fulgham  <bfulgham@apple.com>

        Avoid uninitialized mach ports
        https://bugs.webkit.org/show_bug.cgi?id=184090
        <rdar://problem/37261129>

        Reviewed by Chris Dumez.

        It is possible for mach_port_allocate to return an error, but we rarely check its return value. The value
        of the argument passed to mach_port_allocate is not guaranteed to be valid when it returns an error, so
        there is a potential for us to try to use invalid ports.

        We should always check return values, and ensure that the mach port variables we seek to initialize are
        kept in a valid state.

        Reviewed by Chris Dumez.

        * wtf/Threading.h: Initialize mach port.

2018-03-28  Robin Morisset  <rmorisset@apple.com>

        appendQuotedJSONString stops on arithmetic overflow instead of propagating it upwards
        https://bugs.webkit.org/show_bug.cgi?id=183894

        Reviewed by Saam Barati.

        appendQuotedJSONString now returns a bool indicating whether it succeeded, instead of silently failing when given a string too large
        to fit in 4GB.

        * wtf/text/StringBuilder.h:
        * wtf/text/StringBuilderJSON.cpp:
        (WTF::StringBuilder::appendQuotedJSONString):

2018-03-27  Per Arne Vollan  <pvollan@apple.com>

        The layout test fast/canvas/webgl/read-pixels-test.html is timing out.
        https://bugs.webkit.org/show_bug.cgi?id=183923
        <rdar://problem/38756869>

        Reviewed by Brent Fulgham.

        Add compile guard for blocking of the WindowServer in the WebProcess.

        * wtf/FeatureDefines.h:

2018-03-26  Tim Horton  <timothy_horton@apple.com>

        Add and adopt HAVE(CORE_ANIMATION_RENDER_SERVER)
        https://bugs.webkit.org/show_bug.cgi?id=184026
        <rdar://problem/38883321>

        Reviewed by Sam Weinig.

        * wtf/Platform.h:

2018-03-26  Yusuke Suzuki  <utatane.tea@gmail.com>

        We should have SSE4 detection in the X86 MacroAssembler.
        https://bugs.webkit.org/show_bug.cgi?id=165363

        Reviewed by JF Bastien.

        GCC 5 supports clobbering PIC registers in inline ASM [1,2].

        [1]: https://gcc.gnu.org/bugzilla/show_bug.cgi?id=47602
        [2]: https://gcc.gnu.org/viewcvs/gcc?view=revision&revision=216154

        * wtf/Atomics.h:
        (WTF::x86_cpuid):

2018-03-26  Antoine Quint  <graouts@apple.com>

        [ASan] Allow Ref<> to be swapped
        https://bugs.webkit.org/show_bug.cgi?id=184017
        <rdar://problem/36336787>

        Reviewed by JF Bastien.

        Unpoison a Ref in various calls just like in ~Ref so that sorting a Vector<Ref<>> works with ASan on.

        * wtf/Ref.h:
        (WTF::Ref::assignToHashTableEmptyValue):
        (WTF::=):
        (WTF::U>::replace):

2018-03-26  Brent Fulgham  <bfulgham@apple.com>

        Warn against cookie access in the WebContent process using ProcessPrivilege assertions
        https://bugs.webkit.org/show_bug.cgi?id=183911
        <rdar://problem/38762306>

        Reviewed by Youenn Fablet.

        Extend the ProcessPrivilege API with the ability to add and remove individual
        privileges.

        * wtf/ProcessPrivilege.cpp:
        (WTF::addProcessPrivilege):
        (WTF::removeProcessPrivilege):
        * wtf/ProcessPrivilege.h:

2018-03-25  Carlos Alberto Lopez Perez  <clopez@igalia.com>

        WebProcess memory monitor: use %zu format specifier for size_t
        https://bugs.webkit.org/show_bug.cgi?id=183997

        Reviewed by Michael Catanzaro.

        usse %zu format specifier for size_t instead of %lu.

        * wtf/MemoryPressureHandler.cpp:
        (WTF::MemoryPressureHandler::shrinkOrDie):
        (WTF::MemoryPressureHandler::measurementTimerFired):

2018-03-25  Tim Horton  <timothy_horton@apple.com>

        Add and adopt ENABLE(AIRPLAY_PICKER)
        https://bugs.webkit.org/show_bug.cgi?id=183992

        Reviewed by Daniel Bates.

        * wtf/FeatureDefines.h:

2018-03-23  Tim Horton  <timothy_horton@apple.com>

        Introduce and adopt HAVE(AUDIO_TOOLBOX_AUDIO_SESSION)
        https://bugs.webkit.org/show_bug.cgi?id=183954
        <rdar://problem/38808858>

        Reviewed by Dan Bernstein.

        * wtf/Platform.h:

2018-03-23  David Kilzer  <ddkilzer@apple.com>

        Stop using dispatch_set_target_queue()
        <https://webkit.org/b/183908>
        <rdar://problem/33553533>

        Reviewed by Daniel Bates.

        * wtf/cocoa/WorkQueueCocoa.cpp:
        (WTF::WorkQueue::platformInitialize): Remove !HAVE(QOS_CLASSES)
        code path since it's never used now that HAVE(QOS_CLASSES) is
        equivalent to PLATFORM(COCOA) in <wtf/Platform.h>.

2018-03-23  Carlos Alberto Lopez Perez  <clopez@igalia.com>

        WebProcess memory monitor thresholds should be better tuned for embedded systems.
        https://bugs.webkit.org/show_bug.cgi?id=183773

        Reviewed by Yusuke Suzuki.

        Take into account the total system RAM for the thresholds calculation.

        For systems with more than 3GB the conservative and strict thresholds remain as they are,
        but for systems with less RAM the thresholds are dynamically configured as follows:

        - Conservative threshold (release non critical memory) if WebProcess using more than 33% of the total RAM.
        - Strict threshold (release all possible memory) if WebProcess using more than 50% of the total RAM.

        The Kill threshold is also modified. Now it is capped at 90% of the total RAM.

        * wtf/MemoryPressureHandler.cpp:
        (WTF::thresholdForMemoryKillWithProcessState):
        (WTF::thresholdForPolicy):
        (WTF::MemoryPressureHandler::shrinkOrDie):

2018-03-23  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Add standard containers with FastAllocator specialization
        https://bugs.webkit.org/show_bug.cgi?id=183789

        Reviewed by Darin Adler.

        Sometimes we want standard containers due to various reasons.
        For example, WTF::HashMap lacks the ability to hold all the
        integer keys since it uses 0 for empty value and -1 for deleted
        value. However, using std::containers use std::allocator without
        specialization.

        This patch introduces WTF::{StdMap, StdSet, StdList, StdUnorderedMap, StdUnorderedSet}.
        They are standard containers with FastAllocator specialization.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/StdList.h: Copied from Source/JavaScriptCore/runtime/TypeLocationCache.h.
        * wtf/StdMap.h: Copied from Source/JavaScriptCore/runtime/TypeLocationCache.h.
        * wtf/StdSet.h: Copied from Source/JavaScriptCore/runtime/TypeLocationCache.h.
        * wtf/StdUnorderedMap.h: Copied from Source/JavaScriptCore/runtime/TypeLocationCache.h.
        * wtf/StdUnorderedSet.h: Copied from Source/JavaScriptCore/runtime/TypeLocationCache.h.

2018-03-22  Tim Horton  <timothy_horton@apple.com>

        Adopt USE(OPENGL[_ES]) in more places
        https://bugs.webkit.org/show_bug.cgi?id=183882
        <rdar://problem/37912195>

        Reviewed by Dan Bernstein.

        * wtf/Platform.h:

2018-03-20  Brent Fulgham  <bfulgham@apple.com>

        Create an assertion mechanism to ensure proper WebCore use in each WebKit Process
        https://bugs.webkit.org/show_bug.cgi?id=183806
        <rdar://problem/38694251>

        Reviewed by Ryosuke Niwa.

        Part of our security improvements involve better isolation between the different WebKit
        processes (UIProcess, WebContent, Networking, Storage, etc.).

        We need an assertion language we can use to protect certain critical APIs and code paths
        against accidental misuse.

        This patch adds a new enum type meant to represent different categories of program logic
        that we do not want used in the wrong process.

        This first patch just creates these types and makes them available. New assertions using
        these values will be added as we complete our work ensuring proper process isolation.

        In a method we want to protect, we can add an assertion describing the process privileges
        needed to execute the code. For example, for cookie access we might use this:

            ASSERT(hasProcessPrivilege(ProcessPrivilege::CanAccessRawCookies);

        At the launch of the UIProcess we would use this method to ensure all privileges are available:

            setProcessPrivileges(allPrivileges());

        In the network process, during platform initialization, we would use something like this:

            setProcessPrivileges({ ProcessPrivilege::CanAccessRawCookies, ProcessPrivilege::CanAccessCredentials });

        In the WebContent process, we would not set any privileges. We could just leave it as the
        default initialization, or use this:

            setProcessPrivileges({ });

        Later, when we attempt to execute the initial code, we would expect an assertion for the
        WebContent process, while Network and UIProcess pass the assertion.

        * WTF.xcodeproj/project.pbxproj: Add new files.
        * wtf/CMakeLists.txt: Ditto.
        * wtf/ProcessPrivilege.cpp: Added.
        (WTF::processPrivileges):
        (WTF::setProcessPrivileges):
        (WTF::hasProcessPrivilege):
        * wtf/ProcessPrivilege.h: Added.

2018-03-20  Tim Horton  <timothy_horton@apple.com>

        Introduce HAVE_MEDIA_PLAYER and HAVE_CORE_VIDEO
        https://bugs.webkit.org/show_bug.cgi?id=183803
        <rdar://problem/38690487>

        Reviewed by Sam Weinig.

        * wtf/Platform.h:

2018-03-20  Brian Burg  <bburg@apple.com>

        SLEEP_THREAD_FOR_DEBUGGER should not use fancy number literals
        https://bugs.webkit.org/show_bug.cgi?id=183792

        Reviewed by Timothy Hatcher.

        * wtf/DebugUtilities.h: Remove the '_s' since this won't
        compile when included by files compiled as Objective-C++.

2018-03-20  Tim Horton  <timothy_horton@apple.com>

        Add and adopt WK_PLATFORM_NAME and adjust default feature defines
        https://bugs.webkit.org/show_bug.cgi?id=183758
        <rdar://problem/38017644>

        Reviewed by Dan Bernstein.

        * wtf/FeatureDefines.h:

2018-03-19  Eric Carlson  <eric.carlson@apple.com>

        [Extra zoom mode] Require fullscreen for video playback
        https://bugs.webkit.org/show_bug.cgi?id=183742
        <rdar://problem/38235862>

        Reviewed by Jer Noble.

        * wtf/Platform.h:

2018-03-15  Tim Horton  <timothy_horton@apple.com>

        Avoid defining commonly-named system macros on all Cocoa platforms
        https://bugs.webkit.org/show_bug.cgi?id=183687

        Reviewed by Dan Bernstein.

        * wtf/Platform.h:

2018-03-14  Tim Horton  <timothy_horton@apple.com>

        Fix the build after r229387
        https://bugs.webkit.org/show_bug.cgi?id=183639
        <rdar://problem/38448568>

        Reviewed by Dean Jackson.

        * wtf/Platform.h:

2018-03-13  Tim Horton  <timothy_horton@apple.com>

        Add and adopt WK_ALTERNATE_FRAMEWORKS_DIR in WTF and bmalloc
        https://bugs.webkit.org/show_bug.cgi?id=183576
        <rdar://problem/38396766>

        Reviewed by Dan Bernstein.

        * Configurations/Base.xcconfig:
        * Configurations/CopyWTFHeaders.xcconfig:
        * Configurations/WTF.xcconfig:
        * Configurations/mbmalloc.xcconfig:

2018-03-13  Michael Catanzaro  <mcatanzaro@igalia.com>

        Unreviewed, fix typo in a comment

        * wtf/Platform.h:

2018-03-12  Don Olmstead  <don.olmstead@sony.com>

        [CMake][Win] Forwarding headers of WTF and PAL are copied twice in Visual Studio builds
        https://bugs.webkit.org/show_bug.cgi?id=183240

        Reviewed by Alex Christensen.

        * wtf/CMakeLists.txt:
        * wtf/PlatformGTK.cmake:
        * wtf/PlatformJSCOnly.cmake:
        * wtf/PlatformMac.cmake:
        * wtf/PlatformWPE.cmake:
        * wtf/PlatformWin.cmake:

2018-03-12  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, include time.h
        https://bugs.webkit.org/show_bug.cgi?id=183312

        Attempt to fix oss-fuzz build.

        * wtf/CurrentTime.cpp:
        * wtf/unix/CPUTimeUnix.cpp:

2018-03-12  Yoav Weiss  <yoav@yoav.ws>

        Runtime flag for link prefetch and remove link subresource.
        https://bugs.webkit.org/show_bug.cgi?id=183540

        Reviewed by Chris Dumez.

        Remove the LINK_PREFETCH build time flag.

        * wtf/FeatureDefines.h:

2018-03-12  Mark Lam  <mark.lam@apple.com>

        Make a NativeFunction into a class to support pointer profiling.
        https://bugs.webkit.org/show_bug.cgi?id=183573
        <rdar://problem/38384697>

        Reviewed by Filip Pizlo.

        Changed Poisoned so that it can be used on tagged pointers as well.

        * wtf/Poisoned.h:

2018-03-11  Filip Pizlo  <fpizlo@apple.com>

        Split DirectArguments into JSValueOOB and JSValueStrict parts
        https://bugs.webkit.org/show_bug.cgi?id=183458

        Reviewed by Yusuke Suzuki.

        * wtf/MathExtras.h:
        (WTF::dynamicPoison): Deleted.

2018-03-11  Yusuke Suzuki  <utatane.tea@gmail.com>

        [Win] Use SRWLOCK and CONDITION_VARIABLE to simplify implementation
        https://bugs.webkit.org/show_bug.cgi?id=183541

        Reviewed by Darin Adler.

        After Windows Vista, Windows offers SRWLOCK and CONDITION_VARIABLE.
        They can simplify the implementation of our WTF::Mutex and WTF::ThreadCondition.

        C++ std::mutex and std::condition_variable uses std::chrono for their timed
        functions. Since std::chrono is not overflow-aware, we cannot reliably use
        this functionalities. This is why we still keep WTF::Mutex and WTF::ThreadCondition.
        They are used for ParkingLot.

        * wtf/ThreadingPrimitives.h:
        * wtf/ThreadingWin.cpp:
        (WTF::Mutex::Mutex):
        (WTF::Mutex::~Mutex):
        (WTF::Mutex::lock):
        (WTF::Mutex::tryLock):
        (WTF::Mutex::unlock):
        (WTF::absoluteTimeToWaitTimeoutInterval):
        (WTF::ThreadCondition::ThreadCondition):
        (WTF::ThreadCondition::~ThreadCondition):
        (WTF::ThreadCondition::wait):
        (WTF::ThreadCondition::timedWait):
        (WTF::ThreadCondition::signal):
        (WTF::ThreadCondition::broadcast):
        (WTF::PlatformCondition::timedWait): Deleted.
        (WTF::PlatformCondition::signal): Deleted.

2018-03-10  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r229436.
        https://bugs.webkit.org/show_bug.cgi?id=183542

        seems to have regressed wasm compile times by 10% (Requested
        by pizlo-mbp on #webkit).

        Reverted changeset:

        "bmalloc mutex should be adaptive"
        https://bugs.webkit.org/show_bug.cgi?id=177839
        https://trac.webkit.org/changeset/229436

2018-03-09  Mark Lam  <mark.lam@apple.com>

        [Re-landing] Prepare LLInt code to support pointer profiling.
        https://bugs.webkit.org/show_bug.cgi?id=183387
        <rdar://problem/38199678>

        Reviewed by JF Bastien.

        * wtf/Platform.h:

2018-03-08  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r229354 and r229364.
        https://bugs.webkit.org/show_bug.cgi?id=183492

        Breaks internal builds (Requested by ryanhaddad on #webkit).

        Reverted changesets:

        "Prepare LLInt code to support pointer profiling."
        https://bugs.webkit.org/show_bug.cgi?id=183387
        https://trac.webkit.org/changeset/229354

        "Add support for ARM64E."
        https://bugs.webkit.org/show_bug.cgi?id=183398
        https://trac.webkit.org/changeset/229364

2018-03-08  Filip Pizlo  <fpizlo@apple.com>

        bmalloc mutex should be adaptive
        https://bugs.webkit.org/show_bug.cgi?id=177839

        Reviewed by Michael Saboff.
        
        Add some comments that I thought of while copy-pasting this code.

        Reland after failing to reproduce the WasmBench crash that caused it to get rolled out. Maybe that fixed
        itself somehow?

        * wtf/LockAlgorithmInlines.h:
        * wtf/WordLock.cpp:
        (WTF::WordLock::unlockSlow):

2018-03-08  Keith Miller  <keith_miller@apple.com>

        Disable JIT on Cocoa 32-bit ARM.
        https://bugs.webkit.org/show_bug.cgi?id=183426

        Reviewed by Michael Saboff.

        * wtf/Platform.h:

2018-03-08  Keith Miller  <keith_miller@apple.com>

        Use asm instead of __asm__ in WTFBreakpointTrap so MSVC builds
        https://bugs.webkit.org/show_bug.cgi?id=183465

        Reviewed by Michael Saboff.

        * wtf/Assertions.h:

2018-03-07  Filip Pizlo  <fpizlo@apple.com>

        Make it possible to randomize register allocation
        https://bugs.webkit.org/show_bug.cgi?id=183416

        Reviewed by Keith Miller.

        * wtf/MathExtras.h:
        (WTF::shuffleVector):

2018-03-08  Yusuke Suzuki  <utatane.tea@gmail.com>

        [Win] Use __debugbreak for WTFBreakpointTrap
        https://bugs.webkit.org/show_bug.cgi?id=183450

        Reviewed by Mark Lam.

        This patch adds WTFBreakpointTrap() implementation for MSVC by using
        __debugbreak. It fixes build failure in Windows due to the use of
        WTFBreakpointTrap().

        * wtf/Assertions.h:

2018-03-08  Zan Dobersek  <zdobersek@igalia.com>

        [GLib] RunLoop::wakeUp(): use a zero value instead of the monotonic time
        https://bugs.webkit.org/show_bug.cgi?id=183447

        Reviewed by Carlos Garcia Campos.

        * wtf/glib/RunLoopGLib.cpp:
        (WTF::RunLoop::wakeUp): Micro-optimize the wake-up schedule by using
        a zero value as the GSource ready time, instead of retrieving and using
        the current monotonic time.

2018-03-08  Tim Horton  <timothy_horton@apple.com>

        Don't have Celestial in minimal simulator configuration
        https://bugs.webkit.org/show_bug.cgi?id=183432
        <rdar://problem/38252985>

        Reviewed by Dan Bernstein.

        * wtf/Platform.h:

2018-03-06  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Set canInitializeWithMemset = true if T is an integral type
        https://bugs.webkit.org/show_bug.cgi?id=183357

        Reviewed by Darin Adler.

        This patch set `canInitializeWithMemset = true` if T is an integral type.
        This can offer a chance to use memset if we use UniqueArray<T> where T is
        an integral type. We also rename VectorTypeOperations::initialize to
        VectorTypeOperations::initializeIfNonPOD, VectorTypeOperations::forceInitialize
        to VectorTypeOperations::initialize respectively.

        * wtf/RefCountedArray.h:
        (WTF::RefCountedArray::RefCountedArray):
        * wtf/UniqueArray.h:
        * wtf/Vector.h:
        (WTF::VectorTypeOperations::initializeIfNonPOD):
        (WTF::VectorTypeOperations::initialize):
        (WTF::Vector::Vector):
        (WTF::Malloc>::resize):
        (WTF::Malloc>::grow):
        (WTF::VectorTypeOperations::forceInitialize): Deleted.
        * wtf/VectorTraits.h:

2018-03-07  Keith Miller  <keith_miller@apple.com>

        Meta-program setupArguments and callOperation
        https://bugs.webkit.org/show_bug.cgi?id=183263

        Rubber-stamped by Filip Pizlo.

        Add a new function traits struct that provides interesting
        information about the provided function pointer. Right now it only
        provides information for function pointers, in theory we could
        also get it to work for other types.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/Bitmap.h:
        (WTF::WordType>::Bitmap):
        * wtf/CMakeLists.txt:
        * wtf/FunctionTraits.h: Added.
        (WTF::slotsForCCallArgument):
        (WTF::computeCCallSlots):
        (WTF::FunctionTraits<Result):

2018-03-07  Tim Horton  <timothy_horton@apple.com>

        Shuffle around some feature flags for minimal simulator mode
        https://bugs.webkit.org/show_bug.cgi?id=183419
        <rdar://problem/37694987>

        Reviewed by Beth Dakin.

        * wtf/FeatureDefines.h:
        * wtf/Platform.h:

2018-03-06  Mark Lam  <mark.lam@apple.com>

        Prepare LLInt code to support pointer profiling.
        https://bugs.webkit.org/show_bug.cgi?id=183387
        <rdar://problem/38199678>

        Reviewed by JF Bastien.

        * wtf/Platform.h:

2018-03-06  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r229330.
        https://bugs.webkit.org/show_bug.cgi?id=183379

        Broke some Apple internal code (Requested by ap on #webkit).

        Reverted changeset:

        "Remove unused crash hook functionality"
        https://bugs.webkit.org/show_bug.cgi?id=183369
        https://trac.webkit.org/changeset/229330

2018-03-06  Michael Catanzaro  <mcatanzaro@igalia.com>

        Remove unused crash hook functionality
        https://bugs.webkit.org/show_bug.cgi?id=183369

        Reviewed by Alexey Proskuryakov.

        WTFSetCrashHook and WTFInstallReportBacktraceOnCrashHook are not used on any platforms and
        can be removed.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h:

2018-03-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        Fix std::make_unique / new[] using system malloc
        https://bugs.webkit.org/show_bug.cgi?id=182975

        Reviewed by JF Bastien.

        If we use `make_unique<char[]>(num)` or `new char[num]`, allocation is
        done by the system malloc instead of bmalloc. This patch fixes this issue
        by following three changes.

        1. Introduce UniqueArray<T>. It allocates memory from FastMalloc. While C++
        array with `new` need to hold the size to call destructor correctly, our
        UniqueArray only supports type T which does not have a non trivial destructor.
        It reduces the allocation size since we do not need to track the size of the
        array compared to standard `new T[]`. This is basically usable if we want to
        have raw array which pointer won't be changed even if the container is moved.
        In addition, we also extend UniqueArray<T> for types which have non trivial
        destructors.

        2. Use Vector<T> instead.

        3. Annotate allocated types with MAKE_FAST_ALLOCATED. Since it introduces
        new[] and delete[] operators, make_unique<T[]>(num) will allocate memory
        from FastMalloc.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/Assertions.cpp:
        * wtf/CMakeLists.txt:
        * wtf/FastMalloc.h:
        (WTF::FastFree::operator() const):
        (WTF::FastFree<T::operator() const):
        * wtf/MallocPtr.h:
        (WTF::MallocPtr::operator bool const):
        * wtf/StackShot.h:
        (WTF::StackShot::StackShot):
        (WTF::StackShot::operator=):
        * wtf/SystemFree.h:
        (WTF::SystemFree<T::operator() const):
        * wtf/UniqueArray.h: Copied from Source/WebKit/Platform/win/LoggingWin.cpp.
        (WTF::makeUniqueArray):
        * wtf/Vector.h:
        (WTF::VectorTypeOperations::forceInitialize):

2018-03-05  Michael Saboff  <msaboff@apple.com>

        Start using MAP_JIT for macOS
        https://bugs.webkit.org/show_bug.cgi?id=183353

        Reviewed by Filip Pizlo.

        Unify setting this flag for both iOS and macOS.

        * wtf/OSAllocatorPosix.cpp:
        (WTF::OSAllocator::reserveAndCommit):

2018-03-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, follow-up after r229209
        https://bugs.webkit.org/show_bug.cgi?id=183312

        Add RELEASE_ASSERT to ensure success.

        * wtf/cocoa/CPUTimeCocoa.mm:
        (WTF::CPUTime::forCurrentThread):
        * wtf/unix/CPUTimeUnix.cpp:
        (WTF::CPUTime::forCurrentThread):
        * wtf/win/CPUTimeWin.cpp:
        (WTF::CPUTime::forCurrentThread):

2018-03-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, fix MediaTime test
        https://bugs.webkit.org/show_bug.cgi?id=183319

        __builtin_xxx_overflow writes overflowed data into ResultType value even if overflow happens.
        This is different from the original CheckedArithmetic semantics.

        * wtf/CheckedArithmetic.h:

2018-03-04  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Move currentCPUTime and sleep(Seconds) to CPUTime.h and Seconds.h respectively
        https://bugs.webkit.org/show_bug.cgi?id=183312

        Reviewed by Mark Lam.

        1. currentCPUTime to CPUTime.h. It is now defined as CPUTime::forCurrentThread.
        We also removes fallback implementation for currentCPUTime since (1) that implementation
        is wrong and (2) no environments we support needs this.

        2. sleep(Seconds) to Seconds.h. Since sleep(MonotonicTime) and sleep(WallTime) are defined
        in MonotonicTime.h and WallTime.h, this code move is natural.

        3. Remove wtf/CurrentTime.h since nothing is defined now. But we keep CurrentTime.cpp to
        consolidate various time-source implementations in one place.

        * WTF.xcodeproj/project.pbxproj:
        * benchmarks/ConditionSpeedTest.cpp:
        * benchmarks/LockFairnessTest.cpp:
        * benchmarks/LockSpeedTest.cpp:
        * wtf/CMakeLists.txt:
        * wtf/CPUTime.h:
        * wtf/CurrentTime.cpp:
        (WTF::currentCPUTime): Deleted.
        (WTF::sleep): Deleted.
        * wtf/CurrentTime.h: Removed.
        * wtf/DateMath.cpp:
        * wtf/DebugUtilities.h:
        * wtf/FastMalloc.cpp:
        * wtf/MainThread.cpp:
        * wtf/MonotonicTime.cpp:
        * wtf/ParkingLot.cpp:
        * wtf/Seconds.cpp:
        (WTF::sleep):
        * wtf/Seconds.h:
        * wtf/StackShotProfiler.h:
        * wtf/Stopwatch.h:
        * wtf/ThreadingPthreads.cpp:
        * wtf/ThreadingWin.cpp:
        * wtf/cocoa/CPUTimeCocoa.mm:
        (WTF::CPUTime::forCurrentThread):
        * wtf/cocoa/MemoryPressureHandlerCocoa.mm:
        * wtf/linux/MemoryPressureHandlerLinux.cpp:
        * wtf/unix/CPUTimeUnix.cpp:
        (WTF::CPUTime::forCurrentThread):
        * wtf/win/CPUTimeWin.cpp:
        (WTF::CPUTime::forCurrentThread):
        * wtf/win/RunLoopWin.cpp:

2018-03-04  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Use __builtin_xxx_overflow for CheckedArithmetic
        https://bugs.webkit.org/show_bug.cgi?id=183319

        Reviewed by Darin Adler.

        GCC and Clang has the builtins for arithmetic operations with overflow flags.
        CheckedArithmetic operations can be done with this builtins. Since the compiler
        can use overflow flags, potentially this is more efficient. CheckedArithmetic
        already has TestWebKitAPI tests and we ensured the tests pass.

        * wtf/CheckedArithmetic.h:

2018-03-02  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Remove RunLoop and RunLoop::Timer's interface using double as seconds
        https://bugs.webkit.org/show_bug.cgi?id=183293

        Reviewed by Alex Christensen.

        This patch mainly drops startRepeating(double) and startOneShot(double) interfaces.
        Use startRepeating(Seconds) and startOneShot(Seconds) instead.

        * wtf/MemoryPressureHandler.cpp:
        (WTF::MemoryPressureHandler::setShouldUsePeriodicMemoryMonitor):
        * wtf/RunLoop.h:
        (WTF::RunLoop::TimerBase::startRepeating):
        (WTF::RunLoop::TimerBase::startOneShot):
        (WTF::RunLoop::TimerBase::startInternal):
        * wtf/RunLoopTimer.h:
        * wtf/RunLoopTimerCF.cpp:
        (WTF::RunLoopTimerBase::start):
        * wtf/cf/RunLoopCF.cpp:
        (WTF::RunLoop::runForDuration):
        (WTF::RunLoop::TimerBase::start):
        * wtf/generic/RunLoopGeneric.cpp:
        (WTF::RunLoop::TimerBase::start):
        * wtf/glib/RunLoopGLib.cpp:
        (WTF::RunLoop::TimerBase::start):
        * wtf/win/MemoryPressureHandlerWin.cpp:
        (WTF::MemoryPressureHandler::install):
        * wtf/win/RunLoopWin.cpp:
        (WTF::RunLoop::TimerBase::start):

2018-03-02  Christopher Reid  <chris.reid@sony.com>

        Build fix after r229174
        https://bugs.webkit.org/show_bug.cgi?id=183301

        Reviewed by Alex Christensen.

        Updating MemoryPressureHandler::holdOff to use Seconds instead of unsigned.

        * wtf/MemoryPressureHandler.cpp:

2018-03-02  Tim Horton  <timothy_horton@apple.com>

        Make it possible to build for iOS without Celestial
        https://bugs.webkit.org/show_bug.cgi?id=183295
        <rdar://problem/38074468>

        Reviewed by Dan Bernstein.

        * wtf/Platform.h:

2018-03-02  Tim Horton  <timothy_horton@apple.com>

        Make it possible to disable WKPDFView
        https://bugs.webkit.org/show_bug.cgi?id=183281
        <rdar://problem/38060815>

        Reviewed by Dan Bates.

        * wtf/FeatureDefines.h:

2018-03-02  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Annotate more classes with WTF_MAKE_FAST_ALLOCATED
        https://bugs.webkit.org/show_bug.cgi?id=183279

        Reviewed by JF Bastien.

        * wtf/SimpleStats.h:
        * wtf/ThreadGroup.h:

2018-03-01  Yusuke Suzuki  <utatane.tea@gmail.com>

        Remove monotonicallyIncreasingTime
        https://bugs.webkit.org/show_bug.cgi?id=182911

        Reviewed by Michael Catanzaro.

        This patch drops monotonicallyIncreasingTime and monotonicallyIncreasingTimeMS.
        We have MonotonicTime API instead. This offers strongly typed MonotonicTime,
        Seconds etc. This reduces the chance of bugs mixing doubles which represent milliseconds
        and seconds.

        Large part of this patch is mechanical one: replacing monotonicallyIncreasingTime with
        MonotonicTime, using MonotonicTime and Seconds instead of raw doubles.

        But this patch actually finds some bugs (but it is a bit difficult to show it as a test).
        One is mixing media time (CACurrentMediaTime()) and MonotonicTime. Basically they are
        super close because both uses mach_absolute_time(). But they would be slightly different.
        So we should not mix them.

        The second bug is GraphicsLayer::suspendAnimations(double). While CA ports (Apple, AppleWin,
        iOS etc.) use this double as MonotonicTime, GTK and WPE use this double as Seconds (timeOffset).
        This patch fixes it and now the signature becomes GraphicsLayer::suspendAnimations(MonotonicTime).

        In this patch, we still uses bunch of double for Seconds. But fixing them at this patch increases
        the size of this larger and larger. So some of them remains double. This should be fixed in
        subsequent patches.

        * benchmarks/ConditionSpeedTest.cpp:
        * benchmarks/LockSpeedTest.cpp:
        * wtf/CurrentTime.cpp:
        (WTF::MonotonicTime::now):
        (WTF::monotonicallyIncreasingTime): Deleted.
        * wtf/CurrentTime.h:
        (WTF::monotonicallyIncreasingTimeMS): Deleted.
        * wtf/MemoryPressureHandler.h:
        * wtf/MonotonicTime.cpp:
        (WTF::MonotonicTime::now): Deleted.
        * wtf/MonotonicTime.h:
        * wtf/ParkingLot.cpp:
        * wtf/Seconds.h:
        (WTF::Seconds::nan):
        * wtf/Stopwatch.h:
        (WTF::Stopwatch::reset):
        (WTF::Stopwatch::start):
        (WTF::Stopwatch::stop):
        (WTF::Stopwatch::elapsedTime):
        (WTF::Stopwatch::elapsedTimeSince):
        * wtf/cocoa/MemoryPressureHandlerCocoa.mm:
        (WTF::MemoryPressureHandler::holdOff):
        (WTF::MemoryPressureHandler::respondToMemoryPressure):
        * wtf/linux/MemoryPressureHandlerLinux.cpp:
        (WTF::MemoryPressureHandler::EventFDPoller::EventFDPoller):
        (WTF::MemoryPressureHandler::holdOff):
        (WTF::MemoryPressureHandler::respondToMemoryPressure):
        * wtf/win/MemoryPressureHandlerWin.cpp:
        (WTF::MemoryPressureHandler::holdOff):

2018-03-02  Dan Bernstein  <mitz@apple.com>

        Safari uses WebContent.Development when loading injected bundle embedded in its app bundle
        https://bugs.webkit.org/show_bug.cgi?id=183275

        Reviewed by Tim Horton.

        * wtf/spi/cocoa/SecuritySPI.h: Declared SecTaskGetCodeSignStatus.

2018-02-27  Karlen Simonyan  <szkarlen@gmail.com>

        [Win64] JSCOnly compile error using VS2017 and cmake
        https://bugs.webkit.org/show_bug.cgi?id=183176

        Reviewed by Alex Christensen.

        * wtf/PlatformJSCOnly.cmake:

2018-02-26  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GStreamer] User current executable name instead of g_get_prgname() for gst_init
        https://bugs.webkit.org/show_bug.cgi?id=183119

        Reviewed by Philippe Normand.

        Add getCurrentExecutableName() helper function to get the name of the current executable.

        * wtf/glib/GLibUtilities.cpp:
        (getCurrentExecutableName): Get the basename of getCurrentExecutablePath() falling back to g_get_prgname().
        * wtf/glib/GLibUtilities.h:

2018-02-23  John Wilander  <wilander@apple.com>

        Introduce ITP debug logging as an opt-in developer feature
        https://bugs.webkit.org/show_bug.cgi?id=183065
        <rdar://problem/37803761>

        Reviewed by Brent Fulgham.

        * wtf/Assertions.h:
            Introduces RELEASE_LOG_INFO() and RELEASE_LOG_INFO_IF().

2018-02-23  Fujii Hironori  <Hironori.Fujii@sony.com>

        warning: unused variable 'InitialBufferSize' in Assertions.cpp
        https://bugs.webkit.org/show_bug.cgi?id=183076

        Reviewed by Yusuke Suzuki.

        * wtf/Assertions.cpp: Moved the definition of InitialBufferSize to inside #if.

2018-02-22  Yusuke Suzuki  <utatane.tea@gmail.com>

        Remove currentTime() / currentTimeMS()
        https://bugs.webkit.org/show_bug.cgi?id=183052

        Reviewed by Mark Lam.

        This patch removes WTF::currentTime() and WTF::currentTimeMS().
        We have fancy WallTime APIs. It has strong types like WallTime and Seconds,
        and this reduces the chance of bugs mixing doubles which represent milliseconds
        and seconds.

        * wtf/Condition.h:
        * wtf/CurrentTime.cpp:
        (WTF::currentTime):
        (WTF::WallTime::now):
        * wtf/CurrentTime.h:
        (WTF::currentTimeMS): Deleted.
        * wtf/DateMath.h:
        (WTF::jsCurrentTime):
        * wtf/ParkingLot.cpp:
        (WTF::ParkingLot::parkConditionallyImpl):
        * wtf/ThreadingPrimitives.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::ThreadCondition::timedWait):
        * wtf/ThreadingWin.cpp:
        (WTF::ThreadCondition::timedWait):
        (WTF::absoluteTimeToWaitTimeoutInterval):
        * wtf/WallTime.cpp:
        (WTF::WallTime::now): Deleted.
        * wtf/WallTime.h:

2018-02-22  Yusuke Suzuki  <utatane.tea@gmail.com>

        Remove sleep(double) and sleepMS(double) interfaces
        https://bugs.webkit.org/show_bug.cgi?id=183038

        Reviewed by Mark Lam.

        This patch removes sleep(double) and sleepMS(double) interfaces.
        We can just use sleep(Seconds) instead.

        * benchmarks/LockFairnessTest.cpp:
        * benchmarks/LockSpeedTest.cpp:
        * wtf/CurrentTime.cpp:
        (WTF::sleep):
        * wtf/CurrentTime.h:
        (WTF::sleepMS): Deleted.
        * wtf/DebugUtilities.h:
        * wtf/Seconds.cpp:
        (WTF::sleep): Deleted.
        * wtf/Seconds.h:
        * wtf/StackShotProfiler.h:

2018-02-21  Don Olmstead  <don.olmstead@sony.com>

        [CMake][Win] Use cmakeconfig.h rather than config.h and Platform.h
        https://bugs.webkit.org/show_bug.cgi?id=182883

        Reviewed by Per Arne Vollan.

        * wtf/Platform.h:

2018-02-14  Brian Burg  <bburg@apple.com>

        Web Automation: combine session commands to resize and move top-level browsing contexts
        https://bugs.webkit.org/show_bug.cgi?id=182749
        <rdar://problem/37515170>

        Reviewed by Andy Estes.

        * wtf/JSONValues.h: add a getDouble() implementation that returns a std::optional<T>
        rather than using an out-parameter. I'd like to move more code to this style.

2018-02-20  Tim Horton  <timothy_horton@apple.com>

        Introduce HAVE(IOSURFACE_ACCELERATOR)
        https://bugs.webkit.org/show_bug.cgi?id=182955
        <rdar://problem/37699510>

        Reviewed by Sam Weinig.

        * wtf/Platform.h:

2018-02-20  Chris Dumez  <cdumez@apple.com>

        Provisional load may get committed before receiving the decidePolicyForNavigationResponse response
        https://bugs.webkit.org/show_bug.cgi?id=182720
        <rdar://problem/37515204>

        Reviewed by Alex Christensen.

        Add convenience CompletionHandlerCallingScope class which calls its CompletionHandler
        when destroyed, and provides a release() methods to manually call the completionHandler.

        * wtf/CompletionHandler.h:
        (WTF::CompletionHandlerCallingScope::CompletionHandlerCallingScope):
        (WTF::CompletionHandlerCallingScope::~CompletionHandlerCallingScope):
        (WTF::CompletionHandlerCallingScope::CompletionHandler<void):

2018-02-20  Tim Horton  <timothy_horton@apple.com>

        Always inline soft linking functions to work around a clang bug
        https://bugs.webkit.org/show_bug.cgi?id=182985
        <rdar://problem/37587017>

        Reviewed by Dan Bernstein.

        * wtf/cocoa/SoftLinking.h:
        In some cases, clang will emit a weak extern symbol for a re-declared
        symbol that has availability attributes on it. To avoid this, always
        inline to avoid emitting a second symbol.

2018-02-16  Dean Jackson  <dino@apple.com>

        Use OPENGL macros to be more clear about which OpenGL/ES WebGL uses on Cocoa
        https://bugs.webkit.org/show_bug.cgi?id=182894

        Reviewed by Tim Horton.

        If we're on a Cocoa platform, define USE_OPENGL/USE_OPENGL_ES
        depending on what we're actually going to use. In this case,
        they are exclusive, but it doesn't appear that other platforms
        use this approach. Ultimately the idea is to be more concerned
        with the type of OpenGL we're using, rather than the platform.

        * wtf/Platform.h: Define USE_OPENGL(_ES) for PLATFORM(COCOA).

2018-02-16  Filip Pizlo  <fpizlo@apple.com>

        Unreviewed, roll out r228306 (custom memcpy/memset) because the bots say that it was not a
        progression.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/BitVector.cpp:
        (WTF::BitVector::setSlow):
        (WTF::BitVector::clearAll):
        (WTF::BitVector::resizeOutOfLine):
        * wtf/BitVector.h:
        (WTF::BitVector::OutOfLineBits::numWords const):
        (WTF::BitVector::wordCount): Deleted.
        * wtf/CMakeLists.txt:
        * wtf/ConcurrentBuffer.h:
        (WTF::ConcurrentBuffer::growExact):
        * wtf/FastBitVector.h:
        (WTF::FastBitVectorWordOwner::operator=):
        (WTF::FastBitVectorWordOwner::clearAll):
        (WTF::FastBitVectorWordOwner::set):
        * wtf/FastCopy.h: Removed.
        * wtf/FastMalloc.cpp:
        (WTF::fastZeroedMalloc):
        (WTF::fastStrDup):
        (WTF::tryFastZeroedMalloc):
        * wtf/FastZeroFill.h: Removed.
        * wtf/OSAllocator.h:
        (WTF::OSAllocator::reallocateCommitted):
        * wtf/StringPrintStream.cpp:
        (WTF::StringPrintStream::increaseSize):
        * wtf/Vector.h:
        * wtf/persistence/PersistentDecoder.cpp:
        (WTF::Persistence::Decoder::decodeFixedLengthData):
        * wtf/persistence/PersistentEncoder.cpp:
        (WTF::Persistence::Encoder::encodeFixedLengthData):
        * wtf/text/CString.cpp:
        (WTF::CString::init):
        (WTF::CString::copyBufferIfNeeded):
        * wtf/text/LineBreakIteratorPoolICU.h:
        (WTF::LineBreakIteratorPool::makeLocaleWithBreakKeyword):
        * wtf/text/StringBuilder.cpp:
        (WTF::StringBuilder::allocateBuffer):
        (WTF::StringBuilder::append):
        * wtf/text/StringConcatenate.h:
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::copyCharacters):
        * wtf/text/icu/UTextProvider.cpp:
        (WTF::uTextCloneImpl):
        * wtf/text/icu/UTextProviderLatin1.cpp:
        (WTF::uTextLatin1Clone):
        (WTF::openLatin1UTextProvider):
        * wtf/threads/Signals.cpp:

2018-02-16  Keith Miller  <keith_miller@apple.com>

        Remove unused line from Platform.h
        https://bugs.webkit.org/show_bug.cgi?id=182871

        Reviewed by Mark Lam.

        * wtf/Platform.h:

2018-02-14  Michael Saboff  <msaboff@apple.com>

        REGRESSION(225695) : com.apple.WebKit.WebContent at com.apple.JavaScriptCore: JSC::RegExp::match + 630 :: stack overflow
        https://bugs.webkit.org/show_bug.cgi?id=182705

        Reviewed by Mark Lam.

        Moved the setting of ENABLE_YARR_JIT_ALL_PARENS_EXPRESSIONS to Platform.h since more than just the YARR
        code needs to know if that feature is enabled.

        * wtf/Platform.h:

2018-02-12  Mark Lam  <mark.lam@apple.com>

        Add more support for pointer preparations.
        https://bugs.webkit.org/show_bug.cgi?id=182703
        <rdar://problem/37469451>

        Reviewed by Saam Barati.

        * wtf/PointerPreparations.h:

2018-02-09  Ross Kirsling  <ross.kirsling@sony.com>

        Use REQUEST_ANIMATION_FRAME_DISPLAY_MONITOR on any non-Windows port.
        https://bugs.webkit.org/show_bug.cgi?id=182623

        Reviewed by Alex Christensen.

        * wtf/Platform.h:
        Simplify #if.

2018-02-08  Filip Pizlo  <fpizlo@apple.com>

        Experiment with alternative implementation of memcpy/memset
        https://bugs.webkit.org/show_bug.cgi?id=182563

        Reviewed by Michael Saboff and Mark Lam.
        
        Adds a faster x86_64-specific implementation of memcpy and memset. These versions go by
        different names than memcpy/memset and have a different API:
        
        WTF::fastCopy<T>(T* dst, T* src, size_t N): copies N values of type T from src to dst.
        WTF::fastZeroFill(T* dst, size_T N): writes N * sizeof(T) zeroes to dst.
        
        There are also *Bytes variants that take void* for dst and src and size_t numBytes. Those are
        most appropriate in places where the code is already computing bytes.
        
        These will just call memcpy/memset on platforms where the optimized versions are not supported.
        
        These new functions are not known to the compiler to be memcpy/memset. This has the effect that
        the compiler will not try to replace them with anything else. This could be good or bad:
        
        - It's *good* if the size is *not known* at compile time. In that case, by my benchmarks, these
          versions are faster than either the memcpy/memset call or whatever else the compiler could
          emit. This is because of a combination of inlining and the algorithm itself (see below).
        
        - It's *bad* if the size is *known* at compile time. In that case, the compiler could
          potentially emit a fully unrolled memcpy/memset. That might not happen if the size is large
          (even if it's known), but in this patch I avoid replacing any memcpy/memset calls when the
          size is a constant. In particular, this totally avoids the call overhead -- if the size is
          small, then the compiler will emit a nice inlined copy or set. If the size is large, then the
          most optimal thing to do is emit the shortest piece of code possible, and that's a call to
          memcpy/memset.
        
        It's unfortunate that you have to choose between them on your own. One way to avoid that might
        have been to override the memcpy/memset symbols, so that the compiler can still do its
        reasoning. But that's not quite right, since then we would lose inlining in the unknonw-size
        case. Also, it's possible that for some unknown-size cases, the compiler could choose to emit
        something on its own because it might think that some property of aliasing or alignment could
        help it. I think it's a bit better to use our own copy/set implementations even in those cases.
        Another way that I tried avoiding this is to detect inside fastCopy/fastZeroFill if the size is
        constant. But there is no good way to do that in C++. There is a builtin for doing that inside a
        macro, but that feels janky, so I didn't want to do it in this patch.
        
        The reason why these new fastCopy/fastZeroFill functions are faster is that:
        
        - They can be inlined. There is no function call. Only a few registers get clobbered. So, the
          impact on the quality of the code surrounding the memcpy/memset is smaller.
        
        - They use type information to select the implementation. For sizes that are multiples of 2, 4,
          or 8, the resulting code performs dramatically better on small arrays than memcpy because it
          uses fewer cycles. The difference is greatest for 2 and 4 byte types, since memcpy usually
          handles small arrays by tiering from a 8-byte word copy loop to a byte copy loop. So, for 2
          or 4 byte arrays, we use an algorithm that tiers from 8-byte word down to a 2-byte or 4-byte
          (depending on type) copy loop. So, for example, when copying a 16-bit string that has 1, 2, or
          3 characters, this means doing 1, 2, or 3 word copies rather than 2, 4, or 6 byte copies. For
          8-byte types, the resulting savings are mainly that there is no check to see if a tier-down to
          the byte-copy loop is needed -- so really that means reducing code size. 1-byte types don't
          get this inherent advantage over memcpy/memset, but they still benefit from all of the other
          advantages of these functions. Of course, this advantage isn't inherent to our approach. The
          compiler could also notice that the arguments to memcpy/memset have some alignment properties.
          It could do it even more generally than we do - for example a copy over bytes where the size
          is a multiple of 4 can use the 4-byte word algorithm. But based on my tests, the compiler does
          not do this (even though it does other things, like turn a memset call with a zero value
          argument into a bzero call).
        
        - They use a very nicely written word copy/set loop for small arrays. I spent a lot of time
          getting the assembly just right. When we use memcpy/memset, sometimes we would optimize the
          call by having a fast path word copy loop for small sizes. That's not necessary with this
          implementation, since the assembly copy loop gets inlined.
        
        - They use `rep movs` or `rep stos` for copies of 200 bytes or more. This decision benchmarks
          poorly on every synthetic memcpy/memset benchmark I have built, and so unsurprisingly, it's
          not what system memcpy/memset does. Most system memcpy/memset implementations end up doing
          some SSE for medium-sized copies,. However, I previously found that this decision is bad for
          one of the memset calls in GC (see clearArray() and friends in ArrayConventions.h|cpp) - I was
          able to make the overhead of that call virtually disappear by doing `rep stos` more
          aggressively. The theory behind this change is that it's not just the GC that prefers smaller
          `rep` threshold and no SSE. I am betting that `rep`ing more is better when the heap gets
          chaotic and the data being copied is used in interesting ways -- hence, synthetic
          memcpy/memset benchmarks think it's bad (they don't do enough chaotic memory accesses) while
          it's good for real-world uses. Also, when I previously worked on JVMs, I had found that the
          best memcpy/memset heuristics when dealing with GC'd objects in a crazy heap were different
          than any memcpy/memset in any system library.
        
        This appears to be a 0.9% speed-up on PLT. I'm not sure if it's more because of the inlining or
        the `rep`. I think it's both. I'll leave figuring out the exact tuning for future patches.

        * wtf/BitVector.cpp:
        (WTF::BitVector::setSlow):
        (WTF::BitVector::clearAll):
        (WTF::BitVector::resizeOutOfLine):
        * wtf/BitVector.h:
        (WTF::BitVector::wordCount):
        (WTF::BitVector::OutOfLineBits::numWords const):
        * wtf/ConcurrentBuffer.h:
        (WTF::ConcurrentBuffer::growExact):
        * wtf/FastBitVector.h:
        (WTF::FastBitVectorWordOwner::operator=):
        (WTF::FastBitVectorWordOwner::clearAll):
        (WTF::FastBitVectorWordOwner::set):
        * wtf/FastCopy.h: Added.
        (WTF::fastCopy):
        (WTF::fastCopyBytes):
        * wtf/FastMalloc.cpp:
        (WTF::fastZeroedMalloc):
        (WTF::fastStrDup):
        (WTF::tryFastZeroedMalloc):
        * wtf/FastZeroFill.h: Added.
        (WTF::fastZeroFill):
        (WTF::fastZeroFillBytes):
        * wtf/MD5.cpp:
        * wtf/OSAllocator.h:
        (WTF::OSAllocator::reallocateCommitted):
        * wtf/StringPrintStream.cpp:
        (WTF::StringPrintStream::increaseSize):
        * wtf/Vector.h:
        * wtf/persistence/PersistentDecoder.cpp:
        (WTF::Persistence::Decoder::decodeFixedLengthData):
        * wtf/persistence/PersistentEncoder.cpp:
        (WTF::Persistence::Encoder::encodeFixedLengthData):
        * wtf/text/CString.cpp:
        (WTF::CString::init):
        (WTF::CString::copyBufferIfNeeded):
        * wtf/text/LineBreakIteratorPoolICU.h:
        (WTF::LineBreakIteratorPool::makeLocaleWithBreakKeyword):
        * wtf/text/StringBuilder.cpp:
        (WTF::StringBuilder::allocateBuffer):
        (WTF::StringBuilder::append):
        * wtf/text/StringConcatenate.h:
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::copyCharacters):
        * wtf/text/icu/UTextProvider.cpp:
        (WTF::uTextCloneImpl):
        * wtf/text/icu/UTextProviderLatin1.cpp:
        (WTF::uTextLatin1Clone):
        (WTF::openLatin1UTextProvider):
        * wtf/threads/Signals.cpp:

2018-02-06  Darin Adler  <darin@apple.com>

        Event improvements
        https://bugs.webkit.org/show_bug.cgi?id=179591

        Reviewed by Chris Dumez.

        * wtf/text/OrdinalNumber.h: Added som missing const.
        * wtf/text/TextPosition.h: Ditto.

2018-02-06  Fujii Hironori  <Hironori.Fujii@sony.com>

        [GTK] fast/events/message-channel-gc-4.html is flaky
        https://bugs.webkit.org/show_bug.cgi?id=182104

        Reviewed by Carlos Garcia Campos.

        Revert r228001 because RunLoop::current isn't called in GC thread
        anymore since r228152.

        * wtf/RunLoop.cpp:
        (WTF::RunLoop::current): Removed a template argument
        CanBeGCThread::True of ThreadSpecific.

2018-02-05  Konstantin Tokarev  <annulen@yandex.ru>

        [cmake] Fix build with ICU configured without collation support
        https://bugs.webkit.org/show_bug.cgi?id=182498

        Reviewed by Alex Christensen.

        WebKit has CollatorDefault.cpp providing necessary stubs when
        UCONFIG_NO_COLLATION is defined, however it is not included in cmake
        file list.

        * wtf/CMakeLists.txt:

2018-02-05  Alicia Boya García  <aboya@igalia.com>

        Fix bug in MediaTime comparison for negative values with different scale.
        https://bugs.webkit.org/show_bug.cgi?id=182433

        Reviewed by Xabier Rodriguez-Calvar.

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::compare const):

2018-02-02  Mark Lam  <mark.lam@apple.com>

        More ARM64_32 fixes.
        https://bugs.webkit.org/show_bug.cgi?id=182441
        <rdar://problem/37162310>

        Reviewed by Dan Bernstein.

        My previous speculative ARM64_32 build fix in copyLCharsFromUCharSource() was wrong.
        I've now fixed it to choose the default implementation case instead of the ARM64
        case if the target is ARM64_32.

        * wtf/text/ASCIIFastPath.h:
        (WTF::copyLCharsFromUCharSource):

2018-02-02  Konstantin Tokarev  <annulen@yandex.ru>

        Unreviewed build fix for JSCOnly on macOS after r227845.
        https://bugs.webkit.org/show_bug.cgi?id=182274

        Reverted part of r227845 that moved CommonCryptoSPI.h
        handling into PlatformMac, because it is needed for all
        ports which can be built on macOS.

        * wtf/CMakeLists.txt:
        * wtf/PlatformMac.cmake:

2018-02-02  Fujii Hironori  <Hironori.Fujii@sony.com>

        [GTK] fast/events/message-channel-gc-4.html is flaky
        https://bugs.webkit.org/show_bug.cgi?id=182104

        Reviewed by Carlos Garcia Campos.

        RELEASE_ASSERT of ThreadSpecific::set fails because
        RunLoop::current is called even in GC thread since r227275.

        * wtf/RunLoop.cpp:
        (WTF::RunLoop::current):
        Let the second template argument of ThreadSpecific CanBeGCThread::True.

2018-02-01  Michael Catanzaro  <mcatanzaro@igalia.com>

        [WPE][GTK] Make RunLoop::TimerBase robust to its own deletion inside its source callback
        https://bugs.webkit.org/show_bug.cgi?id=182271

        Reviewed by Carlos Garcia Campos.

        RunLoopTimer::fired executes the user's callback, which could delete the RunLoopTimer
        itself. But the source callback is not prepared to handle this case. We can detect it
        easily, because TimerBase's destructor will call g_source_destroy(), which confusingly
        removes the GSource from its GMainContext without actually destroying the GSource. Then we
        can check if the GSource is still attached using g_source_is_destroyed().

        * wtf/glib/RunLoopGLib.cpp:
        (WTF::RunLoop::TimerBase::TimerBase):

2018-01-31  Saam Barati  <sbarati@apple.com>

        Replace tryLargeMemalignVirtual with tryLargeZeroedMemalignVirtual and use it to allocate large zeroed memory in Wasm
        https://bugs.webkit.org/show_bug.cgi?id=182064
        <rdar://problem/36840132>

        Reviewed by Geoffrey Garen.

        * wtf/Gigacage.cpp:
        (Gigacage::tryAllocateZeroedVirtualPages):
        (Gigacage::freeVirtualPages):
        (Gigacage::tryAllocateVirtualPages): Deleted.
        * wtf/Gigacage.h:
        * wtf/OSAllocator.h:

2018-01-31  Mark Lam  <mark.lam@apple.com>

        Fix some ARM64_32 build failures.
        https://bugs.webkit.org/show_bug.cgi?id=182356
        <rdar://problem/37057690>

        Reviewed by Michael Saboff.

        * wtf/MathExtras.h:
        (WTF::dynamicPoison):
        * wtf/text/ASCIIFastPath.h:
        (WTF::copyLCharsFromUCharSource):

2018-01-30  Mark Lam  <mark.lam@apple.com>

        Apply poisoning to TypedArray vector pointers.
        https://bugs.webkit.org/show_bug.cgi?id=182155
        <rdar://problem/36286266>

        Reviewed by JF Bastien.

        1. Added the ability to poison a CagedPtr.

        2. Prevent CagedPtr from being implicitly instantiated, and add operator= methods
           instead.  This is because implicitly instantiated CagedPtrs with a poisoned
           trait may silently use a wrong poison value.

        * wtf/CagedPtr.h:
        (WTF::CagedPtr::CagedPtr):
        (WTF::CagedPtr::get const):
        (WTF::CagedPtr::operator=):

2018-01-30  Fujii Hironori  <Hironori.Fujii@sony.com>

        [Win] Warning fix.
        https://bugs.webkit.org/show_bug.cgi?id=177007

        Reviewed by Yusuke Suzuki.

        A 32 bit integer should not be casted to a pointer directly in 64
        bit Windows. It should be casted to a uintptr_t beforehand.

        Rules for Using Pointers (Windows)
        https://msdn.microsoft.com/library/windows/desktop/aa384242

        * wtf/ThreadingWin.cpp (InvalidThread): Casted 0xbbadbeef to uintptr_t.

2018-01-30  Don Olmstead  <don.olmstead@sony.com>

        Unreviewed build fix for JSCOnly after r227845.
        https://bugs.webkit.org/show_bug.cgi?id=182274

        * wtf/PlatformJSCOnly.cmake:

2018-01-30  Don Olmstead  <don.olmstead@sony.com>

        [CMake] Make WTF headers copies
        https://bugs.webkit.org/show_bug.cgi?id=182274

        Reviewed by Alex Christensen.

        * wtf/CMakeLists.txt:
        * wtf/PlatformGTK.cmake:
        * wtf/PlatformJSCOnly.cmake:
        * wtf/PlatformMac.cmake:
        * wtf/PlatformWPE.cmake:
        * wtf/PlatformWin.cmake:

2018-01-30  Mark Lam  <mark.lam@apple.com>

        Move ENABLE_POISON to Platform.h.
        https://bugs.webkit.org/show_bug.cgi?id=182298
        <rdar://problem/37032686>

        Reviewed by Michael Saboff and JF Bastien.

        ENABLE_POISON belongs in Platform.h to ensure that all places that depend on
        ENABLE(POISON) will see it properly defined.

        * wtf/Platform.h:
        * wtf/Poisoned.h:

2018-01-26  Mark Lam  <mark.lam@apple.com>

        Add infrastructure for pointer preparation.
        https://bugs.webkit.org/show_bug.cgi?id=182191
        <rdar://problem/36889194>

        Reviewed by JF Bastien.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/PointerPreparations.h: Added.

2018-01-26  Chris Nardi  <cnardi@chromium.org>

        Addressing post-review comments after r226614
        https://bugs.webkit.org/show_bug.cgi?id=182151

        Reviewed by Myles C. Maxfield.

        * wtf/text/StringImpl.h:
        (WTF::isSpaceOrNewline):
        * wtf/text/TextBreakIterator.cpp:
        (WTF::numCodeUnitsInGraphemeClusters):
        * wtf/text/TextBreakIterator.h:

2018-01-26  Filip Pizlo  <fpizlo@apple.com>

        Fix style - need to use C comments.

        * wtf/Platform.h:

2018-01-26  Filip Pizlo  <fpizlo@apple.com>

        Disable TLS-based TLCs
        https://bugs.webkit.org/show_bug.cgi?id=182175

        Reviewed by Saam Barati.

        Add a flag for TLS-based TLCs and set it to 0. We can re-enable this feature when we need to use TLCs for
        actual thread-local allocation and when we fix the fact that WebCore context switches JSC VMs without telling
        us.

        * wtf/Platform.h:

2018-01-25  Filip Pizlo  <fpizlo@apple.com>

        Unreviewed, fix windows build.

        * wtf/MathExtras.h:
        (WTF::opaque):

2018-01-24  Filip Pizlo  <fpizlo@apple.com>

        DirectArguments should protect itself using dynamic poisoning and precise index masking
        https://bugs.webkit.org/show_bug.cgi?id=182086

        Reviewed by Saam Barati.
        
        Add helpers for:
        
        Dynamic poisoning: this means arranging to have the pointer you will dereference become an
        invalid pointer if the type check you were relying on would have failed.
        
        Precise index masking: a variant of index masking that does not depend on distancing. I figured
        I'd just try this first for DirectArguments, since I didn't think that arguments[i] was ever
        hot enough to warrant anything better. Turns out that in all of the benchmarks that care about
        arguments performance, we optimize things to the point that the index masking isn't on a hot
        path anymore. Turns out, it's neutral!

        * wtf/MathExtras.h:
        (WTF::preciseIndexMask):
        (WTF::dynamicPoison):

2018-01-25  Jer Noble  <jer.noble@apple.com>

        Unreviewed build fix after r227631; make USE_VIDEOTOOLBOX universally enabled on iOS.

        * wtf/Platform.h:

2018-01-25  Jer Noble  <jer.noble@apple.com>

        Move ImageDecoderAVFObjC from using AVSampleBufferGenerator to AVAssetReaderOutput for parsing
        https://bugs.webkit.org/show_bug.cgi?id=182091

        Reviewed by Eric Carlson.

        * wtf/Platform.h:

2018-01-25  Mark Lam  <mark.lam@apple.com>

        Rename the Poisoned::isPoisoned constant to Poisoned::isPoisonedType.
        https://bugs.webkit.org/show_bug.cgi?id=182143
        <rdar://problem/36880970>

        Reviewed by JF Bastien.

        This is so that it doesn't conflict with the isPoisoned() debugging methods that
        are normally not built.  Also renamed PoisonedUniquePtr::isPoisonedUniquePtr to
        PoisonedUniquePtr::isPoisonedUniquePtrType to be consistent.

        * wtf/Poisoned.h:
        * wtf/PoisonedUniquePtr.h:

2018-01-25  Filip Pizlo  <fpizlo@apple.com>

        JSC GC should support TLCs (thread local caches)
        https://bugs.webkit.org/show_bug.cgi?id=181559

        Reviewed by Mark Lam and Saam Barati.

        * wtf/Bitmap.h: Just fixing a compile error.

2018-01-25  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r227592.
        https://bugs.webkit.org/show_bug.cgi?id=182110

        it made ARM64 (Linux and iOS) crash (Requested by pizlo-mbp on
        #webkit).

        Reverted changeset:

        "JSC GC should support TLCs (thread local caches)"
        https://bugs.webkit.org/show_bug.cgi?id=181559
        https://trac.webkit.org/changeset/227592

2018-01-20  Filip Pizlo  <fpizlo@apple.com>

        JSC GC should support TLCs (thread local caches)
        https://bugs.webkit.org/show_bug.cgi?id=181559

        Reviewed by Mark Lam and Saam Barati.

        * wtf/Bitmap.h: Just fixing a compile error.

2018-01-23  Mark Lam  <mark.lam@apple.com>

        Update Poisoned pointers to take a Poison class instead of a uintptr_t&.
        https://bugs.webkit.org/show_bug.cgi?id=182017
        <rdar://problem/36795513>

        Reviewed by Filip Pizlo and JF Bastien.

        This paves the way for custom poison values which we'll need for use in
        TypedArrays later.

        * wtf/Bag.h:
        * wtf/DumbPtrTraits.h:
        (WTF::DumbPtrTraits::poison): Deleted.
        * wtf/DumbValueTraits.h:
        (WTF::DumbValueTraits::poison): Deleted.
        * wtf/Poisoned.h:
        (WTF::Poison::key):
        (WTF::Poisoned::swap):
        (WTF::Poisoned::poison const):
        (WTF::Poisoned::unpoison const):
        (WTF::Poisoned::poison):
        (WTF::Poisoned::unpoison):
        (WTF::PoisonedPtrTraits::swap):
        (WTF::PoisonedValueTraits::swap):
        (WTF::PoisonedPtrTraits::poison): Deleted.
        (WTF::PoisonedValueTraits::poison): Deleted.
        * wtf/PoisonedUniquePtr.h:
        * wtf/Ref.h:
        * wtf/RefCountedArray.h:
        * wtf/RefPtr.h:
        * wtf/WTFAssertions.cpp:

2018-01-23  Alex Christensen  <achristensen@webkit.org>

        Remove pre-Sierra-OS-specific code in WTF and JavaScriptCore
        https://bugs.webkit.org/show_bug.cgi?id=182028

        Reviewed by Keith Miller.

        * wtf/Platform.h:
        * wtf/mac/AppKitCompatibilityDeclarations.h:
        * wtf/mac/DeprecatedSymbolsUsedBySafari.mm:
        (WTF::MainThreadFunctionTracker::singleton): Deleted.
        (WTF::MainThreadFunctionTracker::callOnMainThread): Deleted.
        (WTF::MainThreadFunctionTracker::cancelCallOnMainThread): Deleted.
        (WTF::MainThreadFunctionTracker::addFunction): Deleted.
        (WTF::MainThreadFunctionTracker::removeIdentifier): Deleted.
        (WTF::MainThreadFunctionTracker::removeFunctions): Deleted.
        (WTF::callOnMainThread): Deleted.
        (WTF::cancelCallOnMainThread): Deleted.
        * wtf/spi/cocoa/SecuritySPI.h:
        * wtf/spi/darwin/dyldSPI.h:
        * wtf/text/icu/TextBreakIteratorICU.h:
        (WTF::TextBreakIteratorICU::TextBreakIteratorICU):
        (WTF::caretRules): Deleted.

2018-01-23  Filip Pizlo  <fpizlo@apple.com>

        JSC should use a speculation fence on VM entry/exit
        https://bugs.webkit.org/show_bug.cgi?id=181991

        Reviewed by JF Bastien and Mark Lam.
        
        Implement speculationFence as lfence on x86 and isb on ARM64. I'm not sure if isb is
        appropriate for all ARM64's.

        * wtf/Atomics.h:
        (WTF::speculationFence):
        (WTF::x86_lfence):

2018-01-22  Alex Christensen  <achristensen@webkit.org>

        Begin removing QTKit code
        https://bugs.webkit.org/show_bug.cgi?id=181951

        Reviewed by Jer Noble.

        * wtf/Platform.h:

2018-01-21  Wenson Hsieh  <wenson_hsieh@apple.com>

        Add a new feature flag for EXTRA_ZOOM_MODE and reintroduce AdditionalFeatureDefines.h
        https://bugs.webkit.org/show_bug.cgi?id=181918

        Reviewed by Tim Horton.

        Include AdditionalFeatureDefines.h, if possible. This allows WebKitAdditions to override
        the value of certain feature flags in the OpenSource WebKit repository.

        * wtf/Platform.h:

2018-01-19  Alex Christensen  <achristensen@webkit.org>

        Fix jsc-only build
        https://bugs.webkit.org/show_bug.cgi?id=181874

        Reviewed by JF Bastien.

        This makes "build-webkit --jsc-only" work on Mac!

        * wtf/PlatformJSCOnly.cmake:

2018-01-19  Keith Miller  <keith_miller@apple.com>

        HaveInternalSDK includes should be "#include?"
        https://bugs.webkit.org/show_bug.cgi?id=179670

        Reviewed by Dan Bernstein.

        * Configurations/Base.xcconfig:

2018-01-19  Alexey Proskuryakov  <ap@apple.com>

        Update XPCSPI.h
        https://bugs.webkit.org/show_bug.cgi?id=181827
        rdar://problem/36393031

        Reviewed by Daniel Bates.

        * wtf/spi/darwin/XPCSPI.h:

2018-01-18  Chris Dumez  <cdumez@apple.com>

        We should be able to terminate service workers that are unresponsive
        https://bugs.webkit.org/show_bug.cgi?id=181563
        <rdar://problem/35280031>

        Reviewed by Alex Christensen.

        * wtf/ObjectIdentifier.h:
        (WTF::ObjectIdentifier::loggingString const):
        Allow using loggingString() from RELEASE_LOG().

2018-01-18  Dan Bernstein  <mitz@apple.com>

        [Xcode] Streamline and future-proof target-macOS-version-dependent build setting definitions
        https://bugs.webkit.org/show_bug.cgi?id=181803

        Reviewed by Tim Horton.

        * Configurations/Base.xcconfig: Updated.
        * Configurations/DebugRelease.xcconfig: Updated.

2018-01-17  Daniel Bates  <dabates@apple.com>

        REGRESSION (r222795): Cardiogram never signs in
        https://bugs.webkit.org/show_bug.cgi?id=181693
        <rdar://problem/36286293>

        Reviewed by Ryosuke Niwa.

        Add macro define for future iOS.

        * wtf/spi/darwin/dyldSPI.h:

2018-01-17  Per Arne Vollan  <pvollan@apple.com>

        [Win] Compile error: 'wtf/text/icu/TextBreakIteratorICU.h' not found.
        https://bugs.webkit.org/show_bug.cgi?id=181744
        <rdar://problem/36582562>

        Reviewed by Alex Christensen.

        Add WTF folders to forwarding headers directories.

        * wtf/PlatformWin.cmake:

2018-01-16  Per Arne Vollan  <pvollan@apple.com>

        [Win] JSC compile error in runtime/DateConversion.cpp.
        https://bugs.webkit.org/show_bug.cgi?id=181690
        <rdar://problem/36480409>
 
        Reviewed by Brent Fulgham.

        Add 'text/win' folder to list of forwarding headers directories.
 
        * wtf/PlatformWin.cmake:

2018-01-15  Michael Catanzaro  <mcatanzaro@igalia.com>

        Improve use of ExportMacros
        https://bugs.webkit.org/show_bug.cgi?id=181652

        Reviewed by Konstantin Tokarev.

        * wtf/ExportMacros.h: Simplify the #defines in this file.
        * wtf/Platform.h: Remove unneeded define. Remove comment that expects all ports to
          eventually enable the export macros. WPE will never want these. We don't currently want
          them for GTK either, though how we link GTK has been in flux recently.

2018-01-15  JF Bastien  <jfbastien@apple.com>

        Remove makePoisonedUnique
        https://bugs.webkit.org/show_bug.cgi?id=181630
        <rdar://problem/36498623>

        Reviewed by Mark Lam.

        I added a conversion from std::unique_ptr, so we can just use
        std::make_unique and it'll auto-poison when converted.

        * wtf/PoisonedUniquePtr.h:
        (WTF::makePoisonedUnique): Deleted.

2018-01-13  Mark Lam  <mark.lam@apple.com>

        Replace all use of ConstExprPoisoned with Poisoned.
        https://bugs.webkit.org/show_bug.cgi?id=181542
        <rdar://problem/36442138>

        Reviewed by JF Bastien.

        1. Removed ConstExprPoisoned and its artifacts.

        2. Consolidated Poisoned into PoisonedImpl.  PoisonedImpl is not more.

        3. Changed all clients of ConstExprPoisoned to use Poisoned instead.

        4. Worked around the GCC and Clang compiler bug that confuses an intptr_t&
           template arg with intptr_t.
           See use of std::enable_if_t<Other::isPoisoned> in Poisoned.h.

        5. Removed ENABLE(MIXED_POISON) since we now have a workaround (3) that makes it
           possible to use the mixed poison code.

        6. Also fixed broken implementation of comparison operators in Poisoned.

        * wtf/Bag.h:
        * wtf/DumbPtrTraits.h:
        (WTF::DumbPtrTraits::poison):
        * wtf/DumbValueTraits.h:
        (WTF::DumbValueTraits::poison):
        * wtf/Poisoned.h:
        (WTF::Poisoned::Poisoned):
        (WTF::Poisoned::operator== const):
        (WTF::Poisoned::operator!= const):
        (WTF::Poisoned::operator< const):
        (WTF::Poisoned::operator<= const):
        (WTF::Poisoned::operator> const):
        (WTF::Poisoned::operator>= const):
        (WTF::Poisoned::operator=):
        (WTF::Poisoned::swap):
        (WTF::swap):
        (WTF::PoisonedPtrTraits::poison):
        (WTF::PoisonedPtrTraits::swap):
        (WTF::PoisonedValueTraits::poison):
        (WTF::PoisonedValueTraits::swap):
        (WTF::PoisonedImpl::PoisonedImpl): Deleted.
        (WTF::PoisonedImpl::assertIsPoisoned const): Deleted.
        (WTF::PoisonedImpl::assertIsNotPoisoned const): Deleted.
        (WTF::PoisonedImpl::unpoisoned const): Deleted.
        (WTF::PoisonedImpl::clear): Deleted.
        (WTF::PoisonedImpl::operator* const): Deleted.
        (WTF::PoisonedImpl::operator-> const): Deleted.
        (WTF::PoisonedImpl::bits const): Deleted.
        (WTF::PoisonedImpl::operator! const): Deleted.
        (WTF::PoisonedImpl::operator bool const): Deleted.
        (WTF::PoisonedImpl::operator== const): Deleted.
        (WTF::PoisonedImpl::operator!= const): Deleted.
        (WTF::PoisonedImpl::operator< const): Deleted.
        (WTF::PoisonedImpl::operator<= const): Deleted.
        (WTF::PoisonedImpl::operator> const): Deleted.
        (WTF::PoisonedImpl::operator>= const): Deleted.
        (WTF::PoisonedImpl::operator=): Deleted.
        (WTF::PoisonedImpl::swap): Deleted.
        (WTF::PoisonedImpl::exchange): Deleted.
        (WTF::PoisonedImpl::poison): Deleted.
        (WTF::PoisonedImpl::unpoison): Deleted.
        (WTF::constExprPoisonRandom): Deleted.
        (WTF::makeConstExprPoison): Deleted.
        (WTF::ConstExprPoisonedPtrTraits::exchange): Deleted.
        (WTF::ConstExprPoisonedPtrTraits::swap): Deleted.
        (WTF::ConstExprPoisonedPtrTraits::unwrap): Deleted.
        (WTF::ConstExprPoisonedValueTraits::exchange): Deleted.
        (WTF::ConstExprPoisonedValueTraits::swap): Deleted.
        (WTF::ConstExprPoisonedValueTraits::unwrap): Deleted.
        * wtf/PoisonedUniquePtr.h:
        (WTF::PoisonedUniquePtr::PoisonedUniquePtr):
        (WTF::PoisonedUniquePtr::operator=):
        * wtf/Ref.h:
        * wtf/RefCountedArray.h:
        (WTF::RefCountedArray::RefCountedArray):
        * wtf/RefPtr.h:
        * wtf/WTFAssertions.cpp:

2018-01-12  JF Bastien  <jfbastien@apple.com>

        PoisonedWriteBarrier
        https://bugs.webkit.org/show_bug.cgi?id=181599
        <rdar://problem/36474351>

        Reviewed by Mark Lam.

        Supporting changes needed to allow poisoning of WriteBarrier
        objects.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/DumbPtrTraits.h:
        * wtf/DumbValueTraits.h: Copied from Source/WTF/wtf/DumbPtrTraits.h.
        (WTF::DumbValueTraits::exchange):
        (WTF::DumbValueTraits::swap):
        (WTF::DumbValueTraits::unwrap):
        * wtf/Forward.h:
        * wtf/Poisoned.h:
        (WTF::ConstExprPoisonedValueTraits::exchange):
        (WTF::ConstExprPoisonedValueTraits::swap):
        (WTF::ConstExprPoisonedValueTraits::unwrap):

2018-01-11  Basuke Suzuki  <Basuke.Suzuki@sony.com>

        Remove noexcept from definition of std::tie()
        https://bugs.webkit.org/show_bug.cgi?id=181577

        Reviewed by Yusuke Suzuki.

        * wtf/StdLibExtras.h:
        (WTF::tie):

2018-01-11  Filip Pizlo  <fpizlo@apple.com>

        Reserve a fast TLS key for GC TLC
        https://bugs.webkit.org/show_bug.cgi?id=181539

        Reviewed by Alexey Proskuryakov.
        
        Who knew that thread-local caches would be a mitigation for timing attacks. Here's how it
        works: if we have TLCs then we can "context switch" them when we "context switch" origins. 
        This allows us to put some minimal distance between objects from different origins, which
        gives us the ability to allow small overflows when doing certain bounds checks without
        creating a useful Spectre information leak.
        
        So I think that means we have to implement thread-local caches (also known as thread-local
        allocation buffers, but I prefer the TLC terminology).

        * wtf/FastTLS.h:

2018-01-04  Filip Pizlo  <fpizlo@apple.com>

        CodeBlocks should be in IsoSubspaces
        https://bugs.webkit.org/show_bug.cgi?id=180884

        Reviewed by Saam Barati.
        
        Deque<>::contains() is helpful for a debug ASSERT.

        * wtf/Deque.h:
        (WTF::inlineCapacity>::contains):

2018-01-11  JF Bastien  <jfbastien@apple.com>

        NFC reorder headers
        https://bugs.webkit.org/show_bug.cgi?id=181521

        Reviewed by Darin Adler.

        Follow-up on r226752. I misunderstood the header include order
        style. No functional change.

        * wtf/Poisoned.h:
        * wtf/PoisonedUniquePtr.h:

2018-01-10  JF Bastien  <jfbastien@apple.com>

        Poison small JSObject derivatives which only contain pointers
        https://bugs.webkit.org/show_bug.cgi?id=181483
        <rdar://problem/36407127>

        Reviewed by Mark Lam.

        The associated JSC poisoning change requires some template
        "improvements" to our poisoning machinery. Worth noting is that
        I'm making PoisonedUniquePtr move-assignable and
        move-constructible from unique_ptr, which makes it a better
        drop-in replacement because we don't need to use
        makePoisonedUniquePtr. This means function-locals can be
        unique_ptr and get the nice RAII pattern, and once the function is
        done you can just move to the class' PoisonedUniquePtr without
        worrying.

        * wtf/Poisoned.h:
        (WTF::PoisonedImpl::PoisonedImpl):
        * wtf/PoisonedUniquePtr.h:
        (WTF::PoisonedUniquePtr::PoisonedUniquePtr):
        (WTF::PoisonedUniquePtr::operator=):

2018-01-10  Don Olmstead  <don.olmstead@sony.com>

        Add nullptr_t specialization of poison
        https://bugs.webkit.org/show_bug.cgi?id=181469

        Reviewed by JF Bastien.

        * wtf/Poisoned.h:
        (WTF::PoisonedImpl::poison):

2018-01-10  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r226667 and r226673.
        https://bugs.webkit.org/show_bug.cgi?id=181488

        This caused a flaky crash. (Requested by mlewis13 on #webkit).

        Reverted changesets:

        "CodeBlocks should be in IsoSubspaces"
        https://bugs.webkit.org/show_bug.cgi?id=180884
        https://trac.webkit.org/changeset/226667

        "REGRESSION (r226667): CodeBlocks should be in IsoSubspaces"
        https://bugs.webkit.org/show_bug.cgi?id=180884
        https://trac.webkit.org/changeset/226673

2018-01-04  Filip Pizlo  <fpizlo@apple.com>

        CodeBlocks should be in IsoSubspaces
        https://bugs.webkit.org/show_bug.cgi?id=180884

        Reviewed by Saam Barati.
        
        Deque<>::contains() is helpful for a debug ASSERT.

        * wtf/Deque.h:
        (WTF::inlineCapacity>::contains):

2018-01-08  Don Olmstead  <don.olmstead@sony.com>

        Add WTF_EXPORTs to UniStdExtras
        https://bugs.webkit.org/show_bug.cgi?id=181415

        Reviewed by Alex Christensen.

        * wtf/UniStdExtras.h:

2018-01-07  Mark Lam  <mark.lam@apple.com>

        Apply poisoning to more pointers in JSC.
        https://bugs.webkit.org/show_bug.cgi?id=181096
        <rdar://problem/36182970>

        Reviewed by JF Bastien.

        Added support for PoisonedBag and PoisonedRefCountedArray.

        * wtf/Bag.h:
        (WTF::Private::BagNode::BagNode):
        (WTF::Bag::Bag):
        (WTF::Bag::operator=):
        (WTF::Bag::clear):
        (WTF::Bag::add):
        (WTF::Bag::begin):
        (WTF::Bag::unwrappedHead):
        (WTF::Bag::Node::Node): Deleted.
        * wtf/BagToHashMap.h:
        (WTF::toHashMap):
        * wtf/Poisoned.h:
        (WTF::constExprPoisonRandom):
        (WTF::makeConstExprPoison):
        * wtf/RefCountedArray.h:
        (WTF::RefCountedArray::RefCountedArray):
        (WTF::RefCountedArray::clone const):
        (WTF::RefCountedArray::operator=):
        (WTF::RefCountedArray::~RefCountedArray):
        (WTF::RefCountedArray::refCount const):
        (WTF::RefCountedArray::size const):
        (WTF::RefCountedArray::data):
        (WTF::RefCountedArray::begin):
        (WTF::RefCountedArray::end):
        (WTF::RefCountedArray::data const):
        (WTF::RefCountedArray::begin const):
        (WTF::RefCountedArray::operator== const):
        (WTF::RefCountedArray::Header::fromPayload):
        * wtf/WTFAssertions.cpp:

2018-01-05  JF Bastien  <jfbastien@apple.com>

        WebAssembly: poison JS object's secrets
        https://bugs.webkit.org/show_bug.cgi?id=181339
        <rdar://problem/36325001>

        Reviewed by Mark Lam.

        swapping a poisoned pointer with a non-poisoned one (as is done in
        JSWebAssembyMemory::adopt) was missing.

        * wtf/Poisoned.h:
        (WTF::PoisonedImpl::swap):
        (WTF::ConstExprPoisonedPtrTraits::swap):

2018-01-05  David Kilzer  <ddkilzer@apple.com>

        Re-enable -Wcast-qual in WebCore for Apple ports
        <https://webkit.org/b/177895>
        <rdar://problem/34960830>

        Reviewed by Joseph Pecoraro.

        * wtf/RetainPtr.h:
        (WTF::RetainPtr::fromStorageTypeHelper const): Add const_cast<>
        operator here since some CFTypes are not defined as const
        pointers, which triggers a warning in C++ source with
        -Wcast-qual when casting from CFTypeRef back to the original
        type.  Note that we use const_cast<CF_BRIDGED_TYPE(id) void*>()
        here (and in TypeCastsCF.h below) since this is what CFTypeRef
        is defined as in CFBase.h, but without the 'const' modifier.
        (WTF::RetainPtr::fromStorageType const): Ditto.

        * wtf/cf/TypeCastsCF.h: Use #pragma once.
        (WTF_DECLARE_CF_TYPE_TRAIT): Rename from DECLARE_CF_TYPE_TRAIT.
        Don't #undef it so that it can be used in other source files.
        (WTF_DECLARE_CF_MUTABLE_TYPE_TRAIT): Add new macro that is used
        for declaring CFMutable types.  The CFTypeID for CF_Foo_ and
        CFMutable_Foo_ are the same, so we have to use a different macro
        to declare type traits for those types.
        (WTF::dynamic_cf_cast): Add assertion to catch issues in Debug
        builds.
        (WTF::checked_cf_cast): Inline code from WTF::dynamic_cf_cast
        and change behavior to be more consistent between Debug and
        Release builds, as well as other "checked" functions.
        Previously this function would return nullptr in Release builds
        if nullptr or the wrong type of object was passed in, but crash
        in both cases on Debug builds.  The new behavior always returns
        nullptr if nullptr was passed in (but never crashes), and always
        crashes if the wrong type of object is passed in.

2018-01-04  Keith Miller  <keith_miller@apple.com>

        TypedArrays and Wasm should use index masking.
        https://bugs.webkit.org/show_bug.cgi?id=181313

        Reviewed by Michael Saboff.

        * wtf/MathExtras.h:
        (WTF::computeIndexingMask):

2018-01-03  Michael Saboff  <msaboff@apple.com>

        Disable SharedArrayBuffers from Web API
        https://bugs.webkit.org/show_bug.cgi?id=181266

        Reviewed by Saam Barati.

        Turn off SharedArrayBuffers using a compile time flag ENABLE_SHARED_ARRAY_BUFFER.

        * wtf/Platform.h:

2017-12-28  Yusuke Suzuki  <utatane.tea@gmail.com>

        Remove std::chrono completely
        https://bugs.webkit.org/show_bug.cgi?id=181186

        Reviewed by Alex Christensen.

        std::chrono's overflow unaware design is dangerous[1]. Even small code like
        `condition.wait_for(std::chrono::seconds::max())` is broken in some platforms
        due to overflow of std::chrono::time_point. So we intentionally avoid using
        std::chrono, and use WallTime, MonotonicTime, Seconds instead.

        This patch removes all the remaining use of std::chrono from WebKit tree.

        [1]: https://lists.webkit.org/pipermail/webkit-dev/2016-May/028242.html

        * wtf/CrossThreadCopier.h:
        Remove std::chrono support from cross thread copiers.
        * wtf/Forward.h:
        * wtf/MonotonicTime.h:
        (WTF::MonotonicTime::isolatedCopy const):
        Add isolatedCopy function.
        * wtf/RunLoop.h:
        (WTF::RunLoop::TimerBase::startRepeating):
        (WTF::RunLoop::TimerBase::startOneShot):
        Just remove these helpers.
        * wtf/Seconds.h:
        (WTF::Seconds::isolatedCopy const):
        Add isolatedCopy function.
        * wtf/WallTime.h:
        (WTF::WallTime::isolatedCopy const):
        Add isolatedCopy function.
        * wtf/persistence/PersistentCoders.h:
        (WTF::Persistence::Coder<Seconds>::encode):
        (WTF::Persistence::Coder<Seconds>::decode):
        (WTF::Persistence::Coder<WallTime>::encode):
        (WTF::Persistence::Coder<WallTime>::decode):
        Add persistent coder support for Seconds and WallTime.
        (WTF::Persistence::Coder<std::chrono::system_clock::time_point>::encode): Deleted.
        (WTF::Persistence::Coder<std::chrono::system_clock::time_point>::decode): Deleted.
        Remove std::chrono support from persistent coders.

2018-01-02  Mark Lam  <mark.lam@apple.com>

        Refactoring: Rename DummyClass to DummyStruct because it's a struct.
        https://bugs.webkit.org/show_bug.cgi?id=181230

        Reviewed by JF Bastien.

        * wtf/WTFAssertions.cpp:

2018-01-02  Mark Lam  <mark.lam@apple.com>

        Ensure that poisoned pointers do not look like double or int32 JSValues.
        https://bugs.webkit.org/show_bug.cgi?id=181221
        <rdar://problem/36248638>

        Reviewed by JF Bastien.

        Changed poison values to ensure that poisoned bits (i.e. pointer ^ poison)
        satisfies the following conditions:
        1. bits 48-63 are 0: this ensures that poisoned bits look like a pointer and
           not a double or int32 JSValue.
        2. bits 32-47 are not completely 0.
        3. bit 2 is never 0: this ensures that the poisoned value of a non-null pointer
           will never be null.
        4. bit 0-1 is always 0: this ensures that clients can still use the 2 bottom
           bits of the poisoned value as flag bits (just like they were able to do with
           pointer values).  The only difference is that bit 2 can no longer be used for
           flag bits because poisoned values need it to always be set.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/PointerAsserts.cpp: Removed.

        * wtf/Poisoned.cpp:
        (WTF::makePoison):
        - Updated to satisfy the above requirements.
        
        * wtf/Poisoned.h:
        (WTF::makeConstExprPoison):
        (WTF::makePoison): Deleted.

        * wtf/WTFAssertions.cpp: Copied from Source/WTF/wtf/PointerAsserts.cpp.
        - Renamed from PointerAsserts.cpp because we assert more things than just
          pointers here.
        - Added some assertions to test makeConstExprPoison() to ensure that it satisfies
          the above requirements.

2017-12-28  Yusuke Suzuki  <utatane.tea@gmail.com>

        Remove std::chrono if it is not used for ArgumentCoder or PersistentCoder
        https://bugs.webkit.org/show_bug.cgi?id=181174

        Reviewed by Konstantin Tokarev.

        Make WallTime more constexpr friendly. This change is already applied to MonoTonicTime.

        We would like to move std::{isfinite,isinf,isnan} overloadings from std:: to each class scope in a separate patch[1].

        [1]: https://bugs.webkit.org/show_bug.cgi?id=181183

        * wtf/WallTime.h:
        (WTF::WallTime::WallTime):
        (WTF::WallTime::fromRawSeconds):
        (WTF::WallTime::infinity):
        (WTF::WallTime::secondsSinceEpoch const):
        (WTF::WallTime::operator bool const):
        (WTF::WallTime::operator+ const):
        (WTF::WallTime::operator- const):
        (WTF::WallTime::operator== const):
        (WTF::WallTime::operator!= const):
        (WTF::WallTime::operator< const):
        (WTF::WallTime::operator> const):
        (WTF::WallTime::operator<= const):
        (WTF::WallTime::operator>= const):

2017-12-28  Fujii Hironori  <Hironori.Fujii@sony.com>

        [Win][CMake] Use add_custom_command to copy each forwarding header files
        https://bugs.webkit.org/show_bug.cgi?id=180921

        Reviewed by Brent Fulgham.

        * wtf/PlatformWin.cmake: Use WEBKIT_MAKE_FORWARDING_HEADERS.

2017-12-27  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Add clock_gettime based monotonicallyIncreasingTime implementation for Linux and BSDs
        https://bugs.webkit.org/show_bug.cgi?id=181175

        Reviewed by Michael Catanzaro.

        Use platform-provided POSIX APIs to get monotonic time.

        * wtf/CurrentTime.cpp:
        (WTF::monotonicallyIncreasingTime):

2017-12-26  Carlos Alberto Lopez Perez  <clopez@igalia.com>

        REGRESSION(r225769): Build error with constexpr std::max // std::min in libdstdc++4
        https://bugs.webkit.org/show_bug.cgi?id=181160

        Reviewed by Myles C. Maxfield.

        In libstdc++-4 std::max and std::min are not annotated with constexpr.
        This patch adds a WTF::min and WTF::max for using where a constexpr result is expected.
        Related: https://gcc.gnu.org/bugzilla/show_bug.cgi?id=60271

        * wtf/StdLibExtras.h:
        (WTF::min):
        (WTF::max):

2017-12-26  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Remove std::chrono completely
        https://bugs.webkit.org/show_bug.cgi?id=181165

        Reviewed by Konstantin Tokarev.

        WTF::currentCPUTime now returns WTF::Seconds.
        We also add the implementaiton for Linux and FreeBSD.

        * wtf/CurrentTime.cpp:
        (WTF::currentCPUTime):
        * wtf/CurrentTime.h:

2017-12-22  Wenson Hsieh  <wenson_hsieh@apple.com>

        Unreviewed, try to fix the Sierra build after r226277.

        The macOS 10.12 SDK does not know about NSControlStateValue and some types of NSLevelIndicatorStyles, so these
        need to be declared in a separate section in AppKitCompatibilityDeclarations.h (rather than in the < macOS 10.12
        SDK #ifdef).

        * wtf/mac/AppKitCompatibilityDeclarations.h:

2017-12-22  Wenson Hsieh  <wenson_hsieh@apple.com>

        Fix build failures due to using deprecated AppKit symbols
        https://bugs.webkit.org/show_bug.cgi?id=181110
        <rdar://problem/36162865>

        Reviewed by Dan Bernstein and Tim Horton.

        When building with older macOS SDKs where some AppKit constants don't exist, define the modern constants to be
        equal to their deprecated counterparts. This allows us to just have the modern types in WebKit sources while
        avoiding breakage on old SDKs.

        This, along with many other symbols in the compability header, can be removed once WebKit stops supporting macOS
        10.11.

        * wtf/mac/AppKitCompatibilityDeclarations.h:

2017-12-21  Mark Lam  <mark.lam@apple.com>

        Add WTF::PoisonedUniquePtr to replace std::unique_ptr when poisoning is desired.
        https://bugs.webkit.org/show_bug.cgi?id=181062
        <rdar://problem/36167040>

        Reviewed by Chris Dumez.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/PointerAsserts.cpp: Copied from Source/WTF/wtf/RefPtr.cpp.
        - renamed file because we asserts all kinds of pointers in here, not just RefPtr.
        
        * wtf/Poisoned.h:
        - added a missing #include.
        - make constexpr poison values more scrambled.
        (WTF::makePoison):

        * wtf/PoisonedUniquePtr.h: Added.
        (WTF::PoisonedUniquePtr::PoisonedUniquePtr):
        (WTF::PoisonedUniquePtr::~PoisonedUniquePtr):
        (WTF::PoisonedUniquePtr::create):
        (WTF::PoisonedUniquePtr::operator=):
        (WTF::PoisonedUniquePtr::get const):
        (WTF::PoisonedUniquePtr::operator[] const):
        (WTF::PoisonedUniquePtr::clear):
        (WTF::PoisonedUniquePtr::destroy):
        (WTF::PoisonedUniquePtr::clearWithoutDestroy):
        (WTF::makePoisonedUnique):
        * wtf/RefPtr.cpp: Removed.

2017-12-21  Jeremy Jones  <jeremyj@apple.com>

        Element fullscreen interface should display the location
        https://bugs.webkit.org/show_bug.cgi?id=181006
        rdar://problem/36143176

        Reviewed by Simon Fraser.

        Add SecTrustCopyInfo SPI.

        * wtf/spi/cocoa/SecuritySPI.h:

2017-12-20  Fujii Hironori  <Hironori.Fujii@sony.com>

        [CMake][WTF] Lowercase ForwardingHeaders directory name of WTF
        https://bugs.webkit.org/show_bug.cgi?id=181022

        Reviewed by Konstantin Tokarev.

        * wtf/CMakeLists.txt: Renamed ForwardingHeaders directory name WTF to wtf.
        * wtf/PlatformWin.cmake: Ditto.

2017-12-19  Brian Burg  <bburg@apple.com>

        SLEEP_THREAD_FOR_DEBUGGER() macro should try to print out the PID of the affected process
        https://bugs.webkit.org/show_bug.cgi?id=180947

        Reviewed by Joseph Pecoraro.

        * wtf/DebugUtilities.h:
        - Use sleep() from CurrentTime.h as it is more cross-platform.
        - Print a message with the process PID to simplify attaching to sleeping thread.
        - Include source location in case multiple such macros are being used.

2017-12-18  Daniel Bates  <dabates@apple.com>

        Conditionally forward declare NSMapTable SPI
        https://bugs.webkit.org/show_bug.cgi?id=180936
        <rdar://problem/35037796>

        Reviewed by Dan Bernstein.

        * wtf/spi/cocoa/NSMapTableSPI.h:

2017-12-16  Filip Pizlo  <fpizlo@apple.com>

        Vector index masking
        https://bugs.webkit.org/show_bug.cgi?id=180909

        Reviewed by Keith Miller.
        
        Adds index masking to StringImpl and Vector.
        
        Perf:
        
        - 0.4% slower on microbenchmarks.
        - Octane totally even.
        - Kraken may be 0.8% slower.
        - Speedometer is 0.8% slower with p = 0.008.
        - membuster is even:
            - snap2pre: 0.7% bigger w/ p = 0.26,
            - snap2post: 0.3% smaller w/ p = 0.81,
            - snap3pre: 1.2% bigger w/ p = 0.63,
            - snap3post: 0.4% smaller w/ p = 0.76.

        * wtf/MathExtras.h:
        (WTF::roundUpToPowerOfTwo):
        (WTF::maskForSize):
        * wtf/SizeLimits.cpp:
        * wtf/Vector.h:
        (WTF::VectorBufferBase::allocateBuffer):
        (WTF::VectorBufferBase::tryAllocateBuffer):
        (WTF::VectorBufferBase::reallocateBuffer):
        (WTF::VectorBufferBase::deallocateBuffer):
        (WTF::VectorBufferBase::releaseBuffer):
        (WTF::VectorBufferBase::VectorBufferBase):
        (WTF::VectorBufferBase::updateMask):
        (WTF::VectorBuffer::allocateBuffer):
        (WTF::VectorBuffer::tryAllocateBuffer):
        (WTF::VectorBuffer::swap):
        (WTF::VectorBuffer::restoreInlineBufferIfNeeded):
        (WTF::Vector::at):
        (WTF::Vector::at const):
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::maskOffset):
        (WTF::StringImpl::mask const):
        (WTF::StringImplShape::StringImplShape):
        (WTF::StringImpl::at const):
        (WTF::StringImpl::tailOffset):
        * wtf/text/StringView.h:
        (WTF::StringView::StringView):
        (WTF::StringView::operator=):
        (WTF::StringView::initialize):
        (WTF::StringView::clear):
        (WTF::StringView::operator[] const):
        * wtf/text/WTFString.h:
        (WTF::String::mask const):

2017-12-18  Claudio Saavedra  <csaavedra@igalia.com>

        [GTK][Darwin] Do not define mach exceptions for GTK+

        Rubber-stamped by Michael Catanzaro.
        * wtf/Platform.h:

2017-12-17  Yusuke Suzuki  <utatane.tea@gmail.com>

        [FTL] NewArrayBuffer should be sinked if it is only used for spreading
        https://bugs.webkit.org/show_bug.cgi?id=179762

        Reviewed by Saam Barati.

        We add RecursableLambda<>. This can take a lambda and offer a way
        to call this lambda recursively without introducing additional allocations.

        C++ lambda is super useful in particular when we need to capture many
        variables as references. Passing many arguments to a usual function is not
        a good way. But C++ lambda does not allow us to easily call itself recursively.

        Our recursableLambda offers `self` function as a first argument of the
        given lambda. We can call this `self` recursively.

        auto targetFunction = recursableLambda([] (auto self, ...) -> resultType {
            self(...);
        });

        While `std::function<> func = [&func] { ... }` allows recursion, it causes
        heap allocation for std::function<>. `auto func = [&func] { ... }` causes
        a compile error since we need to deduce an actual type when capturing `func`.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/RecursableLambda.h: Added.
        (WTF::RecursableLambda::RecursableLambda):
        (WTF::RecursableLambda::operator() const):
        (WTF::recursableLambda):

2017-12-17  Mark Lam  <mark.lam@apple.com>

        Enhance Ref and RefPtr to be able to work with smart pointers.
        https://bugs.webkit.org/show_bug.cgi?id=180762
        <rdar://problem/36027122>

        Reviewed by JF Bastien and Darin Adler.

        This is so we can use them with ConstExprPoisoned pointers to make PoisonedRef
        and PoisonedRefPtr.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/DumbPtrTraits.h: Added.
        (WTF::DumbPtrTraits::exchange):
        (WTF::DumbPtrTraits::swap):
        (WTF::DumbPtrTraits::unwrap):
        * wtf/Forward.h:
        * wtf/Poisoned.h:
        (WTF::ConstExprPoisonedPtrTraits::exchange):
        (WTF::ConstExprPoisonedPtrTraits::swap):
        (WTF::ConstExprPoisonedPtrTraits::unwrap):
        * wtf/Ref.h:
        (WTF::Ref::~Ref):
        (WTF::Ref::Ref):
        (WTF::Ref::ptrAllowingHashTableEmptyValue const):
        (WTF::Ref::ptrAllowingHashTableEmptyValue):
        (WTF::Ref::operator-> const):
        (WTF::Ref::get const):
        (WTF::Ref::operator T& const):
        (WTF::=):
        (WTF::U>::swap):
        (WTF::swap):
        (WTF::U>::replace):
        (WTF::static_reference_cast):
        (WTF::adoptRef):
        (WTF::is):
        (WTF::Ref<T>::swap): Deleted.
        (WTF::Ref<T>::replace): Deleted.
        (WTF::GetPtrHelper<Ref<T>>::getPtr): Deleted.
        * wtf/RefPtr.cpp: Added.
        * wtf/RefPtr.h:
        (WTF::RefPtr::RefPtr):
        (WTF::RefPtr::~RefPtr):
        (WTF::RefPtr::get const):
        (WTF::RefPtr::operator* const):
        (WTF::RefPtr::operator-> const):
        (WTF::U>::RefPtr):
        (WTF::U>::leakRef):
        (WTF::=):
        (WTF::U>::swap):
        (WTF::swap):
        (WTF::operator==):
        (WTF::operator!=):
        (WTF::static_pointer_cast):
        (WTF::adoptRef):
        (WTF::is):
        (WTF::RefPtr<T>::RefPtr): Deleted.
        (WTF::RefPtr<T>::leakRef): Deleted.
        (WTF::RefPtr<T>::swap): Deleted.

2017-12-16  Yusuke Suzuki  <utatane.tea@gmail.com>

        Remove unnecessary boolean result of start() functions
        https://bugs.webkit.org/show_bug.cgi?id=180856

        Reviewed by Darin Adler.

        CrossThreadTaskHandler's Thread is just released without calling
        either `waitForCompletion` or `detach`. It means that this resource
        of the thread is not released.

        * benchmarks/ConditionSpeedTest.cpp:
        * wtf/CrossThreadTaskHandler.cpp:
        (WTF::CrossThreadTaskHandler::CrossThreadTaskHandler):
        * wtf/CrossThreadTaskHandler.h:

2017-12-14  David Kilzer  <ddkilzer@apple.com>

        Enable -Wstrict-prototypes for WebKit
        <https://webkit.org/b/180757>
        <rdar://problem/36024132>

        Rubber-stamped by Joseph Pecoraro.

        * Configurations/Base.xcconfig:
        (CLANG_WARN_STRICT_PROTOTYPES): Add. Set to YES.
        * wtf/Assertions.h:
        (WTFReportBacktrace): Add 'void' to C function declaration.
        (WTFCrashHookFunction): Add 'void' to C function pointer declaration.
        (WTFInstallReportBacktraceOnCrashHook): Add 'void' to C function declaration.
        (WTFIsDebuggerAttached): Ditto.
        (WTFCrash): Ditto.
        (WTFCrashWithSecurityImplication): Ditto.

2017-12-14  Yusuke Suzuki  <utatane.tea@gmail.com>

        Drop Thread::tryCreate
        https://bugs.webkit.org/show_bug.cgi?id=180808

        Reviewed by Darin Adler.

        We remove Thread::tryCreate. When thread creation fails, we have no way to keep WebKit working.
        Compared to tryMalloc, Thread::create always consumes fixed size of resource. If it fails,
        this is not due to arbitrary large user request. It is not reasonable that some thread creations
        are handled gracefully while the other thread creations are not.

        If we would like to have the limit of number of users' thread creation (like, calling `new Worker`
        so many times), we should have a soft limit instead of relying on system's hard limit.

        * wtf/ParallelJobsGeneric.cpp:
        (WTF::ParallelEnvironment::ThreadPrivate::tryLockFor):
        * wtf/Threading.cpp:
        (WTF::Thread::create):
        (WTF::Thread::tryCreate): Deleted.
        * wtf/Threading.h:
        (WTF::Thread::create): Deleted.

2017-12-13  Keith Miller  <keith_miller@apple.com>

        JSObjects should have a mask for loading indexed properties
        https://bugs.webkit.org/show_bug.cgi?id=180768

        Reviewed by Mark Lam.

        Add a clz that wraps the builtin clz intrinisics provided by
        various compilers. The clz function by default assumes that
        the input may be zero. On X86 this makes a difference because not
        all CPUs have LZCNT and BSR has undefined behavior on zero. On ARM,
        the zero check gets optimized away, regardless.

        * wtf/StdLibExtras.h:
        (std::clz):

2017-12-12  Yusuke Suzuki  <utatane.tea@gmail.com>

        REGRESSION(r225769): Build errors with constexpr std::tie on older gcc
        https://bugs.webkit.org/show_bug.cgi?id=180692

        Reviewed by Carlos Garcia Campos.

        Due to libstdc++'s bug[1], std::tie is not annotated with constexpr in libstdc++ 5.
        This patch adds WTF::tie for a work around. Since we do not want to
        include <tuple> in StdLibExtras.h, we define this function for all
        the compilers.

        [1]: https://gcc.gnu.org/bugzilla/show_bug.cgi?id=65978

        * wtf/StdLibExtras.h:

2017-12-13  Mark Lam  <mark.lam@apple.com>

        Fill out some Poisoned APIs, fix some bugs, and add some tests.
        https://bugs.webkit.org/show_bug.cgi?id=180724
        <rdar://problem/36006884>

        Reviewed by JF Bastien.

        Also rename Int32Poisoned to ConstExprPoisoned.  The key it takes is actually a
        uint32_t.  So, Int32 is really a misnomer.  In addition, the key needs to be a
        constexpr.  So, ConstExprPoisoned is a better name for it.

        * wtf/Poisoned.cpp:
        (WTF::makePoison):
        * wtf/Poisoned.h:
        (WTF::PoisonedImplHelper::asReference):
        (WTF::PoisonedImpl::PoisonedImpl):
        (WTF::PoisonedImpl::clear):
        (WTF::PoisonedImpl::operator* const):
        (WTF::PoisonedImpl::operator-> const):
        (WTF::PoisonedImpl::operator== const):
        (WTF::PoisonedImpl::operator!= const):
        (WTF::PoisonedImpl::operator< const):
        (WTF::PoisonedImpl::operator<= const):
        (WTF::PoisonedImpl::operator> const):
        (WTF::PoisonedImpl::operator>= const):
        (WTF::PoisonedImpl::operator=):
        (WTF::PoisonedImpl::swap):
        (WTF::PoisonedImpl::exchange):
        (WTF::swap):
        (WTF::makePoison):
        (WTF::PoisonedImpl::operator==): Deleted.

2017-12-12  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Implement optimized WeakMap and WeakSet
        https://bugs.webkit.org/show_bug.cgi?id=179929

        Reviewed by Saam Barati.

        We introduce JSValueMalloc, which is specialized malloc scheme with Gigacage::JSValue.
        This is used for WeakMapImpl's buffer.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/JSValueMalloc.cpp: Added.
        (WTF::tryJSValueMalloc):
        (WTF::jsValueMalloc):
        (WTF::jsValueRealloc):
        (WTF::jsValueFree):
        * wtf/JSValueMalloc.h: Added.
        (WTF::JSValueMalloc::malloc):
        (WTF::JSValueMalloc::tryMalloc):
        (WTF::JSValueMalloc::realloc):
        (WTF::JSValueMalloc::free):
        * wtf/MallocPtr.h:
        (WTF::MallocPtr::~MallocPtr):
        (WTF::MallocPtr::malloc):
        (WTF::MallocPtr::tryMalloc):
        (WTF::MallocPtr::realloc):
        We extend MallocPtr to adopt malloc scheme as its template parameter.

2017-12-11  Filip Pizlo  <fpizlo@apple.com>

        It should be possible to flag a cell for unconditional finalization
        https://bugs.webkit.org/show_bug.cgi?id=180636

        Reviewed by Saam Barati.
        
        This adds ConcurrentVector, which is like SegmentedVector, but wastes some space to allow
        resizing to proceed concurrently to access. It's not possible to resize concurrently to
        resizing, concurrent read/writes aren't protected from racing if they access the same element,
        and who knows what you'll get if you iterate up to size() while someone else append()s. The
        key insight is to stash all prior copies of the spine, so that nobody crashes trying to access
        a stale spine.
        
        I'm going to want to do the same thing for FastBitVector, by creating a segmented WordOwner
        class. That would require repeating the dance of having a spine that can resize while stashing
        old versions. So, the spine resizing logic is abstracted behind ConcurrentBuffer. You could
        use that as a kind of "concurrent vector" for immutable data. That's how ConcurrentVector uses
        it: it's an immutable array of segment pointers.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/ConcurrentBuffer.h: Added.
        (WTF::ConcurrentBuffer::ConcurrentBuffer):
        (WTF::ConcurrentBuffer::~ConcurrentBuffer):
        (WTF::ConcurrentBuffer::growExact):
        (WTF::ConcurrentBuffer::grow):
        (WTF::ConcurrentBuffer::array const):
        (WTF::ConcurrentBuffer::operator[]):
        (WTF::ConcurrentBuffer::operator[] const):
        (WTF::ConcurrentBuffer::createArray):
        * wtf/ConcurrentVector.h: Added.
        (WTF::ConcurrentVectorIterator::~ConcurrentVectorIterator):
        (WTF::ConcurrentVectorIterator::operator* const):
        (WTF::ConcurrentVectorIterator::operator-> const):
        (WTF::ConcurrentVectorIterator::operator++):
        (WTF::ConcurrentVectorIterator::operator== const):
        (WTF::ConcurrentVectorIterator::operator!= const):
        (WTF::ConcurrentVectorIterator::operator=):
        (WTF::ConcurrentVectorIterator::ConcurrentVectorIterator):
        (WTF::ConcurrentVector::~ConcurrentVector):
        (WTF::ConcurrentVector::size const):
        (WTF::ConcurrentVector::isEmpty const):
        (WTF::ConcurrentVector::at):
        (WTF::ConcurrentVector::at const):
        (WTF::ConcurrentVector::operator[]):
        (WTF::ConcurrentVector::operator[] const):
        (WTF::ConcurrentVector::first):
        (WTF::ConcurrentVector::first const):
        (WTF::ConcurrentVector::last):
        (WTF::ConcurrentVector::last const):
        (WTF::ConcurrentVector::takeLast):
        (WTF::ConcurrentVector::append):
        (WTF::ConcurrentVector::alloc):
        (WTF::ConcurrentVector::removeLast):
        (WTF::ConcurrentVector::grow):
        (WTF::ConcurrentVector::begin):
        (WTF::ConcurrentVector::end):
        (WTF::ConcurrentVector::segmentExistsFor):
        (WTF::ConcurrentVector::segmentFor):
        (WTF::ConcurrentVector::subscriptFor):
        (WTF::ConcurrentVector::ensureSegmentsFor):
        (WTF::ConcurrentVector::ensureSegment):
        (WTF::ConcurrentVector::allocateSegment):

2017-12-12  JF Bastien  <jfbastien@apple.com>

        makeString: support more integral types
        https://bugs.webkit.org/show_bug.cgi?id=180720

        Reviewed by Sam Weinig.

        Only some integral types worked. Add more types by using template
        magic. While we're here, also use the same magic for
        floating-point types in the theoretical future where short float
        or long double matter.

        The core of the magic is a second, defaulted, template
        parameter. It's declared in Forward.h (as void), and then in
        classes where we want to enable_if we use it (in C++ speak we
        create a partial class template specialization), otherwise we
        leave it as void.

        Also clean up some constructors which were being way too verbose
        in stating that they were declarations for this template
        specialization right here, when really we already knew that.

        * wtf/Forward.h:
        * wtf/text/StringConcatenate.h:
        (WTF::StringTypeAdapter<char>::StringTypeAdapter<char>): Deleted.
        (WTF::StringTypeAdapter<char>::length): Deleted.
        (WTF::StringTypeAdapter<char>::is8Bit): Deleted.
        (WTF::StringTypeAdapter<char>::writeTo const): Deleted.
        (WTF::StringTypeAdapter<char>::toString const): Deleted.
        (WTF::StringTypeAdapter<UChar>::StringTypeAdapter<UChar>): Deleted.
        (WTF::StringTypeAdapter<UChar>::length const): Deleted.
        (WTF::StringTypeAdapter<UChar>::is8Bit const): Deleted.
        (WTF::StringTypeAdapter<UChar>::writeTo const): Deleted.
        (WTF::StringTypeAdapter<UChar>::toString const): Deleted.
        (WTF::StringTypeAdapter<char::StringTypeAdapter): Deleted.
        (WTF::StringTypeAdapter<ASCIILiteral>::StringTypeAdapter): Deleted.
        (WTF::StringTypeAdapter<Vector<char>>::StringTypeAdapter): Deleted.
        (WTF::StringTypeAdapter<Vector<char>>::length const): Deleted.
        (WTF::StringTypeAdapter<Vector<char>>::is8Bit const): Deleted.
        (WTF::StringTypeAdapter<Vector<char>>::writeTo const): Deleted.
        (WTF::StringTypeAdapter<Vector<char>>::toString const): Deleted.
        (WTF::StringTypeAdapter<String>::StringTypeAdapter<String>): Deleted.
        (WTF::StringTypeAdapter<String>::length const): Deleted.
        (WTF::StringTypeAdapter<String>::is8Bit const): Deleted.
        (WTF::StringTypeAdapter<String>::writeTo const): Deleted.
        (WTF::StringTypeAdapter<String>::toString const): Deleted.
        (WTF::StringTypeAdapter<AtomicString>::StringTypeAdapter): Deleted.
        * wtf/text/StringConcatenateNumbers.h:
        (WTF::StringTypeAdapter<FormattedNumber>::StringTypeAdapter):
        (WTF::StringTypeAdapter<int>::StringTypeAdapter<int>): Deleted.
        (WTF::StringTypeAdapter<int>::length const): Deleted.
        (WTF::StringTypeAdapter<int>::is8Bit const): Deleted.
        (WTF::StringTypeAdapter<int>::writeTo const): Deleted.
        (WTF::StringTypeAdapter<int>::toString const): Deleted.
        (WTF::StringTypeAdapter<unsigned>::StringTypeAdapter<unsigned>): Deleted.
        (WTF::StringTypeAdapter<unsigned>::length const): Deleted.
        (WTF::StringTypeAdapter<unsigned>::is8Bit const): Deleted.
        (WTF::StringTypeAdapter<unsigned>::writeTo const): Deleted.
        (WTF::StringTypeAdapter<unsigned>::toString const): Deleted.
        (WTF::StringTypeAdapter<double>::StringTypeAdapter<double>): Deleted.
        (WTF::StringTypeAdapter<double>::length const): Deleted.
        (WTF::StringTypeAdapter<double>::is8Bit const): Deleted.
        (WTF::StringTypeAdapter<double>::writeTo const): Deleted.
        (WTF::StringTypeAdapter<double>::toString const): Deleted.
        (WTF::StringTypeAdapter<float>::StringTypeAdapter<float>): Deleted.
        (WTF::StringTypeAdapter<FormattedNumber>::StringTypeAdapter<FormattedNumber>): Deleted.
        * wtf/text/StringView.h:
        (WTF::StringTypeAdapter<StringView>::StringTypeAdapter<StringView>): Deleted.
        (WTF::StringTypeAdapter<StringView>::length): Deleted.
        (WTF::StringTypeAdapter<StringView>::is8Bit): Deleted.
        (WTF::StringTypeAdapter<StringView>::writeTo): Deleted.
        (WTF::StringTypeAdapter<StringView>::toString const): Deleted.

2017-12-12  Caio Lima  <ticaiolima@gmail.com>

        [ESNext][BigInt] Implement BigInt literals and JSBigInt
        https://bugs.webkit.org/show_bug.cgi?id=179000

        Reviewed by Darin Adler and Yusuke Suzuki.

        * wtf/HashFunctions.h:

2017-12-12  Joseph Pecoraro  <pecoraro@apple.com>

        Symbol not found: __ZN3WTF8LockBase10unlockSlowEv
        https://bugs.webkit.org/show_bug.cgi?id=180691

        Reviewed by Yusuke Suzuki.

        * wtf/mac/DeprecatedSymbolsUsedBySafari.mm:
        (WTF::LockBase::lockSlow):
        (WTF::LockBase::unlockSlow):
        Add back LockBase Symbols used by System Safari on 10.13.

2017-12-12  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Thread::create should have Thread::tryCreate
        https://bugs.webkit.org/show_bug.cgi?id=180333

        Reviewed by Darin Adler.

        Many callers of Thread::create assume that it returns non-nullptr Thread.
        But if the number of threads hits the limit in the system, creating Thread
        would fail. In that case, it is really difficult to keep WebKit working.

        We introduce Thread::tryCreate, and change the returned value from Thread::create
        from RefPtr<Thread> to Ref<Thread>. In Thread::create, we ensure thread creation
        succeeds by RELEASE_ASSERT. And we use Thread::create intentionally if the
        caller assumes that thread should be created.

        * wtf/AutomaticThread.cpp:
        (WTF::AutomaticThread::start):
        * wtf/ParallelJobsGeneric.cpp:
        (WTF::ParallelEnvironment::ThreadPrivate::tryLockFor):
        * wtf/Threading.cpp:
        (WTF::Thread::tryCreate):
        (WTF::Thread::create): Deleted.
        * wtf/Threading.h:
        (WTF::Thread::create):
        * wtf/WorkQueue.cpp:
        (WTF::WorkQueue::concurrentApply):

2017-12-11  Eric Carlson  <eric.carlson@apple.com>

        Web Inspector: Optionally log WebKit log parameters as JSON
        https://bugs.webkit.org/show_bug.cgi?id=180529
        <rdar://problem/35909462>

        Reviewed by Joseph Pecoraro.

        * wtf/Logger.h:
        (WTF::Logger::log):
        (WTF::LogArgument<Logger::LogSiteIdentifier>::toString):

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::toJSONString const): Serialize to JSON string.
        * wtf/MediaTime.h:

2017-12-11  Tim Horton  <timothy_horton@apple.com>

        Stop using deprecated target conditional for simulator builds
        https://bugs.webkit.org/show_bug.cgi?id=180662
        <rdar://problem/35136156>

        Reviewed by Simon Fraser.

        * wtf/Platform.h:

2017-12-11  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Add Converter traits to StringHasher instead of function pointer
        https://bugs.webkit.org/show_bug.cgi?id=180656

        Reviewed by JF Bastien.

        In the latest ICU, UChar is char16_t. So defining defaultConverter(UChar)
        and defaultConverter(char16_t) causes duplicate definitions.
        Instead of passing a funtion pointer, we pass a trait class DefaultConveter
        which has `convert` static function. And we make this `convert` function
        generic. This avoids defining convert function for UChar and char16_t.

        * wtf/text/StringHash.h:
        (WTF::ASCIICaseInsensitiveHash::FoldCase::convert):
        (WTF::ASCIICaseInsensitiveHash::hash):
        (WTF::ASCIICaseInsensitiveHash::foldCase): Deleted.
        * wtf/text/StringHasher.h:
        (WTF::StringHasher::DefaultConverter::convert):
        (WTF::StringHasher::addCharactersAssumingAligned):
        (WTF::StringHasher::addCharacters):
        (WTF::StringHasher::computeHashAndMaskTop8Bits):
        (WTF::StringHasher::computeHash):
        (WTF::StringHasher::computeLiteralHash):
        (WTF::StringHasher::computeLiteralHashAndMaskTop8Bits):
        (WTF::StringHasher::computeHashImpl):
        (WTF::StringHasher::Converter): Deleted.
        (WTF::StringHasher::defaultConverter): Deleted.

2017-12-10  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Reduce sizeof(Thread) by adjusting alignment
        https://bugs.webkit.org/show_bug.cgi?id=180630

        Reviewed by Saam Barati.

        Reduce sizeof(Thread) slightly by adjusting alignment.

        * wtf/Threading.h:

2017-12-10  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, follow-up patch after r225726
        https://bugs.webkit.org/show_bug.cgi?id=180622

        Suggested by Darin. We should take care of signed-extension of `char`.

        * wtf/text/StringHasher.h:
        (WTF::StringHasher::defaultConverter):

2017-12-09  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Remove RELAXED_CONSTEXPR
        https://bugs.webkit.org/show_bug.cgi?id=180624

        Reviewed by JF Bastien.

        All of our required compilers support relaxed constexpr in C++14.
        We can drop RELAXED_CONSTEXPR macro in our tree.

        * wtf/Compiler.h:
        * wtf/Expected.h:
        (std::experimental::fundamentals_v3::expected::operator*):
        (std::experimental::fundamentals_v3::expected::value):
        (std::experimental::fundamentals_v3::expected::error):
        * wtf/Unexpected.h:
        (std::experimental::fundamentals_v3::unexpected::value):
        (std::experimental::fundamentals_v3::unexpected::value const):

2017-12-09  Yusuke Suzuki  <utatane.tea@gmail.com>

        Fix WTF::Hasher tuple expansion with variadic args
        https://bugs.webkit.org/show_bug.cgi?id=180623

        Reviewed by JF Bastien.

        We expand a tuple with `...`, and use this in a function's argument list.
        And in this argument list, we call `add()` for each value. This will be
        expanded as follows.

            [] (...) { }((add(hasher, std::get<i>(values)), 0)...);

        will become,

            [] (...) { }((add(hasher, std::get<0>(values)), 0), (add(hasher, std::get<1>(values)), 0), ...);

        However, the evaluation order of the C++ argument is unspecified. Actually,
        in GCC environment, this `add()` is not called in our expected order. As a
        result, currently we have test failures in TestWTF.

        This patch just uses variadic templates to expand tuples, and call add() in
        our expected order. This patch fixes an existing failure of TestWTF in GCC environment.

        * wtf/Hasher.h:
        (WTF::Hasher::computeHash):
        (WTF::addArgs):
        (WTF::addTupleHelper):
        (WTF::add):

2017-12-09  Yusuke Suzuki  <utatane.tea@gmail.com>

        Use relaxed constexpr for StringHasher
        https://bugs.webkit.org/show_bug.cgi?id=180622

        Reviewed by JF Bastien.

        Now VC++ is updated and all the WebKit compilers support C++14 relaxed constexpr.
        This patch uses relaxed constexpr for StringHasher constexpr implementation

        * wtf/text/StringHasher.h:
        (WTF::StringHasher::addCharactersAssumingAligned):
        (WTF::StringHasher::Converter):
        (WTF::StringHasher::computeHashAndMaskTop8Bits):
        (WTF::StringHasher::computeHash):
        (WTF::StringHasher::computeLiteralHash):
        (WTF::StringHasher::computeLiteralHashAndMaskTop8Bits):
        (WTF::StringHasher::defaultConverter):
        (WTF::StringHasher::avalancheBits):
        (WTF::StringHasher::finalize):
        (WTF::StringHasher::finalizeAndMaskTop8Bits):
        (WTF::StringHasher::avoidZero):
        (WTF::StringHasher::calculateWithRemainingLastCharacter):
        (WTF::StringHasher::calculateWithTwoCharacters):
        (WTF::StringHasher::processPendingCharacter const):
        (WTF::StringHasher::StringHasher): Deleted.
        (WTF::StringHasher::avalancheBits3): Deleted.
        (WTF::StringHasher::avalancheBits2): Deleted.
        (WTF::StringHasher::avalancheBits1): Deleted.
        (WTF::StringHasher::avalancheBits0): Deleted.
        (WTF::StringHasher::calculateWithRemainingLastCharacter1): Deleted.
        (WTF::StringHasher::calculateWithRemainingLastCharacter0): Deleted.
        (WTF::StringHasher::calculate1): Deleted.
        (WTF::StringHasher::calculate0): Deleted.
        (WTF::StringHasher::calculate): Deleted.
        (WTF::StringHasher::computeLiteralHashImpl): Deleted.

2017-12-08  Eric Carlson  <eric.carlson@apple.com>

        Move Logger from PAL to WTF so it can be used outside of WebCore
        https://bugs.webkit.org/show_bug.cgi?id=180561

        Reviewed by Alex Christensen.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/Logger.h: Copied from Source/WebCore/PAL/pal/Logger.h.
        (PAL::LogArgument::toString): Deleted.
        (PAL::Logger::create): Deleted.
        (PAL::Logger::logAlways const): Deleted.
        (PAL::Logger::error const): Deleted.
        (PAL::Logger::warning const): Deleted.
        (PAL::Logger::info const): Deleted.
        (PAL::Logger::debug const): Deleted.
        (PAL::Logger::willLog const): Deleted.
        (PAL::Logger::enabled const): Deleted.
        (PAL::Logger::setEnabled): Deleted.
        (PAL::Logger::LogSiteIdentifier::LogSiteIdentifier): Deleted.
        (PAL::Logger::addObserver): Deleted.
        (PAL::Logger::removeObserver): Deleted.
        (PAL::Logger::Logger): Deleted.
        (PAL::Logger::log): Deleted.
        (PAL::Logger::observers): Deleted.
        (PAL::LogArgument<Logger::LogSiteIdentifier>::toString): Deleted.
        * wtf/LoggerHelper.h: Copied from Source/WebCore/PAL/pal/LoggerHelper.h.

2017-12-08  Yusuke Suzuki  <utatane.tea@gmail.com>

        Remove pthread_once in favor of dispatch_once
        https://bugs.webkit.org/show_bug.cgi?id=180591

        Reviewed by Saam Barati.

        Fix the comment.

        * wtf/Threading.h:
        (WTF::Thread::current):

2017-12-08  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF][Linux][GTK] Fix a minor bug in generic/WorkQueue when WorkQueue is immediately destroyed
        https://bugs.webkit.org/show_bug.cgi?id=180586

        Reviewed by Darin Adler.

        If WorkQueue is created and destroyed immediately, RunLoop::stop can be called
        befire calling RunLoop::run(). At that time WorkQueue thread is not stopped.

        This patch dispatches a task stopping its own RunLoop to ensure stop is done.
        We also clean up WorkQueue implementation not to include unnecessary fields,
        lock, condition, and thread.

        * wtf/WorkQueue.h:
        * wtf/generic/WorkQueueGeneric.cpp:
        (WorkQueue::platformInitialize):
        (WorkQueue::platformInvalidate):

2017-12-08  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Remove remaining use of Mutex
        https://bugs.webkit.org/show_bug.cgi?id=180579

        Reviewed by Alex Christensen.

        Mutex should be only used in low-level Locking and Threading.
        Other ones should use WTF::Lock and WTF::Condition instead.
        This patch replaces WTF::Mutex with WTF::Lock in WTF if it
        is not related to threading or locking implementation.

        And we also use WTF::Lock and WTF::Condition in WTF::BinarySemaphore.

        * wtf/RunLoop.cpp:
        (WTF::RunLoop::performWork):
        (WTF::RunLoop::dispatch):
        * wtf/RunLoop.h:
        * wtf/WorkQueue.cpp:
        * wtf/WorkQueue.h:
        * wtf/threads/BinarySemaphore.cpp:
        (WTF::BinarySemaphore::signal):
        (WTF::BinarySemaphore::wait):
        (WTF::BinarySemaphore::BinarySemaphore): Deleted.
        (WTF::BinarySemaphore::~BinarySemaphore): Deleted.
        * wtf/threads/BinarySemaphore.h:
        * wtf/win/WorkQueueWin.cpp:
        (WTF::WorkQueue::registerHandle):
        (WTF::WorkQueue::unregisterAndCloseHandle):
        (WTF::WorkQueue::dispatch):
        (WTF::WorkQueue::timerCallback):
        (WTF::WorkQueue::dispatchAfter):
        (WTF::TimerContext::TimerContext): Deleted.

2017-12-08  Yusuke Suzuki  <utatane.tea@gmail.com>

        Use StaticLock and Lock instead of Mutex in Windows WebKitLegacy
        https://bugs.webkit.org/show_bug.cgi?id=180572

        Reviewed by Mark Lam.

        Remove DEPRECATED_DEFINE_STATIC_LOCAL since it's no longer used.

        * wtf/StdLibExtras.h:

2017-12-07  Basuke Suzuki  <Basuke.Suzuki@sony.com>

        [Win] [64-bit] Resolve Microsoft warning C4319 on BitVector.cpp
        https://bugs.webkit.org/show_bug.cgi?id=180490

        Reviewed by Alex Christensen.

        bitsInPointer() returns unsigned which is smaller than size_t.
        "~"(negate) operator is applied before extending its size which result filled with zero.
        This may be potentially a bug if numBits is greater than max value of unsigned long
        (which is not practical).

        * wtf/BitVector.cpp:
        (WTF::BitVector::OutOfLineBits::create):

2017-12-07  Yusuke Suzuki  <utatane.tea@gmail.com>

        Use WTF Locking primitives in WebThread and drop pthread_xxx use
        https://bugs.webkit.org/show_bug.cgi?id=180445

        Reviewed by Saam Barati.

        Add initializer form to fill struct with zero if struct does not have any default initializers.

        * wtf/ThreadSpecific.h:
        (WTF::ThreadSpecific::Data::Data):

2017-12-07  Mark Lam  <mark.lam@apple.com>

        Apply poisoning to some native code pointers.
        https://bugs.webkit.org/show_bug.cgi?id=180541
        <rdar://problem/35916875>

        Reviewed by Filip Pizlo.

        Ensure that the resultant poisoned bits still looks like a pointer in that its
        bottom bits are 0, just like the alignment bits of a pointer.  This allows the
        client to use the bottom bits of the poisoned bits as flag bits just like the
        client was previously able to do with pointer values.

        Note: we only ensure that the bottom alignment bits of the generated poison
        value is 0.  We're not masking out the poisoned bits.  This means that the bottom
        bits of the poisoned bits will only be null if the original pointer is aligned.
        Hence, if the client applies the poison to an unaligned pointer, we do not lose
        any information on the low bits.

        Also removed 2 wrong assertions in PoisonedImpl's constructors.  We were
        asserting that Poisoned will never be used with a null value, but that's invalid.
        We do want to allow a null value so that we don't have to constantly do null
        checks in the clients.  This was uncovered by some layout tests.

        * wtf/Poisoned.cpp:
        (WTF::makePoison):
        * wtf/Poisoned.h:
        (WTF::PoisonedImpl::PoisonedImpl):

2017-12-07  Mark Lam  <mark.lam@apple.com>

        [Re-landing r225620] Refactoring: Rename ScrambledPtr to Poisoned.
        https://bugs.webkit.org/show_bug.cgi?id=180514

        Reviewed by Saam Barati and JF Bastien.

        Re-landing r225620 with speculative build fix for GCC 7.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Poisoned.cpp: Copied from Source/WTF/wtf/ScrambledPtr.cpp.
        (WTF::makePoison):
        (WTF::makeScrambledPtrKey): Deleted.
        * wtf/Poisoned.h: Copied from Source/WTF/wtf/ScrambledPtr.h.
        (WTF::PoisonedImpl::PoisonedImpl):
        (WTF::PoisonedImpl::assertIsPoisoned const):
        (WTF::PoisonedImpl::assertIsNotPoisoned const):
        (WTF::PoisonedImpl::unpoisoned const):
        (WTF::PoisonedImpl::operator-> const):
        (WTF::PoisonedImpl::bits const):
        (WTF::PoisonedImpl::operator! const):
        (WTF::PoisonedImpl::operator bool const):
        (WTF::PoisonedImpl::operator== const):
        (WTF::PoisonedImpl::operator==):
        (WTF::PoisonedImpl::operator=):
        (WTF::PoisonedImpl::poison):
        (WTF::PoisonedImpl::unpoison):
        (WTF::ScrambledPtr::ScrambledPtr): Deleted.
        (WTF::ScrambledPtr::assertIsScrambled const): Deleted.
        (WTF::ScrambledPtr::assertIsNotScrambled const): Deleted.
        (WTF::ScrambledPtr::descrambled const): Deleted.
        (WTF::ScrambledPtr::operator-> const): Deleted.
        (WTF::ScrambledPtr::bits const): Deleted.
        (WTF::ScrambledPtr::operator! const): Deleted.
        (WTF::ScrambledPtr::operator bool const): Deleted.
        (WTF::ScrambledPtr::operator== const): Deleted.
        (WTF::ScrambledPtr::operator==): Deleted.
        (WTF::ScrambledPtr::operator=): Deleted.
        (WTF::ScrambledPtr::scramble): Deleted.
        (WTF::ScrambledPtr::descramble): Deleted.
        * wtf/ScrambledPtr.cpp: Removed.
        * wtf/ScrambledPtr.h: Removed.

2017-12-07  Michael Catanzaro  <mcatanzaro@igalia.com>

        Unreviewed, rolling out r225620
        https://bugs.webkit.org/show_bug.cgi?id=180514
        <rdar://problem/35901694>

        It broke the build with GCC 7, and I don't know how to fix it.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Poisoned.h: Removed.
        * wtf/ScrambledPtr.cpp: Renamed from Source/WTF/wtf/Poisoned.cpp.
        (WTF::makeScrambledPtrKey):
        * wtf/ScrambledPtr.h: Added.
        (WTF::ScrambledPtr::ScrambledPtr):
        (WTF::ScrambledPtr::assertIsScrambled const):
        (WTF::ScrambledPtr::assertIsNotScrambled const):
        (WTF::ScrambledPtr::descrambled const):
        (WTF::ScrambledPtr::operator-> const):
        (WTF::ScrambledPtr::bits const):
        (WTF::ScrambledPtr::operator! const):
        (WTF::ScrambledPtr::operator bool const):
        (WTF::ScrambledPtr::operator== const):
        (WTF::ScrambledPtr::operator==):
        (WTF::ScrambledPtr::operator=):
        (WTF::ScrambledPtr::scramble):
        (WTF::ScrambledPtr::descramble):

2017-12-06  Mark Lam  <mark.lam@apple.com>

        Refactoring: Rename ScrambledPtr to Poisoned.
        https://bugs.webkit.org/show_bug.cgi?id=180514

        Reviewed by Saam Barati.

        We're switching our nomenclature to "poisoning" instead of "scrambling" pointers.
        This allows us to use shorter names.

        This patch is almost purely refactoring, except for one change: the PoisonedImpl
        template class (previously ScrambledPtr) has been modified to allow usage of
        a constexpr uint32_t poison value (see Int32Poisoned) in addition to a runtime
        determined uintptr_t poison value (see Poisoned).

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Poisoned.cpp: Copied from Source/WTF/wtf/ScrambledPtr.cpp.
        (WTF::makePoison):
        (WTF::makeScrambledPtrKey): Deleted.
        * wtf/Poisoned.h: Copied from Source/WTF/wtf/ScrambledPtr.h.
        (WTF::PoisonedImpl::PoisonedImpl):
        (WTF::PoisonedImpl::assertIsPoisoned const):
        (WTF::PoisonedImpl::assertIsNotPoisoned const):
        (WTF::PoisonedImpl::unpoisoned const):
        (WTF::PoisonedImpl::operator-> const):
        (WTF::PoisonedImpl::bits const):
        (WTF::PoisonedImpl::operator! const):
        (WTF::PoisonedImpl::operator bool const):
        (WTF::PoisonedImpl::operator== const):
        (WTF::PoisonedImpl::operator==):
        (WTF::PoisonedImpl::operator=):
        (WTF::PoisonedImpl::poison):
        (WTF::PoisonedImpl::unpoison):
        (WTF::ScrambledPtr::ScrambledPtr): Deleted.
        (WTF::ScrambledPtr::assertIsScrambled const): Deleted.
        (WTF::ScrambledPtr::assertIsNotScrambled const): Deleted.
        (WTF::ScrambledPtr::descrambled const): Deleted.
        (WTF::ScrambledPtr::operator-> const): Deleted.
        (WTF::ScrambledPtr::bits const): Deleted.
        (WTF::ScrambledPtr::operator! const): Deleted.
        (WTF::ScrambledPtr::operator bool const): Deleted.
        (WTF::ScrambledPtr::operator== const): Deleted.
        (WTF::ScrambledPtr::operator==): Deleted.
        (WTF::ScrambledPtr::operator=): Deleted.
        (WTF::ScrambledPtr::scramble): Deleted.
        (WTF::ScrambledPtr::descramble): Deleted.
        * wtf/ScrambledPtr.cpp: Removed.
        * wtf/ScrambledPtr.h: Removed.

2017-12-02  Darin Adler  <darin@apple.com>

        Modernize some aspects of text codecs, eliminate WebKit use of strcasecmp
        https://bugs.webkit.org/show_bug.cgi?id=180009

        Reviewed by Alex Christensen.

        * wtf/Assertions.cpp: Removed include of StringExtras.h.
        (WTFLogChannelByName): Use equalIgnoringASCIICase instead of strcasecmp.
        * wtf/DateMath.cpp: Removed include of StringExtras.h.
        * wtf/MD5.cpp: Ditto. Also removed include of CString.h.
        * wtf/SHA1.cpp: Ditto.

        * wtf/StringExtras.h:
        (strncasecmp): Deleted.
        (strcasecmp): Deleted.

        * wtf/StringPrintStream.cpp: Removed include of StringExtras.h.
        * wtf/text/Base64.cpp: Ditto.

        * wtf/text/LineEnding.cpp:
        (WTF::normalizeLineEndingsToLF): Replaced old more general purpose function with
        this. Changed argument type to vector and used an rvalue reference and return value.
        Also fixed some small logic errors.
        (WTF::normalizeLineEndingsToCRLF): Ditto.
        (WTF::normalizeLineEndingsToNative): Updated for above changes.
        * wtf/text/LineEnding.h: Updated for above changes.

        * wtf/text/StringCommon.h:
        (WTF::equalIgnoringASCIICase): Added overload for const char*.
        (WTF::equalLettersIgnoringASCIICase): Ditto.

        * wtf/text/TextStream.cpp: Removed include of StringExtras.h.
        * wtf/text/WTFString.cpp: Ditto.
        * wtf/unicode/icu/CollatorICU.cpp: Ditto.

2017-12-06  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Remove XXXLockBase since constexpr constructor can initialize static variables without calling global constructors
        https://bugs.webkit.org/show_bug.cgi?id=180495

        Reviewed by Mark Lam.

        Very nice feature of C++11 is that constexpr constructor can initialize static global variables
        without calling global constructors. We do not need to have XXXLockBase with derived XXXLock
        class since StaticXXXLock can have constructors as long as it is constexpr.
        We remove bunch of these classes, and set `XXXLock() = default;` explicitly for readability.
        C++11's default constructor is constexpr as long as its member's default constructor / default
        initializer is constexpr.

        * wtf/Condition.h:
        (WTF::ConditionBase::construct): Deleted.
        (WTF::ConditionBase::waitUntil): Deleted.
        (WTF::ConditionBase::waitFor): Deleted.
        (WTF::ConditionBase::wait): Deleted.
        (WTF::ConditionBase::notifyOne): Deleted.
        (WTF::ConditionBase::notifyAll): Deleted.
        (WTF::Condition::Condition): Deleted.
        * wtf/CountingLock.h:
        (WTF::CountingLock::CountingLock): Deleted.
        (WTF::CountingLock::~CountingLock): Deleted.
        * wtf/Lock.cpp:
        (WTF::Lock::lockSlow):
        (WTF::Lock::unlockSlow):
        (WTF::Lock::unlockFairlySlow):
        (WTF::Lock::safepointSlow):
        (WTF::LockBase::lockSlow): Deleted.
        (WTF::LockBase::unlockSlow): Deleted.
        (WTF::LockBase::unlockFairlySlow): Deleted.
        (WTF::LockBase::safepointSlow): Deleted.
        * wtf/Lock.h:
        (WTF::LockBase::construct): Deleted.
        (WTF::LockBase::lock): Deleted.
        (WTF::LockBase::tryLock): Deleted.
        (WTF::LockBase::try_lock): Deleted.
        (WTF::LockBase::unlock): Deleted.
        (WTF::LockBase::unlockFairly): Deleted.
        (WTF::LockBase::safepoint): Deleted.
        (WTF::LockBase::isHeld const): Deleted.
        (WTF::LockBase::isLocked const): Deleted.
        (WTF::LockBase::isFullyReset const): Deleted.
        (WTF::Lock::Lock): Deleted.
        * wtf/ReadWriteLock.cpp:
        (WTF::ReadWriteLock::readLock):
        (WTF::ReadWriteLock::readUnlock):
        (WTF::ReadWriteLock::writeLock):
        (WTF::ReadWriteLock::writeUnlock):
        (WTF::ReadWriteLockBase::construct): Deleted.
        (WTF::ReadWriteLockBase::readLock): Deleted.
        (WTF::ReadWriteLockBase::readUnlock): Deleted.
        (WTF::ReadWriteLockBase::writeLock): Deleted.
        (WTF::ReadWriteLockBase::writeUnlock): Deleted.
        * wtf/ReadWriteLock.h:
        (WTF::ReadWriteLock::read):
        (WTF::ReadWriteLock::write):
        (WTF::ReadWriteLockBase::ReadLock::tryLock): Deleted.
        (WTF::ReadWriteLockBase::ReadLock::lock): Deleted.
        (WTF::ReadWriteLockBase::ReadLock::unlock): Deleted.
        (WTF::ReadWriteLockBase::WriteLock::tryLock): Deleted.
        (WTF::ReadWriteLockBase::WriteLock::lock): Deleted.
        (WTF::ReadWriteLockBase::WriteLock::unlock): Deleted.
        (WTF::ReadWriteLockBase::read): Deleted.
        (WTF::ReadWriteLockBase::write): Deleted.
        (WTF::ReadWriteLock::ReadWriteLock): Deleted.
        * wtf/RecursiveLockAdapter.h:
        (WTF::RecursiveLockAdapter::RecursiveLockAdapter): Deleted.
        * wtf/WordLock.cpp:
        (WTF::WordLock::lockSlow):
        (WTF::WordLock::unlockSlow):
        (WTF::WordLockBase::lockSlow): Deleted.
        (WTF::WordLockBase::unlockSlow): Deleted.
        * wtf/WordLock.h:
        (WTF::WordLockBase::lock): Deleted.
        (WTF::WordLockBase::unlock): Deleted.
        (WTF::WordLockBase::isHeld const): Deleted.
        (WTF::WordLockBase::isLocked const): Deleted.
        (WTF::WordLockBase::isFullyReset const): Deleted.
        (WTF::WordLock::WordLock): Deleted.
        * wtf/WorkQueue.cpp:

2017-12-05  Stephan Szabo  <stephan.szabo@sony.com>

        Switch windows build to Visual Studio 2017
        https://bugs.webkit.org/show_bug.cgi?id=172412

        Reviewed by Per Arne Vollan.

        * WTF.vcxproj/WTF.proj:
        * wtf/Compiler.h:

2017-12-05  Andy Estes  <aestes@apple.com>

        [Darwin] Simplify use of TargetConditionals
        https://bugs.webkit.org/show_bug.cgi?id=180455
        <rdar://problem/35142971>

        Reviewed by Tim Horton.

        There's no need to check if TARGET_* macros are defined on Darwin platforms, since
        TargetConditionals.h always defines them. Also, we can simplify
        (TARGET_OS_EMBEDDED || TARGET_OS_IPHONE || TARGET_IPHONE_SIMULATOR) to TARGET_OS_IPHONE.

        * wtf/Platform.h:

2017-12-05  Matt Lewis  <jlewis3@apple.com>

        Unreviewed, rolling out r225430.

        This caused an API failure on release.

        Reverted changeset:

        "Move DateComponents into WTF"
        https://bugs.webkit.org/show_bug.cgi?id=180211
        https://trac.webkit.org/changeset/225430

2017-12-05  Michael Saboff  <msaboff@apple.com>

        Make WebKit build for ARM64_32
        https://bugs.webkit.org/show_bug.cgi?id=180447

        Reviewed by Mark Lam.

        Add the 'w' (32bit) pointer qualifier for ARM64_32 pointers in inline assembly.

        * wtf/darwin/WeakLinking.h:
        (WTF::isNullFunctionPointer):

2017-12-05  Filip Pizlo  <fpizlo@apple.com>

        bmalloc IsoHeap needs to allow a thread to deallocate some size for the first time
        https://bugs.webkit.org/show_bug.cgi?id=180443

        Reviewed by Saam Barati.
        
        With this change it's possible to reenable isoheaps on iOS.

        * wtf/IsoMalloc.h:
        * wtf/IsoMallocInlines.h:

2017-12-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Remove m_atomicStringTableDestructor in Thread by querying the condition at thread destruction
        https://bugs.webkit.org/show_bug.cgi?id=180429

        Reviewed by Alex Christensen.

        We now have a pointer to the AtomicStringTable::destroy in Thread.
        This pointer becomes nullptr only when the thread is the web thread not to destroy AtomicStringTable
        twice in the UI thread and the web thread.

        Instead of having a pointer in each Thread, we query whether the current thread is the web thread at
        Thread destruction. And use this information to call AtomicStringTable::destroy. Then, we can drop
        m_atomicStringTableDestructor field in Thread.

        * wtf/Threading.cpp:
        (WTF::Thread::didExit):
        * wtf/Threading.h:
        * wtf/mac/MainThreadMac.mm:
        * wtf/text/AtomicStringTable.cpp:
        (WTF::AtomicStringTable::create):
        (WTF::AtomicStringTable::destroy):
        * wtf/text/AtomicStringTable.h:

2017-12-01  Filip Pizlo  <fpizlo@apple.com>

        GC constraint solving should be parallel
        https://bugs.webkit.org/show_bug.cgi?id=179934

        Reviewed by JF Bastien.
        
        This does some changes to make it easier to do parallel constraint solving:
        
        - I finally removed dependencyWith. This was a silly construct whose only purpose is to confuse
          people about what it means to have a dependency chain. I took that as an opportunity to grealy
          simplify the GC's use of dependency chaining.
        
        - Added more logic to Deque<>, since I use it for part of the load balancer.
        
        - Made it possible to profile lock contention. See
          https://bugs.webkit.org/show_bug.cgi?id=180250#c0 for some preliminary measurements.
        
        - Introduced holdLockIf, which makes it easy to perform predicated lock acquisition. We use that
          to pick a lock in WebCore.
        
        - Introduced CountingLock. It's like WTF::Lock except it also enables optimistic read transactions
          sorta like Java's StampedLock.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/Atomics.h:
        (WTF::dependency):
        (WTF::DependencyWith::DependencyWith): Deleted.
        (WTF::dependencyWith): Deleted.
        * wtf/BitVector.h:
        (WTF::BitVector::iterator::operator++):
        * wtf/CMakeLists.txt:
        * wtf/ConcurrentPtrHashSet.cpp: Added.
        (WTF::ConcurrentPtrHashSet::ConcurrentPtrHashSet):
        (WTF::ConcurrentPtrHashSet::~ConcurrentPtrHashSet):
        (WTF::ConcurrentPtrHashSet::deleteOldTables):
        (WTF::ConcurrentPtrHashSet::clear):
        (WTF::ConcurrentPtrHashSet::initialize):
        (WTF::ConcurrentPtrHashSet::addSlow):
        (WTF::ConcurrentPtrHashSet::resizeIfNecessary):
        (WTF::ConcurrentPtrHashSet::resizeAndAdd):
        (WTF::ConcurrentPtrHashSet::Table::create):
        * wtf/ConcurrentPtrHashSet.h: Added.
        (WTF::ConcurrentPtrHashSet::contains):
        (WTF::ConcurrentPtrHashSet::add):
        (WTF::ConcurrentPtrHashSet::size const):
        (WTF::ConcurrentPtrHashSet::Table::maxLoad const):
        (WTF::ConcurrentPtrHashSet::hash):
        (WTF::ConcurrentPtrHashSet::cast):
        (WTF::ConcurrentPtrHashSet::containsImpl const):
        (WTF::ConcurrentPtrHashSet::addImpl):
        * wtf/Deque.h:
        (WTF::inlineCapacity>::takeFirst):
        * wtf/FastMalloc.h:
        * wtf/Lock.cpp:
        (WTF::LockBase::lockSlow):
        * wtf/Locker.h:
        (WTF::holdLockIf):
        * wtf/ScopedLambda.h:
        * wtf/SharedTask.h:
        (WTF::SharedTask<PassedResultType):
        (WTF::SharedTask<ResultType): Deleted.
        * wtf/StackShot.h: Added.
        (WTF::StackShot::StackShot):
        (WTF::StackShot::operator=):
        (WTF::StackShot::array const):
        (WTF::StackShot::size const):
        (WTF::StackShot::operator bool const):
        (WTF::StackShot::operator== const):
        (WTF::StackShot::hash const):
        (WTF::StackShot::isHashTableDeletedValue const):
        (WTF::StackShot::operator> const):
        (WTF::StackShot::deletedValueArray):
        (WTF::StackShotHash::hash):
        (WTF::StackShotHash::equal):
        * wtf/StackShotProfiler.h: Added.
        (WTF::StackShotProfiler::StackShotProfiler):
        (WTF::StackShotProfiler::profile):
        (WTF::StackShotProfiler::run):

2017-12-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Use m_suspendCount instead of m_suspended flag in Thread
        https://bugs.webkit.org/show_bug.cgi?id=180427

        Reviewed by Carlos Garcia Campos.

        When resuming the thread, signal handler is reinvoked once before `sigsuspend` is resumed.
        But this handler should not do anything since it is just a signal for `sigsuspend`.
        Previously, we use m_suspenedd flag to distinguish between suspending and resuming signal
        handler invocations.

        But this additional m_suspended flag is not necessary since we can use m_suspendCount instead.
        This patch drops m_suspended and use m_suspendCount. Since semaphore operations emit full memory
        barrier, m_suspendCount is loaded and stored as we expect.

        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::signalHandlerSuspendResume):
        (WTF::Thread::suspend):
        (WTF::Thread::resume):

2017-12-04  Simon Fraser  <simon.fraser@apple.com>

        Minor DisplayRefreshMonitor-related cleanup
        https://bugs.webkit.org/show_bug.cgi?id=179802

        Reviewed by Sam Weinig.

        New trace point for when the CVDisplayLink fires on its own thread.

        * wtf/SystemTracing.h:

2017-12-04  JF Bastien  <jfbastien@apple.com>

        Update std::expected to match libc++ coding style
        https://bugs.webkit.org/show_bug.cgi?id=180264

        Reviewed by Alex Christensen.

        As of https://wg21.link/p0323r4 std::expected is on its way to the
        Library Fundamentals v3 TS (LEWG and EWG voted for this, but LWG
        hasn't done wording review yet, hence "on its way"). The API is
        therefore pretty close to what will be in the TS, and I've gotten
        requests for an easily usable implementation of std::expected. I
        talked to our clang team and they'll help me migrate our
        implementation to libc++, but our implementation has to look more
        like libc++ than it does now. Once in libc++ I'll maintain changes
        on both sides to make sure neither is out-of-date for too long.

        - Fork std::unexpected into its own header.
        - Add mild support for an exception-based implementation, but
          don't do noexcept yet.
        - Rename everything to follow STL style, and keep a global using
          or variable alias where possible to reduce WebKit code churn.
        - Minor API updates to remove things that aren't in the proposal
          anymore.

        * wtf/Expected.h:
        (std::experimental::fundamentals_v3::bad_expected_access<void>::bad_expected_access):
        (std::experimental::fundamentals_v3::bad_expected_access::bad_expected_access):
        (std::experimental::fundamentals_v3::bad_expected_access::error):
        (std::experimental::fundamentals_v3::bad_expected_access::error const):
        (std::experimental::fundamentals_v3::__expected_detail::constexpr_base::constexpr_base):
        (std::experimental::fundamentals_v3::__expected_detail::base::base):
        (std::experimental::fundamentals_v3::__expected_detail::base::~base):
        (std::experimental::fundamentals_v3::expected::expected):
        (std::experimental::fundamentals_v3::expected::operator=):
        (std::experimental::fundamentals_v3::expected::swap):
        (std::experimental::fundamentals_v3::expected::operator-> const):
        (std::experimental::fundamentals_v3::expected::operator->):
        (std::experimental::fundamentals_v3::expected::operator* const):
        (std::experimental::fundamentals_v3::expected::operator*):
        (std::experimental::fundamentals_v3::expected::has_value const):
        (std::experimental::fundamentals_v3::expected::value const):
        (std::experimental::fundamentals_v3::expected::value):
        (std::experimental::fundamentals_v3::expected::error const):
        (std::experimental::fundamentals_v3::expected::error):
        (std::experimental::fundamentals_v3::expected::value_or const):
        (std::experimental::fundamentals_v3::expected::value_or):
        (std::experimental::fundamentals_v3::operator==):
        (std::experimental::fundamentals_v3::operator!=):
        (std::experimental::fundamentals_v3::swap):
        (WTF::Unexpected::Unexpected): Deleted.
        (WTF::Unexpected::value const): Deleted.
        (WTF::Unexpected::value): Deleted.
        (WTF::operator==): Deleted.
        (WTF::operator!=): Deleted.
        (WTF::makeUnexpected): Deleted.
        (WTF::ExpectedDetail::Throw): Deleted.
        (WTF::ExpectedDetail::destroy): Deleted.
        (WTF::ExpectedDetail::std::is_trivially_destructible<T>::value): Deleted.
        (WTF::ExpectedDetail::ConstexprBase::ConstexprBase): Deleted.
        (WTF::ExpectedDetail::Base::Base): Deleted.
        (WTF::ExpectedDetail::Base::~Base): Deleted.
        (WTF::Expected::Expected): Deleted.
        (WTF::Expected::operator=): Deleted.
        (WTF::Expected::swap): Deleted.
        (WTF::Expected::operator-> const): Deleted.
        (WTF::Expected::operator->): Deleted.
        (WTF::Expected::operator* const): Deleted.
        (WTF::Expected::operator*): Deleted.
        (WTF::Expected::operator bool const): Deleted.
        (WTF::Expected::hasValue const): Deleted.
        (WTF::Expected::value const): Deleted.
        (WTF::Expected::value): Deleted.
        (WTF::Expected::error const): Deleted.
        (WTF::Expected::error): Deleted.
        (WTF::Expected::getUnexpected const): Deleted.
        (WTF::Expected::valueOr const): Deleted.
        (WTF::Expected::valueOr): Deleted.
        (WTF::swap): Deleted.
        (WTF::makeExpected): Deleted.
        (WTF::makeExpectedFromError): Deleted.
        * wtf/Forward.h:
        * wtf/Optional.h:
        * wtf/StdLibExtras.h:
        * wtf/Unexpected.h: Added.
        (std::experimental::fundamentals_v3::unexpected::unexpected):
        (std::experimental::fundamentals_v3::unexpected::value const):
        (std::experimental::fundamentals_v3::unexpected::value):
        (std::experimental::fundamentals_v3::operator==):
        (std::experimental::fundamentals_v3::operator!=):
        (makeUnexpected):

2017-12-03  Tomas Popela  <tpopela@redhat.com>

        Build fails on x86_64 and arm64 with BMalloc disabled
        https://bugs.webkit.org/show_bug.cgi?id=180188

        Reviewed by Carlos Garcia Campos.

        Add missing methods in WTF's Gigacage.h and fix g_gigacageBasePtr
        definition.

        * wtf/Gigacage.cpp:
        * wtf/Gigacage.h:
        (Gigacage::basePtr):
        (Gigacage::isEnabled):

2017-12-03  Yusuke Suzuki  <utatane.tea@gmail.com>

        WTF shouldn't have both Thread and ThreadIdentifier
        https://bugs.webkit.org/show_bug.cgi?id=180308

        Reviewed by Darin Adler.

        We should use a pointer of WTF::Thread instead of ThreadIdentifier.

        One problem is that Windows support library uses WTF::createThread,
        which returns ThreadIdentifier. So we cannot drop ThreadIdentifier
        in Windows environment. This patch keeps ThreadIdentifier in Windows.

        * wtf/MainThread.cpp:
        (WTF::initializeMainThread):
        (WTF::isMainThread):
        (WTF::canAccessThreadLocalDataForThread):
        * wtf/MainThread.h:
        * wtf/ParkingLot.cpp:
        (WTF::ParkingLot::parkConditionallyImpl):
        (WTF::ParkingLot::unparkOne):
        (WTF::ParkingLot::unparkOneImpl):
        (WTF::ParkingLot::unparkCount):
        * wtf/RecursiveLockAdapter.h:
        (WTF::RecursiveLockAdapter::lock):
        (WTF::RecursiveLockAdapter::unlock):
        (WTF::RecursiveLockAdapter::tryLock):
        * wtf/Threading.cpp:
        (WTF::Thread::dump const):
        * wtf/Threading.h:
        (WTF::Thread::id const):
        (WTF::Thread::operator==): Deleted.
        (WTF::Thread::operator!=): Deleted.
        (WTF::currentThread): Deleted.
        * wtf/ThreadingPrimitives.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::waitForCompletion):
        (WTF::Thread::detach):
        (WTF::Thread::initializeCurrentTLS):
        (WTF::Thread::suspend):
        (WTF::Thread::establishPlatformSpecificHandle):
        (WTF::Thread::currentID): Deleted.
        * wtf/ThreadingWin.cpp:
        (WTF::Thread::waitForCompletion):
        (WTF::Thread::suspend):
        (WTF::Thread::currentDying):
        * wtf/mac/MainThreadMac.mm:
        (WTF::initializeApplicationUIThread):
        (WTF::initializeWebThreadPlatform):
        (WTF::canAccessThreadLocalDataForThread):
        (WTF::initializeApplicationUIThreadIdentifier): Deleted.
        (WTF::initializeWebThreadIdentifier): Deleted.

2017-12-03  Darin Adler  <darin@apple.com>

        Add WTF::Hasher, an easier to use replacement for WTF::IntegerHasher
        https://bugs.webkit.org/show_bug.cgi?id=180318

        Reviewed by JF Bastien.

        * WTF.xcodeproj/project.pbxproj: Added Hasher.h.
        * wtf/CMakeLists.txt: Ditto.

        * wtf/Forward.h: Added Hasher and TextStream.

        * wtf/Hasher.h: Moved StringHasher into a separate header. Added Hasher.
        Marked IntegerHasher deprecated.

        * wtf/text/CString.cpp: Include StringHasher.h instead of Hasher.h.
        * wtf/text/StringHash.h: Ditto.

        * wtf/text/StringHasher.h: Added. Moved StringHasher here from Hasher.h.

        * wtf/text/StringImpl.h: Include StringHasher.h instead of Hasher.h.

        * wtf/text/WTFString.h: Added a hash function. This was useful in some
        adoption I was doing in WebCore, not included in this patch.

        * wtf/unicode/UTF8.cpp: Include StringHasher.h instead of Hasher.h.

2017-12-02  Brady Eidson  <beidson@apple.com>

        Factor out the "databaseTaskQueue" parts of IDBServer into something reusable.
        https://bugs.webkit.org/show_bug.cgi?id=180298

        Reviewed by Chris Dumez.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:

        * wtf/CrossThreadTaskHandler.cpp: Added.
        (WTF::CrossThreadTaskHandler::CrossThreadTaskHandler):
        (WTF::CrossThreadTaskHandler::~CrossThreadTaskHandler):
        (WTF::CrossThreadTaskHandler::postTask):
        (WTF::CrossThreadTaskHandler::postTaskReply):
        (WTF::CrossThreadTaskHandler::taskRunLoop):
        (WTF::CrossThreadTaskHandler::handleTaskRepliesOnMainThread):
        * wtf/CrossThreadTaskHandler.h: Added.

2017-12-01  Mark Lam  <mark.lam@apple.com>

        Let's scramble ClassInfo pointers in cells.
        https://bugs.webkit.org/show_bug.cgi?id=180291
        <rdar://problem/35807620>

        Reviewed by JF Bastien.

        * wtf/ScrambledPtr.h:
        (WTF::ScrambledPtr::descrambled const):
        (WTF::ScrambledPtr::bits const):
        (WTF::ScrambledPtr::operator==):
        (WTF::ScrambledPtr::operator=):
        (WTF::ScrambledPtr::scramble):
        (WTF::ScrambledPtr::descramble):
        (WTF::ScrambledPtr:: const): Deleted.
        (WTF::ScrambledPtr::scrambledBits const): Deleted.

2017-12-01  Christopher Reid  <chris.reid@sony.com>

        Move DateComponents into WTF
        https://bugs.webkit.org/show_bug.cgi?id=180211

        Reviewed by Myles C. Maxfield.

        Moved DateComponents from WebCore/platform into WTF.
        Removed isLeapYear from DateComponents as DateMath already has that function.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/DateComponents.cpp: Renamed from Source\WebCore\platform\DateComponents.cpp.
        * wtf/DateComponents.h: Renamed from Source\WebCore\platform\DateComponents.h.

2017-12-01  Youenn Fablet  <youenn@apple.com>

        Implement https://w3c.github.io/ServiceWorker/#clients-get
        https://bugs.webkit.org/show_bug.cgi?id=180167

        Reviewed by Chris Dumez.

        * wtf/text/StringView.h:
        (WTF::StringView::toUInt64Strict const):
        * wtf/text/WTFString.h:

2017-12-01  Brian Burg  <bburg@apple.com>

        Web Inspector: move Inspector::Protocol::Array<T> to JSON namespace
        https://bugs.webkit.org/show_bug.cgi?id=173662

        Reviewed by Joseph Pecoraro.

        Move Inspector::Protocol::Array<T> to JSON::ArrayOf<T>.

        * wtf/JSONValues.h:
        (WTF::JSONImpl::ArrayOf::ArrayOf):
        (WTF::JSONImpl::ArrayOf::openAccessors):
        (WTF::JSONImpl::ArrayOf::addItem):
        (WTF::JSONImpl::ArrayOf::create):

2017-12-01  Brady Eidson  <beidson@apple.com>

        Add Internals.terminateServiceWorker, and the ability to restart service workers for postMessage.
        https://bugs.webkit.org/show_bug.cgi?id=180170

        Reviewed by Chris Dumez.

        * wtf/CompletionHandler.h:
        (WTF::CompletionHandler<Out):

2017-11-30  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Remove easy toRemove & map.remove() use in OAS phase
        https://bugs.webkit.org/show_bug.cgi?id=180208

        Reviewed by Mark Lam.

        * wtf/HashMap.h:
        (WTF::X>::removeIf):
        * wtf/HashSet.h:
        (WTF::V>::removeIf):
        * wtf/HashTable.h:
        (WTF::KeyTraits>::removeIf):

2017-11-30  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r225362.
        https://bugs.webkit.org/show_bug.cgi?id=180225

        removeIf predicate function can touch remove target set
        (Requested by yusukesuzuki on #webkit).

        Reverted changeset:

        "[JSC] Remove easy toRemove & map.remove() use"
        https://bugs.webkit.org/show_bug.cgi?id=180208
        https://trac.webkit.org/changeset/225362

2017-11-30  Mark Lam  <mark.lam@apple.com>

        Let's scramble MacroAssemblerCodePtr values.
        https://bugs.webkit.org/show_bug.cgi?id=180169
        <rdar://problem/35758340>

        Reviewed by Filip Pizlo, Saam Barati, and JF Bastien.

        Introduce a ScrambledPtr class to facilitate scrambling.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/ScrambledPtr.cpp: Added.
        (WTF::makeScrambledPtrKey):
        * wtf/ScrambledPtr.h: Added.
        (WTF::ScrambledPtr::ScrambledPtr):
        (WTF::ScrambledPtr::paranoidAssertIsScrambled const):
        (WTF::ScrambledPtr::paranoidAssertIsNotScrambled const):
        (WTF::ScrambledPtr:: const):
        (WTF::ScrambledPtr::operator-> const):
        (WTF::ScrambledPtr::scrambledBits const):
        (WTF::ScrambledPtr::operator! const):
        (WTF::ScrambledPtr::operator bool const):
        (WTF::ScrambledPtr::operator== const):
        (WTF::ScrambledPtr::operator==):
        (WTF::ScrambledPtr::scramble):
        (WTF::ScrambledPtr::descramble):

2017-11-30  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Remove easy toRemove & map.remove() use
        https://bugs.webkit.org/show_bug.cgi?id=180208

        Reviewed by Mark Lam.

        Return bool from removeIf. It is true if removeIf removes at least one entry.
        This interface is similar to existing HashSet::remove, which returns true
        if it actually removes entry.

        * wtf/HashMap.h:
        (WTF::X>::removeIf):
        * wtf/HashSet.h:
        (WTF::V>::removeIf):
        * wtf/HashTable.h:
        (WTF::KeyTraits>::removeIf):

2017-11-30  Chris Dumez  <cdumez@apple.com>

        Populate self.registration.installing/waiting/active inside service workers
        https://bugs.webkit.org/show_bug.cgi?id=180168

        Reviewed by Brady Eidson.

        Add CrossThreadCopier support for std::optional<>.

        * wtf/CrossThreadCopier.h:

2017-11-29  JF Bastien  <jfbastien@apple.com>

        WTF / bmalloc: don't write to 0xbbadbeef when ASAN is looking
        https://bugs.webkit.org/show_bug.cgi?id=180175

        Reviewed by Mark Lam.

        ASAN knows that 0xbbadbeef is a bbad aaddress, and tells us so
        when we write to it, say in an assert. That creates bbad error
        reports where ASAN thinks we write to an invalid address, instead
        of thinking that we hit an assertion. In some cases, tooling that
        use fuzzers aggregate similar issues, and think that we just have
        the one bug and not a bunch of different asserts.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h:

2017-11-29  Filip Pizlo  <fpizlo@apple.com>

        GC should support isoheaps
        https://bugs.webkit.org/show_bug.cgi?id=179288

        Reviewed by Saam Barati.
        
        One of my favorite data structures in the GC is a singly-linked list that knows its tail, so that
        things get added to it at the end rather that at the beginning. In this patch, I use this to put
        the same node on multiple lists, which our existing linked list templates also don't support.
        
        This adds a new linked list that does those things:
        
        - It supports append(). It could also support prepend(), but currently there is no need for it.
        
        - It supports nodes that are on multiple lists. The GC uses std::mem_fn() to create a lambda that the
          list uses to set next.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/SinglyLinkedListWithTail.h: Added.
        (WTF::SinglyLinkedListWithTail::isEmpty const):
        (WTF::SinglyLinkedListWithTail::append):
        (WTF::SinglyLinkedListWithTail::first const):
        (WTF::SinglyLinkedListWithTail::last const):

2017-11-29  Stanislav Ocovaj  <stanislav.ocovaj@rt-rk.com>

        [DFG][MIPS] Enable DFG JIT on MIPS.
        https://bugs.webkit.org/show_bug.cgi?id=175447

        Reviewed by Carlos Alberto Lopez Perez.

        * wtf/Platform.h:

2017-11-29  Matt Lewis  <jlewis3@apple.com>

        Unreviewed, rolling out r225286.

        The source files within this patch have been marked as
        executable.

        Reverted changeset:

        "[MIPS][JSC] Implement MacroAssembler::probe support on MIPS"
        https://bugs.webkit.org/show_bug.cgi?id=175447
        https://trac.webkit.org/changeset/225286

2017-11-29  Stanislav Ocovaj  <stanislav.ocovaj@rt-rk.com>

        [DFG][MIPS] Enable DFG JIT on MIPS.
        https://bugs.webkit.org/show_bug.cgi?id=175447

        Reviewed by Carlos Alberto Lopez Perez.

        * wtf/Platform.h:

2017-11-14  Carlos Garcia Campos  <cgarcia@igalia.com>

        Move JSONValues to WTF and convert uses of InspectorValues.h to JSONValues.h
        https://bugs.webkit.org/show_bug.cgi?id=173793

        Reviewed by Joseph Pecoraro.

        Based on patch by Brian Burg.

        Move the implementation into WTF. Put the actual implementation inside
        namespace WTF::JSONImpl so that the symbols in libwtf start with the WTF prefix.
        Also provide a top-level JSON namespace so that clients can write JSON::Value.
        This is essentially a typedef for the entire WTF::JSONImpl namespace.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/JSONValues.cpp: Renamed from Source/JavaScriptCore/inspector/InspectorValues.cpp.
        (JSON::Value::null):
        (JSON::Value::create):
        (JSON::Value::asValue):
        (JSON::Value::asObject):
        (JSON::Value::asArray):
        (JSON::Value::parseJSON):
        (JSON::Value::toJSONString const):
        (JSON::Value::asBoolean const):
        (JSON::Value::asDouble const):
        (JSON::Value::asInteger const):
        (JSON::Value::asString const):
        (JSON::Value::writeJSON const):
        (JSON::Value::memoryCost const):
        (JSON::ObjectBase::~ObjectBase):
        (JSON::ObjectBase::asObject):
        (JSON::ObjectBase::openAccessors):
        (JSON::ObjectBase::memoryCost const):
        (JSON::ObjectBase::getBoolean const):
        (JSON::ObjectBase::getString const):
        (JSON::ObjectBase::getObject const):
        (JSON::ObjectBase::getArray const):
        (JSON::ObjectBase::getValue const):
        (JSON::ObjectBase::remove):
        (JSON::ObjectBase::writeJSON const):
        (JSON::ObjectBase::ObjectBase):
        (JSON::ArrayBase::~ArrayBase):
        (JSON::ArrayBase::asArray):
        (JSON::ArrayBase::writeJSON const):
        (JSON::ArrayBase::ArrayBase):
        (JSON::ArrayBase::get const):
        (JSON::Object::create):
        (JSON::Array::create):
        (JSON::ArrayBase::memoryCost const):
        * wtf/JSONValues.h: Renamed from Source/JavaScriptCore/inspector/InspectorValues.h.
        (JSON::ObjectBase::find):
        (JSON::ObjectBase::find const):
        (JSON::ObjectBase::setBoolean):
        (JSON::ObjectBase::setInteger):
        (JSON::ObjectBase::setDouble):
        (JSON::ObjectBase::setString):
        (JSON::ObjectBase::setValue):
        (JSON::ObjectBase::setObject):
        (JSON::ObjectBase::setArray):
        (JSON::ArrayBase::pushBoolean):
        (JSON::ArrayBase::pushInteger):
        (JSON::ArrayBase::pushDouble):
        (JSON::ArrayBase::pushString):
        (JSON::ArrayBase::pushValue):
        (JSON::ArrayBase::pushObject):
        (JSON::ArrayBase::pushArray):

2017-11-28  Simon Fraser  <simon.fraser@apple.com>

        Modernize GraphicsLayer dumping
        https://bugs.webkit.org/show_bug.cgi?id=180067

        Reviewed by Sam Weinig.
        
        Expose the current indent.

        * wtf/text/TextStream.h:
        (WTF::TextStream::indent const):

2017-11-27  Chris Dumez  <cdumez@apple.com>

        Move callOnMainThreadAndWait() from SocketStreamHandleImplCFNet.cpp to MainThread.h
        https://bugs.webkit.org/show_bug.cgi?id=180060

        Reviewed by Alex Christensen.

        Move callOnMainThreadAndWait() from SocketStreamHandleImplCFNet.cpp to MainThread.h so that it can be reused.

        * wtf/MainThread.cpp:
        (WTF::callOnMainThreadAndWait):
        * wtf/MainThread.h:

2017-11-27  Simon Fraser  <simon.fraser@apple.com>

        Use TextStream's indent tracking, rather than passing indent to all the externalRepresentation() functions
        https://bugs.webkit.org/show_bug.cgi?id=180027

        Reviewed by Jon Lee.

        Remove all the indent arguments, and make use of TextStream::IndentScope to control
        output indentation.

        Add an indent stream manipulator so you can say
          ts << indent << "text"
        to write the indent.

        * wtf/text/TextStream.h:
        (WTF::TextStream::IndentScope::IndentScope):
        (WTF::TextStream::IndentScope::~IndentScope):

2016-08-05  Darin Adler  <darin@apple.com>

        Fix some minor problems in the StringImpl header
        https://bugs.webkit.org/show_bug.cgi?id=160630

        Reviewed by Brent Fulgham.

        * wtf/text/AtomicString.h: Update since CharacterMatchFunctionPtr is now
        CodeUnitMatchFunction.

        * wtf/text/StringCommon.h: Added CodeUnitMatchFunction, which replaces
        CharacterMatchFunctionPtr.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::stripMatchedCharacters): Changed template argument name
        to CodeUnitPredicate to help make it clear this works on code units, not
        code points.
        (WTF::UCharPredicate): Deleted.
        (WTF::SpaceOrNewlinePredicate): Deleted.
        (WTF::StringImpl::stripWhiteSpace): Removed unneeded use of predicate class to
        turn a function into a functor; functions already work fine as functors without
        a class wrapping them.
        (WTF::StringImpl::stripLeadingAndTrailingCharacters): Ditto. Also renamed
        from stripWhiteSpace, since it strips arbitrary characters.
        (WTF::StringImpl::removeCharacters): Fixed various minor style issues and
        updated to new type name.
        (WTF::StringImpl::simplifyMatchedCharactersToSpace): Ditto.
        (WTF::StringImpl::simplifyWhiteSpace): More of the same.
        (WTF::StringImpl::find): Ditto.

        * wtf/text/StringImpl.h: Removed unneeded include of uchar.h, since it's
        included by StringCommon.h. Removed =CharacterMatchFunctionPtr and
        IsWhiteSpaceFunctionPtr, both replaced by CodeUnitMatchFunction. Fixed
        a mistake recently introduced in isSpaceOrNewline, which was unnecessarily,
        inefficiently using ICU for non-ASCII Latin-1 characters.

        * wtf/text/StringView.h: Use CodeUnitMatchFunction instead of CharacterMatchFunction.

        * wtf/text/WTFString.cpp:
        (WTF::String::stripLeadingAndTrailingCharacters): Updated function name and type.
        (WTF::String::simplifyWhiteSpace): Updated type.
        (WTF::String::removeCharacters): Updated type.
        * wtf/text/WTFString.h: Ditto.

2017-11-23  Darin Adler  <darin@apple.com>

        Fix dictionary leak in lookup, convert FindOptions to OptionSet, tweak code style nearby
        https://bugs.webkit.org/show_bug.cgi?id=179981

        Reviewed by Sam Weinig.

        * wtf/OptionSet.h: Added some operators so it's easier to use | and - with individual
        options from the set.

2017-11-23  Darin Adler  <darin@apple.com>

        Reduce WTF::String operations that do unnecessary Unicode operations instead of ASCII
        https://bugs.webkit.org/show_bug.cgi?id=179907

        Reviewed by Sam Weinig.

        * wtf/text/ASCIIFastPath.h: Moved the using for charactersAreAllASCII here since
        the function is defined here.

        * wtf/text/AtomicString.h: Removed overloads of contains, find, startsWith, and
        endsWith that take a boolean indicating whether they should be "case sensitive".
        When false, this was doing Unicode case folding, and no callers needed that.
        Also tweaked formatting and argument names.

        * wtf/text/IntegerToStringConversion.h: Added an include of LChar.h since this file
        uses that. Also tweaked formatting a bit.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::containsOnlyWhitespace): Deleted. Despite its name sounding like
        it used the full Unicode whitespace definition, this actually checked isASCIISpace.
        Callers now all use isAllSpecialCharacters instead with the whitespace definition
        that is appropriate to each call site.
        (WTF::latin1CaseFoldTable): Deleted.
        (WTF::equalCompatibilityCaseless): Deleted.
        (WTF::StringImpl::findIgnoringCase): Deleted.
        (WTF::findIgnoringCaseInner): Deleted.
        (WTF::reverseFindIgnoringCaseInner): Deleted.
        (WTF::StringImpl::reverseFindIgnoringCase): Deleted.
        (WTF::equalInner): Removed boolean caseSensitive argument.
        (WTF::StringImpl::startsWith): Ditto.
        (WTF::StringImpl::endsWith): Ditto.

        * wtf/text/StringImpl.h: Moved TextCaseSensitivity out into a different header.
        Moved ASCIIFastPath.h include here from WTFString.h. Moved isAllSpecialCharacters
        free function here from WTFString.h. Moved lots of function bodies out of class
        definitions to make the class definitions easier to read. Sorted things a bit.
        Tweaked formatting. Marked constructor that takes one argument explicit. Added
        an isEmpty function like the one in String. Renamed copyChars to copyCharacters.
        Added isAllASCII, isAllLatin1 and isAllSpecialCharacters functions. Removed
        boolean caseSensitive arguments from various functions. Removed findIgnoringCase
        and reverseFindIgnoringCase. Added a FIXME to codePointCompare about the way it
        treats null and empty strings as equal. Changed length argument in remove to
        unsigned to match other lengths.

        * wtf/text/WTFString.cpp:
        (WTF::String::removeInternal): Changed length argument to be unsigned.
        (WTF::createWithFormatAndArguments): Use emptyString.
        (WTF::String::isSafeToSendToAnotherThread const): Rewrote to be easier to read.

        * wtf/text/WTFString.h: Moved ASCIIFastPath.h to StringImpl.h. Moved lots of
        function bodies out of class definitions to make the class definitions easier
        to read, made others one-liners. Removed the String::at function but kept the
        String::characterAt function; the two were identical. Removed boolean
        caseSensitive arguments from various functions. Removed findIgnoringCase and
        reverseFindIgnoringCase. Renamed containsOnlyASCII to isAllASCII and
        containsOnlyLatin1 to isAllLatin1 to match the naming of isAllSpecialCharacters.
        Moved the inline implementations of functions that are defined above further
        down, after things like the ASCIILiteral class and various functions.

        * wtf/text/icu/UTextProviderLatin1.cpp: Updated name of copyChars.

2017-11-22  Stephan Szabo  <stephan.szabo@sony.com>

        tuple related items are used in WTF without including tuple
        https://bugs.webkit.org/show_bug.cgi?id=179926

        Reviewed by Darin Adler.

        * wtf/HashFunctions.h:
        * wtf/PrintStream.h:
        * wtf/threads/Signals.h:

2017-11-21  Zan Dobersek  <zdobersek@igalia.com>

        Drop ENABLE_IMAGE_DECODER_DOWN_SAMPLING code
        https://bugs.webkit.org/show_bug.cgi?id=179921

        Reviewed by Carlos Garcia Campos.

        * wtf/FeatureDefines.h: Remove the ENABLE_IMAGE_DECODER_DOWN_SAMPLING
        definition.

2017-11-19  Tim Horton  <timothy_horton@apple.com>

        Remove unused TOUCH_ICON_LOADING feature flag
        https://bugs.webkit.org/show_bug.cgi?id=179873

        Reviewed by Simon Fraser.

        * wtf/FeatureDefines.h:

2017-11-19  Yusuke Suzuki  <utatane.tea@gmail.com>

        Add CPU(UNKNOWN) to cover all the unknown CPU types
        https://bugs.webkit.org/show_bug.cgi?id=179243

        Reviewed by JF Bastien.

        This patch adds a new CPU type, `CPU(UNKNOWN)` to cover all the unknown CPUs.
        This CPU architecture tells conservative assumption to make JSC work on all
        the unknown generic CPUs. And we make several CPUs (ALPHA, SH4, S390, S390X, IA64, IA64_32)
        UNKNOWN.

        We also make InlineASM available only for !CPU(UNKNOWN). In an unknown CPU, inline asm is not useful.

        And we also introduce a generic way to detect 64bit pointer environment by using
        __SIZEOF_POINTER__ predefined macro, or `UINTPTR_MAX > UINT32_MAX`.

        * wtf/InlineASM.h:
        * wtf/Platform.h:
        * wtf/dtoa/utils.h:

2017-11-19  Tim Horton  <timothy_horton@apple.com>

        Remove unused LEGACY_VENDOR_PREFIXES feature flag
        https://bugs.webkit.org/show_bug.cgi?id=179872

        Reviewed by Darin Adler.

        * wtf/FeatureDefines.h:

2017-11-19  Chris Dumez  <cdumez@apple.com>

        Fix potential thread safety issue in ThreadSafeIdentified
        https://bugs.webkit.org/show_bug.cgi?id=179879

        Reviewed by Darin Adler.

        Fix potential thread safety issue in ThreadSafeIdentified. Protect static std::atomic
        initialization with an std::call_once() given that we build with
        --fno-threadsafe-statics.

        * wtf/Identified.h:
        (WTF::Identified::Identified):
        (WTF::Identified::generateIdentifier):
        (WTF::ThreadSafeIdentified::ThreadSafeIdentified):
        (WTF::ThreadSafeIdentified::generateIdentifier):

2017-11-18  Darin Adler  <darin@apple.com>

        Eliminate some cases of double hashing, other related refactoring
        https://bugs.webkit.org/show_bug.cgi?id=179867

        Reviewed by Sam Weinig.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::containsOnlyWhitespace): Added FIXME.

2017-11-19  Chris Dumez  <cdumez@apple.com>

        Fix potential thread safety issue in generateThreadSafeObjectIdentifier()
        https://bugs.webkit.org/show_bug.cgi?id=179877

        Reviewed by Sam Weinig.

        Fix potential thread safety issue in generateThreadSafeObjectIdentifier().
        Protect std::atomic initialization with an std::call_once() given that we
        build with --fno-threadsafe-statics.

        * wtf/ObjectIdentifier.h:
        (WTF::generateThreadSafeObjectIdentifier):

2017-11-18  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Use system endianess information instead of relying CPU information
        https://bugs.webkit.org/show_bug.cgi?id=179861

        Reviewed by JF Bastien.

        Currently, we use known CPU information to determine endianess of the current
        architecture. But this means that unknown CPU does not work well in WebKit
        withou modifying code. Instead, we use compiler or system's macro to determine
        endianess. This paves the way to dropping many CPUs in Platform.h by replacing
        them with CPU(UNKNOWN)[1].

        [1]: https://bugs.webkit.org/show_bug.cgi?id=179243

        * wtf/Platform.h:

2017-11-18  Chris Dumez  <cdumez@apple.com>

        ASSERTION FAILED: registration in WebCore::SWServerJobQueue::scriptContextStarted(ServiceWorkerIdentifier)
        https://bugs.webkit.org/show_bug.cgi?id=179846

        Reviewed by Darin Adler.

        Add a generateThreadSafeObjectIdentifier() for generating an ObjectIdentifier
        in a thread-safe manner, using std::atomic.

        * wtf/ObjectIdentifier.h:
        (WTF::generateObjectIdentifier):
        (WTF::generateThreadSafeObjectIdentifier):

2017-11-18  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Remove CPU(HPPA) in StackBounds by using runtime stack direction test
        https://bugs.webkit.org/show_bug.cgi?id=179859

        Reviewed by JF Bastien.

        Currently, we know that CPU(HPPA)'s stack direction is upward! But listing
        CPU architectures here is not a scalable way.

        Instead, we use runtime stack direction test. By doing so, we can handle
        such a strange architecture without listing the CPU to Platform.h. This paves
        the way to dropping many CPUs in Platform.h by replacing them with CPU(UNKNOWN)[1].

        We also fix StackBounds::isGrowingDownward().

        [1]: https://bugs.webkit.org/show_bug.cgi?id=179243

        * wtf/StackBounds.cpp:
        (WTF::StackBounds::stackDirection):
        (WTF::testStackDirection2):
        (WTF::testStackDirection):
        (WTF::StackBounds::newThreadStackBounds):
        (WTF::StackBounds::currentThreadStackBoundsInternal):
        * wtf/StackBounds.h:
        (WTF::StackBounds::isGrowingDownward const):

2017-11-17  Chris Dumez  <cdumez@apple.com>

        Use a strongly typed identifier for SWServer::Connection
        https://bugs.webkit.org/show_bug.cgi?id=179848

        Reviewed by Brady Eidson.

        Make ObjectIdentifier a little more flexible to support more use cases.

        * wtf/ObjectIdentifier.h:
        (WTF::ObjectIdentifier::toUInt64 const):
        (WTF::makeObjectIdentifier):

2017-11-17  Simon Fraser  <simon.fraser@apple.com>

        Add a TimingScope class for microbenchmarking sections of code
        https://bugs.webkit.org/show_bug.cgi?id=179825

        Reviewed by Zalan Bujtas.
        
        Add a class, similar to B3TimingScope, which makes it easy to microbenchmark
        sections of code. Use looks like:
        
        TimingScope scope("some label", 100);
        
        where this will print mean scope duration every 100 calls. Sample output:
        
            FETurbulence::platformApplySoftware: 100 calls, mean duration: 3.073181ms
            FETurbulence::platformApplySoftware: 200 calls, mean duration: 3.074612ms
            FETurbulence::platformApplySoftware: 300 calls, mean duration: 3.065722ms
        
        Because TimingScope needs to store state beween invocations, and there may be
        multiple TimingScopes in use at the same time, data is stored in a global
        hash map with atomic access.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/TimingScope.cpp: Added.
        (WTF::TimingScope::scopeDidEnd):
        * wtf/TimingScope.h: Added.
        (WTF::TimingScope::TimingScope):
        (WTF::TimingScope::~TimingScope):

2017-11-17  Alex Christensen  <achristensen@webkit.org>

        Clean up after r224952
        https://bugs.webkit.org/show_bug.cgi?id=179809

        Reviewed by Brady Eidson.

        * wtf/MainThread.cpp:
        (WTF::dispatchFunctionsFromMainThread):
        (WTF::callOnMainThread):
        * wtf/MainThread.h:
        * wtf/generic/MainThreadGeneric.cpp:
        (WTF::scheduleDispatchFunctionsOnMainThread):
        (WTF::currentRunLoopInCommonMode): Deleted.
        * wtf/mac/MainThreadMac.mm:
        (WTF::scheduleDispatchFunctionsOnMainThread):
        (WTF::currentRunLoopInCommonMode): Deleted.
        * wtf/win/MainThreadWin.cpp:
        (WTF::scheduleDispatchFunctionsOnMainThread):
        (WTF::currentRunLoopInCommonMode): Deleted.

2017-11-15  Alex Christensen  <achristensen@webkit.org>

        Fix fast/events/message-port-postMessage-recursive.html after r224896
        https://bugs.webkit.org/show_bug.cgi?id=179749

        Reviewed by Jer Noble.

        * wtf/mac/MainThreadMac.mm:
        (WTF::currentRunLoopInCommonMode):
        We sometimes run the runloop in kCFRunLoopDefaultMode, which should also have the responsiveness optimization.
        This allows the runloop to continue to iterate when we are doing lots of things on the main thread.
        CFRunLoop.h has a special definition of these two constants.

2017-11-15  Alex Christensen  <achristensen@webkit.org>

        WebViews scheduled in custom run loop modes should be able to do more than 50ms of work at a time
        https://bugs.webkit.org/show_bug.cgi?id=179742
        <rdar://problem/35519421>

        Reviewed by Jer Noble.
        
        In r224687 I fixed loading from scheduled WebViews with custom run loop modes, but in 
        dispatchFunctionsFromMainThread we have an optimization to yield the run loop if we have already
        done more than 50ms of work on the main thread in this run loop iteration.  When this happens
        and we are running in a custom run loop mode, we disable this responsiveness optimization.
        We are calling CFRunLoopRunInMode or [NSRunLoop acceptInputForMode:beforeDate:] in a while loop anyways,
        so we would not benefit from a responsiveness optimization.  We definitely don't want to reschedule
        on the main thread in the common run loop mode in this case.

        * wtf/MainThread.cpp:
        (WTF::dispatchFunctionsFromMainThread):
        * wtf/MainThread.h:
        * wtf/generic/MainThreadGeneric.cpp:
        (WTF::currentRunLoopInCommonMode):
        * wtf/mac/MainThreadMac.mm:
        (WTF::currentRunLoopInCommonMode):
        * wtf/win/MainThreadWin.cpp:
        (WTF::currentRunLoopInCommonMode):

2017-11-15  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r224863.

        Introduced LayoutTest crashes on iOS Simulator.

        Reverted changeset:

        "Move JSONValues to WTF and convert uses of InspectorValues.h
        to JSONValues.h"
        https://bugs.webkit.org/show_bug.cgi?id=173793
        https://trac.webkit.org/changeset/224863

2017-11-14  Carlos Garcia Campos  <cgarcia@igalia.com>

        Move JSONValues to WTF and convert uses of InspectorValues.h to JSONValues.h
        https://bugs.webkit.org/show_bug.cgi?id=173793

        Reviewed by Brian Burg.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/JSONValues.cpp: Renamed from Source/JavaScriptCore/inspector/InspectorValues.cpp.
        (JSON::Value::null):
        (JSON::Value::create):
        (JSON::Value::asValue):
        (JSON::Value::asObject):
        (JSON::Value::asArray):
        (JSON::Value::parseJSON):
        (JSON::Value::toJSONString const):
        (JSON::Value::asBoolean const):
        (JSON::Value::asDouble const):
        (JSON::Value::asInteger const):
        (JSON::Value::asString const):
        (JSON::Value::writeJSON const):
        (JSON::Value::memoryCost const):
        (JSON::ObjectBase::~ObjectBase):
        (JSON::ObjectBase::asObject):
        (JSON::ObjectBase::openAccessors):
        (JSON::ObjectBase::memoryCost const):
        (JSON::ObjectBase::getBoolean const):
        (JSON::ObjectBase::getString const):
        (JSON::ObjectBase::getObject const):
        (JSON::ObjectBase::getArray const):
        (JSON::ObjectBase::getValue const):
        (JSON::ObjectBase::remove):
        (JSON::ObjectBase::writeJSON const):
        (JSON::ObjectBase::ObjectBase):
        (JSON::ArrayBase::~ArrayBase):
        (JSON::ArrayBase::asArray):
        (JSON::ArrayBase::writeJSON const):
        (JSON::ArrayBase::ArrayBase):
        (JSON::ArrayBase::get const):
        (JSON::Object::create):
        (JSON::Array::create):
        (JSON::ArrayBase::memoryCost const):
        * wtf/JSONValues.h: Renamed from Source/JavaScriptCore/inspector/InspectorValues.h.
        (JSON::ObjectBase::find):
        (JSON::ObjectBase::find const):
        (JSON::ObjectBase::setBoolean):
        (JSON::ObjectBase::setInteger):
        (JSON::ObjectBase::setDouble):
        (JSON::ObjectBase::setString):
        (JSON::ObjectBase::setValue):
        (JSON::ObjectBase::setObject):
        (JSON::ObjectBase::setArray):
        (JSON::ArrayBase::pushBoolean):
        (JSON::ArrayBase::pushInteger):
        (JSON::ArrayBase::pushDouble):
        (JSON::ArrayBase::pushString):
        (JSON::ArrayBase::pushValue):
        (JSON::ArrayBase::pushObject):
        (JSON::ArrayBase::pushArray):

2017-11-14  Alex Christensen  <achristensen@webkit.org>

        Remove Cocoa CFURLConnection loading code
        https://bugs.webkit.org/show_bug.cgi?id=179688

        Reviewed by Antti Koivisto.

        * wtf/SchedulePair.h:
        * wtf/SchedulePairMac.mm:

2017-11-13  Brady Eidson  <beidson@apple.com>

        Massive "Server-process-to-context-process" connection overhaul.
        https://bugs.webkit.org/show_bug.cgi?id=179554

        Reviewed by Chris Dumez.

        * wtf/ObjectIdentifier.h:
        (WTF::generateObjectIdentifier):
        (WTF::makeObjectIdentifier): Deleted.

2017-11-13  JF Bastien  <jfbastien@apple.com>

        std::expected: fix and test move
        https://bugs.webkit.org/show_bug.cgi?id=179617

        Reviewed by Alex Christensen.

        Non-copyable move types should be able to be in an expected
        properly.

        * wtf/Expected.h:
        (WTF::Expected::value const):
        (WTF::Expected::error):
        (WTF::Expected::error const):

2017-11-10  Jer Noble  <jer.noble@apple.com>

        Add a FairPlay Streaming based CDM for Modern EME
        https://bugs.webkit.org/show_bug.cgi?id=179499
        <rdar://problem/35445033>

        Reviewed by Eric Carlson.

        * wtf/Platform.h:

2017-11-10  Alex Christensen  <achristensen@webkit.org>

        REGRESSION(r224267): WebViews scheduled with custom run loop modes don't load
        https://bugs.webkit.org/show_bug.cgi?id=179515
        <rdar://problem/35445245>

        Reviewed by Andy Estes.

        * wtf/MainThread.cpp:
        (WTF::callOnMainThread):
        * wtf/MainThread.h:
        (WTF::callOnMainThread):
        (WTF::scheduleDispatchFunctionsOnMainThread):
        * wtf/generic/MainThreadGeneric.cpp:
        (WTF::scheduleDispatchFunctionsOnMainThread):
        * wtf/mac/MainThreadMac.mm:
        (WTF::scheduleDispatchFunctionsOnMainThread):
        * wtf/win/MainThreadWin.cpp:
        (WTF::scheduleDispatchFunctionsOnMainThread):
        Add an optional parameter which is an array of run loop mode names to pass to performSelectorOnMainThread.

2017-11-10  Ms2ger  <Ms2ger@igalia.com>

        Export tryFastZeroedMalloc.
        https://bugs.webkit.org/show_bug.cgi?id=179051

        Reviewed by Michael Catanzaro.

        The other functions were exported in bug 72855. There does not seem to be a
        reason not to export this one.

        * wtf/FastMalloc.h:

2017-11-09  Chris Dumez  <cdumez@apple.com>

        Unreviewed, rolling out r224661.

        Broke build on several internal Mac/iOS bots

        Reverted changeset:

        "Ignore HSTS for partitioned, cross-origin subresource
        requests"
        https://bugs.webkit.org/show_bug.cgi?id=178993
        https://trac.webkit.org/changeset/224661

2017-11-09  John Wilander  <wilander@apple.com>

        Ignore HSTS for partitioned, cross-origin subresource requests
        https://bugs.webkit.org/show_bug.cgi?id=178993
        <rdar://problem/34962462>

        Reviewed by Brent Fulgham.

        * wtf/Platform.h:
            Added HAVE_CFNETWORK_IGNORE_HSTS.

2017-11-08  Tim Horton  <timothy_horton@apple.com>

        [ios-simulator] API test WebKit.BundleParameters is a flaky failure
        https://bugs.webkit.org/show_bug.cgi?id=178363
        <rdar://problem/35043144>

        Reviewed by Brent Fulgham.

        * wtf/RefCounter.h:
        (WTF::RefCounter<T>::Count::deref):
        (WTF::RefCounter<T>::Count::refCounterWasDeleted):
        (WTF::RefCounter<T>::~RefCounter):
        If a RefCounter::Count is deref()'d and drops its RefCounter's value to
        zero, and the RefCounter is deleted in that valueDidChangeCallback, it
        will delete the Counter that is in the middle of deref(). Keep track
        of whether we're inside the callback and defer the deletion until
        the end of deref().

2017-11-07  Maciej Stachowiak  <mjs@apple.com>

        Get rid of unsightly hex numbers from unified build object files
        https://bugs.webkit.org/show_bug.cgi?id=179410

        Reviewed by Saam Barati.

        * Scripts/generate-unified-source-bundles.rb: For extensions other than "cpp", also include 
        the extension in the base name of the file, to avoid ugly Xcode-generated object file names.

2017-11-07  Filip Pizlo  <fpizlo@apple.com>

        Disable isoheaps on iOS

        Reviewed by Ryosuke Niwa.

        * wtf/IsoMalloc.h:

2017-11-07  Brady Eidson  <beidson@apple.com>

        Implement "UpdateWorkerState" and use it
        https://bugs.webkit.org/show_bug.cgi?id=179318

        Reviewed by Chris Dumez.

        * wtf/ObjectIdentifier.h:
        (WTF::ObjectIdentifier::loggingString const):

2017-11-07  Michael Saboff  <msaboff@apple.com>

        Add SPI function pointers qualifiers for CPU(ARM64E)
        https://bugs.webkit.org/show_bug.cgi?id=179383

        Reviewed by Mark Lam.

        For ARM64E, use the appropriate SPI qualifiers for helper function pointers.

        * wtf/BlockPtr.h:
        (WTF::BlockPtr<R):

2017-10-31  Filip Pizlo  <fpizlo@apple.com>

        bmalloc should support strictly type-segregated isolated heaps
        https://bugs.webkit.org/show_bug.cgi?id=178108

        Reviewed by Saam Barati, Simon Fraser, and Ryosuke Niwa.
        
        This just adds an easy way of using the bmalloc IsoHeap API in WebKit. If bmalloc is not
        enabled, these macros will just make the object FastMalloced.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/FastTLS.h:
        * wtf/IsoMalloc.h: Added.
        * wtf/IsoMallocInlines.h: Added.

2017-11-06  Christopher Reid  <chris.reid@sony.com>

        Use enum classes within FileSystem
        https://bugs.webkit.org/show_bug.cgi?id=175172

        Reviewed by Myles C. Maxfield.

        Adding a helper function for converting enum classes to their underlying type when necessary.

        * wtf/EnumTraits.h:

2017-11-06  Michael Catanzaro  <mcatanzaro@igalia.com>

        [WPE][GTK] Always use SET_AND_EXPOSE_TO_BUILD to set build variables
        https://bugs.webkit.org/show_bug.cgi?id=179038

        Reviewed by Žan Doberšek.

        * wtf/Platform.h:

2017-11-03  Chris Dumez  <cdumez@apple.com>

        Use a single identifier type to identify Service Workers
        https://bugs.webkit.org/show_bug.cgi?id=179192

        Reviewed by Brady Eidson.

        Introduce class for strongly typed identifiers. This avoids mixing up
        different types of identifiers.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/ObjectIdentifier.h: Added.
        (WTF::ObjectIdentifier::encode const):
        (WTF::ObjectIdentifier::decode):
        (WTF::ObjectIdentifier::operator== const):
        (WTF::ObjectIdentifier::operator!= const):
        (WTF::ObjectIdentifier::ObjectIdentifier):
        (WTF::makeObjectIdentifier):
        (WTF::ObjectIdentifierHash::hash):
        (WTF::ObjectIdentifierHash::equal):
        (WTF::HashTraits<ObjectIdentifier<T>>::emptyValue):
        (WTF::HashTraits<ObjectIdentifier<T>>::constructDeletedValue):
        (WTF::HashTraits<ObjectIdentifier<T>>::isDeletedValue):

2017-11-02  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r224353.

        Breaks internal builds.

        Reverted changeset:

        "Ignore HSTS for partitioned, cross-origin subresource
        requests"
        https://bugs.webkit.org/show_bug.cgi?id=178993
        https://trac.webkit.org/changeset/224353

2017-11-02  John Wilander  <wilander@apple.com>

        Ignore HSTS for partitioned, cross-origin subresource requests
        https://bugs.webkit.org/show_bug.cgi?id=178993
        <rdar://problem/34962462>

        Reviewed by Brent Fulgham and Alex Christensen.

        * wtf/Platform.h:
            Added HAVE_CFNETWORK_IGNORE_HSTS.

2017-11-02  Frederic Wang  <fwang@igalia.com>

        Add references to bug 179167 in FIXME comments
        https://bugs.webkit.org/show_bug.cgi?id=179168

        Reviewed by Daniel Bates.

        * wtf/FeatureDefines.h:

2017-11-01  Jiewen Tan  <jiewen_tan@apple.com>

        Let is<T>() accept RefPtrs
        https://bugs.webkit.org/show_bug.cgi?id=178612
        <rdar://problem/35102004>

        Reviewed by Ryosuke Niwa.

        Add support for is<T>() for RefPtrs.

        * wtf/RefPtr.h:
        (WTF::is):

2017-11-01  Simon Fraser  <simon.fraser@apple.com>

        Misc display list and other cleanup
        https://bugs.webkit.org/show_bug.cgi?id=179150

        Reviewed by Tim Horton.

        Add system trace points for display list recording.

        * wtf/SystemTracing.h:

2017-11-01  Fujii Hironori  <Hironori.Fujii@sony.com>

        Use LazyNeverDestroyed instead of DEFINE_GLOBAL
        https://bugs.webkit.org/show_bug.cgi?id=174979

        Reviewed by Yusuke Suzuki.

        DEFINE_GLOBAL is not used anymore. Remove it.

        * WTF.xcodeproj/project.pbxproj: Removed StaticConstructors.h
        * config.h: Removed definitions of SKIP_STATIC_CONSTRUCTORS_ON_MSVC and SKIP_STATIC_CONSTRUCTORS_ON_GCC.
        * wtf/CMakeLists.txt: Removed StaticConstructors.h
        * wtf/StaticConstructors.h: Removed.

2017-10-30  Michael Catanzaro  <mcatanzaro@igalia.com>

        [WPE] Fix build warnings
        https://bugs.webkit.org/show_bug.cgi?id=178899

        Reviewed by Carlos Alberto Lopez Perez.

        * wtf/PlatformWPE.cmake:

2017-10-27  Yousuke Kimoto  <yousuke.kimoto@sony.com>

        [WinCairo] Add WTF files for wincairo webkit
        https://bugs.webkit.org/show_bug.cgi?id=176894

        Reviewed by Alex Christensen.

        * wtf/PlatformWin.cmake:
        * wtf/WorkQueue.cpp:
        * wtf/WorkQueue.h:
        * wtf/win/Win32Handle.h:
        * wtf/win/WorkItemContext.cpp: Added.
        (WTF::WorkItemContext::WorkItemContext):
        (WTF::WorkItemContext::create):
        (WTF::WorkItemContext::~WorkItemContext):
        * wtf/win/WorkItemContext.h: Added.
        (WTF::WorkItemContext::handle):
        (WTF::WorkItemContext::waitHandle):
        (WTF::WorkItemContext::Function<void):
        (WTF::WorkItemContext::queue const):
        * wtf/win/WorkQueueWin.cpp:
        (WTF::WorkQueue::handleCallback):
        (WTF::WorkQueue::registerHandle):
        (WTF::WorkQueue::unregisterAndCloseHandle):
        (WTF::WorkQueue::unregisterWaitAndDestroyItemSoon):
        (WTF::WorkQueue::unregisterWaitAndDestroyItemCallback):

2017-10-27  Keith Miller  <keith_miller@apple.com>

        Add unified source list files and build scripts to Xcode project navigator
        https://bugs.webkit.org/show_bug.cgi?id=178959

        Reviewed by Andy Estes.

        * WTF.xcodeproj/project.pbxproj:

2017-10-26  Mark Lam  <mark.lam@apple.com>

        JSRopeString::RopeBuilder::append() should check for overflows.
        https://bugs.webkit.org/show_bug.cgi?id=178385
        <rdar://problem/35027468>

        Reviewed by Saam Barati.

        * wtf/CheckedArithmetic.h:

2017-10-25  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r222945.
        https://bugs.webkit.org/show_bug.cgi?id=178818

        "It made WasmBench crash" (Requested by saamyjoon on #webkit).

        Reverted changeset:

        "bmalloc mutex should be adaptive"
        https://bugs.webkit.org/show_bug.cgi?id=177839
        https://trac.webkit.org/changeset/222945

2017-10-25  Zan Dobersek  <zdobersek@igalia.com>

        Make SERVICE_WORKER feature buildable on GTK, WPE
        https://bugs.webkit.org/show_bug.cgi?id=178574

        Reviewed by Carlos Garcia Campos.

        * wtf/Identified.h: Explicitly include the <atomic> header since
        std::atomic<> is used in the ThreadSafeIdentified definition.

2017-10-24  Michael Saboff  <msaboff@apple.com>

        WTF: Eliminated PLATFORM checks for HAVE_MACH_EXCEPTIONS
        https://bugs.webkit.org/show_bug.cgi?id=178747

        Reviewed by Saam Barati.

        Removed unnecessary PLATFORM checks as they can cause build failures
        when the include file is present.

        * wtf/Platform.h:

2017-10-23  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Use fastJoin in Array#toString
        https://bugs.webkit.org/show_bug.cgi?id=178062

        Reviewed by Darin Adler.

        A bit cleaning up to use StringImpl::copyChars instead of
        using for-loop directly.

        * wtf/text/StringView.h:
        (WTF::StringView::getCharactersWithUpconvert const):

2017-10-20  Antoine Quint  <graouts@apple.com>

        [Web Animations] Provide basic timeline and animation interfaces
        https://bugs.webkit.org/show_bug.cgi?id=178526

        Reviewed by Dean Jackson.

        Remove the WEB_ANIMATIONS compile-time flag.

        * wtf/FeatureDefines.h:

2017-10-19  Keith Miller  <keith_miller@apple.com>

        REGRESSION (r223476): WebCore exports symbols with names belonging to other frameworks
        https://bugs.webkit.org/show_bug.cgi?id=178424

        Reviewed by David Kilzer.

        This patch moves the wrapper function sharing the name of the externed function
        to the source file and marks it as always inline. Marking it as inline prevents
        the framework from exporting it.

        * wtf/cocoa/SoftLinking.h:

2017-10-18  Keith Miller  <keith_miller@apple.com>

        Setup WebCore build to start using unified sources.
        https://bugs.webkit.org/show_bug.cgi?id=178362

        Reviewed by Tim Horton.

        There are a number of changes to the bundler script. First, it is
        now possible to enable or disable building files based on if the
        associated feature flag is enabled or not. The syntax for this is
        similar to how we do #ifs in C++ code. e.g.

        #if ENABLE_APPLE_PAY
            myApplePayFile.cpp
        #endif

        would enable myApplePayFile.cpp if and only if the APPLE_PAY
        feature define is set.

        I also changed comments from # to // to make it less likely they
        would be confused with a #if.

        Finally, this patch enables bundling files in the same relative
        directory across source list files. Previously, if
        SourcesCocoa.txt had platform/cf/foo.cpp and SourcesMac.txt had
        platform/cf/bar.cpp those files would not be put in the same
        unified source bundle. Now, those files will be put into the same
        bundle but bar.cpp will always follow foo.cpp. The idea is that by
        putting more specific files after more general files we can avoid
        random build failures.

        * Scripts/generate-unified-source-bundles.rb:

2017-10-18  Konstantin Tokarev  <annulen@yandex.ru>

        REGRESSION(r217771): nullTerminatedWCharToString loses last character of input string
        https://bugs.webkit.org/show_bug.cgi?id=178444

        Reviewed by Per Arne Vollan.

        * wtf/text/win/WCharStringExtras.h:
        (WTF::nullTerminatedWCharToString):

2017-10-17  Keith Miller  <keith_miller@apple.com>

        Change WebCore sources to work with unified source builds
        https://bugs.webkit.org/show_bug.cgi?id=178229

        Rubber stamped by Tim Horton.

        * wtf/Platform.h:
        * wtf/cocoa/SoftLinking.h:

2017-10-16  David Kilzer  <ddkilzer@apple.com>

        Add RELEASE_ASSERT_WITH_SECURITY_IMPLICATION() macro
        <https://webkit.org/b/178269>

        Reviewed by Alex Christensen.

        * wtf/Assertions.h:
        (RELEASE_ASSERT_WITH_SECURITY_IMPLICATION): Add macro.

2017-10-14  Sam Weinig  <sam@webkit.org>

        Remove HashCountedSet's copyToVector functions
        https://bugs.webkit.org/show_bug.cgi?id=178215

        Reviewed by Daniel Bates.

        * wtf/HashCountedSet.h:
        (WTF::copyToVector): Deleted.
        
            They are replaced by either copyToVector(hashCountedSet) or copyToVector(hashCountedSet.values())

2017-10-13  Sam Weinig  <sam@webkit.org>

        Adopt type trait template aliases everywhere in WTF
        https://bugs.webkit.org/show_bug.cgi?id=178299

        Reviewed by Yusuke Suzuki.

        Adopt type trait template aliases (e.g. replace 'typename std::make_unsigned<Source>::type'
        with 'std::make_unsigned_t<Source>'). Also adopt using over typedef consistently.

        * wtf/Atomics.h:
        * wtf/CagedUniquePtr.h:
        * wtf/CheckedArithmetic.h:
        * wtf/CompletionHandler.h:
        * wtf/Function.h:
        * wtf/HashCountedSet.h:
        * wtf/HashFunctions.h:
        * wtf/HashMap.h:
        * wtf/HashSet.h:
        * wtf/HashTable.h:
        * wtf/HashTraits.h:
        * wtf/IndexedContainerIterator.h:
        * wtf/IteratorAdaptors.h:
        * wtf/KeyValuePair.h:
        * wtf/LEBDecoder.h:
        * wtf/ListHashSet.h:
        * wtf/MathExtras.h:
        * wtf/NeverDestroyed.h:
        * wtf/OptionSet.h:
        * wtf/RetainPtr.h:
        * wtf/SizeLimits.cpp:
        * wtf/StdLibExtras.h:
        * wtf/SystemFree.h:
        * wtf/ThreadSpecific.h:
        * wtf/TypeCasts.h:
        * wtf/Vector.h:
        * wtf/text/IntegerToStringConversion.h:

2017-10-13  Jer Noble  <jer.noble@apple.com>

        Performance: Skip texture upload if source image and destination texture haven't changed
        https://bugs.webkit.org/show_bug.cgi?id=178254
        <rdar://problem/34968181>

        Reviewed by Dean Jackson.

        Add a new class, UnsafePointer, for safely holding pointers to objects with uncontrolled lifetimes.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/UnsafePointer.h: Added.
        (WTF::UnsafePointer::UnsafePointer):
        (WTF::UnsafePointer::operator== const):
        (WTF::UnsafePointer::operator!= const):
        (WTF::UnsafePointer::operator bool const):
        (WTF::operator==):
        (WTF::operator!=):

2017-10-13  Per Arne Vollan  <pvollan@apple.com>

        [Win] When built with VS2017, MiniBrowser crashes on startup.
        https://bugs.webkit.org/show_bug.cgi?id=175209

        Reviewed by Daniel Bates.

        Add AtomicString(const StaticStringImpl*) constructor. This is needed since
        this patch adds constexpr to the static, global StaticStringImpl objects
        generated in WebCore/bindings/scripts/StaticString.pm.

        * wtf/text/AtomicString.h:
        (WTF::AtomicString::AtomicString):
        * wtf/text/AtomicStringImpl.cpp:
        (WTF::addStatic):
        (WTF::AtomicStringImpl::add):
        * wtf/text/AtomicStringImpl.h:
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::assertHashIsCorrect const):
        (WTF::StringImpl::assertHashIsCorrect): Deleted.

2017-10-12  Alex Christensen  <achristensen@webkit.org>

        Add Expected, HashMap, HashSet, and SHA1 to wtf/Forward.h
        https://bugs.webkit.org/show_bug.cgi?id=178243

        Reviewed by Tim Horton.

        * wtf/Forward.h:
        * wtf/HashMap.h:
        Move default parameters to Forward.h like we did with Vector.
        * wtf/HashSet.h:
        Also fix indentation.

2017-10-12  Alex Christensen  <achristensen@webkit.org>

        Add CompletionHandler and HashCountedSet to wtf/Forward.h
        https://bugs.webkit.org/show_bug.cgi?id=178231

        Reviewed by Tim Horton.

        * wtf/Forward.h:
        * wtf/HashCountedSet.h:

2017-10-11  Sam Weinig  <sam@webkit.org>

        Remove out-parameter variants of copyToVector
        https://bugs.webkit.org/show_bug.cgi?id=178155

        Reviewed by Tim Horton.

        * wtf/HashMap.h:
        (WTF::copyToVector): Deleted.
        * wtf/HashSet.h:
        (WTF::copyToVector): Deleted.
        
            Remove copyToVector.
        
        * wtf/Vector.h:
        (WTF::copyToVectorSpecialization):
        
            Add another version of copyToVector, called copyToVectorSpecialization, that allows
            you to specify the entire specialization for the Vector you want to copy to. This
            can be useful if you want your resulting Vector to have an inline capacity. 

2017-10-12  Sam Weinig  <sam@webkit.org>

        It should be possible to iterate just the values (and not the counts) of a HashCountedSet
        https://bugs.webkit.org/show_bug.cgi?id=178169

        Reviewed by Daniel Bates.

        Cleanup (fix indentation, simplify type names, adopt using), and add a values() range to
        HashCountedSet. This will allow getting a Vector of all the values (and not the counts)
        using the new copyToVector. 

        * wtf/HashCountedSet.h:

2017-10-11  Michael Saboff  <msaboff@apple.com>

        [JSC] Add ability to build with ARMV8 ILP32 ABI
        https://bugs.webkit.org/show_bug.cgi?id=178194

        Reviewed by Saam Barati.

        For ARMV8 32 bit ABI, use JSVALUE32_64 and the CLOOP.

        * wtf/Platform.h:

2017-10-11  Youenn Fablet  <youenn@apple.com>

        Add API to clean CacheStorage data
        https://bugs.webkit.org/show_bug.cgi?id=178034

        Reviewed by Chris Dumez.

        Moving CallbackAggregator pattern into its own class for easier reuse.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CallbackAggregator.h: Added.
        (WTF::CallbackAggregator::create):
        (WTF::CallbackAggregator::~CallbackAggregator):
        (WTF::CallbackAggregator::CallbackAggregator):

2017-10-10  Sam Weinig  <sam@webkit.org>

        Replace copyKeysToVector/copyValuesToVector with copyToVector(map.keys())/copyToVector(map.values())
        https://bugs.webkit.org/show_bug.cgi?id=178102

        Reviewed by Tim Horton.

        * wtf/HashMap.h:
        (WTF::copyKeysToVector): Deleted.
        (WTF::copyValuesToVector): Deleted.
        
            Remove copyKeysToVector and copyValuesToVector which are no longer used.

2017-10-09  Youenn Fablet  <youenn@apple.com>

        Vector should be able to easily create from a list of movable only items
        https://bugs.webkit.org/show_bug.cgi?id=176432

        Reviewed by Darin Adler.

        Adding static from method to construct a Vector from movable-only items.
        This may also be used instead of initializer list constructor for types that would benefit of being moved.

        * wtf/Vector.h:
        (WTF::Vector::Vector):
        (WTF::Vector::from):
        (WTF::Vector::uncheckedInitialize): Introduced as an optimization to set the vector size once.
        (WTF::Malloc>::reserveInitialCapacity):

2017-10-09  Tim Horton  <timothy_horton@apple.com>

        Disable INPUT_TYPE_COLOR in FeatureDefines.h
        https://bugs.webkit.org/show_bug.cgi?id=178103
        <rdar://problem/34872127>

        Reviewed by Simon Fraser.

        * wtf/FeatureDefines.h:
        Because FeatureDefines.h overrides features that are not enabled in
        FeatureDefines.xcconfig, you currently have to turn INPUT_TYPE_COLOR
        off in two places. Since we only ever want it on for Mac, it's OK
        to depend on the xcconfig defining it.

2017-10-09  Sam Weinig  <sam@webkit.org>

        Make HashMap::keys() and HashMap::values() work with WTF::map/WTF::copyToVector
        https://bugs.webkit.org/show_bug.cgi?id=178072

        Reviewed by Darin Adler.

        Introduce SizedIteratorRange, a variant of IteratorRange that includes
        a reference to a backing container in order to get the size of container.
        This is useful for algorithms like WTF::map and WTF::copyToVector, that
        can use the size to efficiently allocate things of the correct size.

        The main beneficiary are HashMap's keys() and values() functions which
        used to return IteratorRanges and now return SizedIteratorRange. This
        allows us to remove (in a future change) copyKeysToVector() and
        copyValuesToVector() by replacing them with copyToVector(map.keys()) and
        copyToVector(map.values()) respectively.

        * wtf/HashMap.h:
        * wtf/IteratorRange.h:
        (WTF::SizedIteratorRange::SizedIteratorRange):
        (WTF::SizedIteratorRange::size const):
        (WTF::SizedIteratorRange::begin const):
        (WTF::SizedIteratorRange::end const):
        (WTF::makeSizedIteratorRange):

2017-10-08  Sam Weinig  <sam@webkit.org>

        It should be possible to create a ListHashSet with a std::initializer_list.
        https://bugs.webkit.org/show_bug.cgi?id=178070

        Reviewed by Darin Adler.

        * wtf/ListHashSet.h:
        (WTF::U>::ListHashSet):
        Add a constructor that takes a std::initializer_list.

2017-10-08  Sam Weinig  <sam@webkit.org>

        Address additional feedback from Darin for r223039 and sort the using declarations.

        * wtf/Vector.h:

2017-10-08  Sam Weinig  <sam@webkit.org>

        There should be a version of copyToVector that returns a Vector, rather than using an out parameter
        https://bugs.webkit.org/show_bug.cgi?id=177732

        Reviewed by Saam Barati.

        Add two new helper functions, copyToVector and copyToVectorOf, which will be able to
        replace the existing out parameter taking copyToVector. Like it's ancestral namesake,
        copyToVector takes an object that is both iterable (supports begin() and end()) and
        has a size, and returns a Vector with a copy of all the items iterated. The copyToVectorOf
        variant allow the user to specify a type to convert to, so if you have a HashSet<int>
        but want those as floats in a Vector, you can do:
        
            auto floatVector = copyToVectorOf<float>(intSet);

        * wtf/Vector.h:
        (WTF::copyToVector):
        (WTF::copyToVectorOf):

2017-10-08  Darin Adler  <darin@apple.com>

        Fix bugs related to setting reflected floating point DOM attributes
        https://bugs.webkit.org/show_bug.cgi?id=178061

        Reviewed by Sam Weinig.

        * wtf/dtoa.cpp:
        (WTF::formatStringTruncatingTrailingZerosIfNeeded): Fix a bug where
        this function would remove trailing zeroes from the exponent if
        present instead of from the mantissa. This meant that it would
        format 1e10 as "1.00000e+1" instead of "1e+10". Added regression
        tests for this to TestWebKitAPI.

        * wtf/dtoa/utils.h:
        (WTF::double_conversion::StringBuilder::RemoveCharacters): Added.
        Used by the fix above.

        * wtf/text/AtomicString.cpp:
        (WTF::AtomicString::number): Note: This function is used by code
        that sets the values of reflected floating point DOM attributes.
        Changed the function to use the rules from numberToString rather
        ones from numberToFixedPrecisionString. This is analogous to
        String::numberToStringECMAScript, and in the future we should change
        String and StringBuilder so this "ECMAScript" semantic is the default
        way to convert a floating point number to a string, and rename the fixed
        precision version that is currently called String::number. I audited
        the small number of sites calling AtomicString::number, by temporarily
        renaming it, and discovered that this is the correct behavior for all;
        none needed fixed precision. Also, fixed a mistake where this explicitly
        converted to String. That was defeating the purpose of having these
        functions in AtomicString: It would allocate a new String and then
        destroy it in the case where an equal string was already in the
        AtomicString table.

2017-10-06  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r222791 and r222873.
        https://bugs.webkit.org/show_bug.cgi?id=178031

        Caused crashes with workers/wasm LayoutTests (Requested by
        ryanhaddad on #webkit).

        Reverted changesets:

        "WebAssembly: no VM / JS version of everything but Instance"
        https://bugs.webkit.org/show_bug.cgi?id=177473
        http://trac.webkit.org/changeset/222791

        "WebAssembly: address no VM / JS follow-ups"
        https://bugs.webkit.org/show_bug.cgi?id=177887
        http://trac.webkit.org/changeset/222873

2017-10-06  Antti Koivisto  <antti@apple.com>

        Minor WeakPtr improvements
        https://bugs.webkit.org/show_bug.cgi?id=177958

        Reviewed by Sam Weinig.

        * wtf/WeakPtr.h:
        (WTF::WeakPtr::operator bool const):

            Make explicit.

        (WTF::WeakPtrFactory::createWeakPtr const):
        (WTF::makeWeakPtr):

            Remove templating from createWeakPtr, makeWeakPtr() is now the
            canonical way to make derived-type WeakPtrs.

2017-10-04  Filip Pizlo  <fpizlo@apple.com>

        bmalloc mutex should be adaptive
        https://bugs.webkit.org/show_bug.cgi?id=177839

        Reviewed by Michael Saboff.
        
        Add some comments that I thought of while copy-pasting this code.

        Reland after fixing ancient WordLock bug: the notify_one has to happen with the lock held
        to ensure it doesn't run after that thread has died.

        * wtf/LockAlgorithmInlines.h:
        * wtf/WordLock.cpp:

2017-10-05  Carlos Alberto Lopez Perez  <clopez@igalia.com>

        Generate a compile error if release is built without compiler optimizations
        https://bugs.webkit.org/show_bug.cgi?id=177665

        Reviewed by Brian Burg.

        For GCC and Clang, generate an error at build time that will alert
        the developer that she is trying to build Release without any compiler
        optimization. A build time error is much better than an unexpected
        "oh, WebKit is really slow ..."  situation later.

        If this was intended, then we tell the developer that she can continue
        by just setting -DRELEASE_WITHOUT_OPTIMIZATIONS in the list of build
        flags.

        The intention of this patch is to ensure that nobody builds Release
        without enabling compiler optimization by mistake.

        * wtf/Compiler.h:

2017-10-05  David Kilzer  <ddkilzer@apple.com>

        Bug 177893: Disable -Wcast-qual for new clang compiler in Apple ports
        <https://webkit.org/b/177893>
        <rdar://problem/33667497>

        Reviewed by Tim Horton.

        * wtf/RetainPtr.h:
        (WTF::RetainPtr::fromStorageType const): Disable warnings for
        -Wcast-qual until we can provide a safe cast function that lets
        us re-enable the warning.

2017-10-05  Matt Lewis  <jlewis3@apple.com>

        Unreviewed, rolling out r222893.

        This caused multiple API failures.

        Reverted changeset:

        "bmalloc mutex should be adaptive"
        https://bugs.webkit.org/show_bug.cgi?id=177839
        http://trac.webkit.org/changeset/222893

2017-10-04  Filip Pizlo  <fpizlo@apple.com>

        bmalloc mutex should be adaptive
        https://bugs.webkit.org/show_bug.cgi?id=177839

        Reviewed by Michael Saboff.
        
        Add some comments that I thought of while copy-pasting this code.

        * wtf/LockAlgorithmInlines.h:
        * wtf/WordLock.cpp:

2017-10-04  JF Bastien  <jfbastien@apple.com>

        WTF: Update std::expected to match current proposal
        https://bugs.webkit.org/show_bug.cgi?id=177881

        Reviewed by Mark Lam.

        The proposal is likely to be in C++20 and I've been asked to help co-champion
        it. I'm therefore updating our implementation to more closely match the current
        proposal, and to make sure it'll work for us if standardized.

         - Rename UnexpectedType to Unexpected to match the proposal.
         - Remove relational operators, only equality / inequality remains.
         - Fix minor type signatures.
         - Add UnexpectedType typedef.
         - Uncomment rebind implementation.
         - Add in-place construction tag, as well as explicit error construction tag.
         - Add template unexpected constructor.
         - Note that make_unexpected isn't in the proposal anymore, but we keep it because we don't have C++17 deduction guides.
         - Remove hashing, which isn't in the proposal anymore.

        * wtf/Expected.h:
        (WTF::Unexpected::Unexpected):
        (WTF::Unexpected::value const):
        (WTF::operator==):
        (WTF::operator!=):
        (WTF::makeUnexpected):
        (WTF::Expected::Expected):
        (WTF::Expected::operator=):
        (WTF::Expected::getUnexpected const):

2017-10-04  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r222840.

        This change breaks internal builds.

        Reverted changeset:

        "Generate a compile error if release is built without compiler
        optimizations"
        https://bugs.webkit.org/show_bug.cgi?id=177665
        http://trac.webkit.org/changeset/222840

2017-10-04  Carlos Alberto Lopez Perez  <clopez@igalia.com>

        Generate a compile error if release is built without compiler optimizations
        https://bugs.webkit.org/show_bug.cgi?id=177665

        Reviewed by Michael Catanzaro.

        For GCC and Clang, generate an error at build time that will alert
        the developer that she is trying to build Release without any compiler
        optimization. A build time error is much better than an unexpected
        "oh, WebKit is really slow ..."  situation later.

        If this was intended, then we tell the developer that she can continue
        by just setting -DRELEASE_WITHOUT_OPTIMIZATIONS in the list of build
        flags.

        The intention of this patch is to ensure that nobody builds Release
        without enabling compiler optimization by mistake.

        * wtf/Compiler.h:

2017-10-04  Tomas Popela  <tpopela@redhat.com>

        Allow building without WOFF enabled

        Reviewed by Michael Catanzaro.

        Don't force the WOFF to be turned on, but follow what is set in cmake.

        * wtf/Platform.h:

2017-10-03  Saam Barati  <sbarati@apple.com>

        Implement polymorphic prototypes
        https://bugs.webkit.org/show_bug.cgi?id=176391

        Reviewed by Filip Pizlo.

        * wtf/Box.h:
        (WTF::Box::operator bool const):
        (WTF::Box::operator bool): Deleted.
        Make Box movable. Also ensure its operator bool doesn't do an atomic increment.
        * wtf/RefPtr.h:
        (WTF::RefPtr::operator bool const):
        Add `explicit operator bool()` for RefPtr.

2017-10-03  Antti Koivisto  <antti@apple.com>

        Allow assigning WeakPtr<Derived> to WeakPtr<Base>
        https://bugs.webkit.org/show_bug.cgi?id=177817

        Reviewed by Geoff Garen.

        Add templated copy/move constructors/assignment operators, similar to RefPtr.

        * wtf/WeakPtr.h:
        (WTF::WeakPtrFactory::createWeakPtr const):
        (WTF::weak_reference_upcast):
        (WTF::weak_reference_downcast):
        (WTF::WeakPtr<T>::WeakPtr):
        (WTF::=):
        (WTF::makeWeakPtr):

2017-10-03  JF Bastien  <jfbastien@apple.com>

        WebAssembly: no VM / JS version of everything but Instance
        https://bugs.webkit.org/show_bug.cgi?id=177473

        Reviewed by Filip Pizlo.

        * wtf/StdLibExtras.h:
        (WTF::default_construct_at): this makes code in WasmTable much
        more readable, and is generally useful for generic code

2017-10-02  Myles C. Maxfield  <mmaxfield@apple.com>

        Move LineEnding.{h,cpp} from WebCore/platform/text to wtf/text
        https://bugs.webkit.org/show_bug.cgi?id=176575

        Reviewed by Alex Christensen.

        As part of the PAL effort, we're trying to move everything out of WebCore/platform, one-by-one.
        These LineEnding files belong in WTF.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/text/LineEnding.cpp: Renamed from Source/WebCore/platform/text/LineEnding.cpp.
        (WTF::normalizeLineEndingsToCRLF):
        * wtf/text/LineEnding.h: Renamed from Source/WebCore/platform/text/LineEnding.h.

2017-10-02  Geoffrey Garen  <ggaren@apple.com>

        WeakPtr should have a move constructor
        https://bugs.webkit.org/show_bug.cgi?id=177789

        Reviewed by Chris Dumez.

        * wtf/WeakPtr.h: Now that we just have a RefPtr data member,
        the default operators are sufficient.

2017-10-02  Geoffrey Garen  <ggaren@apple.com>

        NULL WeakPtr should not malloc!
        https://bugs.webkit.org/show_bug.cgi?id=177773

        Reviewed by Antti Koivisto.

        Translating NULL into malloc is... inefficient.

        * wtf/WeakPtr.h:
        (WTF::WeakPtr::WeakPtr):
        (WTF::WeakPtr::operator=):
        (WTF::WeakPtr::clear): Make m_ref lazy so that a NULL m_ref can represent
        a NULL pointer. Normal dereference is no slower because we can rely on
        the fact that dereference of NULL should crash. operator bool() and get()
        incur an extra branch. That's probably worth it to avoid malloc
        for NULL.

2017-10-02  Antti Koivisto  <antti@apple.com>

        Add makeWeakPtr variant that takes pointer
        https://bugs.webkit.org/show_bug.cgi?id=177767

        Reviewed by Zalan Bujtas.

        * wtf/WeakPtr.h:
        (WTF::makeWeakPtr):

        This version deals with the nullptr.

2017-09-30  Antti Koivisto  <antti@apple.com>

        Add makeWeakPtr for easier WeakPtr construction
        https://bugs.webkit.org/show_bug.cgi?id=177706

        Reviewed by Sam Weinig.

        Standalone makeWeakPtr() returns a WeakPtr of the same type as the argument.

        For this to work the argument type needs to expose a (possibly base type) WeakPtrFactory
        as a public weakPtrFactory() member function.

        * wtf/WeakPtr.h:
        (WTF::WeakPtr::operator-> const):
        (WTF::WeakPtr::operator* const): Also add operator*.
        (WTF::makeWeakPtr):

2017-09-28  Jiewen Tan  <jiewen_tan@apple.com>

        WeakPtrFactory should allow downcasting
        https://bugs.webkit.org/show_bug.cgi?id=177389
        <rdar://problem/34604174>

        Reviewed by Geoffrey Garen.

        In this patch, WeakPtrFactory is enhanced with the ability to create WeakPtrs
        of its owner's sub classes and have them point to the same WeakReference.

        * wtf/WeakPtr.h:
        (WTF::WeakPtr::WeakPtr):
        We cannot determine the base class of type T, thus no friends. It is made public
        such that WeakPtrFactory with a base class type U can create a derived type T
        WeakPtr.
        (WTF::WeakPtrFactory::createWeakPtr const):

2017-09-28  Don Olmstead  <don.olmstead@sony.com>

        Sync SYSTEM_MALLOC implementation of Gigacage
        https://bugs.webkit.org/show_bug.cgi?id=177569

        Reviewed by Mark Lam.

        * wtf/Gigacage.h:
        (Gigacage::basePtr):
        (Gigacage::basePtrs):

2017-09-27  Per Arne Vollan  <pvollan@apple.com>

        [Win64] Compile error, 'BasePtrs' is undefined.
        https://bugs.webkit.org/show_bug.cgi?id=177565

        Reviewed by Mark Lam.

        Copy definition of 'BasePtrs' from bmalloc/GigaCage.h.

        * wtf/Gigacage.h:

2017-09-26  Said Abou-Hallawa  <sabouhallawa@apple.com>

        Followup (r222427): SynchronizedFixedQueue should not have a public constructor
        https://bugs.webkit.org/show_bug.cgi?id=177458

        Reviewed by Tim Horton.

        Since SynchronizedFixedQueue is now derived from ThreadSafeRefCounted<SynchronizedFixedQueue>,
        the standard way to have an instance of it is to call SynchronizedFixedQueue::create()
        which returns a Ref<SynchronizedFixedQueue>. Now it does not make sense to still
        have the constructor public.

        * wtf/SynchronizedFixedQueue.h:
        (WTF::SynchronizedFixedQueue::SynchronizedFixedQueue):

2017-09-24  Keith Miller  <keith_miller@apple.com>

        JSC build should use unified sources for derived sources
        https://bugs.webkit.org/show_bug.cgi?id=177421

        Reviewed by JF Bastien.

        The script now needs to determine if a file is from a derived
        source. This is only relevant for the CMake build since the
        script needs to provide a list of the bundled source files. If the
        script does not provide the full path for derived sources then
        CMake will be unable to find them and the build will fail.

        Additionally, I move the error message for the Xcode build outside
        the main loop. This means that the error message will contain all
        the files you need to add to Xcode and all those files will now be
        written in DerivedSources so they should be easier to add.

        * Scripts/generate-unified-source-bundles.rb:

2017-09-26  Zan Dobersek  <zdobersek@igalia.com>

        Support building JavaScriptCore with the Bionic C library
        https://bugs.webkit.org/show_bug.cgi?id=177427

        Reviewed by Michael Catanzaro.

        * wtf/Platform.h: Define HAVE_MACHINE_CONTEXT when __BIONIC__
        is defined, i.e. when building with the Bionic C library.

2017-09-23  Said Abou-Hallawa  <sabouhallawa@apple.com>

        Images may render partial frames even after loading all the encoded data
        https://bugs.webkit.org/show_bug.cgi?id=177406

        Reviewed by Simon Fraser.

        Make it possible to create a RefPtr<SynchronizedFixedQueue>.

        * wtf/SynchronizedFixedQueue.h:
        (WTF::SynchronizedFixedQueue::create):
        (WTF::SynchronizedFixedQueue::enqueue):
        (WTF::SynchronizedFixedQueue::dequeue):

2017-09-22  Zalan Bujtas  <zalan@apple.com>

        WeakPtrFactory should populate m_ref lazily.
        https://bugs.webkit.org/show_bug.cgi?id=177375

        Reviewed by Geoffrey Garen.

        This helps us with the overhead of initializing WeakPtrFactory for
        objects that rarely end up creating the weak reference.
        -This is in preparation for introducing WeakPtr to RenderObject.

        All credit to Geoffrey Garen.

        * wtf/WeakPtr.h:
        (WTF::WeakReference::get const):
        (WTF::WeakReference::clear):
        (WTF::WeakReference::WeakReference):
        (WTF::WeakPtrFactory::~WeakPtrFactory):
        (WTF::WeakPtrFactory::createWeakPtr const):
        (WTF::WeakPtrFactory::revokeAll):
        (WTF::WeakPtrFactory::WeakPtrFactory): Deleted.

2017-09-21  Alex Christensen  <achristensen@webkit.org>

        Make StringBuilder movable
        https://bugs.webkit.org/show_bug.cgi?id=177311

        Reviewed by Chris Dumez.

        * wtf/text/StringBuilder.h:
        (WTF::StringBuilder::StringBuilder):

2017-09-20  Keith Miller  <keith_miller@apple.com>

        JSC should use unified sources for platform specific files.
        https://bugs.webkit.org/show_bug.cgi?id=177290

        Reviewed by Michael Saboff.

        The unified source bundler script can now handle more than one
        list of sources. Sources will not be bundled across source file
        lists. We want to ensure that changing one platform's sources
        doesn't break another platform's build, as much as
        possible. Additionally, it means that there won't be weird
        performance changes when files are added to an unrelated platform.

        Remove stale reference to generate-unified-source-bundles.rb script
        from Xcode.

        * Scripts/generate-unified-source-bundles.rb:
        * WTF.xcodeproj/project.pbxproj:

2017-09-20  Stephan Szabo  <stephan.szabo@sony.com>

        [Win] WTF: Add alias for process id to use in place of direct uses of pid_t
        https://bugs.webkit.org/show_bug.cgi?id=177017

        Reviewed by Alex Christensen.

        * wtf/ProcessID.h:
        (WTF::getCurrentProcessID):

2017-09-20  Keith Miller  <keith_miller@apple.com>

        JSC Xcode build should use unified sources for platform independent files
        https://bugs.webkit.org/show_bug.cgi?id=177190

        Reviewed by Saam Barati.

        Add a new directory for build scripts that are forwarded to subsequent framework builds.

        * Scripts/generate-unified-source-bundles.rb: Renamed from Source/WTF/generate-unified-source-bundles.rb.
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:

2017-09-20  Per Arne Vollan  <pvollan@apple.com>

        [Win] Cannot find script to generate unified sources.
        https://bugs.webkit.org/show_bug.cgi?id=177014

        Reviewed by Keith Miller.

        Copy the ruby script to WTF/Scripts in the forwarding headers folder.

        * wtf/CMakeLists.txt:

2017-09-20  Alberto Garcia  <berto@igalia.com>

        Fix HPPA and Alpha builds
        https://bugs.webkit.org/show_bug.cgi?id=177224

        Reviewed by Alex Christensen.

        * wtf/Platform.h:

2017-09-19  Youenn Fablet  <youenn@apple.com>

        Allow WTF::map to use any class that is iterable and has a size getter
        https://bugs.webkit.org/show_bug.cgi?id=177026

        Reviewed by Darin Adler.

        Computing the Item type given to the lambda using the iterator instead of ValueType which is specific to Vector.
        Adding the possibility to pass a non const container reference and a lambda taking non const references as well. 

        * wtf/Vector.h:
        (WTF::MapFunctionInspector::acceptsReference):
        (WTF::Mapper::map):
        (WTF::map):

2017-09-19  Jer Noble  <jer.noble@apple.com>

        [Cocoa] Add an ImageDecoder subclass backed by AVFoundation
        https://bugs.webkit.org/show_bug.cgi?id=176825

        Reviewed by Eric Carlson.

        * wtf/Platform.h:

2017-09-18  Andy Estes  <aestes@apple.com>

        [Cocoa] Upstream sandbox-related WebKitSystemInterface functions
        https://bugs.webkit.org/show_bug.cgi?id=177047

        Reviewed by Daniel Bates.

        * wtf/spi/darwin/SandboxSPI.h:

2017-09-18  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r222170.

        The API test added with this change is failing.

        Reverted changeset:

        "Allow WTF::map to use any class that is iterable and has a
        size getter"
        https://bugs.webkit.org/show_bug.cgi?id=177026
        http://trac.webkit.org/changeset/222170

2017-09-18  Youenn Fablet  <youenn@apple.com>

        Allow WTF::map to use any class that is iterable and has a size getter
        https://bugs.webkit.org/show_bug.cgi?id=177026

        Reviewed by Darin Adler.

        Computing the Item type given to the lambda using the iterator instead of ValueType which is specific to Vector.
        Adding the possibility to pass a non const container reference and a lambda taking non const references as well. 

        * wtf/Vector.h:
        (WTF::MapFunctionInspector::acceptsReference):
        (WTF::Mapper::map):
        (WTF::map):

2017-09-15  JF Bastien  <jfbastien@apple.com>

        WTF: use Forward.h when appropriate instead of Vector.h
        https://bugs.webkit.org/show_bug.cgi?id=176984

        Reviewed by Saam Barati.

        There's no need to include Vector.h when Forward.h will suffice. All we need is to move the template default parameters from Vector, and then the forward declaration can be used in so many new places: if a header only takes Vector by reference, rvalue reference, pointer, returns any of these, or has them as members then the header doesn't need to see the definition because the declaration will suffice.

        * wtf/Forward.h:
        * wtf/Vector.h:
        * wtf/text/StringVector.h:

2017-09-15  Keith Miller  <keith_miller@apple.com>

        generate-unified-source-bundles.rb shouldn't write a file that isn't going to change
        https://bugs.webkit.org/show_bug.cgi?id=177021

        Reviewed by Tim Horton.

        * generate-unified-source-bundles.rb:

2017-09-14  Saam Barati  <sbarati@apple.com>

        We should have a way of preventing a caller from making a tail call and we should use it for ProxyObject instead of using build flags
        https://bugs.webkit.org/show_bug.cgi?id=176863

        Reviewed by Keith Miller.

        This patch adds a way for a particular function to mark
        that none of its calls should be tail calls.
        
        It's useful in the following example if you don't want foo
        to do a tail call to bar or baz:
        
        int foo(bool b)
        {
            NO_TAIL_CALLS();
            if (b)
                return baz();
            return bar();
        }
        
        Note that we're not saying that bar/baz should not be tail callable. bar/baz
        may have other callers that are allowed to tail call it. This macro just says
        that foo itself will not perform any tail calls.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/NoTailCalls.h: Added.
        (WTF::NoTailCalls::~NoTailCalls):

2017-09-14  Mark Lam  <mark.lam@apple.com>

        AddressSanitizer: stack-buffer-underflow in JSC::Probe::Page::Page
        https://bugs.webkit.org/show_bug.cgi?id=176874
        <rdar://problem/34436415>

        Reviewed by Saam Barati.

        Added a convenience version of roundUpToMultipleOf() so that it can be applied to
        pointers without the client having to cast explicitly.

        * wtf/StdLibExtras.h:
        (WTF::roundUpToMultipleOf):

2017-09-14  Youenn Fablet  <youenn@apple.com>

        Allow WTF::map to take function as parameter
        https://bugs.webkit.org/show_bug.cgi?id=176909

        Reviewed by Jer Noble.

        * wtf/Vector.h:
        (WTF::map):

2017-09-13  Youenn Fablet  <youenn@apple.com>

        Add a lambda-based map for Vectors
        https://bugs.webkit.org/show_bug.cgi?id=176487

        Reviewed by Darin Adler.

        This helper routine allows refactoring the reserveInitialCapacity/uncheckedAppend pattern, the mapper between source and destination item being a lambda.

        * wtf/Vector.h:
        (WTF::Mapper::transform):
        (WTF::Mapper::map):
        (WTF::map):

2017-09-12  Yusuke Suzuki  <utatane.tea@gmail.com>

        [DFG] Optimize WeakMap::get by adding intrinsic and fixup
        https://bugs.webkit.org/show_bug.cgi?id=176010

        Reviewed by Filip Pizlo.

        Add inlineGet method with HashTranslator.

        * wtf/HashMap.h:
        (WTF::X>::inlineGet const):
        (WTF::MappedTraits>::inlineGet const):
        (WTF::MappedTraits>::fastGet const): Deleted.
        * wtf/LoggingHashMap.h:

2017-09-12  Keith Miller  <keith_miller@apple.com>

        Do unified source builds for JSC
        https://bugs.webkit.org/show_bug.cgi?id=176076

        Reviewed by Geoffrey Garen.

        This patch adds a script that will automatically bundle source
        files, which is currently only used by the CMake build. It's
        important that we use the same script to generate the bundles
        for the CMake build as the Xcode build. If we didn't do this then
        it's likely that there would be build errors that occur in only
        one build system. On the same note, we also need to be careful to
        not bundle platform specific source files with platform
        independent ones. There are a couple of things the script does not
        currently handle but are not essential for the CMake build. First,
        it does not handle the max bundle size restrictions that the Xcode
        build will require. It also does not handle C files.

        The unified source generator script works by collecting groups of
        up to 8 files from the same directory. We don't bundle files from
        across directories since I didn't see a speedup from doing
        so. Additionally, splitting at the directory boundary means that
        it is less likely that adding a new file will force a "clean"
        build. This would happen because the new file will shift every
        subsequent file into the next unified source bundle.

        Using unified sources appears to be a roughly 3.5x build time
        speed up for clean builds on my MBP and appears to have a
        negligible effect in incremental builds.

        * generate-unified-source-bundles.rb: Added.
        * wtf/Assertions.h:

2017-09-12  Joseph Pecoraro  <pecoraro@apple.com>

        QualifiedName::init should assume AtomicStrings::init was already called
        https://bugs.webkit.org/show_bug.cgi?id=176639

        Reviewed by Sam Weinig.

        * wtf/NeverDestroyed.h:
        (WTF::LazyNeverDestroyed::isConstructed const):

2017-09-12  Brent Fulgham  <bfulgham@apple.com>

        Show punycode to user if a URL mixes Armenian Seh or Vo with other scripts
        https://bugs.webkit.org/show_bug.cgi?id=176578
        <rdar://problem/33906231>

        Reviewed by Alex Christensen.

        * wtf/ASCIICType.h:
        (WTF::isASCIIDigitOrPunctuation): Added helper function to recognize ASCII digits
        and punctuation characters.

2017-09-12  Sam Weinig  <sam@webkit.org>

        [Cleanup] Follow up cleanup for DOMFormData implementation
        https://bugs.webkit.org/show_bug.cgi?id=176740

        Reviewed by Alex Christensen.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/HashTraits.h:
        (WTF::KeyValuePair::KeyValuePair): Deleted.
        * wtf/KeyValuePair.h: Added.
        (WTF::KeyValuePair::KeyValuePair):
        (WTF::makeKeyValuePair):

            Move KeyValuePair to its own header and add a makeKeyValuePair helper.

2017-09-11  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r221854.

        The test added with this change fails on 32-bit JSC bots.

        Reverted changeset:

        "[DFG] Optimize WeakMap::get by adding intrinsic and fixup"
        https://bugs.webkit.org/show_bug.cgi?id=176010
        http://trac.webkit.org/changeset/221854

2017-09-03  Yusuke Suzuki  <utatane.tea@gmail.com>

        [DFG] Optimize WeakMap::get by adding intrinsic and fixup
        https://bugs.webkit.org/show_bug.cgi?id=176010

        Reviewed by Filip Pizlo.

        Add inlineGet method with HashTranslator.

        * wtf/HashMap.h:
        (WTF::X>::inlineGet const):
        (WTF::MappedTraits>::inlineGet const):
        (WTF::MappedTraits>::fastGet const): Deleted.
        * wtf/LoggingHashMap.h:

2017-09-07  Myles C. Maxfield  <mmaxfield@apple.com>

        [PAL] Unify PlatformUserPreferredLanguages.h with Language.h
        https://bugs.webkit.org/show_bug.cgi?id=176561

        Reviewed by Brent Fulgham.

        WebCore/platform/Language was the only* user of PlatformUserPreferredLanguages (with 1 exception).
        That exception is that JavaScriptCore needed the functionality of WebCore/platform/Language, but it
        couldn't get it because of the layering violation, so instead it erroneously called into
        PlatformUserPreferredLanguages instead. This patch merges these two files into WTF so JSC gets the
        right function and the PAL effort has one less file to move from WebCore/platform into PAL.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Language.cpp: Renamed from Source/WebCore/platform/Language.cpp.
        (WTF::addLanguageChangeObserver):
        (WTF::userPreferredLanguages):
        * wtf/Language.h: Renamed from Source/WebCore/platform/Language.h.
        * wtf/PlatformGTK.cmake:
        * wtf/PlatformJSCOnly.cmake:
        * wtf/PlatformMac.cmake:
        * wtf/PlatformUserPreferredLanguages.h: Removed.
        * wtf/PlatformWPE.cmake:
        * wtf/PlatformWin.cmake:
        * wtf/cf/LanguageCF.cpp: Renamed from Source/WTF/wtf/PlatformUserPreferredLanguagesMac.mm.
        (WTF::httpStyleLanguageCode):
        (WTF::languagePreferencesDidChange):
        (WTF::platformUserPreferredLanguages):
        * wtf/unix/LanguageUnix.cpp: Renamed from Source/WTF/wtf/PlatformUserPreferredLanguagesUnix.cpp.
        * wtf/win/LanguageWin.cpp: Renamed from Source/WTF/wtf/PlatformUserPreferredLanguagesWin.cpp.

2017-09-06  Eric Carlson  <eric.carlson@apple.com>

        Require LoggingHelper overrides to provide identifier
        https://bugs.webkit.org/show_bug.cgi?id=176477

        Reviewed by Jer Noble.

        * wtf/Assertions.cpp: No more WTFLogLevelNotice.
        * wtf/Assertions.h: Ditto.

2017-09-06  Per Arne Vollan  <pvollan@apple.com>

        [Win] WebCore failed to build, InbandTextTrackPrivateAVF: base class undefined.
        https://bugs.webkit.org/show_bug.cgi?id=176431

        Reviewed by Alex Christensen.

        AVFoundation header detection should be done in WebCore because of build dependencies. 

        * AVFoundationSupport.py: Removed.
        * wtf/Platform.h:
        * wtf/PlatformWin.cmake:

2017-09-05  Yoshiaki Jitsukawa  <Yoshiaki.Jitsukawa@sony.com>

        [Win] Fix the wincairo build after r221558 and r221583
        https://bugs.webkit.org/show_bug.cgi?id=176353

        Reviewed by Yusuke Suzuki.

        * wtf/Assertions.cpp:

2017-09-04  Eric Carlson  <eric.carlson@apple.com>

        Switch HTMLMediaElement to release logging
        https://bugs.webkit.org/show_bug.cgi?id=176065

        Reviewed by Jer Noble.

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::dump const): Use toString.
        (WTF::MediaTime::toString const): New.

2017-09-04  Yusuke Suzuki  <utatane.tea@gmail.com>

        Remove OS(SOLARIS) support
        https://bugs.webkit.org/show_bug.cgi?id=176341

        Reviewed by Sam Weinig.

        WebKit project does not have stake holders supporting Solaris right now.
        And Solaris + SPARC in 64bit environment does not work well since its
        address space includes non-48bit area. It breaks our JSVALUE64 in JSC.
        In addition, Solaris a bit complicates our threading implementation
        because of its special threading stack.

        This patch removes OS(SOLARIS) and COMPILER(SUNCC) support from WebKit.

        * wtf/Compiler.h:
        * wtf/InlineASM.h:
        * wtf/MathExtras.h:
        (std::isfinite): Deleted.
        (std::signbit): Deleted.
        (std::isinf): Deleted.
        * wtf/NumberOfCores.cpp:
        (WTF::numberOfProcessorCores):
        * wtf/Platform.h:
        * wtf/StackBounds.cpp:
        * wtf/ThreadingPthreads.cpp:

2017-09-04  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r221494 and r221500.
        https://bugs.webkit.org/show_bug.cgi?id=176258

        This caused the windows build to fail. (Requested by mlewis13
        on #webkit).

        Reverted changesets:

        "Switch HTMLMediaElement to release logging"
        https://bugs.webkit.org/show_bug.cgi?id=176065
        http://trac.webkit.org/changeset/221494

        "Switch HTMLMediaElement to release logging"
        https://bugs.webkit.org/show_bug.cgi?id=176065
        http://trac.webkit.org/changeset/221500

2017-09-03  Yusuke Suzuki  <utatane.tea@gmail.com>

        Remove "malloc" and "free" use
        https://bugs.webkit.org/show_bug.cgi?id=176310

        Reviewed by Darin Adler.

        Use Vector instead.

        * wtf/Assertions.cpp:

2017-09-04  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, support libstdc++ use with clang
        https://bugs.webkit.org/show_bug.cgi?id=176301

        * wtf/FastMalloc.h:

2017-09-03  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Add C++03 allocator interface for GCC < 6
        https://bugs.webkit.org/show_bug.cgi?id=176301

        Reviewed by Darin Adler.

        Unfortunately, std::list in GCC < 6 does not support C++11 allocator interface.
        This patch adds C++03 allocator interface to FastAllocator to make it usable
        for std::list. It also allows us to use FastAllocator for data structures that
        only support C++03 interface.

        * wtf/FastMalloc.h:
        (WTF::FastAllocator::allocate):
        (WTF::FastAllocator::construct):
        (WTF::FastAllocator::destroy):
        (WTF::FastAllocator::max_size const):
        (WTF::FastAllocator::select_on_container_copy_construction const):

2017-09-03  Chris Dumez  <cdumez@apple.com>

        Unreviewed, rolling out r221552.

        Broke the build

        Reverted changeset:

        "[WTF] Add C++03 allocator interface for GCC < 6"
        https://bugs.webkit.org/show_bug.cgi?id=176301
        http://trac.webkit.org/changeset/221552

2017-09-03  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Add C++03 allocator interface for GCC < 6
        https://bugs.webkit.org/show_bug.cgi?id=176301

        Reviewed by Darin Adler.

        Unfortunately, std::list in GCC < 6 does not support C++11 allocator interface.
        This patch adds C++03 allocator interface to FastAllocator to make it usable
        for std::list. It also allows us to use FastAllocator for data structures that
        only support C++03 interface.

        * wtf/FastMalloc.h:
        (WTF::FastAllocator::allocate):
        (WTF::FastAllocator::construct):
        (WTF::FastAllocator::destroy):
        (WTF::FastAllocator::max_size const):
        (WTF::FastAllocator::select_on_container_copy_construction const):

2017-09-03  Sam Weinig  <sam@webkit.org>

        Remove CanvasProxy
        https://bugs.webkit.org/show_bug.cgi?id=176288

        Reviewed by Yusuke Suzuki.

        CanvasProxy does not appear to be in any current HTML spec
        and was disabled and unimplemented in our tree. Time to 
        get rid of it.

        * wtf/FeatureDefines.h:

2017-09-01  Eric Carlson  <eric.carlson@apple.com>

        Switch HTMLMediaElement to release logging
        https://bugs.webkit.org/show_bug.cgi?id=176065

        Reviewed by Jer Noble.

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::dump const): Use toString.
        (WTF::MediaTime::toString const): New.
        * wtf/MediaTime.h:
        (PAL::LogArgument<WTF::MediaTime>::toString): Logger template.

2017-08-31  Don Olmstead  <don.olmstead@sony.com>

        [CMake] Make USE_CF conditional within Windows
        https://bugs.webkit.org/show_bug.cgi?id=176173

        Reviewed by Alex Christensen.

        * wtf/Platform.h:
        * wtf/PlatformWin.cmake:

2017-08-31  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r221445.

        This change broke Sierra Release builds.

        Reverted changeset:

        "Switch HTMLMediaElement to release logging"
        https://bugs.webkit.org/show_bug.cgi?id=176065
        http://trac.webkit.org/changeset/221445

2017-08-31  Eric Carlson  <eric.carlson@apple.com>

        Switch HTMLMediaElement to release logging
        https://bugs.webkit.org/show_bug.cgi?id=176065

        Reviewed by Jer Noble.

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::dump const): Use toString.
        (WTF::MediaTime::toString const): New.
        * wtf/MediaTime.h:
        (PAL::LogArgument<WTF::MediaTime>::toString): Logger template.

2017-08-31  Filip Pizlo  <fpizlo@apple.com>

        All of the different ArrayBuffer::data's should be CagedPtr<>
        https://bugs.webkit.org/show_bug.cgi?id=175515

        Reviewed by Michael Saboff.
        
        Added a specialization so that CagedPtr<void> is valid.

        * wtf/CagedPtr.h:

2017-08-31  Per Arne Vollan  <pvollan@apple.com>

        [Win] Crash under WorkQueue::performWorkOnRegisteredWorkThread in layout tests.
        https://bugs.webkit.org/show_bug.cgi?id=176163

        Reviewed by Alex Christensen.

        My previous attempt at fixing this crash in <http://trac.webkit.org/changeset/221323>
        was incorrect, since it is still crashing on the bot(s). The current theory of why this
        is failing is that the WorkQueue object deletes itself in the middle of the
        performWorkOnRegisteredWorkThread method when calling deref(). There is no need to
        increase the reference count of the work queue for each function we want to call on the
        work thread. It is sufficient to increase it for every work thread we start, and then
        dereference it when the thread ends. We should also not attempt to access members after
        the deref() call, which can potentially be unsafe.
 
        * wtf/win/WorkQueueWin.cpp:
        (WTF::WorkQueue::workThreadCallback):
        (WTF::WorkQueue::performWorkOnRegisteredWorkThread):
        (WTF::WorkQueue::dispatch):

2017-08-22  Filip Pizlo  <fpizlo@apple.com>

        Strings need to be in some kind of gigacage
        https://bugs.webkit.org/show_bug.cgi?id=174924

        Reviewed by Oliver Hunt.
        
        This makes all strings allocations come from the string gigacage. Because we expect string allocation
        to be a hot path, I created specialized allocation paths for the string gigacage. These paths are
        accessible via <wtf/text/StringMalloc.h>. However, those paths are equivalent to saying
        Gigacage::malloc and friends with the Gigacage::String kind.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Deque.h:
        * wtf/FastMalloc.cpp:
        (WTF::fastFree):
        * wtf/FastMalloc.h:
        (WTF::FastMalloc::malloc):
        (WTF::FastMalloc::tryMalloc):
        (WTF::FastMalloc::realloc):
        (WTF::FastMalloc::free):
        * wtf/Forward.h:
        * wtf/Gigacage.cpp:
        (Gigacage::tryMalloc):
        * wtf/Gigacage.h:
        (Gigacage::name):
        * wtf/Vector.h:
        (WTF::VectorBufferBase::allocateBuffer):
        (WTF::VectorBufferBase::tryAllocateBuffer):
        (WTF::VectorBufferBase::reallocateBuffer):
        (WTF::VectorBufferBase::deallocateBuffer):
        (WTF::Malloc>::Vector):
        (WTF::=):
        (WTF::Malloc>::contains const):
        (WTF::Malloc>::findMatching const):
        (WTF::Malloc>::find const):
        (WTF::Malloc>::reverseFind const):
        (WTF::Malloc>::appendIfNotContains):
        (WTF::Malloc>::fill):
        (WTF::Malloc>::appendRange):
        (WTF::Malloc>::expandCapacity):
        (WTF::Malloc>::tryExpandCapacity):
        (WTF::Malloc>::resize):
        (WTF::Malloc>::resizeToFit):
        (WTF::Malloc>::shrink):
        (WTF::Malloc>::grow):
        (WTF::Malloc>::asanSetInitialBufferSizeTo):
        (WTF::Malloc>::asanSetBufferSizeToFullCapacity):
        (WTF::Malloc>::asanBufferSizeWillChangeTo):
        (WTF::Malloc>::reserveCapacity):
        (WTF::Malloc>::tryReserveCapacity):
        (WTF::Malloc>::reserveInitialCapacity):
        (WTF::Malloc>::shrinkCapacity):
        (WTF::Malloc>::append):
        (WTF::Malloc>::tryAppend):
        (WTF::Malloc>::constructAndAppend):
        (WTF::Malloc>::tryConstructAndAppend):
        (WTF::Malloc>::appendSlowCase):
        (WTF::Malloc>::constructAndAppendSlowCase):
        (WTF::Malloc>::tryConstructAndAppendSlowCase):
        (WTF::Malloc>::uncheckedAppend):
        (WTF::Malloc>::appendVector):
        (WTF::Malloc>::insert):
        (WTF::Malloc>::insertVector):
        (WTF::Malloc>::remove):
        (WTF::Malloc>::removeFirst):
        (WTF::Malloc>::removeFirstMatching):
        (WTF::Malloc>::removeAll):
        (WTF::Malloc>::removeAllMatching):
        (WTF::Malloc>::reverse):
        (WTF::Malloc>::map const):
        (WTF::Malloc>::releaseBuffer):
        (WTF::Malloc>::checkConsistency):
        (WTF::swap):
        (WTF::operator==):
        (WTF::operator!=):
        (WTF::removeRepeatedElements):
        (WTF::minCapacity>::Vector): Deleted.
        (WTF::minCapacity>::contains const): Deleted.
        (WTF::minCapacity>::findMatching const): Deleted.
        (WTF::minCapacity>::find const): Deleted.
        (WTF::minCapacity>::reverseFind const): Deleted.
        (WTF::minCapacity>::appendIfNotContains): Deleted.
        (WTF::minCapacity>::fill): Deleted.
        (WTF::minCapacity>::appendRange): Deleted.
        (WTF::minCapacity>::expandCapacity): Deleted.
        (WTF::minCapacity>::tryExpandCapacity): Deleted.
        (WTF::minCapacity>::resize): Deleted.
        (WTF::minCapacity>::resizeToFit): Deleted.
        (WTF::minCapacity>::shrink): Deleted.
        (WTF::minCapacity>::grow): Deleted.
        (WTF::minCapacity>::asanSetInitialBufferSizeTo): Deleted.
        (WTF::minCapacity>::asanSetBufferSizeToFullCapacity): Deleted.
        (WTF::minCapacity>::asanBufferSizeWillChangeTo): Deleted.
        (WTF::minCapacity>::reserveCapacity): Deleted.
        (WTF::minCapacity>::tryReserveCapacity): Deleted.
        (WTF::minCapacity>::reserveInitialCapacity): Deleted.
        (WTF::minCapacity>::shrinkCapacity): Deleted.
        (WTF::minCapacity>::append): Deleted.
        (WTF::minCapacity>::tryAppend): Deleted.
        (WTF::minCapacity>::constructAndAppend): Deleted.
        (WTF::minCapacity>::tryConstructAndAppend): Deleted.
        (WTF::minCapacity>::appendSlowCase): Deleted.
        (WTF::minCapacity>::constructAndAppendSlowCase): Deleted.
        (WTF::minCapacity>::tryConstructAndAppendSlowCase): Deleted.
        (WTF::minCapacity>::uncheckedAppend): Deleted.
        (WTF::minCapacity>::appendVector): Deleted.
        (WTF::minCapacity>::insert): Deleted.
        (WTF::minCapacity>::insertVector): Deleted.
        (WTF::minCapacity>::remove): Deleted.
        (WTF::minCapacity>::removeFirst): Deleted.
        (WTF::minCapacity>::removeFirstMatching): Deleted.
        (WTF::minCapacity>::removeAll): Deleted.
        (WTF::minCapacity>::removeAllMatching): Deleted.
        (WTF::minCapacity>::reverse): Deleted.
        (WTF::minCapacity>::map const): Deleted.
        (WTF::minCapacity>::releaseBuffer): Deleted.
        (WTF::minCapacity>::checkConsistency): Deleted.
        * wtf/text/AtomicStringImpl.h:
        * wtf/text/CString.cpp:
        (WTF::CStringBuffer::createUninitialized):
        * wtf/text/CString.h:
        * wtf/text/StringBuffer.h:
        (WTF::StringBuffer::StringBuffer):
        (WTF::StringBuffer::~StringBuffer):
        (WTF::StringBuffer::resize):
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::~StringImpl):
        (WTF::StringImpl::destroy):
        (WTF::StringImpl::createUninitializedInternalNonEmpty):
        (WTF::StringImpl::reallocateInternal):
        (WTF::StringImpl::releaseAssertCaged const):
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::createSubstringSharingImpl):
        (WTF::StringImpl::tryCreateUninitialized):
        (WTF::StringImpl::adopt):
        (WTF::StringImpl::bufferOwnership const):
        (WTF::StringImpl::assertCaged const):
        * wtf/text/StringMalloc.cpp: Added.
        (WTF::tryStringMalloc):
        (WTF::stringMalloc):
        (WTF::stringRealloc):
        (WTF::stringFree):
        * wtf/text/StringMalloc.h: Added.
        (WTF::StringMalloc::malloc):
        (WTF::StringMalloc::tryMalloc):
        (WTF::StringMalloc::realloc):
        (WTF::StringMalloc::free):
        * wtf/text/StringVector.h: Added.
        * wtf/text/SymbolImpl.h:
        * wtf/text/UniquedStringImpl.h:
        * wtf/text/WTFString.h:
        (WTF::String::adopt):
        (WTF::String::assertCaged const):
        (WTF::String::releaseAssertCaged const):

2017-08-30  Chris Dumez  <cdumez@apple.com>

        Implement FileSystemDirectoryReader.readEntries()
        https://bugs.webkit.org/show_bug.cgi?id=176091
        <rdar://problem/34168015>

        Reviewed by Andreas Kling.

        * wtf/CrossThreadCopier.h:
        (WTF::crossThreadCopy):
        * wtf/CrossThreadTask.h:
        Move crossThreadCopy() from CrossThreadTask.h to CrossThreadCopier.h and
        add "using WTF::crossThreadCopy" statement to make it more easily usable
        from WebCore.

2017-08-30  Matt Lewis  <jlewis3@apple.com>

        Unreviewed, rolling out r221384.

        This patch caused multiple 32-bit JSC test failures.

        Reverted changeset:

        "Strings need to be in some kind of gigacage"
        https://bugs.webkit.org/show_bug.cgi?id=174924
        http://trac.webkit.org/changeset/221384

2017-08-30  Brady Eidson  <beidson@apple.com>

        Add "Identified" base class to replace a whole bunch of custom identifier generators.
        https://bugs.webkit.org/show_bug.cgi?id=176120

        Reviewed by Alex Christensen.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/Identified.h: Added.
        (WTF::IdentifiedBase::identifier const):
        (WTF::IdentifiedBase::IdentifiedBase):
        (WTF::Identified::Identified):
        (WTF::ThreadSafeIdentified::ThreadSafeIdentified):

2017-08-22  Filip Pizlo  <fpizlo@apple.com>

        Strings need to be in some kind of gigacage
        https://bugs.webkit.org/show_bug.cgi?id=174924

        Reviewed by Oliver Hunt.
        
        This makes all strings allocations come from the string gigacage. Because we expect string allocation
        to be a hot path, I created specialized allocation paths for the string gigacage. These paths are
        accessible via <wtf/text/StringMalloc.h>. However, those paths are equivalent to saying
        Gigacage::malloc and friends with the Gigacage::String kind.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Deque.h:
        * wtf/FastMalloc.cpp:
        (WTF::fastFree):
        * wtf/FastMalloc.h:
        (WTF::FastMalloc::malloc):
        (WTF::FastMalloc::tryMalloc):
        (WTF::FastMalloc::realloc):
        (WTF::FastMalloc::free):
        * wtf/Forward.h:
        * wtf/Gigacage.cpp:
        (Gigacage::tryMalloc):
        * wtf/Gigacage.h:
        (Gigacage::name):
        * wtf/Vector.h:
        (WTF::VectorBufferBase::allocateBuffer):
        (WTF::VectorBufferBase::tryAllocateBuffer):
        (WTF::VectorBufferBase::reallocateBuffer):
        (WTF::VectorBufferBase::deallocateBuffer):
        (WTF::Malloc>::Vector):
        (WTF::=):
        (WTF::Malloc>::contains const):
        (WTF::Malloc>::findMatching const):
        (WTF::Malloc>::find const):
        (WTF::Malloc>::reverseFind const):
        (WTF::Malloc>::appendIfNotContains):
        (WTF::Malloc>::fill):
        (WTF::Malloc>::appendRange):
        (WTF::Malloc>::expandCapacity):
        (WTF::Malloc>::tryExpandCapacity):
        (WTF::Malloc>::resize):
        (WTF::Malloc>::resizeToFit):
        (WTF::Malloc>::shrink):
        (WTF::Malloc>::grow):
        (WTF::Malloc>::asanSetInitialBufferSizeTo):
        (WTF::Malloc>::asanSetBufferSizeToFullCapacity):
        (WTF::Malloc>::asanBufferSizeWillChangeTo):
        (WTF::Malloc>::reserveCapacity):
        (WTF::Malloc>::tryReserveCapacity):
        (WTF::Malloc>::reserveInitialCapacity):
        (WTF::Malloc>::shrinkCapacity):
        (WTF::Malloc>::append):
        (WTF::Malloc>::tryAppend):
        (WTF::Malloc>::constructAndAppend):
        (WTF::Malloc>::tryConstructAndAppend):
        (WTF::Malloc>::appendSlowCase):
        (WTF::Malloc>::constructAndAppendSlowCase):
        (WTF::Malloc>::tryConstructAndAppendSlowCase):
        (WTF::Malloc>::uncheckedAppend):
        (WTF::Malloc>::appendVector):
        (WTF::Malloc>::insert):
        (WTF::Malloc>::insertVector):
        (WTF::Malloc>::remove):
        (WTF::Malloc>::removeFirst):
        (WTF::Malloc>::removeFirstMatching):
        (WTF::Malloc>::removeAll):
        (WTF::Malloc>::removeAllMatching):
        (WTF::Malloc>::reverse):
        (WTF::Malloc>::map const):
        (WTF::Malloc>::releaseBuffer):
        (WTF::Malloc>::checkConsistency):
        (WTF::swap):
        (WTF::operator==):
        (WTF::operator!=):
        (WTF::removeRepeatedElements):
        (WTF::minCapacity>::Vector): Deleted.
        (WTF::minCapacity>::contains const): Deleted.
        (WTF::minCapacity>::findMatching const): Deleted.
        (WTF::minCapacity>::find const): Deleted.
        (WTF::minCapacity>::reverseFind const): Deleted.
        (WTF::minCapacity>::appendIfNotContains): Deleted.
        (WTF::minCapacity>::fill): Deleted.
        (WTF::minCapacity>::appendRange): Deleted.
        (WTF::minCapacity>::expandCapacity): Deleted.
        (WTF::minCapacity>::tryExpandCapacity): Deleted.
        (WTF::minCapacity>::resize): Deleted.
        (WTF::minCapacity>::resizeToFit): Deleted.
        (WTF::minCapacity>::shrink): Deleted.
        (WTF::minCapacity>::grow): Deleted.
        (WTF::minCapacity>::asanSetInitialBufferSizeTo): Deleted.
        (WTF::minCapacity>::asanSetBufferSizeToFullCapacity): Deleted.
        (WTF::minCapacity>::asanBufferSizeWillChangeTo): Deleted.
        (WTF::minCapacity>::reserveCapacity): Deleted.
        (WTF::minCapacity>::tryReserveCapacity): Deleted.
        (WTF::minCapacity>::reserveInitialCapacity): Deleted.
        (WTF::minCapacity>::shrinkCapacity): Deleted.
        (WTF::minCapacity>::append): Deleted.
        (WTF::minCapacity>::tryAppend): Deleted.
        (WTF::minCapacity>::constructAndAppend): Deleted.
        (WTF::minCapacity>::tryConstructAndAppend): Deleted.
        (WTF::minCapacity>::appendSlowCase): Deleted.
        (WTF::minCapacity>::constructAndAppendSlowCase): Deleted.
        (WTF::minCapacity>::tryConstructAndAppendSlowCase): Deleted.
        (WTF::minCapacity>::uncheckedAppend): Deleted.
        (WTF::minCapacity>::appendVector): Deleted.
        (WTF::minCapacity>::insert): Deleted.
        (WTF::minCapacity>::insertVector): Deleted.
        (WTF::minCapacity>::remove): Deleted.
        (WTF::minCapacity>::removeFirst): Deleted.
        (WTF::minCapacity>::removeFirstMatching): Deleted.
        (WTF::minCapacity>::removeAll): Deleted.
        (WTF::minCapacity>::removeAllMatching): Deleted.
        (WTF::minCapacity>::reverse): Deleted.
        (WTF::minCapacity>::map const): Deleted.
        (WTF::minCapacity>::releaseBuffer): Deleted.
        (WTF::minCapacity>::checkConsistency): Deleted.
        * wtf/text/AtomicStringImpl.h:
        * wtf/text/CString.cpp:
        (WTF::CStringBuffer::createUninitialized):
        * wtf/text/CString.h:
        * wtf/text/StringBuffer.h:
        (WTF::StringBuffer::StringBuffer):
        (WTF::StringBuffer::~StringBuffer):
        (WTF::StringBuffer::resize):
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::~StringImpl):
        (WTF::StringImpl::destroy):
        (WTF::StringImpl::createUninitializedInternalNonEmpty):
        (WTF::StringImpl::reallocateInternal):
        (WTF::StringImpl::releaseAssertCaged const):
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::createSubstringSharingImpl):
        (WTF::StringImpl::tryCreateUninitialized):
        (WTF::StringImpl::adopt):
        (WTF::StringImpl::bufferOwnership const):
        (WTF::StringImpl::assertCaged const):
        * wtf/text/StringMalloc.cpp: Added.
        (WTF::tryStringMalloc):
        (WTF::stringMalloc):
        (WTF::stringRealloc):
        (WTF::stringFree):
        * wtf/text/StringMalloc.h: Added.
        (WTF::StringMalloc::malloc):
        (WTF::StringMalloc::tryMalloc):
        (WTF::StringMalloc::realloc):
        (WTF::StringMalloc::free):
        * wtf/text/StringVector.h: Added.
        * wtf/text/SymbolImpl.h:
        * wtf/text/UniquedStringImpl.h:
        * wtf/text/WTFString.h:
        (WTF::String::adopt):
        (WTF::String::assertCaged const):
        (WTF::String::releaseAssertCaged const):

2017-08-28  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Use table based approach for JSON.stringify's Quote
        https://bugs.webkit.org/show_bug.cgi?id=176044

        Reviewed by Darin Adler.

        We change escape operation of JSON Quote from branch-based to table-based.
        This patch partially adopts SpiderMonkey's change to StringBuilderJSON.cpp
        to optimize this escaping operation. We separate changes from StringBuilder.cpp
        to apply MPL to StringBuilderJSON.cpp file. Since WebKit already adopts MPL in
        some files (like, DateMath.h), it is acceptable.

        Kraken json-stringify-tinderbox shows 7.2% improvement.

                                           baseline                  patched

        json-stringify-tinderbox        40.429+-0.771      ^      37.693+-0.862         ^ definitely 1.0726x faster

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/text/StringBuilder.cpp:
        (WTF::appendQuotedJSONStringInternalSlow): Deleted.
        (WTF::appendQuotedJSONStringInternal): Deleted.
        (WTF::StringBuilder::appendQuotedJSONString): Deleted.
        * wtf/text/StringBuilderJSON.cpp: Added.
        (WTF::appendQuotedJSONStringInternal):
        (WTF::StringBuilder::appendQuotedJSONString):

2017-08-29  Per Arne Vollan  <pvollan@apple.com>

        [Win] Crash under WorkQueue::performWorkOnRegisteredWorkThread in layout tests.
        https://bugs.webkit.org/show_bug.cgi?id=176064

        Reviewed by Saam Barati.

        The crash log indicates that the function pointer is null in this case.

        * wtf/win/WorkQueueWin.cpp:
        (WTF::WorkQueue::dispatch):

2017-08-28  Andy Estes  <aestes@apple.com>

        [Cocoa] Upstream WKGetWebDefaultCFStringEncoding()
        https://bugs.webkit.org/show_bug.cgi?id=176039

        Reviewed by Alex Christensen.

        * wtf/spi/cf/CFStringSPI.h:

2017-08-26  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, suppress warnings in GTK port

        Add printf format attribute.

        * wtf/text/WTFString.cpp:

2017-08-25  Eric Carlson  <eric.carlson@apple.com>

        Add Logger::logAlways
        https://bugs.webkit.org/show_bug.cgi?id=175996

        Reviewed by Jer Noble.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h:

2017-08-25  Daniel Bates  <dabates@apple.com>

        Demarcate code added due to lack of NSDMI for aggregates
        https://bugs.webkit.org/show_bug.cgi?id=175990

        Reviewed by Andy Estes.

        * wtf/Compiler.h:

2017-08-25  Don Olmstead  <don.olmstead@sony.com>

        Define *_GIGACAGE_MASK when Gigacage is not supported
        https://bugs.webkit.org/show_bug.cgi?id=175994

        Reviewed by Mark Lam.

        * wtf/Gigacage.h:

2017-08-25  Eric Carlson  <eric.carlson@apple.com>

        Add String::format variant that takes va_args
        https://bugs.webkit.org/show_bug.cgi?id=175988

        Reviewed by Jer Noble.

        * wtf/text/WTFString.cpp:
        (WTF::createWithFormatAndArguments): Created with the guts of String::format.
        (WTF::String::formatWithArguments): New, call createWithFormatAndArguments.
        (WTF::String::format): Move logic to createWithFormatAndArguments, use it.
        * wtf/text/WTFString.h:

2017-08-25  Saam Barati  <sbarati@apple.com>

        Support compiling catch in the DFG
        https://bugs.webkit.org/show_bug.cgi?id=174590
        <rdar://problem/34047845>

        Reviewed by Filip Pizlo.

        This patch generalizes the BackwardsGraph fake root into a more generalizable
        class called SingleRootGraph. SingleRootGraph exposes the general graph interface
        used in Dominators and NaturalLoops. SingleRootGraph takes as input a graph with
        the normal graph interface, but also allows the input graph to contain more than
        one root. SingleRootGraph then exposes a single root, which it creates, that has
        an outgoing edge to all the roots in the original graph.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/BackwardsGraph.h:
        (WTF::BackwardsGraph::dump const):
        (WTF::BackwardsGraph::rootName): Deleted.
        (WTF::BackwardsGraph::Node::Node): Deleted.
        (WTF::BackwardsGraph::Node::root): Deleted.
        (WTF::BackwardsGraph::Node::operator== const): Deleted.
        (WTF::BackwardsGraph::Node::operator!= const): Deleted.
        (WTF::BackwardsGraph::Node::operator bool const): Deleted.
        (WTF::BackwardsGraph::Node::isRoot const): Deleted.
        (WTF::BackwardsGraph::Node::node const): Deleted.
        (): Deleted.
        (WTF::BackwardsGraph::Set::Set): Deleted.
        (WTF::BackwardsGraph::Set::add): Deleted.
        (WTF::BackwardsGraph::Set::remove): Deleted.
        (WTF::BackwardsGraph::Set::contains): Deleted.
        (WTF::BackwardsGraph::Set::dump const): Deleted.
        (WTF::BackwardsGraph::Map::Map): Deleted.
        (WTF::BackwardsGraph::Map::clear): Deleted.
        (WTF::BackwardsGraph::Map::size const): Deleted.
        (WTF::BackwardsGraph::Map::operator[]): Deleted.
        (WTF::BackwardsGraph::Map::operator[] const): Deleted.
        * wtf/Dominators.h:
        (WTF::Dominators::Dominators):
        (WTF::Dominators::forAllBlocksInIteratedDominanceFrontierOf):
        (WTF::Dominators::forAllBlocksInPrunedIteratedDominanceFrontierOf):
        (WTF::Dominators::iteratedDominanceFrontierOf const):
        (WTF::Dominators::forAllBlocksInIteratedDominanceFrontierOfImpl const):
        * wtf/SingleRootGraph.h: Added.
        (WTF::SingleRootGraphNode::rootName):
        (WTF::SingleRootGraphNode::SingleRootGraphNode):
        (WTF::SingleRootGraphNode::root):
        (WTF::SingleRootGraphNode::operator== const):
        (WTF::SingleRootGraphNode::operator!= const):
        (WTF::SingleRootGraphNode::operator bool const):
        (WTF::SingleRootGraphNode::isRoot const):
        (WTF::SingleRootGraphNode::node const):
        (WTF::SingleRootGraphSet::add):
        (WTF::SingleRootGraphSet::remove):
        (WTF::SingleRootGraphSet::contains):
        (WTF::SingleRootGraphSet::dump const):
        (WTF::SingleRootMap::SingleRootMap):
        (WTF::SingleRootMap::clear):
        (WTF::SingleRootMap::size const):
        (WTF::SingleRootMap::operator[]):
        (WTF::SingleRootMap::operator[] const):
        (WTF::SingleRootGraph::SingleRootGraph):
        (WTF::SingleRootGraph::root const):
        (WTF::SingleRootGraph::newMap):
        (WTF::SingleRootGraph::successors const):
        (WTF::SingleRootGraph::predecessors const):
        (WTF::SingleRootGraph::index const):
        (WTF::SingleRootGraph::node const):
        (WTF::SingleRootGraph::numNodes const):
        (WTF::SingleRootGraph::dump const):
        (WTF::SingleRootGraph::assertIsConsistent const):

2017-08-24  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r221119, r221124, and r221143.
        https://bugs.webkit.org/show_bug.cgi?id=175973

        "I think it regressed JSBench by 20%" (Requested by saamyjoon
        on #webkit).

        Reverted changesets:

        "Support compiling catch in the DFG"
        https://bugs.webkit.org/show_bug.cgi?id=174590
        http://trac.webkit.org/changeset/221119

        "Unreviewed, build fix in GTK port"
        https://bugs.webkit.org/show_bug.cgi?id=174590
        http://trac.webkit.org/changeset/221124

        "DFG::JITCode::osrEntry should get sorted since we perform a
        binary search on it"
        https://bugs.webkit.org/show_bug.cgi?id=175893
        http://trac.webkit.org/changeset/221143

2017-08-23  Filip Pizlo  <fpizlo@apple.com>

        Reduce Gigacage sizes
        https://bugs.webkit.org/show_bug.cgi?id=175920

        Reviewed by Mark Lam.

        Provide filler API for the no-bmalloc/no-Gigacage case.

        * wtf/Gigacage.h:
        (Gigacage::mask):

2017-08-23  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, build fix in GTK port
        https://bugs.webkit.org/show_bug.cgi?id=174590

        * wtf/SingleRootGraph.h:
        (WTF::SingleRootGraph::successors const):
        (WTF::SingleRootGraph::predecessors const):

2017-08-23  Saam Barati  <sbarati@apple.com>

        Support compiling catch in the DFG
        https://bugs.webkit.org/show_bug.cgi?id=174590

        Reviewed by Filip Pizlo.

        This patch generalizes the BackwardsGraph fake root into a more generalizable
        class called SingleRootGraph. SingleRootGraph exposes the general graph interface
        used in Dominators and NaturalLoops. SingleRootGraph takes as input a graph with
        the normal graph interface, but also allows the input graph to contain more than
        one root. SingleRootGraph then exposes a single root, which it creates, that has
        an outgoing edge to all the roots in the original graph.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/BackwardsGraph.h:
        (WTF::BackwardsGraph::dump const):
        (WTF::BackwardsGraph::rootName): Deleted.
        (WTF::BackwardsGraph::Node::Node): Deleted.
        (WTF::BackwardsGraph::Node::root): Deleted.
        (WTF::BackwardsGraph::Node::operator== const): Deleted.
        (WTF::BackwardsGraph::Node::operator!= const): Deleted.
        (WTF::BackwardsGraph::Node::operator bool const): Deleted.
        (WTF::BackwardsGraph::Node::isRoot const): Deleted.
        (WTF::BackwardsGraph::Node::node const): Deleted.
        (): Deleted.
        (WTF::BackwardsGraph::Set::Set): Deleted.
        (WTF::BackwardsGraph::Set::add): Deleted.
        (WTF::BackwardsGraph::Set::remove): Deleted.
        (WTF::BackwardsGraph::Set::contains): Deleted.
        (WTF::BackwardsGraph::Set::dump const): Deleted.
        (WTF::BackwardsGraph::Map::Map): Deleted.
        (WTF::BackwardsGraph::Map::clear): Deleted.
        (WTF::BackwardsGraph::Map::size const): Deleted.
        (WTF::BackwardsGraph::Map::operator[]): Deleted.
        (WTF::BackwardsGraph::Map::operator[] const): Deleted.
        * wtf/Dominators.h:
        (WTF::Dominators::Dominators):
        (WTF::Dominators::forAllBlocksInIteratedDominanceFrontierOf):
        (WTF::Dominators::forAllBlocksInPrunedIteratedDominanceFrontierOf):
        (WTF::Dominators::iteratedDominanceFrontierOf const):
        (WTF::Dominators::forAllBlocksInIteratedDominanceFrontierOfImpl const):
        * wtf/SingleRootGraph.h: Added.
        (WTF::SingleRootGraphNode::rootName):
        (WTF::SingleRootGraphNode::SingleRootGraphNode):
        (WTF::SingleRootGraphNode::root):
        (WTF::SingleRootGraphNode::operator== const):
        (WTF::SingleRootGraphNode::operator!= const):
        (WTF::SingleRootGraphNode::operator bool const):
        (WTF::SingleRootGraphNode::isRoot const):
        (WTF::SingleRootGraphNode::node const):
        (WTF::SingleRootGraphSet::add):
        (WTF::SingleRootGraphSet::remove):
        (WTF::SingleRootGraphSet::contains):
        (WTF::SingleRootGraphSet::dump const):
        (WTF::SingleRootMap::SingleRootMap):
        (WTF::SingleRootMap::clear):
        (WTF::SingleRootMap::size const):
        (WTF::SingleRootMap::operator[]):
        (WTF::SingleRootMap::operator[] const):
        (WTF::SingleRootGraph::SingleRootGraph):
        (WTF::SingleRootGraph::root const):
        (WTF::SingleRootGraph::newMap):
        (WTF::SingleRootGraph::successors const):
        (WTF::SingleRootGraph::predecessors const):
        (WTF::SingleRootGraph::index const):
        (WTF::SingleRootGraph::node const):
        (WTF::SingleRootGraph::numNodes const):
        (WTF::SingleRootGraph::dump const):
        (WTF::SingleRootGraph::assertIsConsistent const):

2017-08-23  Youenn Fablet  <youenn@apple.com>

        [Cache API] Enable persistent coder to encode FetchOptions
        https://bugs.webkit.org/show_bug.cgi?id=175883

        Reviewed by Alex Christensen.

        Enabling encoding/decoding of enums with EnumTraits.
        This code is similar to the one of IPC encoder/decoder.

        * wtf/persistence/PersistentDecoder.h:
        (WTF::Persistence::Decoder::decode):
        * wtf/persistence/PersistentEncoder.h:
        (WTF::Persistence::Encoder::encode):

2017-08-23  Per Arne Vollan  <pvollan@apple.com>

        [Win] Compile error, include file <wtf/AVFoundationHeaderDetection.h> is not found.
        https://bugs.webkit.org/show_bug.cgi?id=175853

        Reviewed by Brent Fulgham.

        Copy generated WTF header files to the same place as we copy forwarding headers.
 
        * WTF.vcxproj/WTF.proj:

2017-08-22  Chris Dumez  <cdumez@apple.com>

        Introduce a new CompletionHandler type and use it for NetworkDataTaskClient's completion handlers to help catch bugs
        https://bugs.webkit.org/show_bug.cgi?id=175832

        Reviewed by Alex Christensen.

        Introduce a new CompletionHandler type which wraps a WTF::Function and ensures via assertions
        that the function is always called once and only once.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CompletionHandler.h: Added.
        (WTF::CompletionHandler<Out):

2017-08-22  Alex Christensen  <achristensen@webkit.org>

        Fix Windows build after r221017.
        https://bugs.webkit.org/show_bug.cgi?id=157053

        * wtf/PlatformWin.cmake:

2017-08-22  Per Arne Vollan  <pvollan@apple.com>

        Implement 64-bit MacroAssembler::probe support for Windows.
        https://bugs.webkit.org/show_bug.cgi?id=175724

        Reviewed by Mark Lam.

        Enable masm probe and DFG.

        * wtf/Platform.h:

2017-08-21  Mark Lam  <mark.lam@apple.com>

        [Follow up]: Add back the ability to disable MASM_PROBE from the build.
        https://bugs.webkit.org/show_bug.cgi?id=175656
        <rdar://problem/33933720>

        Not reviewed.

        Fixed a typo: should be "OS(WINDOWS)", not "OS(WINDOW)".

        * wtf/Platform.h:

2017-08-21  Carlos Alberto Lopez Perez  <clopez@igalia.com>

        [GTK] ARMv7 build fails to build MacroAssemblerARMv7.cpp.
        https://bugs.webkit.org/show_bug.cgi?id=175514

        Reviewed by Keith Miller.

        * wtf/Platform.h: Enable DFG and MASM_PROBE back for GTK ARM_THUMB2.

2017-08-20  Sam Weinig  <sam@webkit.org>

        StringView could use a function to strip leading/trailing characters without allocation
        https://bugs.webkit.org/show_bug.cgi?id=175757

        Reviewed by Darin Adler.

        There are many places in WebCore/WebKit that we call functions like, 
        WebCore::stripLeadingAndTrailingHTMLSpaces,  or String::stripWhiteSpace() only to use 
        the allocated String as a temporary for either another transformation or a comparison.
        Now that we have StringView, we can avoid that extra allocation, by having returning a
        StringView  substring in these scenarios.

        For instance, the check (from ScriptElement.cpp:287):

        if (!stripLeadingAndTrailingHTMLSpaces(sourceURL).isEmpty()) {
            ...
        }

        currently allocates a string just to make this check. With a new 
        stripLeadingAndTrailingHTMLSpaces such as:

        StringView stripLeadingAndTrailingHTMLSpaces(StringView stringView)
        {
            return stringView.stripLeadingAndTrailingMatchedCharacters([] (auto c) {
                return isHTMLSpace(c);
            });
        }

        We could instead have exact same code from ScriptElement.cpp now avoid an allocation.

        * wtf/text/StringView.h:
        (WTF::StringView::stripLeadingAndTrailingMatchedCharacters):

2017-08-21  Eric Carlson  <eric.carlson@apple.com>

        Add WTFLogChannel level to allow runtime log filtering
        https://bugs.webkit.org/show_bug.cgi?id=175731
        <rdar://problem/33967234>

        Reviewed by Jer Noble.
        
        Add WTFLog*, LOG, and RELEASE_LOG variants that take a "log level" parameter so code
        can include logging statements that are only conditionally emitted.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h:
        * wtf/MemoryPressureHandler.cpp:
        * wtf/RefCountedLeakCounter.cpp:

2017-08-20  Mark Lam  <mark.lam@apple.com>

        Gardening: fix CLoop build.
        https://bugs.webkit.org/show_bug.cgi?id=175688
        <rdar://problem/33436870>

        Not reviewed.

        Disable MASM_PROBE if !ENABLE(JIT).

        * wtf/Platform.h:

2017-08-18  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r220938.

        The API tests added with this change are failing.

        Reverted changeset:

        "Add WTFLogChannel level to allow runtime log filtering"
        https://bugs.webkit.org/show_bug.cgi?id=175731
        http://trac.webkit.org/changeset/220938

2017-08-18  Eric Carlson  <eric.carlson@apple.com>

        Add WTFLogChannel level to allow runtime log filtering
        https://bugs.webkit.org/show_bug.cgi?id=175731
        <rdar://problem/33967234>

        Reviewed by Jer Noble.
        
        Add WTFLog*, LOG, and RELEASE_LOG variants that take a "log level" parameter so code
        can include logging statements that are only conditionally emitted.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h:
        * wtf/MemoryPressureHandler.cpp:
        * wtf/RefCountedLeakCounter.cpp:

2017-08-18  Per Arne Vollan  <pvollan@apple.com>

        Implement 32-bit MacroAssembler::probe support for Windows.
        https://bugs.webkit.org/show_bug.cgi?id=175449

        Reviewed by Mark Lam.

        Enable the DFG on Win32. 

        * wtf/Platform.h:

2017-08-17  Mark Lam  <mark.lam@apple.com>

        Only use 16 VFP registers if !CPU(ARM_NEON).
        https://bugs.webkit.org/show_bug.cgi?id=175514

        Reviewed by JF Bastien.

        If CPU(ARM_NEON) is not enabled, we'll conservatively assume only VFP2 support is
        available. Hence, we'll only the first 16 FPDoubleRegisterIDs are available.

        For reference, see:
        NEON registers: http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0473c/CJACABEJ.html
        VFP2 and VFP3 registers: http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0473c/CIHDIBDG.html
        NEON to VFP register mapping: http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0473c/CJAIJHFC.html

        This is mostly for GTK toolchains which may target older ARM CPUs which only have
        VFP2 support.

        * wtf/Platform.h:

2017-08-16  Mark Lam  <mark.lam@apple.com>

        Add back the ability to disable MASM_PROBE from the build.
        https://bugs.webkit.org/show_bug.cgi?id=175656
        <rdar://problem/33933720>

        Reviewed by Yusuke Suzuki.

        * wtf/Platform.h:

2017-08-16  Mark Lam  <mark.lam@apple.com>

        Gardening: fix GTK ARM_THUMB2 build.
        https://bugs.webkit.org/show_bug.cgi?id=175446

        Not reviewed.

        Disable the use of the DFG for GTK ARM_THUMB2 builds until
        https://bugs.webkit.org/show_bug.cgi?id=175514 is fixed.

        * wtf/Platform.h:

2017-08-16  Andy Estes  <aestes@apple.com>

        [Payment Request] Add an ENABLE flag and an experimental feature preference
        https://bugs.webkit.org/show_bug.cgi?id=175622

        Reviewed by Tim Horton.

        * wtf/FeatureDefines.h:

2017-08-14  Simon Fraser  <simon.fraser@apple.com>

        Remove Proximity Events and related code
        https://bugs.webkit.org/show_bug.cgi?id=175545

        Reviewed by Daniel Bates.

        No platform enables Proximity Events, so remove code inside ENABLE(PROXIMITY_EVENTS)
        and other related code.

        * wtf/FeatureDefines.h:

2017-08-14  Simon Fraser  <simon.fraser@apple.com>

        Remove ENABLE(REQUEST_AUTOCOMPLETE) code, which was disabled everywhere
        https://bugs.webkit.org/show_bug.cgi?id=175504

        Reviewed by Sam Weinig.

        * wtf/FeatureDefines.h:

2017-08-14  Simon Fraser  <simon.fraser@apple.com>

        Remove ENABLE_VIEW_MODE_CSS_MEDIA and related code
        https://bugs.webkit.org/show_bug.cgi?id=175557

        Reviewed by Jon Lee.

        No port cares about the ENABLE(VIEW_MODE_CSS_MEDIA) feature, so remove it.

        * wtf/FeatureDefines.h:

2017-08-12  Filip Pizlo  <fpizlo@apple.com>

        Put the ScopedArgumentsTable's ScopeOffset array in some gigacage
        https://bugs.webkit.org/show_bug.cgi?id=174921

        Reviewed by Mark Lam.
        
        If you want to std::unique_ptr a class that knows that it should be in the Gigacage, then we
        would create the Gigacage equivalent of WTF_MAKE_FAST_ALLOCATED and it would just work.
        
        But this does not work if we want to std::unique_ptr a primitive type. So, this patch adds a
        solution for this problem: CagedUniquePtr<>. This will handle allocation
        (CagedUniquePtr<>::create()) and deallocation (in the style of std::unique_ptr). It has three
        variants:
        
        - Non-array types.
        - Arrays that don't have destructors.
        - Arrays that have destructors.
        
        Just like std::unique_ptr, the array case is triggered by saying "[]" at the end of the type.
        
        Unlike std::unique_ptr and most other smart pointers, the whole point of this smart pointer is
        to dictate where the thing you're pointing at is allocated. For this reason, it has to know how
        to do things like the array destructor protocol. So it creates its own: the CagedUniquePtr for
        arrays with destructors is a fat pointer that remembers the length of the array.
        
        CagedUniquePtr<> makes it impossible to leak/release the pointer. This is stricter than what
        std::unique_ptr does, and is probably appropriate for all of the places where we would use this
        type.
        
        So far, we only use it for ScopedArgumentsTable::m_arguments, but I suspect that it will be
        useful in other places.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/CagedUniquePtr.h: Added.
        (WTF::CagedUniquePtr::CagedUniquePtr):
        (WTF::CagedUniquePtr::create):
        (WTF::CagedUniquePtr::operator=):
        (WTF::CagedUniquePtr::~CagedUniquePtr):
        (WTF::CagedUniquePtr::get const):
        (WTF::CagedUniquePtr::getMayBeNull const):
        (WTF::CagedUniquePtr::operator== const):
        (WTF::CagedUniquePtr::operator!= const):
        (WTF::CagedUniquePtr::operator bool const):
        (WTF::CagedUniquePtr::operator* const):
        (WTF::CagedUniquePtr::operator-> const):
        (WTF::CagedUniquePtr::operator[] const):
        (WTF::CagedUniquePtr::destroy):
        * wtf/Gigacage.cpp:
        (Gigacage::tryMallocArray):
        (Gigacage::malloc):
        (Gigacage::mallocArray):
        * wtf/Gigacage.h:

2017-08-11  Ryosuke Niwa  <rniwa@webkit.org>

        Replace DATA_TRANSFER_ITEMS by a runtime flag and add a stub implementation
        https://bugs.webkit.org/show_bug.cgi?id=175474

        Reviewed by Wenson Hsieh.

        * wtf/FeatureDefines.h:

2017-08-11  Don Olmstead  <don.olmstead@sony.com>

        [WTF] Move ValueToString into WTF
        https://bugs.webkit.org/show_bug.cgi?id=175469

        Reviewed by Sam Weinig.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/text/ValueToString.h: Renamed from Source/WebCore/platform/ValueToString.h.

2017-08-11  Tim Horton  <timothy_horton@apple.com>

        Fix the build with modern Clang's -Wexpansion-to-defined
        https://bugs.webkit.org/show_bug.cgi?id=175467
        <rdar://problem/33667497>

        Reviewed by Simon Fraser.

        * wtf/FeatureDefines.h:
        * wtf/Platform.h:
        Avoid object-like macros that expand to include defined(), because this
        behaves inconsistently between different compilers (though in ways
        that don't matter for these particular defines, which aren't used on MSVC),
        and Clang has added a warning for it.

        Move ENABLE_WEBASSEMBLY to Platform.h since it depends on things that
        are defined there and can't be evaluated at time-of-use because of the
        aforementioned new rules. Previously, there was a cycle between
        ENABLE_WEBASSEMBLY and ENABLE_B3_JIT -- break that so that it just
        goes FTL_JIT->B3_JIT->WASM instead.

2017-08-10  Sam Weinig  <sam@webkit.org>

        WTF::Function does not allow for reference / non-default constructible return types
        https://bugs.webkit.org/show_bug.cgi?id=175244

        Reviewed by Chris Dumez.

        When Function, then NoncopyableFunction, was templatized to allow non-void return values
        in r201493, it maintained the behavior of being callable even if the Function was null.
        To accomplish this, when null, the default construction of the return parameter was used.
        This means Function can't be used with return types that are not default constructible,
        such as reference types and Ref.

        This behavior of returning something when null is surprising, as this is not how normal
        functions behave, and not very useful. Instead, we now assert that the function is not
        null when being called.

        * wtf/Function.h:
        (WTF::Function operator(...)):
        Instead of allowing a null callable wrapper by returning the default construction of
        the return type, assert that the wrapper is there when calling a Function.

2017-08-10  Mark Lam  <mark.lam@apple.com>

        Make the MASM_PROBE mechanism mandatory for DFG and FTL builds.
        https://bugs.webkit.org/show_bug.cgi?id=175446
        <rdar://problem/33836545>

        Reviewed by Saam Barati.

        This is needed in order to support https://bugs.webkit.org/show_bug.cgi?id=174645.
        One consequence of this is that the DFG will now be disabled for the MIPS and
        Windows ports. See:
            https://bugs.webkit.org/show_bug.cgi?id=175447
            https://bugs.webkit.org/show_bug.cgi?id=175449

        Also, we should only ENABLE_SIGNAL_BASED_VM_TRAPS if the DFG is enabled.  It was
        never meaningful to use SIGNAL_BASED_VM_TRAPS with the baseline JIT anyway.  This
        is a mis-configuration error that is now fixed.

        * wtf/Platform.h:

2017-08-10  Brady Eidson  <beidson@apple.com>

        Rename the source files for the WTF persistent coders.
        https://bugs.webkit.org/show_bug.cgi?id=175441

        Reviewed by Tim Horton.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:

        * wtf/persistence/PersistentCoder.h: Renamed from Source/WTF/wtf/persistence/Coder.h.
        * wtf/persistence/PersistentCoders.cpp: Renamed from Source/WTF/wtf/persistence/Coders.cpp.
        * wtf/persistence/PersistentCoders.h: Renamed from Source/WTF/wtf/persistence/Coders.h.
        * wtf/persistence/PersistentDecoder.cpp: Renamed from Source/WTF/wtf/persistence/Decoder.cpp.
        * wtf/persistence/PersistentDecoder.h: Renamed from Source/WTF/wtf/persistence/Decoder.h.
        * wtf/persistence/PersistentEncoder.cpp: Renamed from Source/WTF/wtf/persistence/Encoder.cpp.
        * wtf/persistence/PersistentEncoder.h: Renamed from Source/WTF/wtf/persistence/Encoder.h.

2017-08-10  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, attempt to fix build failure with VC2017

        * wtf/PriorityQueue.h:

2017-08-10  Yusuke Suzuki  <utatane.tea@gmail.com>

        Run more WTF tests
        https://bugs.webkit.org/show_bug.cgi?id=174970

        Reviewed by Michael Catanzaro.

        CHAR_BIT is not defined.

        * wtf/LEBDecoder.h:

2017-08-09  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] ThreadSpecific should not introduce additional indirection
        https://bugs.webkit.org/show_bug.cgi?id=175187

        Reviewed by Mark Lam.

        ThreadSpecific sets Data* to the TLS. And Data holds T*, which
        is fast allocated actual data. But ideally, we should store T
        instance directly in Data instead of introducing an additional
        indirection.

        This patch adds storage in Data in order to embed the instance of T. The constructor
        for Data will invoke the constructor for T on the embedded storage. We also drop
        ThreadSpecific::replace which is only used by the web thread to set its thread specific
        ThreadGlobalData to the one shared from the main thread. The existing implementation
        relies on the main thread and the web thread never exiting in order for the shared
        ThreadGlobalData to stay alive. We can achieve the same semantics by using a
        ThreadSpecific<std::unique_ptr<T>> to hold the ThreadGlobalData instance instead.

        * wtf/ThreadSpecific.h:
        (WTF::ThreadSpecific::Data::construct):
        (WTF::ThreadSpecific::Data::Data):
        We make it fast allocated since we previously allocated ThreadSpecific T data by fastMalloc.

        (WTF::ThreadSpecific::Data::~Data):
        (WTF::ThreadSpecific::Data::storagePointer const):
        (WTF::canBeGCThread>::get):
        We also drop RELEASE_ASSERT from ::get(). We already inserted this assert to setAndConstruct(),
        so when creating the member to this TLS, we execute this release assert. So it is
        not necessary to execute this assertion every time we get data from this TLS.

        (WTF::canBeGCThread>::set):
        (WTF::canBeGCThread>::destroy):
        (WTF::canBeGCThread>::setAndConstruct):
        (WTF::T):
        (WTF::canBeGCThread>::replace): Deleted.

2017-08-10  Tim Horton  <timothy_horton@apple.com>

        Fix a silly typo in Compiler.h

        * wtf/Compiler.h:
        Heature, indeed.

2017-08-10  Michael Catanzaro  <mcatanzaro@igalia.com>

        Remove ENABLE_GAMEPAD_DEPRECATED
        https://bugs.webkit.org/show_bug.cgi?id=175361

        Reviewed by Carlos Garcia Campos.

        * wtf/FeatureDefines.h:

2017-08-09  Don Olmstead  <don.olmstead@sony.com>

        [WTF] Move TextStream into WTF
        https://bugs.webkit.org/show_bug.cgi?id=175211

        Reviewed by Myles C. Maxfield.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/text/TextStream.cpp: Renamed from Source/WebCore/platform/text/TextStream.cpp.
        (WTF::TextStream::writeIndent):
        * wtf/text/TextStream.h: Renamed from Source/WebCore/platform/text/TextStream.h.
        (WTF::TextStream::FormatNumberRespectingIntegers::FormatNumberRespectingIntegers):

2017-08-09  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r220466, r220477, and r220487.
        https://bugs.webkit.org/show_bug.cgi?id=175411

        This change broke existing API tests and follow up fixes did
        not resolve all the issues. (Requested by ryanhaddad on
        #webkit).

        Reverted changesets:

        https://bugs.webkit.org/show_bug.cgi?id=175244
        http://trac.webkit.org/changeset/220466

        "WTF::Function does not allow for reference / non-default
        constructible return types"
        https://bugs.webkit.org/show_bug.cgi?id=175244
        http://trac.webkit.org/changeset/220477

        https://bugs.webkit.org/show_bug.cgi?id=175244
        http://trac.webkit.org/changeset/220487

2017-08-09  Sam Weinig  <sam@webkit.org>

        WTF::Function does not allow for reference / non-default constructible return types
        https://bugs.webkit.org/show_bug.cgi?id=175244

        Reviewed by Chris Dumez.

        When Function, then NoncopyableFunction, was templatized to allow non-void return values
        in r201493, it maintained the behavior of being callable even if the Function was null.
        To accomplish this, when null, the default construction of the return parameter was used.
        This means Function can't be used with return types that are not default constructible,
        such as reference types and Ref.

        This behavior of returning something when null is surprising, as this is not how normal
        functions behave, and not very useful. Instead, we now assert that the function is not
        null when being called.

        * wtf/Function.h:
        (WTF::Function operator(...)):
        Instead of allowing a null callable wrapper by returning the default construction of
        the return type, assert that the wrapper is there when calling a Function.

2017-08-09  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r220457.

        This change introduced API test failures.

        Reverted changeset:

        "WTF::Function does not allow for reference / non-default
        constructible return types"
        https://bugs.webkit.org/show_bug.cgi?id=175244
        http://trac.webkit.org/changeset/220457

2017-08-09  Sam Weinig  <sam@webkit.org>

        WTF::Function does not allow for reference / non-default constructible return types
        https://bugs.webkit.org/show_bug.cgi?id=175244

        Reviewed by Chris Dumez.

        When Function, then NoncopyableFunction, was templatized to allow non-void return values
        in r201493, it maintained the behavior of being callable even if the Function was null.
        To accomplish this, when null, the default construction of the return parameter was used.
        This means Function can't be used with return types that are not default constructible,
        such as reference types and Ref.

        This behavior of returning something when null is surprising, as this is not how normal
        functions behave, and not very useful. Instead, we now assert that the function is not
        null when being called.

        * wtf/Function.h:
        (WTF::Function operator(...)):
        Instead of allowing a null callable wrapper by returning the default construction of
        the return type, assert that the wrapper is there when calling a Function.

2017-08-08  Filip Pizlo  <fpizlo@apple.com>

        Baseline JIT should do caging
        https://bugs.webkit.org/show_bug.cgi?id=175037

        Reviewed by Mark Lam.

        * wtf/Gigacage.h:
        (Gigacage::disableDisablingPrimitiveGigacageIfShouldBeEnabled):
        (Gigacage::isDisablingPrimitiveGigacageDisabled):
        (Gigacage::isPrimitiveGigacagePermanentlyEnabled):
        (Gigacage::canPrimitiveGigacageBeDisabled):
        (Gigacage::basePtr):

2017-08-08  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r220368.

        This change caused WK1 tests to exit early with crashes.

        Reverted changeset:

        "Baseline JIT should do caging"
        https://bugs.webkit.org/show_bug.cgi?id=175037
        http://trac.webkit.org/changeset/220368

2017-08-08  Michael Catanzaro  <mcatanzaro@igalia.com>

        [CMake] Properly test if compiler supports compiler flags
        https://bugs.webkit.org/show_bug.cgi?id=174490

        Reviewed by Konstantin Tokarev.

        * wtf/Compiler.h:

2017-08-07  Filip Pizlo  <fpizlo@apple.com>

        Baseline JIT should do caging
        https://bugs.webkit.org/show_bug.cgi?id=175037

        Reviewed by Mark Lam.

        * wtf/Gigacage.h:
        (Gigacage::disableDisablingPrimitiveGigacageIfShouldBeEnabled):
        (Gigacage::isDisablingPrimitiveGigacageDisabled):
        (Gigacage::isPrimitiveGigacagePermanentlyEnabled):
        (Gigacage::canPrimitiveGigacageBeDisabled):

2017-08-07  Filip Pizlo  <fpizlo@apple.com>

        Unreviewed, try to fix Windows build.

        * wtf/Gigacage.cpp:
        * wtf/Gigacage.h:

2017-08-06  Filip Pizlo  <fpizlo@apple.com>

        Primitive auxiliaries and JSValue auxiliaries should have separate gigacages
        https://bugs.webkit.org/show_bug.cgi?id=174919

        Reviewed by Keith Miller.
        
        This mirrors the changes from bmalloc/Gigacage.h.
        
        Also it teaches CagedPtr how to reason about multiple gigacages.

        * wtf/CagedPtr.h:
        (WTF::CagedPtr::get const):
        (WTF::CagedPtr::operator[] const):
        * wtf/Gigacage.cpp:
        (Gigacage::tryMalloc):
        (Gigacage::tryAllocateVirtualPages):
        (Gigacage::freeVirtualPages):
        (Gigacage::tryAlignedMalloc):
        (Gigacage::alignedFree):
        (Gigacage::free):
        * wtf/Gigacage.h:
        (Gigacage::disablePrimitiveGigacage):
        (Gigacage::addPrimitiveDisableCallback):
        (Gigacage::removePrimitiveDisableCallback):
        (Gigacage::name):
        (Gigacage::basePtr):
        (Gigacage::caged):
        (Gigacage::isCaged):
        (Gigacage::tryAlignedMalloc):
        (Gigacage::alignedFree):
        (Gigacage::free):
        (Gigacage::disableGigacage): Deleted.
        (Gigacage::addDisableCallback): Deleted.
        (Gigacage::removeDisableCallback): Deleted.

2017-08-07  Brian Burg  <bburg@apple.com>

        Remove CANVAS_PATH compilation guard
        https://bugs.webkit.org/show_bug.cgi?id=175207

        Reviewed by Sam Weinig.

        * wtf/FeatureDefines.h:

2017-08-05  Filip Pizlo  <fpizlo@apple.com>

        REGRESSION (r219895-219897): Number of leaks on Open Source went from 9240 to 235983 and is now at 302372
        https://bugs.webkit.org/show_bug.cgi?id=175083

        Reviewed by Oliver Hunt.
        
        Adds a classic ReadWriteLock class. I wrote my own because I can never remember if the pthread one is
        guaranted to bias in favor of writers or not.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/Condition.h:
        (WTF::ConditionBase::construct):
        (WTF::Condition::Condition):
        * wtf/Lock.h:
        (WTF::LockBase::construct):
        (WTF::Lock::Lock):
        * wtf/ReadWriteLock.cpp: Added.
        (WTF::ReadWriteLockBase::construct):
        (WTF::ReadWriteLockBase::readLock):
        (WTF::ReadWriteLockBase::readUnlock):
        (WTF::ReadWriteLockBase::writeLock):
        (WTF::ReadWriteLockBase::writeUnlock):
        * wtf/ReadWriteLock.h: Added.
        (WTF::ReadWriteLockBase::ReadLock::tryLock):
        (WTF::ReadWriteLockBase::ReadLock::lock):
        (WTF::ReadWriteLockBase::ReadLock::unlock):
        (WTF::ReadWriteLockBase::WriteLock::tryLock):
        (WTF::ReadWriteLockBase::WriteLock::lock):
        (WTF::ReadWriteLockBase::WriteLock::unlock):
        (WTF::ReadWriteLockBase::read):
        (WTF::ReadWriteLockBase::write):
        (WTF::ReadWriteLock::ReadWriteLock):

2017-08-04  Matt Lewis  <jlewis3@apple.com>

        Unreviewed, rolling out r220271.

        Rolling out due to Layout Test failing on iOS Simulator.

        Reverted changeset:

        "Remove STREAMS_API compilation guard"
        https://bugs.webkit.org/show_bug.cgi?id=175165
        http://trac.webkit.org/changeset/220271

2017-08-04  Youenn Fablet  <youenn@apple.com>

        Remove STREAMS_API compilation guard
        https://bugs.webkit.org/show_bug.cgi?id=175165

        Reviewed by Darin Adler.

        * wtf/FeatureDefines.h:

2017-08-03  Brian Burg  <bburg@apple.com>

        Remove ENABLE(WEB_SOCKET) guards
        https://bugs.webkit.org/show_bug.cgi?id=167044

        Reviewed by Joseph Pecoraro.

        * wtf/FeatureDefines.h:

2017-08-03  Youenn Fablet  <youenn@apple.com>

        Remove FETCH_API compilation guard
        https://bugs.webkit.org/show_bug.cgi?id=175154

        Reviewed by Chris Dumez.

        * wtf/FeatureDefines.h:

2017-08-03  Brady Eidson  <beidson@apple.com>

        Add SW IDLs and stub out basic functionality.
        https://bugs.webkit.org/show_bug.cgi?id=175115

        Reviewed by Chris Dumez.

        * wtf/FeatureDefines.h:

2017-08-03  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, build fix for Windows port
        https://bugs.webkit.org/show_bug.cgi?id=175013

        * wtf/Threading.h:

2017-08-03  Yusuke Suzuki  <utatane.tea@gmail.com>

        Merge ThreadHolder to WTF::Thread itself
        https://bugs.webkit.org/show_bug.cgi?id=175013

        Reviewed by Mark Lam.

        Currently, we store ThreadHolder* to the TLS, and ThreadHolder* holds Ref<Thread>.
        When we get Thread& from the current thread TLS, we need to dereference the ThreadHolder*.
        However, ideally, we can store Thread* directly to the current thread TLS.
        While the ThreadHolder design is beautiful, it's worth optimizing by storing Thread* directly
        since Thread::current() is so frequently executed.

        This patch merges ThreadHolder to Thread. And we now store Thread* directly in the TLS.
        When storing it to TLS, we call leakRef() to keep Thread ref count incremented by the TLS.
        And when destroying the TLS, we call `deref()` to ensure that Thread* is dereferenced from
        the TLS.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/ThreadHolder.cpp: Removed.
        * wtf/ThreadHolder.h: Removed.
        * wtf/ThreadHolderPthreads.cpp: Removed.
        * wtf/ThreadHolderWin.cpp: Removed.
        * wtf/Threading.cpp:
        (WTF::Thread::entryPoint):
        (WTF::initializeThreading):
        * wtf/Threading.h:
        (WTF::Thread::currentMayBeNull):
        (WTF::Thread::current):
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::waitForCompletion):
        (WTF::Thread::initializeCurrentTLS):
        (WTF::Thread::initializeTLSKey):
        (WTF::Thread::initializeTLS):
        (WTF::Thread::destructTLS):
        (WTF::Thread::createCurrentThread): Deleted.
        * wtf/ThreadingWin.cpp:
        (WTF::Thread::initializeCurrentTLS):
        (WTF::threadMapMutex):
        (WTF::Thread::initializeTLSKey):
        (WTF::Thread::currentDying):
        (WTF::Thread::get):
        (WTF::Thread::initializeTLS):
        (WTF::Thread::destructTLS):
        (WTF::waitForThreadCompletion):
        (WTF::Thread::createCurrentThread): Deleted.

2017-08-03  Yusuke Suzuki  <utatane.tea@gmail.com>

        [Linux][WTF] Use one global semaphore to notify thread suspend and resume completion
        https://bugs.webkit.org/show_bug.cgi?id=175124

        Reviewed by Carlos Garcia Campos.

        POSIX sem_t is used to notify thread suspend and resume completion in Linux ports
        since sem_post is async-signal-safe function. Since we guard suspend() and resume()
        with one global lock, this semaphore is also guarded by this lock. So we do not need
        to have semaphore per WTF::Thread.

        This patch introduces one global Semaphore. And drop per thread semaphore.

        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::~Thread):
        (WTF::Semaphore::Semaphore):
        (WTF::Semaphore::~Semaphore):
        (WTF::Semaphore::wait):
        (WTF::Semaphore::post):
        (WTF::Thread::signalHandlerSuspendResume):
        (WTF::Thread::initializePlatformThreading):
        (WTF::Thread::suspend):
        (WTF::Thread::resume):
        (WTF::Thread::Thread): Deleted.
        * wtf/ThreadingWin.cpp:
        (WTF::Thread::Thread): Deleted.

2017-08-03  Yusuke Suzuki  <utatane.tea@gmail.com>

        [Linux][WTF] Reduce sizeof(WTF::Thread) by using a pointer to PlatformRegisters
        https://bugs.webkit.org/show_bug.cgi?id=175119

        Reviewed by Carlos Garcia Campos.

        sizeof(PlatformRegisters) is so large. In my Linux box, it is 256. It enlarges the sizeof(WTF::Thread).
        However, it is not necessary to hold it in WTF::Thread member. Thread's ucontext data and its stack is
        effective while suspending the thread. So, we can just use the pointer to the PlatformRegister instead
        of copying it to the member of the WTF::Thread.

        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::signalHandlerSuspendResume):
        (WTF::Thread::getRegisters):

2017-08-02  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, build fix for Windows port
        https://bugs.webkit.org/show_bug.cgi?id=174716

        This ugliness will be fixed in https://bugs.webkit.org/show_bug.cgi?id=175013.

        * wtf/ThreadHolder.h:
        * wtf/Threading.h:

2017-08-02  Yusuke Suzuki  <utatane.tea@gmail.com>

        Merge WTFThreadData to Thread::current
        https://bugs.webkit.org/show_bug.cgi?id=174716

        Reviewed by Mark Lam.

        We placed thread specific data in WTFThreadData previously. But now, we have a new good place
        to put thread specific data: WTF::Thread. Before this patch, WTFThreadData and WTF::Thread
        sometimes have the completely same fields (m_stack etc.) due to initialization order limitations.
        This patch merges WTFThreadData to WTF::Thread. We apply WTFThreadData's initialization style
        to WTF::Thread. So, WTF::Thread's holder now uses fast TLS for darwin environment. Thus,
        Thread::current() access is now accelerated. And WTF::Thread::current() can be accessed even
        before calling WTF::initializeThreading.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/LockAlgorithm.h:
        * wtf/LockAlgorithmInlines.h:
        * wtf/MainThread.h:
        * wtf/ParkingLot.cpp:
        * wtf/StackStats.cpp:
        (WTF::StackStats::PerThreadStats::PerThreadStats):
        (WTF::StackStats::CheckPoint::CheckPoint):
        (WTF::StackStats::CheckPoint::~CheckPoint):
        (WTF::StackStats::probe):
        (WTF::StackStats::LayoutCheckPoint::LayoutCheckPoint):
        * wtf/ThreadHolder.cpp:
        (WTF::ThreadHolder::initializeCurrent):
        * wtf/ThreadHolder.h:
        (WTF::ThreadHolder::ThreadHolder):
        (WTF::ThreadHolder::currentMayBeNull):
        (WTF::ThreadHolder::current):
        * wtf/ThreadHolderPthreads.cpp:
        (WTF::ThreadHolder::initializeKey):
        (WTF::ThreadHolder::initialize):
        (WTF::ThreadHolder::destruct):
        (WTF::ThreadHolder::initializeOnce): Deleted.
        (WTF::ThreadHolder::current): Deleted.
        * wtf/ThreadHolderWin.cpp:
        (WTF::ThreadHolder::initializeKey):
        (WTF::ThreadHolder::currentDying):
        (WTF::ThreadHolder::initialize):
        (WTF::ThreadHolder::initializeOnce): Deleted.
        (WTF::ThreadHolder::current): Deleted.
        * wtf/Threading.cpp:
        (WTF::Thread::initializeInThread):
        (WTF::Thread::entryPoint):
        (WTF::Thread::create):
        (WTF::Thread::didExit):
        (WTF::initializeThreading):
        (WTF::Thread::currentMayBeNull): Deleted.
        * wtf/Threading.h:
        (WTF::Thread::current):
        (WTF::Thread::atomicStringTable):
        (WTF::Thread::setCurrentAtomicStringTable):
        (WTF::Thread::stackStats):
        (WTF::Thread::savedStackPointerAtVMEntry):
        (WTF::Thread::setSavedStackPointerAtVMEntry):
        (WTF::Thread::savedLastStackTop):
        (WTF::Thread::setSavedLastStackTop):
        * wtf/ThreadingPrimitives.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::createCurrentThread):
        (WTF::Thread::current): Deleted.
        * wtf/ThreadingWin.cpp:
        (WTF::Thread::createCurrentThread):
        (WTF::Thread::current): Deleted.
        * wtf/WTFThreadData.cpp: Removed.
        * wtf/WTFThreadData.h: Removed.
        * wtf/text/AtomicString.cpp:
        * wtf/text/AtomicStringImpl.cpp:
        (WTF::stringTable):
        * wtf/text/AtomicStringTable.cpp:
        (WTF::AtomicStringTable::create):
        * wtf/text/AtomicStringTable.h:

2017-08-02  Joseph Pecoraro  <pecoraro@apple.com>

        NeverDestroyed related leaks seen on bots
        https://bugs.webkit.org/show_bug.cgi?id=175113

        Reviewed by Yusuke Suzuki.

        * wtf/NeverDestroyed.h:
        (WTF::NeverDestroyed::NeverDestroyed):
        Previously the result of makeNeverDestroyed was not always moving into
        the `static NeverDestroyed` static local variable. In some cases it would
        re-invoke the constructor, creating a new NeverDestroyed object. In the
        case of a Vector it was causing leaks.

        Adding a move constructor convinces the compiler to move the result
        of makeNeverDestroyed into the NeverDestroyed static. It doesn't actually
        invoke the move constructor here, which I believe means it is deciding
        to perform optional copy elision optimization.
        'http://en.cppreference.com/w/cpp/language/copy_elision

2017-08-02  Filip Pizlo  <fpizlo@apple.com>

        All C++ accesses to JSObject::m_butterfly should do caging
        https://bugs.webkit.org/show_bug.cgi?id=175039

        Reviewed by Keith Miller.
        
        Adds a smart pointer class that does various kinds of caging for you.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/CagedPtr.h: Added.
        (WTF::CagedPtr::CagedPtr):
        (WTF::CagedPtr::get const):
        (WTF::CagedPtr::getMayBeNull const):
        (WTF::CagedPtr::operator== const):
        (WTF::CagedPtr::operator!= const):
        (WTF::CagedPtr::operator bool const):
        (WTF::CagedPtr::operator* const):
        (WTF::CagedPtr::operator-> const):

2017-08-02  Filip Pizlo  <fpizlo@apple.com>

        We should be OK with the gigacage being disabled on gmalloc
        https://bugs.webkit.org/show_bug.cgi?id=175082

        Reviewed by Michael Saboff.

        * wtf/Gigacage.h:
        (Gigacage::shouldBeEnabled):

2017-08-01  Filip Pizlo  <fpizlo@apple.com>

        Bmalloc and GC should put auxiliaries (butterflies, typed array backing stores) in a gigacage (separate multi-GB VM region)
        https://bugs.webkit.org/show_bug.cgi?id=174727

        Reviewed by Mark Lam.
        
        For the Gigacage project to have minimal impact, we need to have some abstraction that allows code to
        avoid having to guard itself with #if's. This adds a Gigacage abstraction that overlays the Gigacage
        namespace from bmalloc, which always lets you call things like Gigacage::caged and Gigacage::tryMalloc.
        
        Because of how many places need to possibly allocate in a gigacage, or possibly perform caged accesses,
        it's better to hide the question of whether or not it's enabled inside this API.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/FastMalloc.cpp:
        * wtf/Gigacage.cpp: Added.
        (Gigacage::tryMalloc):
        (Gigacage::tryAllocateVirtualPages):
        (Gigacage::freeVirtualPages):
        (Gigacage::tryAlignedMalloc):
        (Gigacage::alignedFree):
        (Gigacage::free):
        * wtf/Gigacage.h: Added.
        (Gigacage::ensureGigacage):
        (Gigacage::disableGigacage):
        (Gigacage::addDisableCallback):
        (Gigacage::removeDisableCallback):
        (Gigacage::caged):
        (Gigacage::isCaged):
        (Gigacage::tryAlignedMalloc):
        (Gigacage::alignedFree):
        (Gigacage::free):

2017-07-31  Matt Lewis  <jlewis3@apple.com>

        Unreviewed, rolling out r220060.

        This broke our internal builds. Contact reviewer of patch for
        more information.

        Reverted changeset:

        "Merge WTFThreadData to Thread::current"
        https://bugs.webkit.org/show_bug.cgi?id=174716
        http://trac.webkit.org/changeset/220060

2017-07-31  Yusuke Suzuki  <utatane.tea@gmail.com>

        Merge WTFThreadData to Thread::current
        https://bugs.webkit.org/show_bug.cgi?id=174716

        Reviewed by Sam Weinig.

        We placed thread specific data in WTFThreadData previously. But now, we have a new good place
        to put thread specific data: WTF::Thread. Before this patch, WTFThreadData and WTF::Thread
        sometimes have the completely same fields (m_stack etc.) due to initialization order limitations.
        This patch merges WTFThreadData to WTF::Thread. We apply WTFThreadData's initialization style
        to WTF::Thread. So, WTF::Thread's holder now uses fast TLS for darwin environment. Thus,
        Thread::current() access is now accelerated. And WTF::Thread::current() can be accessed even
        before calling WTF::initializeThreading.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/LockAlgorithm.h:
        * wtf/LockAlgorithmInlines.h:
        * wtf/MainThread.h:
        * wtf/ParkingLot.cpp:
        * wtf/StackStats.cpp:
        (WTF::StackStats::PerThreadStats::PerThreadStats):
        (WTF::StackStats::CheckPoint::CheckPoint):
        (WTF::StackStats::CheckPoint::~CheckPoint):
        (WTF::StackStats::probe):
        (WTF::StackStats::LayoutCheckPoint::LayoutCheckPoint):
        * wtf/ThreadHolder.cpp:
        (WTF::ThreadHolder::initializeCurrent):
        * wtf/ThreadHolder.h:
        (WTF::ThreadHolder::ThreadHolder):
        (WTF::ThreadHolder::currentMayBeNull):
        (WTF::ThreadHolder::current):
        * wtf/ThreadHolderPthreads.cpp:
        (WTF::ThreadHolder::initialize):
        (WTF::ThreadHolder::destruct):
        (WTF::ThreadHolder::current): Deleted.
        * wtf/ThreadHolderWin.cpp:
        (WTF::ThreadHolder::currentDying):
        (WTF::ThreadHolder::initialize):
        (WTF::ThreadHolder::current): Deleted.
        * wtf/Threading.cpp:
        (WTF::Thread::initializeInThread):
        (WTF::Thread::entryPoint):
        (WTF::Thread::didExit):
        (WTF::initializeThreading):
        (WTF::Thread::currentMayBeNull): Deleted.
        * wtf/Threading.h:
        (WTF::Thread::atomicStringTable):
        (WTF::Thread::setCurrentAtomicStringTable):
        (WTF::Thread::stackStats):
        (WTF::Thread::savedStackPointerAtVMEntry):
        (WTF::Thread::setSavedStackPointerAtVMEntry):
        (WTF::Thread::savedLastStackTop):
        (WTF::Thread::setSavedLastStackTop):
        (WTF::Thread::current):
        * wtf/ThreadingPrimitives.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::createCurrentThread):
        (WTF::Thread::current): Deleted.
        * wtf/ThreadingWin.cpp:
        (WTF::Thread::createCurrentThread):
        (WTF::Thread::current): Deleted.
        * wtf/WTFThreadData.cpp: Removed.
        * wtf/WTFThreadData.h: Removed.
        * wtf/text/AtomicString.cpp:
        * wtf/text/AtomicStringImpl.cpp:
        (WTF::stringTable):
        * wtf/text/AtomicStringTable.cpp:
        (WTF::AtomicStringTable::create):
        * wtf/text/AtomicStringTable.h:

2017-07-31  Xabier Rodriguez Calvar  <calvaris@igalia.com>

        Created a bool pretty printer at WTF for debugging purposes
        https://bugs.webkit.org/show_bug.cgi?id=174893

        Reviewed by Darin Adler.

        * wtf/PrintStream.cpp:
        (WTF::printInternal): The overload taking bool uses boolForPrinting
        * wtf/PrintStream.h:
        (WTF::boolForPrinting): Converts a bool in "true" or "false".

2017-07-30  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Introduce Private Symbols
        https://bugs.webkit.org/show_bug.cgi?id=174935

        Reviewed by Darin Adler.

        Upcoming proposal of class fields[1] requires private fields.
        The simple way to implement it is adding a property with a private symbol.
        Currently, we have private symbols for internal properties. They are usual
        Symbols managed by the hash table. So basically private symbols are statically
        created in BuiltinNames. However this new proposal encourages users to create
        such private symbols more and more.

        So, this patch introduces notion of "Private" into WTF SymbolImpl. This patch
        adds PrivateSymbolImpl. This is SymbolImpl with "Private" flag. We do not need
        to look up the symbol from the hash table to check whether the given symbol
        is a private one.

        [1]: https://github.com/tc39/proposal-class-fields

        * wtf/text/StringImpl.h:
        * wtf/text/SymbolImpl.cpp:
        (WTF::PrivateSymbolImpl::create):
        (WTF::PrivateSymbolImpl::createNullSymbol):
        * wtf/text/SymbolImpl.h:
        (WTF::SymbolImpl::isPrivate):
        (WTF::SymbolImpl::StaticSymbolImpl::StaticSymbolImpl):
        (WTF::SymbolImpl::SymbolImpl):
        (WTF::PrivateSymbolImpl::PrivateSymbolImpl):

2017-07-30  Brady Eidson  <beidson@apple.com>

        Add URLSchemeHandler API tests that verify the lack of URLSchemeTask object leaks.
        https://bugs.webkit.org/show_bug.cgi?id=174958

        Reviewed by Darin Adler.

        This patch adds a new template class "InstanceCounted<T>".
        
        For each specialization, "InstanceCounted" will keep track of the total number of
        instances in existence.
        
        This makes explicate leak checking in API tests possible.
        
        Since this adds some runtime and storage overhead the code that actually does anything
        is only compiled in debug builds.
        
        * WTF.xcodeproj/project.pbxproj:
        * wtf/InstanceCounted.h: Added.
        (WTF::InstanceCounted::InstanceCounted):
        (WTF::InstanceCounted::instanceCount):
        (WTF::InstanceCounted::~InstanceCounted):

2017-07-27  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Drop Thread initialization wait in some platforms by introducing StackBounds::newThreadStackBounds(PlatformThreadHandle&)
        https://bugs.webkit.org/show_bug.cgi?id=174303

        Reviewed by Mark Lam.

        Currently, the caller thread of Thread::create() need to wait for completion of the initialization of the target thread.
        This is because we need to initialize Thread::m_stack in the target thread. Before this patch, a target thread's
        StackBounds can only be retrieved by the target thread itself. However, this potentially causes context-switching between
        the caller and the target threads and hurts efficiency of creating threads.

        Fortunately, in some platforms (including major platforms except for Windows), we can get StackBounds of a target
        thread from a caller thread. This allows us to avoid waiting for completion of thread initialization.

        In this patch, we introduce HAVE_STACK_BOUNDS_FOR_NEW_THREAD and StackBounds::newThreadStackBounds. When creating
        a new thread, we will use StackBounds::newThreadStackBounds to get StackBounds if possible. As a result, we
        do not need to wait for completion of thread initialization to ensure m_stack field of Thread is initialized.

        While some documents claim that it is possible on Windows to get the StackBounds of another thread[1], the method relies on
        undocumented Windows NT APIs (NtQueryInformationThread, NtReadVirtualMemory etc.). So in this patch, we just
        use the conservative approach simply waiting for completion of thread initialization.

        [1]: https://stackoverflow.com/questions/3918375/how-to-get-thread-stack-information-on-windows

        * wtf/Platform.h:
        * wtf/StackBounds.cpp:
        (WTF::StackBounds::newThreadStackBounds):
        (WTF::StackBounds::currentThreadStackBoundsInternal):
        (WTF::StackBounds::initialize): Deleted.
        * wtf/StackBounds.h:
        (WTF::StackBounds::currentThreadStackBounds):
        (WTF::StackBounds::StackBounds):
        * wtf/Threading.cpp:
        (WTF::Thread::NewThreadContext::NewThreadContext):
        (WTF::Thread::entryPoint):
        (WTF::Thread::create):
        (WTF::Thread::initialize): Deleted.
        * wtf/Threading.h:
        * wtf/ThreadingPrimitives.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::initializeCurrentThreadEvenIfNonWTFCreated):
        (WTF::wtfThreadEntryPoint):
        (WTF::Thread::establishHandle):
        (WTF::Thread::initializeCurrentThreadInternal):
        (WTF::Thread::current):
        * wtf/ThreadingWin.cpp:
        (WTF::Thread::initializeCurrentThreadEvenIfNonWTFCreated):
        (WTF::Thread::initializeCurrentThreadInternal):
        (WTF::Thread::current):
        * wtf/win/MainThreadWin.cpp:
        (WTF::initializeMainThreadPlatform):

2017-07-27  JF Bastien  <jfbastien@apple.com>

        Update lock benchmarks
        https://bugs.webkit.org/show_bug.cgi?id=174907

        Reviewed by Filip Pizlo.

        * benchmarks/ConditionSpeedTest.cpp:
        (main):
        * benchmarks/LockFairnessTest.cpp:
        * benchmarks/LockSpeedTest.cpp:
        * benchmarks/ToyLocks.h:

2017-07-26  Brian Burg  <bburg@apple.com>

        Remove WEB_TIMING feature flag
        https://bugs.webkit.org/show_bug.cgi?id=174795

        Reviewed by Alex Christensen.

        * wtf/FeatureDefines.h:

2017-07-26  Claudio Saavedra  <csaavedra@igalia.com>

        [WPE] Enable KeyboardEvent key and code attributes
        https://bugs.webkit.org/show_bug.cgi?id=174822

        Reviewed by Žan Doberšek.

        There is no reason for this to be disabled from what I see.

        * wtf/FeatureDefines.h: Enable KeyboardEvent key and code attributes.

2017-07-23  Filip Pizlo  <fpizlo@apple.com>

        B3 should do LICM
        https://bugs.webkit.org/show_bug.cgi?id=174750

        Reviewed by Keith Miller and Saam Barati.
        
        Moved DFG::NaturalLoops to WTF. The new templatized NaturalLoops<> uses the same Graph abstraction as
        Dominators<>. This allows us to add a B3::NaturalLoops for free.
        
        Also made small tweaks to RangeSet, which the LICM uses.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Dominators.h:
        * wtf/NaturalLoops.h: Added.
        (WTF::NaturalLoop::NaturalLoop):
        (WTF::NaturalLoop::graph):
        (WTF::NaturalLoop::header):
        (WTF::NaturalLoop::size):
        (WTF::NaturalLoop::at):
        (WTF::NaturalLoop::operator[]):
        (WTF::NaturalLoop::contains):
        (WTF::NaturalLoop::index):
        (WTF::NaturalLoop::isOuterMostLoop):
        (WTF::NaturalLoop::dump):
        (WTF::NaturalLoop::addBlock):
        (WTF::NaturalLoops::NaturalLoops):
        (WTF::NaturalLoops::graph):
        (WTF::NaturalLoops::numLoops):
        (WTF::NaturalLoops::loop):
        (WTF::NaturalLoops::headerOf):
        (WTF::NaturalLoops::innerMostLoopOf):
        (WTF::NaturalLoops::innerMostOuterLoop):
        (WTF::NaturalLoops::belongsTo):
        (WTF::NaturalLoops::loopDepth):
        (WTF::NaturalLoops::loopsOf):
        (WTF::NaturalLoops::dump):
        * wtf/RangeSet.h:
        (WTF::RangeSet::begin):
        (WTF::RangeSet::end):
        (WTF::RangeSet::addAll):

2017-07-23  Michael Catanzaro  <mcatanzaro@igalia.com>

        Implement FALLTHROUGH attribute for C with GCC
        https://bugs.webkit.org/show_bug.cgi?id=174555

        Reviewed by Darin Adler.

        My previous attempt to silence the JSC -Wimplicit-fallthrough warnings failed because they
        are coming from a C file, and our FALLTHROUGH macro is only implemented for C++. So
        implement it for C as well, using C attribute syntax.
 
        Note this is only possible to do for GCC, because Clang only supports this attribute using
        the [[C++ attribute syntax]].

        * wtf/Compiler.h:

2017-07-14  Filip Pizlo  <fpizlo@apple.com>

        It should be easy to decide how WebKit yields
        https://bugs.webkit.org/show_bug.cgi?id=174298

        Reviewed by Saam Barati.
        
        Created a Thread::yield() abstraction for sched_yield(), and made WTF use it everywhere that it
        had previously used std::this_thread::yield().
        
        To make it less annoying to experiment with changes to the lock algorithm in the future, this also
        moves the meat of the algorithm into LockAlgorithmInlines.h. Only two files include that header.
        Since LockAlgorithm.h no longer includes ParkingLot.h, a bunch of files in WK now need to include
        timing headers (Seconds, MonotonicTime, etc) manually.

        * WTF.xcodeproj/project.pbxproj:
        * benchmarks/ToyLocks.h:
        * wtf/CMakeLists.txt:
        * wtf/Lock.cpp:
        * wtf/LockAlgorithm.h:
        (WTF::LockAlgorithm::lockSlow): Deleted.
        (WTF::LockAlgorithm::unlockSlow): Deleted.
        * wtf/LockAlgorithmInlines.h: Added.
        (WTF::hasParkedBit>::lockSlow):
        (WTF::hasParkedBit>::unlockSlow):
        * wtf/MainThread.cpp:
        * wtf/RunLoopTimer.h:
        * wtf/Threading.cpp:
        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::yield):
        * wtf/ThreadingWin.cpp:
        (WTF::Thread::yield):
        * wtf/WordLock.cpp:
        (WTF::WordLockBase::lockSlow):
        (WTF::WordLockBase::unlockSlow):

2017-07-22  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Extend ThreadGroup::add results from bool to ThreadGroupAddResult
        https://bugs.webkit.org/show_bug.cgi?id=174705

        Reviewed by Mark Lam.

        After starting using ThreadGroup to bookkeep active threads for Signals,
        we would like to know tristate of ThreadGroup::add result, NewlyAdded, AlreadyAdded, NotAdded.
        This patch extends the result of ThreadGroup::add from bool to ThreadGroupAddResult tristate.
        Note that NotAdded is returned if the target thread is dying.

        * wtf/ThreadGroup.cpp:
        (WTF::ThreadGroup::add):
        (WTF::ThreadGroup::addCurrentThread):
        * wtf/ThreadGroup.h:
        * wtf/Threading.cpp:
        (WTF::Thread::addToThreadGroup):
        * wtf/Threading.h:
        * wtf/threads/Signals.cpp:
        (WTF::registerThreadForMachExceptionHandling):

2017-07-21  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r219732.
        https://bugs.webkit.org/show_bug.cgi?id=174748

        static is not threadsafe in WebKit tree (Requested by
        yusukesuzuki on #webkit).

        Reverted changeset:

        "[WTF] Drop initializeDate"
        https://bugs.webkit.org/show_bug.cgi?id=174714
        http://trac.webkit.org/changeset/219732

2017-07-21  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Drop initializeDate
        https://bugs.webkit.org/show_bug.cgi?id=174714

        Reviewed by Darin Adler.

        minYear static variable will be initialized in an exclusive manner, which is ensured by C++ "static" semantics.
        Thus, we do not need to call initializeDate() explicitly.

        * wtf/DateMath.cpp:
        (WTF::equivalentYearForDST):
        (WTF::initializeDates): Deleted.
        * wtf/Threading.cpp:
        (WTF::initializeThreading):

2017-07-21  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Introduce static symbols
        https://bugs.webkit.org/show_bug.cgi?id=158863

        Reviewed by Darin Adler.

        We add a new class StaticSymbolImpl. StaticSymbolImpl can offer
        the way to create static SymbolImpl. It can be shared between
        multiple VMs and multiple threads.

        * wtf/text/SymbolImpl.h:
        (WTF::SymbolImpl::StaticSymbolImpl::StaticSymbolImpl):
        (WTF::SymbolImpl::StaticSymbolImpl::operator SymbolImpl&):
        For StaticSymbolImpl's hashForSymbol, we use usual string hash value.
        Since all the SymbolImpls are unique, basically, any value is OK here.
        Non-confilicting to the other SymbolImpls is ideal.

2017-07-21  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Newly added AtomicStringImpl should use BufferInternal static string if StringImpl is static
        https://bugs.webkit.org/show_bug.cgi?id=174501

        Reviewed by Darin Adler.

        When creating AtomicStringImpl from static StringImpl, we can just use createWithoutCopying
        to create a BufferInternal AtomicStringImpl which m_data{8,16} is static string's one.

        * wtf/text/AtomicStringImpl.cpp:
        (WTF::CStringTranslator::hash):
        (WTF::CStringTranslator::equal):
        (WTF::CStringTranslator::translate):
        (WTF::AtomicStringImpl::add):
        (WTF::HashTranslatorCharBuffer::HashTranslatorCharBuffer):
        (WTF::UCharBufferTranslator::hash):
        (WTF::UCharBufferTranslator::equal):
        (WTF::UCharBufferTranslator::translate):
        (WTF::LCharBufferTranslator::hash):
        (WTF::LCharBufferTranslator::equal):
        (WTF::LCharBufferTranslator::translate):
        (WTF::BufferFromStaticDataTranslator::hash):
        (WTF::BufferFromStaticDataTranslator::equal):
        (WTF::BufferFromStaticDataTranslator::translate):
        (WTF::AtomicStringImpl::addLiteral):
        (WTF::addSymbol):
        (WTF::addStatic):
        (WTF::AtomicStringImpl::addSlowCase):
        (WTF::AtomicStringImpl::lookUp):
        (WTF::CharBufferFromLiteralDataTranslator::hash): Deleted.
        (WTF::CharBufferFromLiteralDataTranslator::equal): Deleted.
        (WTF::CharBufferFromLiteralDataTranslator::translate): Deleted.
        (WTF::addSubstring): Deleted.
        * wtf/text/StringImpl.h:

2017-07-21  Konstantin Tokarev  <annulen@yandex.ru>

       [cmake] Unreviewed, add definitions necessary to use ICU shipped with macOS

       macOS system ICU libraries are built with U_DISABLE_RENAMING=1 and
       U_SHOW_CPLUSPLUS_API=0. After r219155 we have to pass this definitons
       explicitly, because ICU headers in the tree are not modified anymore.

        * wtf/PlatformMac.cmake: Rely on ICU_LIBRARIES instead of passing ICU
        library name explicitly in WTF_LIBRARIES.

2017-07-20  Chris Dumez  <cdumez@apple.com>

        Replace calls to Vector::resize() with calls to more efficient shrink() / grow() when applicable
        https://bugs.webkit.org/show_bug.cgi?id=174660

        Reviewed by Geoffrey Garen.

        Replace calls to Vector::resize() with calls to more efficient shrink() / grow() when applicable.
        This essentially replaces a branch to figure out if the new size is less or greater than the
        current size by an assertion.

        * wtf/IndexSparseSet.h:
        (WTF::OverflowHandler>::IndexSparseSet):
        (WTF::OverflowHandler>::clear):
        * wtf/Insertion.h:
        (WTF::executeInsertions):
        * wtf/RangeSet.h:
        (WTF::RangeSet::compact):
        * wtf/Vector.h:
        (WTF::removeRepeatedElements):
        * wtf/persistence/Coders.h:

2017-07-20  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Use ThreadGroup to bookkeep active threads for Mach exception
        https://bugs.webkit.org/show_bug.cgi?id=174678

        Reviewed by Mark Lam.

        We can use ThreadGroup to bookkeep active threads for Mach exceptions.
        When the thread dies, it is automatically removed from the thread groups.
        So we do not need to call unregisterThreadForMachExceptionHandling.

        * wtf/ThreadGroup.cpp:
        (WTF::ThreadGroup::~ThreadGroup):
        (WTF::ThreadGroup::add):
        * wtf/ThreadGroup.h:
        * wtf/ThreadHolder.cpp:
        (WTF::ThreadHolder::~ThreadHolder):
        * wtf/Threading.cpp:
        (WTF::Thread::addToThreadGroup):
        (WTF::Thread::removeFromThreadGroup):
        * wtf/Threading.h:
        * wtf/threads/Signals.cpp:
        (WTF::setExceptionPorts):
        (WTF::activeThreads):
        (WTF::registerThreadForMachExceptionHandling):
        (WTF::installSignalHandler):
        (WTF::unregisterThreadForMachExceptionHandling): Deleted.
        * wtf/threads/Signals.h:

2017-07-19  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Remove unnecessary indirection of WTF::Thread entry point
        https://bugs.webkit.org/show_bug.cgi?id=174291

        Reviewed by Mark Lam.

        Now wtfThreadEntryPoint is almost the same. Only the difference is function signature due to platform APIs.
        We remove ThreadFunctionInvocation indirection in ThreadingPthread.cpp and ThreadingWin.cpp.

        Also, ThreadFunctionInvocation keeps a RefPtr to the Thread object. This was previously needed to keep the
        Thread object alive until the thread itself could install the ThreadHolder into its thread local storage.
        The ThreadHolder has a Ref that keeps the Thread object alive for the lifetime of the thread. Since
        Thread::create() now waits for the thread to be initialized before returning and Thread::create() hold a Ref
        to the Thread object, we are guaranteed that the Thread object will be alive long enough for it to be installed
        in the thread's ThreadHolder, and we no longer need ThreadFunctionInvocation.

        And we also simplify ThreadHolder::initialize a bit. Now Thread::create waits for the completion of Thread
        initialization. So, after establishing thread handle, we can call ThreadHolder::initialize before completing
        Thread initialization.

        Also we drop errno.h ifdefs in ThreadingWin.cpp. This is introduced to support WinCE. But now WinCE port is removed.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/ThreadFunctionInvocation.h: Removed.
        * wtf/ThreadHolder.h:
        * wtf/ThreadHolderWin.cpp:
        (WTF::ThreadHolder::initialize):
        * wtf/Threading.cpp:
        (WTF::Thread::entryPoint):
        (WTF::Thread::create):
        (WTF::threadEntryPoint): Deleted.
        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::initializeCurrentThreadEvenIfNonWTFCreated):
        (WTF::wtfThreadEntryPoint):
        (WTF::Thread::establishHandle):
        (WTF::Thread::initializeCurrentThreadInternal):
        (WTF::Thread::current):
        (WTF::Thread::establishPlatformSpecificHandle):
        (WTF::Thread::createInternal): Deleted.
        (WTF::Thread::establish): Deleted.
        * wtf/ThreadingWin.cpp:
        (WTF::Thread::initializeCurrentThreadEvenIfNonWTFCreated):
        (WTF::Thread::initializeCurrentThreadInternal):
        (WTF::wtfThreadEntryPoint):
        (WTF::Thread::establishHandle):
        (WTF::Thread::current):
        (WTF::Thread::establishPlatformSpecificHandle):
        (WTF::Thread::createInternal): Deleted.
        (WTF::Thread::establish): Deleted.
        * wtf/win/MainThreadWin.cpp:
        (WTF::initializeMainThreadPlatform):

2017-07-19  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Implement WTF::ThreadGroup
        https://bugs.webkit.org/show_bug.cgi?id=174081

        Reviewed by Mark Lam.

        This patch implements WTF::ThreadGroup. It implements core of JSC::MachineThreads with more reliable way.
        JSC::MachineThreads was complicated because of managing dead threads. Each JSC::MachineThreads has its
        own TLS with a registered destructor. And everytime a thread dies, the registered TLS destructor is called.
        And this destructor will remove the current dying thread from JSC::MachineThreads.

        However the above implementation is tricky. And each JSC::MachineThreads requires own TLS space, which is
        not considered in WTF's Windows ThreadSpecific implementation. Current design works well since we only
        have small number of MachineThreads right now.

        Instead, we use more reliable way. After introducing WTF::Thread, WTF::Thread has WTF::Thread::didExit,
        which is called when associated TLS (with WTF::Thread) is destroyed. We leverage this mechanism to remove
        WTF::Thread from MachineThreads.

        This patch introduces WTF::ThreadGroup. It is tightly integrated with WTF::Thread: WTF::Thread knows
        ThreadGroups which includes this thread. And WTF::ThreadGroup of course knows WTF::Threads added to it.
        WTF::Thread::didExit carefully remove itself from WTF::ThreadGroups.

        The most important part of this patch is locking. WTF::Thread can die. And WTF::ThreadGroup can die.
        If we take a design using two fine grain locks in WTF::Thread and WTF::ThreadGroup, we easily encounter
        dead lock. Consider the following case.

        1. When adding WTF::Thread (TH) to WTF::ThreadGroup (THG), we first hold a lock of THG, and hold a lock of TH (locking order is THG -> TH).
        2. When TH dies, TH need to hold a lock of TH to iterate THGs. And we hold a lock of THG to unregister TH from it (locking order is TH -> THG).
        3. When suspending and resuming THs in THG, we first hold a lock of THG. And then, we hold a lock of TH to suspend and resume it (locking order is THG -> TH).
        4. When destroying THG, we need to hold a lock of TH to unregister THG from TH. We can hold a lock of THG before that (locking order is THG -> TH).

        Then, it easily causes dead lock. We cannot swap the locking order of (2) since iterating THG requires a lock of TH.
        To solve this problem, we use std::shared_ptr and std::weak_ptr.

        1. When adding WTF::Thread (TH) to WTF::ThreadGroup (THG), we first hold THG, and hold a lock of TH. (THG -> TH)
        2. When TH dies, TH first hold lock of TH. And we use std::weak_ptr<>::lock() to retain non-destructed ThreadGroups.
        If some of ThreadGroups are dying, we just ignore them. It is ok because such a ThreadGroup will be destructed. So we do not need to unregister this thread from
        such a ThreadGroup. Then, we have Vector<std::shared_ptr<ThreadGroup>>. So we unlock a lock of TH. To unregister a thread from thread group, we first hold a
        lock of THG and then hold a lock of TH. Both lifetime is ensured: THG is retained by std::shared_ptr. And TH is itself. (TH), (THG -> TH).
        3. When suspending and resuming THs in THG, we first hold a lock of THG. And then, we hold a lock of TH to suspend and resume it (THG -> TH).
        4. When destroying THG, we hold a lock of THG. And hold a lock of TH. During holding THG's lock, registered thread never dies because (2) holds THG lock. (THG -> TH).

        We also fix suspend and resume locking mechanism to avoid dead lock. We should hold the global lock when suspending and resuming.
        If we use per-thread lock, the suspended thread can hold the lock of the other threads. It causes dead lock.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/AutomaticThread.cpp:
        * wtf/CMakeLists.txt:
        * wtf/CrossThreadCopier.h:
        * wtf/ParkingLot.h:
        * wtf/ThreadGroup.cpp: Copied from Source/JavaScriptCore/wasm/WasmMachineThreads.cpp.
        (WTF::ThreadGroup::~ThreadGroup):
        (WTF::ThreadGroup::add):
        (WTF::ThreadGroup::addCurrentThread):
        * wtf/ThreadGroup.h: Copied from Source/JavaScriptCore/wasm/WasmMachineThreads.cpp.
        (WTF::ThreadGroup::create):
        (WTF::ThreadGroup::threads):
        (WTF::ThreadGroup::getLock):
        (WTF::ThreadGroup::weakFromThis):
        * wtf/Threading.cpp:
        (WTF::shouldRemoveThreadFromThreadGroup):
        (WTF::Thread::didExit):
        (WTF::Thread::addToThreadGroup):
        (WTF::Thread::removeFromThreadGroup):
        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::resume):
        (WTF::Thread::getRegisters):
        * wtf/ThreadingWin.cpp:
        (WTF::Thread::resume):
        (WTF::Thread::getRegisters):

2017-07-18  Andy Estes  <aestes@apple.com>

        [Xcode] Enable CLANG_WARN_RANGE_LOOP_ANALYSIS
        https://bugs.webkit.org/show_bug.cgi?id=174631

        Reviewed by Tim Horton.

        * Configurations/Base.xcconfig:

2017-07-18  Yusuke Suzuki  <utatane.tea@gmail.com>

        WTF::Thread should have the threads stack bounds.
        https://bugs.webkit.org/show_bug.cgi?id=173975

        Reviewed by Mark Lam.

        We move StackBounds from WTFThreadData to WTF::Thread.
        One important thing is that we should make valid StackBounds
        visible to Thread::create() caller. When the caller get
        WTF::Thread from Thread::create(), this WTF::Thread should
        have a valid StackBounds. But StackBounds information can be
        retrived only in the WTF::Thread's thread itself.

        We also clean up WTF::initializeThreading. StringImpl::empty()
        is now statically initialized by using constexpr constructor.
        Thus we do not need to call StringImpl::empty() explicitly here.
        And WTF::initializeThreading() does not have any main thread
        affinity right now in all the platforms. So we fix the comment
        in Threading.h. Then, now, WTF::initializeThreading() is called
        in UI thread when using Web thread in iOS.

        * wtf/StackBounds.h:
        (WTF::StackBounds::emptyBounds):
        (WTF::StackBounds::StackBounds):
        * wtf/Threading.cpp:
        (WTF::threadEntryPoint):
        (WTF::Thread::create):
        (WTF::Thread::currentMayBeNull):
        (WTF::Thread::initialize):
        (WTF::initializeThreading):
        * wtf/Threading.h:
        (WTF::Thread::stack):
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::initializeCurrentThreadEvenIfNonWTFCreated):
        (WTF::Thread::current):
        (WTF::initializeCurrentThreadEvenIfNonWTFCreated): Deleted.
        (WTF::Thread::currentMayBeNull): Deleted.
        * wtf/ThreadingWin.cpp:
        (WTF::Thread::initializeCurrentThreadEvenIfNonWTFCreated):
        (WTF::Thread::initializeCurrentThreadInternal):
        (WTF::Thread::current):
        * wtf/WTFThreadData.cpp:
        (WTF::WTFThreadData::WTFThreadData):
        * wtf/WTFThreadData.h:
        (WTF::WTFThreadData::stack):

2017-07-18  Andy Estes  <aestes@apple.com>

        [Xcode] Enable CLANG_WARN_OBJC_LITERAL_CONVERSION
        https://bugs.webkit.org/show_bug.cgi?id=174631

        Reviewed by Sam Weinig.

        * Configurations/Base.xcconfig:

2017-07-18  Andy Estes  <aestes@apple.com>

        [Xcode] Enable CLANG_WARN_NON_LITERAL_NULL_CONVERSION
        https://bugs.webkit.org/show_bug.cgi?id=174631

        Reviewed by Dan Bernstein.

        * Configurations/Base.xcconfig:

2017-07-18  Andy Estes  <aestes@apple.com>

        [Xcode] Enable CLANG_WARN_BLOCK_CAPTURE_AUTORELEASING
        https://bugs.webkit.org/show_bug.cgi?id=174631

        Reviewed by Darin Adler.

        * Configurations/Base.xcconfig:

2017-07-17  Konstantin Tokarev  <annulen@yandex.ru>

        [cmake] Set library types before their targets are created
        https://bugs.webkit.org/show_bug.cgi?id=174600

        Reviewed by Michael Catanzaro.

        Since r219560 library targets are created before PlatformXXX.cmake
        files are processed, however library type must be passed in
        add_library() call and cannot be changed afterwards. Set these
        variables in OptionsXXX.cmake.

        * wtf/PlatformGTK.cmake:
        * wtf/PlatformMac.cmake:

2017-07-17  Yoshiaki Jitsukawa  <Yoshiaki.Jitsukawa@sony.com>

        Move USE_AVFOUNDATION definition on Windows to wtf/Platform.h
        https://bugs.webkit.org/show_bug.cgi?id=174356

        Reviewed by Brent Fulgham.

        Move the definition of USE_AVFOUNDATION on Windows to wtf/platform.h

        Add a custom command to generate AVFoundationHeaderDetection.h, which
        is renamed from WebCoreHeaderDetection.h

        * AVFoundationSupport.py: Moved from Source/WebCore/AVFoundationSupport.py.
        * wtf/Platform.h:
        * wtf/PlatformWin.cmake:

2017-07-17  Darin Adler  <darin@apple.com>

        Improve use of NeverDestroyed
        https://bugs.webkit.org/show_bug.cgi?id=174348

        Reviewed by Sam Weinig.

        * wtf/HashSet.h: Added an overload of HashSet::add that takes an initializer list of
        const references. This is handy to add a bunch of values all at once. Later we can
        consider optimizing to grow the hash table only once instead of deciding whether to
        grow repeatedly as we add each value.
        (WTF::copyToVector): Changed to use std::copy, removing 4 of the 6 lines of code here.

        * wtf/MemoryPressureHandler.cpp: Include NeverDestroyed.h here ...
        * wtf/MemoryPressureHandler.h: ... not here.

        * wtf/NeverDestroyed.h: Added the ability to have a const NeverDestroyed.
        Added a makeNeverDestroyed function that deduces the type from the argument.
        With auto, this can be used to avoid writing out a long type twice.

        * wtf/ThreadingPthreads.cpp: Removed unneeded include of NeverDestroyed.h.
        * wtf/text/AtomicString.cpp: Ditto.

2017-07-17  Konstantin Tokarev  <annulen@yandex.ru>

        [CMake] Create targets before WEBKIT_INCLUDE_CONFIG_FILES_IF_EXISTS is called
        https://bugs.webkit.org/show_bug.cgi?id=174557

        Reviewed by Michael Catanzaro.

        * wtf/CMakeLists.txt:

2017-07-14  Jonathan Bedard  <jbedard@apple.com>

        Add iOS 11 SPI
        https://bugs.webkit.org/show_bug.cgi?id=174430
        <rdar://problem/33269288>

        Reviewed by Tim Horton.

        * Configurations/WTF.xcconfig: Exclude MachExceptions.def when building iOS 11 for
        the iOS simulator.

2017-07-14  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r219510.
        https://bugs.webkit.org/show_bug.cgi?id=174525

        Need to revert length() == 0 check for null string (Requested
        by yusukesuzuki on #webkit).

        Reverted changeset:

        "[WTF] Newly added AtomicStringImpl should use BufferInternal
        static string if StringImpl is static"
        https://bugs.webkit.org/show_bug.cgi?id=174501
        http://trac.webkit.org/changeset/219510

2017-07-14  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Newly added AtomicStringImpl should use BufferInternal static string if StringImpl is static
        https://bugs.webkit.org/show_bug.cgi?id=174501

        Reviewed by Darin Adler.

        When creating AtomicStringImpl from static StringImpl, we can just use createWithoutCopying
        to create a BufferInternal AtomicStringImpl which m_data{8,16} is static string's one.

        * wtf/text/AtomicStringImpl.cpp:
        (WTF::CStringTranslator::hash):
        (WTF::CStringTranslator::equal):
        (WTF::CStringTranslator::translate):
        (WTF::AtomicStringImpl::add):
        (WTF::HashTranslatorCharBuffer::HashTranslatorCharBuffer):
        (WTF::UCharBufferTranslator::hash):
        (WTF::UCharBufferTranslator::equal):
        (WTF::UCharBufferTranslator::translate):
        (WTF::LCharBufferTranslator::hash):
        (WTF::LCharBufferTranslator::equal):
        (WTF::LCharBufferTranslator::translate):
        (WTF::BufferFromStaticDataTranslator::hash):
        (WTF::BufferFromStaticDataTranslator::equal):
        (WTF::BufferFromStaticDataTranslator::translate):
        (WTF::AtomicStringImpl::addLiteral):
        (WTF::addSymbol):
        (WTF::addStatic):
        (WTF::AtomicStringImpl::addSlowCase):
        (WTF::AtomicStringImpl::lookUp):
        (WTF::CharBufferFromLiteralDataTranslator::hash): Deleted.
        (WTF::CharBufferFromLiteralDataTranslator::equal): Deleted.
        (WTF::CharBufferFromLiteralDataTranslator::translate): Deleted.
        (WTF::addSubstring): Deleted.
        * wtf/text/StringImpl.h:

2017-07-14  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Use std::unique_ptr for StackTrace
        https://bugs.webkit.org/show_bug.cgi?id=174495

        Reviewed by Alex Christensen.

        Instead of returning pointer to heap allocated StackTrace,
        we should return std::unique_ptr<StackTrace>.
        And we also move WTFGetBackTrace from Assertions.cpp to
        StackTrace.cpp to consolidate stack trace related operations
        into StackTrace.cpp.

        * wtf/Assertions.cpp:
        * wtf/StackTrace.cpp:
        (WTFGetBacktrace):
        (WTF::StackTrace::captureStackTrace):
        * wtf/StackTrace.h:

2017-07-13  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, annotate inline for operator==/!= for FastAllocator
        https://bugs.webkit.org/show_bug.cgi?id=174366

        * wtf/FastMalloc.h:
        (WTF::operator==):
        (WTF::operator!=):

2017-07-12  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r219176.
        https://bugs.webkit.org/show_bug.cgi?id=174436

        "Can cause infinite recursion on iOS" (Requested by mlam on
        #webkit).

        Reverted changeset:

        "WTF::Thread should have the threads stack bounds."
        https://bugs.webkit.org/show_bug.cgi?id=173975
        http://trac.webkit.org/changeset/219176

2017-07-12  Adrian Perez de Castro  <aperez@igalia.com>

        [WTF] Failure to build when the compiler specifically targets ARMv8-A / defines __ARM_ARCH_8A__
        https://bugs.webkit.org/show_bug.cgi?id=174425

        Reviewed by Michael Catanzaro.

        * wtf/Platform.h: Also check for __ARCH_ARM_8A__ to detect ARMv8.

2017-07-12  Michael Saboff  <msaboff@apple.com>

        Unreviewed build fix when both DATA_LOG_TO_FILE and DATA_LOG_FILENAME are defined.

        * wtf/DataLog.cpp:
        (WTF::initializeLogFileOnce): Changed declaration of logBasename from
        char* logBasename to const char* logBasename.

2017-07-12  Matt Lewis  <jlewis3@apple.com>

        Unreviewed, rolling out r219401.

        This revision rolled out the previous patch, but after talking
        with reviewer, a rebaseline is what was needed.Rolling back in
        before rebaseline.

        Reverted changeset:

        "Unreviewed, rolling out r219379."
        https://bugs.webkit.org/show_bug.cgi?id=174400
        http://trac.webkit.org/changeset/219401

2017-07-12  Matt Lewis  <jlewis3@apple.com>

        Unreviewed, rolling out r219379.

        This revision caused a consistent failure in the test
        fast/dom/Window/property-access-on-cached-window-after-frame-
        removed.html.

        Reverted changeset:

        "Remove NAVIGATOR_HWCONCURRENCY"
        https://bugs.webkit.org/show_bug.cgi?id=174400
        http://trac.webkit.org/changeset/219379

2017-07-12  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, attempt to fix Windows build
        https://bugs.webkit.org/show_bug.cgi?id=174366

        * wtf/FastMalloc.h:
        (WTF::operator==):
        (WTF::operator!=):
        (WTF::FastAllocator::operator==): Deleted.
        (WTF::FastAllocator::operator!=): Deleted.

2017-07-11  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK][WPE] Enable FILE_LOCK and implement lockFile and unlockFile
        https://bugs.webkit.org/show_bug.cgi?id=174357

        Reviewed by Michael Catanzaro.

        * wtf/Platform.h: Enable FILE_LOCK in GTK and WPE ports.

2017-07-11  Dean Jackson  <dino@apple.com>

        Remove NAVIGATOR_HWCONCURRENCY
        https://bugs.webkit.org/show_bug.cgi?id=174400

        Reviewed by Sam Weinig.

        * wtf/FeatureDefines.h:

2017-07-11  Dean Jackson  <dino@apple.com>

        Rolling out r219372.

        * wtf/FeatureDefines.h:

2017-07-11  Dean Jackson  <dino@apple.com>

        Remove NAVIGATOR_HWCONCURRENCY
        https://bugs.webkit.org/show_bug.cgi?id=174400

        Reviewed by Sam Weinig.

        * wtf/FeatureDefines.h:

2017-07-11  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Drop unnecessary AtomicString constructor since we have constexpr hash function
        https://bugs.webkit.org/show_bug.cgi?id=174347

        Reviewed by Alex Christensen.

        Previously, we calculate hash value in perl script and generate source code with that value.
        This AtomicString constructor takes this pre-calculated hash value to efficiently construct
        itself. But now, we have constexpr hash function, then we do not need to specify hash value
        directly in this way. Thus we drop this functionality.

        * wtf/text/AtomicString.h:
        * wtf/text/AtomicStringImpl.cpp:
        (WTF::HashAndCharactersTranslator::hash): Deleted.
        (WTF::HashAndCharactersTranslator::equal): Deleted.
        (WTF::HashAndCharactersTranslator::translate): Deleted.
        * wtf/text/AtomicStringImpl.h:
        (WTF::AtomicStringImpl::add):

2017-07-10  Per Arne Vollan  <pvollan@apple.com>

        [Win] Link error when building WTF from WTF.proj project file.
        https://bugs.webkit.org/show_bug.cgi?id=174316
        <rdar://problem/33178200>

        Reviewed by Brent Fulgham.

        WTF_CPU_X86 cmake variable needs to be set for link libraries directories to be correct.

        * WTF.vcxproj/WTF.proj:

2017-07-03  Brian Burg  <bburg@apple.com>

        Web Replay: remove some unused code
        https://bugs.webkit.org/show_bug.cgi?id=173903

        Rubber-stamped by Joseph Pecoraro.

        * wtf/FeatureDefines.h:

2017-07-10  Brady Eidson  <beidson@apple.com>

        Cleanup lifetime issues of UniqueIDBDatabase and IDBBackingStore.
        <rdar://problem/32908525> and https://bugs.webkit.org/show_bug.cgi?id=174244

        Reviewed by David Kilzer and Alex Christensen. 

        Add proper "kill" support to CrossThreadQueue, as well as isEmpty() support.

        * wtf/CrossThreadQueue.h:
        (WTF::CrossThreadQueue<DataType>::append):
        (WTF::CrossThreadQueue<DataType>::kill):
        (WTF::CrossThreadQueue<DataType>::isKilled):
        (WTF::CrossThreadQueue<DataType>::isEmpty):
        (WTF::CrossThreadQueue::isKilled): Deleted.

2017-07-09  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Use fastMalloc / fastFree for STL containers
        https://bugs.webkit.org/show_bug.cgi?id=174297

        Reviewed by Sam Weinig.

        * wtf/FastMalloc.h:
        (WTF::FastAllocator::FastAllocator):
        (WTF::FastAllocator::allocate):
        (WTF::FastAllocator::deallocate):
        (WTF::FastAllocator::operator==):
        (WTF::FastAllocator::operator!=):

2017-07-07  Brent Fulgham  <bfulgham@apple.com>

        [WK2] Use a rolling 30-day uptime for processing statistics
        https://bugs.webkit.org/show_bug.cgi?id=174235
        <rdar://problem/33164381>

        Reviewed by Chris Dumez.

        Modify Deque to allow it to be used in a template specialization in KeyedDecoder.

        * wtf/Deque.h:

2017-07-07  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r219238, r219239, and r219241.
        https://bugs.webkit.org/show_bug.cgi?id=174265

        "fast/workers/dedicated-worker-lifecycle.html is flaky"
        (Requested by yusukesuzuki on #webkit).

        Reverted changesets:

        "[WTF] Implement WTF::ThreadGroup"
        https://bugs.webkit.org/show_bug.cgi?id=174081
        http://trac.webkit.org/changeset/219238

        "Unreviewed, build fix after r219238"
        https://bugs.webkit.org/show_bug.cgi?id=174081
        http://trac.webkit.org/changeset/219239

        "Unreviewed, CLoop build fix after r219238"
        https://bugs.webkit.org/show_bug.cgi?id=174081
        http://trac.webkit.org/changeset/219241

2017-07-07  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, Windows build fix after r219233 part 4
        https://bugs.webkit.org/show_bug.cgi?id=174231

        * wtf/Assertions.h:

2017-07-06  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, Windows build fix after r219233 part 3
        https://bugs.webkit.org/show_bug.cgi?id=174231

        * wtf/Assertions.h:
        (compilerFenceForCrash):

2017-07-06  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, Windows build fix after r219233 part 2
        https://bugs.webkit.org/show_bug.cgi?id=174231

        * wtf/Assertions.h:

2017-07-06  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, Windows build fix after r219233
        https://bugs.webkit.org/show_bug.cgi?id=174231

        * wtf/Compiler.h:

2017-07-06  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, build fix after r219238
        https://bugs.webkit.org/show_bug.cgi?id=174081

        * wtf/Threading.cpp:
        (WTF::Thread::addToThreadGroup):

2017-07-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Implement WTF::ThreadGroup
        https://bugs.webkit.org/show_bug.cgi?id=174081

        Reviewed by Mark Lam.

        This patch implements WTF::ThreadGroup. It implements core of JSC::MachineThreads with more reliable way.
        JSC::MachineThreads was complicated because of managing dead threads. Each JSC::MachineThreads has its
        own TLS with a registered destructor. And everytime a thread dies, the registered TLS destructor is called.
        And this destructor will remove the current dying thread from JSC::MachineThreads.

        However the above implementation is tricky. And each JSC::MachineThreads requires own TLS space, which is
        not considered in WTF's Windows ThreadSpecific implementation. Current design works well since we only
        have small number of MachineThreads right now.

        Instead, we use more reliable way. After introducing WTF::Thread, WTF::Thread has WTF::Thread::didExit,
        which is called when associated TLS (with WTF::Thread) is destroyed. We leverage this mechanism to remove
        WTF::Thread from MachineThreads.

        This patch introduces WTF::ThreadGroup. It is tightly integrated with WTF::Thread: WTF::Thread knows
        ThreadGroups which includes this thread. And WTF::ThreadGroup of course knows WTF::Threads added to it.
        WTF::Thread::didExit carefully remove itself from WTF::ThreadGroups.

        The most important part of this patch is locking. WTF::Thread can die. And WTF::ThreadGroup can die.
        If we take a design using two fine grain locks in WTF::Thread and WTF::ThreadGroup, we easily encounter
        dead lock. Consider the following case.

        1. When adding WTF::Thread (TH) to WTF::ThreadGroup (THG), we first hold a lock of THG, and hold a lock of TH (locking order is THG -> TH).
        2. When TH dies, TH need to hold a lock of TH to iterate THGs. And we hold a lock of THG to unregister TH from it (locking order is TH -> THG).
        3. When suspending and resuming THs in THG, we first hold a lock of THG. And then, we hold a lock of TH to suspend and resume it (locking order is THG -> TH).
        4. When destroying THG, we need to hold a lock of TH to unregister THG from TH. We can hold a lock of THG before that (locking order is THG -> TH).

        Then, it easily causes dead lock. We cannot swap the locking order of (2) since iterating THG requires a lock of TH.
        To solve this problem, we introduce one global lock ThreadGroup::destructionMutex (GL).

        1. When adding WTF::Thread (TH) to WTF::ThreadGroup (THG), we first hold GL, and hold a lock of THG. Do not hold a
        lock of TH. TH's thread groups information is guarded by GL instead of a lock of TH (locking order is GL -> THG).
        2. When TH dies, TH need to hold GL to iterate THGs. And we hold a lock of THG to unregister TH from it (locking order is GL -> THG).
        3. When suspending and resuming THs in THG, we first hold a lock of THG. And then, we hold a lock of TH to suspend and resume it (locking order is THG -> TH).
        4. When destroying THG, we need to hold GL to unregister THG from TH. We can hold a lock of THG after that (locking order is GL -> THG).

        We still have a lock of THG. By separating GL and THG's lock, we can hold a lock of THG while completely unrelated TH is destructed which takes a lock of GL and unrelated THG.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/AutomaticThread.cpp:
        * wtf/CMakeLists.txt:
        * wtf/CrossThreadCopier.h:
        * wtf/ParkingLot.h:
        * wtf/ThreadGroup.cpp: Copied from Source/JavaScriptCore/wasm/WasmMachineThreads.cpp.
        (WTF::ThreadGroup::destructionMutex):
        (WTF::ThreadGroup::~ThreadGroup):
        (WTF::ThreadGroup::add):
        (WTF::ThreadGroup::addCurrentThread):
        (WTF::ThreadGroup::removeCurrentThread):
        * wtf/ThreadGroup.h: Copied from Source/JavaScriptCore/wasm/WasmMachineThreads.cpp.
        (WTF::ThreadGroup::create):
        (WTF::ThreadGroup::threads):
        (WTF::ThreadGroup::getLock):
        * wtf/Threading.cpp:
        (WTF::Thread::didExit):
        (WTF::Thread::addToThreadGroup):
        (WTF::Thread::removeFromThreadGroup):
        * wtf/Threading.h:
        (WTF::Thread::canAddToThreadGroup):

2017-07-06  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Clean up StringStatics.cpp by using LazyNeverDestroyed<> for Atoms
        https://bugs.webkit.org/show_bug.cgi?id=174150

        Reviewed by Mark Lam.

        This patch cleans up StringStatics.cpp and remove it from the tree.

        1. Move StringImpl methods to appropriate place, "StringImpl.cpp".

        StringImpl::hashSlowCase() and StringImpl::concurrentHash() are defined in
        StringStatics.cpp. But they should be defined in StringImpl.cpp.
        This patch just moves them to StringImpl.cpp.

        2. Use LazyNeverDestroyed to initialize AtomicString atoms like emptyAtom.

        Previously, we initialized AtomicString atoms like emptyAtom in a hacky way.
        We first define them as extern global variables. However, AtomicString has
        a non-trivial constructor. Thus, we cannot do this because it requires global
        constructor calls. This is why we have StringStatics.cpp. In this file, we
        include "StaticConstructors.h". After including this file, all the global
        constructor call disabled in Windows. And in GCC environment, we allocate
        void* storage for that variable. And we use placement new in AtomicString::init()
        to initialize these storage.
        However, we already have better way for that: LazyNeverDestroyed. It just allocates
        storage like the above. And it does not have any global constructors. Thus
        we can just declare it as a global variable. And we initialize them lazily in
        AtomicString::init(). This way effectively avoids "StaticConstructors.h" hacky way.
        And it makes "StringStatics.cpp" unnecessary.
        Then, we just move these variables and AtomicString::init() to AtomicString.cpp.

        And we also change emptyAtom to emptyAtom() to get the value from LazyNeverDestroyed<>.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/text/AtomicString.cpp:
        (WTF::AtomicString::convertASCIICase):
        (WTF::AtomicString::fromUTF8Internal):
        (WTF::AtomicString::init):
        * wtf/text/AtomicString.h:
        (WTF::nullAtom):
        (WTF::emptyAtom):
        (WTF::starAtom):
        (WTF::xmlAtom):
        (WTF::xmlnsAtom):
        (WTF::AtomicString::fromUTF8):
        * wtf/text/StringBuilder.h:
        (WTF::StringBuilder::toAtomicString):
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::hashSlowCase):
        (WTF::StringImpl::concurrentHash):
        * wtf/text/StringStatics.cpp: Removed.

2017-07-06  Keith Miller  <keith_miller@apple.com>

        Add extra insurance to prevent clang from making crash traces sad
        https://bugs.webkit.org/show_bug.cgi?id=174231

        Reviewed by Saam Barati.

        This patch makes it slightly harder for Clang to coalesce our crash calls.
        Additionally, it also makes Clang never tail call the WTFCrashWithInfo so
        our stack trace should always be "reasonable".

        * wtf/Assertions.h:
        * wtf/Compiler.h:

2017-07-06  Matt Lewis  <jlewis3@apple.com>

        Unreviewed, rolling out r219178.

        This caused a consistent failure with the API test
        StringBuilderTest.ToAtomicStringOnEmpty on all Debug testers.

        Reverted changeset:

        "[WTF] Clean up StringStatics.cpp by using
        LazyNeverDestroyed<> for Atoms"
        https://bugs.webkit.org/show_bug.cgi?id=174150
        http://trac.webkit.org/changeset/219178

2017-07-05  Don Olmstead  <don.olmstead@sony.com>

        [WTF] Move SoftLinking.h into WTF
        https://bugs.webkit.org/show_bug.cgi?id=174000

        Reviewed by Alex Christensen.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/SoftLinking.h: Copied from Source/WebCore/platform/ios/QuickLookSoftLink.mm.
        * wtf/cocoa/SoftLinking.h: Renamed from Source/WebCore/platform/cocoa/SoftLinking.h.
        * wtf/win/SoftLinking.h: Renamed from Source/WebCore/platform/win/SoftLinking.h.

2017-07-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        Upgrade GCC baseline
        https://bugs.webkit.org/show_bug.cgi?id=174155

        Reviewed by Michael Catanzaro.

        * wtf/Compiler.h:

2017-07-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        WTF::StringImpl::copyChars segfaults when built with GCC 7
        https://bugs.webkit.org/show_bug.cgi?id=173407

        Reviewed by Andreas Kling.

        With GCC 7, StringImpl::copyChars() behaves as unexpected.
        This function violates strict aliasing rule.

        This optimization is originally introduced to improve performance
        in SunSpider's string tests in 2008. When running it in my Linux
        box, it no longer causes any observable difference. So, we just
        remove this optimization.

                                        baseline                  patched

        string-base64                7.7544+-0.1761            7.6138+-0.2071          might be 1.0185x faster
        string-fasta                10.5429+-0.2746     ?     10.7500+-0.2669        ? might be 1.0196x slower
        string-tagcloud             14.8588+-0.2828           14.8039+-0.3039
        string-unpack-code          36.1769+-0.4251           35.3397+-0.5398          might be 1.0237x faster
        string-validate-input        8.5182+-0.2206            8.3514+-0.2179          might be 1.0200x faster

        * wtf/text/StringImpl.h:
        (WTF::StringImpl::copyChars):

2017-07-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        Use std::lock_guard instead of std::unique_lock if move semantics and try_lock is not necessary
        https://bugs.webkit.org/show_bug.cgi?id=174148

        Reviewed by Mark Lam.

        It is not necessary to use std::unique_lock if we do not use additional features compared to std::lock_guard.

        (WTF::ThreadHolder::get):
        (WTF::ThreadHolder::initialize):
        (WTF::ThreadHolder::destruct):
        * wtf/Threading.cpp:
        (WTF::Thread::didExit):
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::changePriority):
        (WTF::Thread::waitForCompletion):
        (WTF::Thread::detach):
        (WTF::Thread::signal):
        (WTF::Thread::resume):
        (WTF::Thread::getRegisters):
        (WTF::Thread::establish):
        * wtf/ThreadingWin.cpp:
        (WTF::Thread::changePriority):
        (WTF::Thread::waitForCompletion):
        (WTF::Thread::detach):
        (WTF::Thread::resume):
        (WTF::Thread::getRegisters):
        (WTF::Thread::establish):
        * wtf/WordLock.cpp:
        (WTF::WordLockBase::unlockSlow):

2017-07-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Clean up StringStatics.cpp by using LazyNeverDestroyed<> for Atoms
        https://bugs.webkit.org/show_bug.cgi?id=174150

        Reviewed by Mark Lam.

        This patch cleans up StringStatics.cpp and remove it from the tree.

        1. Move StringImpl methods to appropriate place, "StringImpl.cpp".

        StringImpl::hashSlowCase() and StringImpl::concurrentHash() are defined in
        StringStatics.cpp. But they should be defined in StringImpl.cpp.
        This patch just moves them to StringImpl.cpp.

        2. Use LazyNeverDestroyed to initialize AtomicString atoms like emptyAtom.

        Previously, we initialized AtomicString atoms like emptyAtom in a hacky way.
        We first define them as extern global variables. However, AtomicString has
        a non-trivial constructor. Thus, we cannot do this because it requires global
        constructor calls. This is why we have StringStatics.cpp. In this file, we
        include "StaticConstructors.h". After including this file, all the global
        constructor call disabled in Windows. And in GCC environment, we allocate
        void* storage for that variable. And we use placement new in AtomicString::init()
        to initialize these storage.
        However, we already have better way for that: LazyNeverDestroyed. It just allocates
        storage like the above. And it does not have any global constructors. Thus
        we can just declare it as a global variable. And we initialize them lazily in
        AtomicString::init(). This way effectively avoids "StaticConstructors.h" hacky way.
        And it makes "StringStatics.cpp" unnecessary.
        Then, we just move these variables and AtomicString::init() to AtomicString.cpp.

        And we also change emptyAtom to emptyAtom() to get the value from LazyNeverDestroyed<>.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/text/AtomicString.cpp:
        (WTF::AtomicString::convertASCIICase):
        (WTF::AtomicString::fromUTF8Internal):
        (WTF::AtomicString::init):
        * wtf/text/AtomicString.h:
        (WTF::nullAtom):
        (WTF::emptyAtom):
        (WTF::starAtom):
        (WTF::xmlAtom):
        (WTF::xmlnsAtom):
        (WTF::AtomicString::fromUTF8):
        * wtf/text/StringBuilder.h:
        (WTF::StringBuilder::toAtomicString):
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::hashSlowCase):
        (WTF::StringImpl::concurrentHash):
        * wtf/text/StringStatics.cpp: Removed.

2017-07-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        WTF::Thread should have the threads stack bounds.
        https://bugs.webkit.org/show_bug.cgi?id=173975

        Reviewed by Keith Miller.

        We move StackBounds from WTFThreadData to WTF::Thread.
        One important thing is that we should make valid StackBounds
        visible to Thread::create() caller. When the caller get
        WTF::Thread from Thread::create(), this WTF::Thread should
        have a valid StackBounds. But StackBounds information can be
        retrived only in the WTF::Thread's thread itself.

        We also clean up WTF::initializeThreading. StringImpl::empty()
        is now statically initialized by using constexpr constructor.
        Thus we do not need to call StringImpl::empty() explicitly here.
        And WTF::initializeThreading() does not have any main thread
        affinity right now in all the platforms. So we fix the comment
        in Threading.h. Then, now, WTF::initializeThreading() is called
        in UI thread when using Web thread in iOS.

        * wtf/StackBounds.h:
        (WTF::StackBounds::emptyBounds):
        (WTF::StackBounds::StackBounds):
        * wtf/StackStats.cpp:
        (WTF::StackStats::PerThreadStats::PerThreadStats):
        * wtf/Threading.cpp:
        (WTF::threadEntryPoint):
        (WTF::Thread::create):
        (WTF::Thread::currentMayBeNull):
        (WTF::Thread::initialize):
        (WTF::initializeThreading):
        * wtf/Threading.h:
        (WTF::Thread::stack):
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::initializeCurrentThreadEvenIfNonWTFCreated):
        (WTF::Thread::current):
        (WTF::initializeCurrentThreadEvenIfNonWTFCreated): Deleted.
        (WTF::Thread::currentMayBeNull): Deleted.
        * wtf/ThreadingWin.cpp:
        (WTF::Thread::initializeCurrentThreadEvenIfNonWTFCreated):
        (WTF::Thread::initializeCurrentThreadInternal):
        (WTF::Thread::current):
        * wtf/WTFThreadData.cpp:
        (WTF::WTFThreadData::WTFThreadData):
        * wtf/WTFThreadData.h:
        (WTF::WTFThreadData::stack): Deleted.

2017-07-05  Keith Miller  <keith_miller@apple.com>

        Crashing with information should have an abort reason
        https://bugs.webkit.org/show_bug.cgi?id=174185

        Reviewed by Saam Barati.

        Fix an ifdef to actually work with X86_64. It turns out X64_64 is
        not an architecture... Whoops.

        * wtf/Assertions.cpp:

2017-07-03  Myles C. Maxfield  <mmaxfield@apple.com>

        Remove copy of ICU headers from WebKit
        https://bugs.webkit.org/show_bug.cgi?id=116407

        Reviewed by Alex Christensen.

        Add an extra rsync command to CopyWTFHeaders which copies the ICU headers
        to DSTROOT/usr/local/include/. These headers already live inside a
        "unicode" folder, so an example path of a header is
        DSTROOT/usr/local/include/unicode/uchar.h. This is already in the search
        path of the other WebKit projects, so those other projects can remove
        their explicit listing of the old place these headers lived.

        Also add the remaining ICU 55.1 headers which the other projects (like
        WebCore) need. Revert any local changes to these headers in favor of
        using the GCC_PREPROCESSOR_DEFINITIONS build setting. This is so we can
        compile the same way against unmodified headers.

        * Configurations/Base.xcconfig:
        * Configurations/CopyWTFHeaders.xcconfig:
        * WTF.xcodeproj/project.pbxproj:
        * icu/unicode/alphaindex.h: Added.
        * icu/unicode/appendable.h: Added.
        * icu/unicode/basictz.h: Added.
        * icu/unicode/brkiter.h: Added.
        (BreakIterator::isBufferClone):
        * icu/unicode/bytestrie.h: Added.
        * icu/unicode/bytestriebuilder.h: Added.
        * icu/unicode/calendar.h: Added.
        (Calendar::createInstance):
        (Calendar::roll):
        (Calendar::internalSet):
        (Calendar::weekNumber):
        * icu/unicode/caniter.h: Added.
        * icu/unicode/chariter.h: Renamed from Source/WebCore/icu/unicode/chariter.h.
        * icu/unicode/choicfmt.h: Added.
        * icu/unicode/coleitr.h: Added.
        (CollationElementIterator::primaryOrder):
        (CollationElementIterator::secondaryOrder):
        (CollationElementIterator::tertiaryOrder):
        (CollationElementIterator::isIgnorable):
        * icu/unicode/coll.h: Added.
        * icu/unicode/compactdecimalformat.h: Added.
        * icu/unicode/curramt.h: Added.
        (CurrencyAmount::getCurrency):
        (CurrencyAmount::getISOCurrency):
        * icu/unicode/currpinf.h: Added.
        (CurrencyPluralInfo::operator!=):
        * icu/unicode/currunit.h: Added.
        (CurrencyUnit::getISOCurrency):
        * icu/unicode/datefmt.h: Added.
        * icu/unicode/dbbi.h: Added.
        * icu/unicode/dcfmtsym.h: Added.
        (DecimalFormatSymbols::getSymbol):
        (DecimalFormatSymbols::getConstSymbol):
        (DecimalFormatSymbols::setSymbol):
        (DecimalFormatSymbols::getLocale):
        (DecimalFormatSymbols::getCurrencyPattern):
        * icu/unicode/decimfmt.h: Added.
        (DecimalFormat::getConstSymbol):
        * icu/unicode/docmain.h: Added.
        * icu/unicode/dtfmtsym.h: Added.
        * icu/unicode/dtintrv.h: Added.
        (DateInterval::getFromDate):
        (DateInterval::getToDate):
        (DateInterval::operator!=):
        * icu/unicode/dtitvfmt.h: Added.
        (DateIntervalFormat::operator!=):
        * icu/unicode/dtitvinf.h: Added.
        (DateIntervalInfo::operator!=):
        * icu/unicode/dtptngen.h: Added.
        * icu/unicode/dtrule.h: Added.
        * icu/unicode/enumset.h: Added.
        (EnumSet::EnumSet):
        (EnumSet::~EnumSet):
        (EnumSet::clear):
        (EnumSet::add):
        (EnumSet::remove):
        (EnumSet::contains):
        (EnumSet::set):
        (EnumSet::get):
        (EnumSet::isValidEnum):
        (EnumSet::isValidValue):
        (EnumSet::operator=):
        (EnumSet::getAll):
        (EnumSet::flag):
        * icu/unicode/errorcode.h: Added.
        * icu/unicode/fieldpos.h: Added.
        (FieldPosition::operator=):
        (FieldPosition::operator==):
        (FieldPosition::operator!=):
        * icu/unicode/filteredbrk.h: Added.
        * icu/unicode/fmtable.h: Added.
        (Formattable::getDate):
        (Formattable::getString):
        (Formattable::getLong):
        (Formattable::toUFormattable):
        (Formattable::fromUFormattable):
        * icu/unicode/format.h: Added.
        * icu/unicode/fpositer.h: Added.
        * icu/unicode/gender.h: Added.
        * icu/unicode/gregocal.h: Added.
        * icu/unicode/icudataver.h: Added.
        * icu/unicode/icuplug.h: Added.
        * icu/unicode/idna.h: Added.
        * icu/unicode/listformatter.h: Added.
        (ListFormatData::ListFormatData):
        * icu/unicode/locdspnm.h: Added.
        (LocaleDisplayNames::createInstance):
        * icu/unicode/locid.h: Added.
        (Locale::operator!=):
        (Locale::getCountry):
        (Locale::getLanguage):
        (Locale::getScript):
        (Locale::getVariant):
        (Locale::getName):
        (Locale::isBogus):
        * icu/unicode/measfmt.h: Added.
        * icu/unicode/measunit.h: Added.
        * icu/unicode/measure.h: Added.
        (Measure::getNumber):
        (Measure::getUnit):
        * icu/unicode/messagepattern.h: Added.
        * icu/unicode/msgfmt.h: Added.
        * icu/unicode/normalizer2.h: Added.
        * icu/unicode/normlzr.h: Added.
        (Normalizer::operator!= ):
        (Normalizer::quickCheck):
        (Normalizer::isNormalized):
        (Normalizer::compare):
        * icu/unicode/numfmt.h: Added.
        (NumberFormat::isParseIntegerOnly):
        (NumberFormat::isLenient):
        * icu/unicode/numsys.h: Added.
        * icu/unicode/parsepos.h: Added.
        (ParsePosition::operator=):
        (ParsePosition::operator==):
        (ParsePosition::operator!=):
        (ParsePosition::getIndex):
        (ParsePosition::setIndex):
        (ParsePosition::getErrorIndex):
        (ParsePosition::setErrorIndex):
        * icu/unicode/plurfmt.h: Added.
        * icu/unicode/plurrule.h: Added.
        * icu/unicode/rbbi.h: Added.
        (RuleBasedBreakIterator::operator!=):
        * icu/unicode/rbnf.h: Added.
        (RuleBasedNumberFormat::isLenient):
        (RuleBasedNumberFormat::getDefaultRuleSet):
        * icu/unicode/rbtz.h: Added.
        * icu/unicode/regex.h: Added.
        * icu/unicode/region.h: Added.
        * icu/unicode/reldatefmt.h: Added.
        * icu/unicode/resbund.h: Added.
        * icu/unicode/schriter.h: Added.
        * icu/unicode/scientificnumberformatter.h: Added.
        * icu/unicode/search.h: Added.
        (SearchIterator::operator!=):
        * icu/unicode/selfmt.h: Added.
        * icu/unicode/simpletz.h: Added.
        (SimpleTimeZone::setStartRule):
        (SimpleTimeZone::setEndRule):
        (SimpleTimeZone::getOffset):
        * icu/unicode/smpdtfmt.h: Added.
        (SimpleDateFormat::get2DigitYearStart):
        * icu/unicode/sortkey.h: Added.
        (CollationKey::operator!=):
        (CollationKey::isBogus):
        (CollationKey::getByteArray):
        * icu/unicode/stringtriebuilder.h: Added.
        * icu/unicode/stsearch.h: Added.
        * icu/unicode/symtable.h: Added.
        * icu/unicode/tblcoll.h: Added.
        * icu/unicode/timezone.h: Added.
        (TimeZone::getID):
        (TimeZone::setID):
        * icu/unicode/tmunit.h: Added.
        * icu/unicode/tmutamt.h: Added.
        (TimeUnitAmount::operator!=):
        * icu/unicode/tmutfmt.h: Added.
        (TimeUnitFormat::operator!=):
        * icu/unicode/translit.h: Added.
        (Transliterator::getMaximumContextLength):
        (Transliterator::setID):
        (Transliterator::integerToken):
        (Transliterator::pointerToken):
        * icu/unicode/tzfmt.h: Added.
        * icu/unicode/tznames.h: Added.
        * icu/unicode/tzrule.h: Added.
        * icu/unicode/tztrans.h: Added.
        * icu/unicode/ubidi.h: Added.
        * icu/unicode/ucal.h: Renamed from Source/JavaScriptCore/icu/unicode/ucal.h.
        * icu/unicode/ucasemap.h: Added.
        * icu/unicode/ucat.h: Added.
        * icu/unicode/ucharstrie.h: Added.
        * icu/unicode/ucharstriebuilder.h: Added.
        * icu/unicode/uchriter.h: Added.
        * icu/unicode/uclean.h: Added.
        * icu/unicode/ucnv_cb.h: Renamed from Source/WebCore/icu/unicode/ucnv_cb.h.
        * icu/unicode/ucnvsel.h: Added.
        * icu/unicode/ucoleitr.h: Renamed from Source/WebCore/icu/unicode/ucoleitr.h.
        * icu/unicode/uconfig.h:
        * icu/unicode/ucsdet.h: Renamed from Source/WebCore/icu/unicode/ucsdet.h.
        * icu/unicode/udat.h: Renamed from Source/JavaScriptCore/icu/unicode/udat.h.
        * icu/unicode/udata.h: Added.
        * icu/unicode/udateintervalformat.h: Added.
        * icu/unicode/udatpg.h: Renamed from Source/JavaScriptCore/icu/unicode/udatpg.h.
        * icu/unicode/udisplaycontext.h: Renamed from Source/JavaScriptCore/icu/unicode/udisplaycontext.h.
        * icu/unicode/ufieldpositer.h: Renamed from Source/JavaScriptCore/icu/unicode/ufieldpositer.h.
        * icu/unicode/uformattable.h: Renamed from Source/JavaScriptCore/icu/unicode/uformattable.h.
        * icu/unicode/ugender.h: Added.
        * icu/unicode/uidna.h: Renamed from Source/WebCore/icu/unicode/uidna.h.
        * icu/unicode/uldnames.h: Added.
        * icu/unicode/ulistformatter.h: Added.
        * icu/unicode/ulocdata.h: Added.
        * icu/unicode/umisc.h: Renamed from Source/JavaScriptCore/icu/unicode/umisc.h.
        * icu/unicode/umsg.h: Added.
        * icu/unicode/unifilt.h: Added.
        * icu/unicode/unifunct.h: Added.
        * icu/unicode/unimatch.h: Added.
        * icu/unicode/unirepl.h: Added.
        * icu/unicode/uniset.h: Added.
        (UnicodeSet::operator!=):
        (UnicodeSet::isFrozen):
        (UnicodeSet::containsSome):
        (UnicodeSet::isBogus):
        (UnicodeSet::fromUSet):
        (UnicodeSet::toUSet):
        (UnicodeSet::span):
        (UnicodeSet::spanBack):
        * icu/unicode/unum.h: Renamed from Source/JavaScriptCore/icu/unicode/unum.h.
        * icu/unicode/unumsys.h: Renamed from Source/JavaScriptCore/icu/unicode/unumsys.h.
        * icu/unicode/upluralrules.h: Added.
        * icu/unicode/uregex.h: Added.
        * icu/unicode/uregion.h: Added.
        * icu/unicode/urep.h: Added.
        * icu/unicode/ures.h: Added.
        (ures_getUnicodeString):
        (ures_getNextUnicodeString):
        (ures_getUnicodeStringByIndex):
        (ures_getUnicodeStringByKey):
        * icu/unicode/usearch.h: Renamed from Source/WebCore/icu/unicode/usearch.h.
        * icu/unicode/usetiter.h: Added.
        (UnicodeSetIterator::isString):
        (UnicodeSetIterator::getCodepoint):
        (UnicodeSetIterator::getCodepointEnd):
        * icu/unicode/ushape.h: Renamed from Source/WebCore/icu/unicode/ushape.h.
        * icu/unicode/uspoof.h: Added.
        * icu/unicode/usprep.h: Added.
        * icu/unicode/ustdio.h: Added.
        * icu/unicode/ustream.h: Added.
        * icu/unicode/ustringtrie.h: Added.
        * icu/unicode/utf32.h: Added.
        * icu/unicode/utmscale.h: Added.
        * icu/unicode/utrace.h: Added.
        * icu/unicode/utrans.h: Added.
        * icu/unicode/utypes.h:
        * icu/unicode/vtzone.h: Added.

2017-07-04  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Make double-conversion's cache data constant and drop double_conversion::initialize()
        https://bugs.webkit.org/show_bug.cgi?id=174124

        Reviewed by Saam Barati.

        We annotate double-conversion's cache data as const and constexpr. And move it out of function.
        Since they are not involving global constructors, they are compiled as rodata and initialized
        without calling double_conversion::initialize().

        And we drop double_conversion::initialize() function since it is no longer necessary.

        * wtf/Threading.cpp:
        (WTF::initializeThreading):
        * wtf/dtoa/cached-powers.cc:
        * wtf/dtoa/cached-powers.h:

2017-07-04  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Initialize srandom and srand with cryptographically random number
        https://bugs.webkit.org/show_bug.cgi?id=174123

        Reviewed by Mark Lam.

        Use cryptographically random number instead of current time as a seed.

        * wtf/RandomNumberSeed.h:
        (WTF::initializeRandomNumberGenerator):

2017-07-04  Joseph Pecoraro  <pecoraro@apple.com>

        Xcode duplicate UUID for DisallowCType.h and DispatchPtr.h
        https://bugs.webkit.org/show_bug.cgi?id=174117

        Reviewed by Alexey Proskuryakov.

        * WTF.xcodeproj/project.pbxproj:
        Give DisallowCType.h and DispatchPtr.h different UUIDs.

2017-07-03  Saam Barati  <sbarati@apple.com>

        LayoutTest workers/bomb.html is a Crash
        https://bugs.webkit.org/show_bug.cgi?id=167757
        <rdar://problem/33086462>

        Reviewed by Keith Miller.

        * wtf/AutomaticThread.cpp:
        (WTF::AutomaticThreadCondition::waitFor):
        * wtf/AutomaticThread.h:

2017-07-03  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r219060.
        https://bugs.webkit.org/show_bug.cgi?id=174108

        crashing constantly when initializing UIWebView (Requested by
        thorton on #webkit).

        Reverted changeset:

        "WTF::Thread should have the threads stack bounds."
        https://bugs.webkit.org/show_bug.cgi?id=173975
        http://trac.webkit.org/changeset/219060

2017-07-03  Matt Lewis  <jlewis3@apple.com>

        Unreviewed, rolling out r219103.

        Caused multiple build failures.

        Reverted changeset:

        "Remove copy of ICU headers from WebKit"
        https://bugs.webkit.org/show_bug.cgi?id=116407
        http://trac.webkit.org/changeset/219103

2017-07-03  Myles C. Maxfield  <mmaxfield@apple.com>

        Remove copy of ICU headers from WebKit
        https://bugs.webkit.org/show_bug.cgi?id=116407

        Reviewed by Alex Christensen.

        Add an extra rsync command to CopyWTFHeaders which copies the ICU headers
        to DSTROOT/usr/local/include/. These headers already live inside a
        "unicode" folder, so an example path of a header is
        DSTROOT/usr/local/include/unicode/uchar.h. This is already in the search
        path of the other WebKit projects, so those other projects can remove
        their explicit listing of the old place these headers lived.

        Also add the remaining ICU 55.1 headers which the other projects (like
        WebCore) need. Revert any local changes to these headers in favor of
        using the GCC_PREPROCESSOR_DEFINITIONS build setting. This is so we can
        compile the same way against unmodified headers.

        * Configurations/Base.xcconfig:
        * Configurations/CopyWTFHeaders.xcconfig:
        * WTF.xcodeproj/project.pbxproj:
        * icu/unicode/alphaindex.h: Added.
        * icu/unicode/appendable.h: Added.
        * icu/unicode/basictz.h: Added.
        * icu/unicode/brkiter.h: Added.
        (BreakIterator::isBufferClone):
        * icu/unicode/bytestrie.h: Added.
        * icu/unicode/bytestriebuilder.h: Added.
        * icu/unicode/calendar.h: Added.
        (Calendar::createInstance):
        (Calendar::roll):
        (Calendar::internalSet):
        (Calendar::weekNumber):
        * icu/unicode/caniter.h: Added.
        * icu/unicode/chariter.h: Renamed from Source/WebCore/icu/unicode/chariter.h.
        * icu/unicode/choicfmt.h: Added.
        * icu/unicode/coleitr.h: Added.
        (CollationElementIterator::primaryOrder):
        (CollationElementIterator::secondaryOrder):
        (CollationElementIterator::tertiaryOrder):
        (CollationElementIterator::isIgnorable):
        * icu/unicode/coll.h: Added.
        * icu/unicode/compactdecimalformat.h: Added.
        * icu/unicode/curramt.h: Added.
        (CurrencyAmount::getCurrency):
        (CurrencyAmount::getISOCurrency):
        * icu/unicode/currpinf.h: Added.
        (CurrencyPluralInfo::operator!=):
        * icu/unicode/currunit.h: Added.
        (CurrencyUnit::getISOCurrency):
        * icu/unicode/datefmt.h: Added.
        * icu/unicode/dbbi.h: Added.
        * icu/unicode/dcfmtsym.h: Added.
        (DecimalFormatSymbols::getSymbol):
        (DecimalFormatSymbols::getConstSymbol):
        (DecimalFormatSymbols::setSymbol):
        (DecimalFormatSymbols::getLocale):
        (DecimalFormatSymbols::getCurrencyPattern):
        * icu/unicode/decimfmt.h: Added.
        (DecimalFormat::getConstSymbol):
        * icu/unicode/docmain.h: Added.
        * icu/unicode/dtfmtsym.h: Added.
        * icu/unicode/dtintrv.h: Added.
        (DateInterval::getFromDate):
        (DateInterval::getToDate):
        (DateInterval::operator!=):
        * icu/unicode/dtitvfmt.h: Added.
        (DateIntervalFormat::operator!=):
        * icu/unicode/dtitvinf.h: Added.
        (DateIntervalInfo::operator!=):
        * icu/unicode/dtptngen.h: Added.
        * icu/unicode/dtrule.h: Added.
        * icu/unicode/enumset.h: Added.
        (EnumSet::EnumSet):
        (EnumSet::~EnumSet):
        (EnumSet::clear):
        (EnumSet::add):
        (EnumSet::remove):
        (EnumSet::contains):
        (EnumSet::set):
        (EnumSet::get):
        (EnumSet::isValidEnum):
        (EnumSet::isValidValue):
        (EnumSet::operator=):
        (EnumSet::getAll):
        (EnumSet::flag):
        * icu/unicode/errorcode.h: Added.
        * icu/unicode/fieldpos.h: Added.
        (FieldPosition::operator=):
        (FieldPosition::operator==):
        (FieldPosition::operator!=):
        * icu/unicode/filteredbrk.h: Added.
        * icu/unicode/fmtable.h: Added.
        (Formattable::getDate):
        (Formattable::getString):
        (Formattable::getLong):
        (Formattable::toUFormattable):
        (Formattable::fromUFormattable):
        * icu/unicode/format.h: Added.
        * icu/unicode/fpositer.h: Added.
        * icu/unicode/gender.h: Added.
        * icu/unicode/gregocal.h: Added.
        * icu/unicode/icudataver.h: Added.
        * icu/unicode/icuplug.h: Added.
        * icu/unicode/idna.h: Added.
        * icu/unicode/listformatter.h: Added.
        (ListFormatData::ListFormatData):
        * icu/unicode/locdspnm.h: Added.
        (LocaleDisplayNames::createInstance):
        * icu/unicode/locid.h: Added.
        (Locale::operator!=):
        (Locale::getCountry):
        (Locale::getLanguage):
        (Locale::getScript):
        (Locale::getVariant):
        (Locale::getName):
        (Locale::isBogus):
        * icu/unicode/measfmt.h: Added.
        * icu/unicode/measunit.h: Added.
        * icu/unicode/measure.h: Added.
        (Measure::getNumber):
        (Measure::getUnit):
        * icu/unicode/messagepattern.h: Added.
        * icu/unicode/msgfmt.h: Added.
        * icu/unicode/normalizer2.h: Added.
        * icu/unicode/normlzr.h: Added.
        (Normalizer::operator!= ):
        (Normalizer::quickCheck):
        (Normalizer::isNormalized):
        (Normalizer::compare):
        * icu/unicode/numfmt.h: Added.
        (NumberFormat::isParseIntegerOnly):
        (NumberFormat::isLenient):
        * icu/unicode/numsys.h: Added.
        * icu/unicode/parsepos.h: Added.
        (ParsePosition::operator=):
        (ParsePosition::operator==):
        (ParsePosition::operator!=):
        (ParsePosition::getIndex):
        (ParsePosition::setIndex):
        (ParsePosition::getErrorIndex):
        (ParsePosition::setErrorIndex):
        * icu/unicode/plurfmt.h: Added.
        * icu/unicode/plurrule.h: Added.
        * icu/unicode/rbbi.h: Added.
        (RuleBasedBreakIterator::operator!=):
        * icu/unicode/rbnf.h: Added.
        (RuleBasedNumberFormat::isLenient):
        (RuleBasedNumberFormat::getDefaultRuleSet):
        * icu/unicode/rbtz.h: Added.
        * icu/unicode/regex.h: Added.
        * icu/unicode/region.h: Added.
        * icu/unicode/reldatefmt.h: Added.
        * icu/unicode/resbund.h: Added.
        * icu/unicode/schriter.h: Added.
        * icu/unicode/scientificnumberformatter.h: Added.
        * icu/unicode/search.h: Added.
        (SearchIterator::operator!=):
        * icu/unicode/selfmt.h: Added.
        * icu/unicode/simpletz.h: Added.
        (SimpleTimeZone::setStartRule):
        (SimpleTimeZone::setEndRule):
        (SimpleTimeZone::getOffset):
        * icu/unicode/smpdtfmt.h: Added.
        (SimpleDateFormat::get2DigitYearStart):
        * icu/unicode/sortkey.h: Added.
        (CollationKey::operator!=):
        (CollationKey::isBogus):
        (CollationKey::getByteArray):
        * icu/unicode/stringtriebuilder.h: Added.
        * icu/unicode/stsearch.h: Added.
        * icu/unicode/symtable.h: Added.
        * icu/unicode/tblcoll.h: Added.
        * icu/unicode/timezone.h: Added.
        (TimeZone::getID):
        (TimeZone::setID):
        * icu/unicode/tmunit.h: Added.
        * icu/unicode/tmutamt.h: Added.
        (TimeUnitAmount::operator!=):
        * icu/unicode/tmutfmt.h: Added.
        (TimeUnitFormat::operator!=):
        * icu/unicode/translit.h: Added.
        (Transliterator::getMaximumContextLength):
        (Transliterator::setID):
        (Transliterator::integerToken):
        (Transliterator::pointerToken):
        * icu/unicode/tzfmt.h: Added.
        * icu/unicode/tznames.h: Added.
        * icu/unicode/tzrule.h: Added.
        * icu/unicode/tztrans.h: Added.
        * icu/unicode/ubidi.h: Added.
        * icu/unicode/ucal.h: Renamed from Source/JavaScriptCore/icu/unicode/ucal.h.
        * icu/unicode/ucasemap.h: Added.
        * icu/unicode/ucat.h: Added.
        * icu/unicode/ucharstrie.h: Added.
        * icu/unicode/ucharstriebuilder.h: Added.
        * icu/unicode/uchriter.h: Added.
        * icu/unicode/uclean.h: Added.
        * icu/unicode/ucnv_cb.h: Renamed from Source/WebCore/icu/unicode/ucnv_cb.h.
        * icu/unicode/ucnvsel.h: Added.
        * icu/unicode/ucoleitr.h: Renamed from Source/WebCore/icu/unicode/ucoleitr.h.
        * icu/unicode/uconfig.h:
        * icu/unicode/ucsdet.h: Renamed from Source/WebCore/icu/unicode/ucsdet.h.
        * icu/unicode/udat.h: Renamed from Source/JavaScriptCore/icu/unicode/udat.h.
        * icu/unicode/udata.h: Added.
        * icu/unicode/udateintervalformat.h: Added.
        * icu/unicode/udatpg.h: Renamed from Source/JavaScriptCore/icu/unicode/udatpg.h.
        * icu/unicode/udisplaycontext.h: Renamed from Source/JavaScriptCore/icu/unicode/udisplaycontext.h.
        * icu/unicode/ufieldpositer.h: Renamed from Source/JavaScriptCore/icu/unicode/ufieldpositer.h.
        * icu/unicode/uformattable.h: Renamed from Source/JavaScriptCore/icu/unicode/uformattable.h.
        * icu/unicode/ugender.h: Added.
        * icu/unicode/uidna.h: Renamed from Source/WebCore/icu/unicode/uidna.h.
        * icu/unicode/uldnames.h: Added.
        * icu/unicode/ulistformatter.h: Added.
        * icu/unicode/ulocdata.h: Added.
        * icu/unicode/umisc.h: Renamed from Source/JavaScriptCore/icu/unicode/umisc.h.
        * icu/unicode/umsg.h: Added.
        * icu/unicode/unifilt.h: Added.
        * icu/unicode/unifunct.h: Added.
        * icu/unicode/unimatch.h: Added.
        * icu/unicode/unirepl.h: Added.
        * icu/unicode/uniset.h: Added.
        (UnicodeSet::operator!=):
        (UnicodeSet::isFrozen):
        (UnicodeSet::containsSome):
        (UnicodeSet::isBogus):
        (UnicodeSet::fromUSet):
        (UnicodeSet::toUSet):
        (UnicodeSet::span):
        (UnicodeSet::spanBack):
        * icu/unicode/unum.h: Renamed from Source/JavaScriptCore/icu/unicode/unum.h.
        * icu/unicode/unumsys.h: Renamed from Source/JavaScriptCore/icu/unicode/unumsys.h.
        * icu/unicode/upluralrules.h: Added.
        * icu/unicode/uregex.h: Added.
        * icu/unicode/uregion.h: Added.
        * icu/unicode/urep.h: Added.
        * icu/unicode/ures.h: Added.
        (ures_getUnicodeString):
        (ures_getNextUnicodeString):
        (ures_getUnicodeStringByIndex):
        (ures_getUnicodeStringByKey):
        * icu/unicode/usearch.h: Renamed from Source/WebCore/icu/unicode/usearch.h.
        * icu/unicode/usetiter.h: Added.
        (UnicodeSetIterator::isString):
        (UnicodeSetIterator::getCodepoint):
        (UnicodeSetIterator::getCodepointEnd):
        * icu/unicode/ushape.h: Renamed from Source/WebCore/icu/unicode/ushape.h.
        * icu/unicode/usprep.h: Added.
        * icu/unicode/ustdio.h: Added.
        * icu/unicode/ustream.h: Added.
        * icu/unicode/ustringtrie.h: Added.
        * icu/unicode/utf32.h: Added.
        * icu/unicode/utmscale.h: Added.
        * icu/unicode/utrace.h: Added.
        * icu/unicode/utrans.h: Added.
        * icu/unicode/utypes.h:
        * icu/unicode/vtzone.h: Added.

2017-07-03  Keith Miller  <keith_miller@apple.com>

        Fix ifndef in Assertions.h
        https://bugs.webkit.org/show_bug.cgi?id=174104

        Reviewed by Saam Barati.

        The ifndef should have been checking for
        CRASH_WITH_SECURITY_IMPLICATION_AND_INFO since that is what the
        ifndef defines.

        * wtf/Assertions.h:

2017-07-03  Andy Estes  <aestes@apple.com>

        [Xcode] Add an experimental setting to build with ccache
        https://bugs.webkit.org/show_bug.cgi?id=173875

        Reviewed by Tim Horton.

        * Configurations/DebugRelease.xcconfig: Included ccache.xcconfig.

2017-07-03  Daewoong Jang  <daewoong.jang@navercorp.com>

        Remove an unused function export
        https://bugs.webkit.org/show_bug.cgi?id=174084

        Reviewed by Yusuke Suzuki.

        * wtf/Threading.h:

2017-07-02  Yusuke Suzuki  <utatane.tea@gmail.com>

        WTF::Thread should have the threads stack bounds.
        https://bugs.webkit.org/show_bug.cgi?id=173975

        Reviewed by Mark Lam.

        We move StackBounds from WTFThreadData to WTF::Thread.
        One important thing is that we should make valid StackBounds
        visible to Thread::create() caller. When the caller get
        WTF::Thread from Thread::create(), this WTF::Thread should
        have a valid StackBounds. But StackBounds information can be
        retrived only in the WTF::Thread's thread itself.

        * wtf/StackBounds.h:
        (WTF::StackBounds::emptyBounds):
        (WTF::StackBounds::StackBounds):
        * wtf/StackStats.cpp:
        (WTF::StackStats::PerThreadStats::PerThreadStats):
        * wtf/Threading.cpp:
        (WTF::threadEntryPoint):
        (WTF::Thread::create):
        (WTF::Thread::currentMayBeNull):
        (WTF::Thread::initialize):
        * wtf/Threading.h:
        (WTF::Thread::stack):
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::initializeCurrentThreadEvenIfNonWTFCreated):
        (WTF::Thread::current):
        (WTF::initializeCurrentThreadEvenIfNonWTFCreated): Deleted.
        (WTF::Thread::currentMayBeNull): Deleted.
        * wtf/ThreadingWin.cpp:
        (WTF::Thread::initializeCurrentThreadEvenIfNonWTFCreated):
        (WTF::Thread::initializeCurrentThreadInternal):
        (WTF::Thread::current):
        * wtf/WTFThreadData.cpp:
        (WTF::WTFThreadData::WTFThreadData):
        * wtf/WTFThreadData.h:
        (WTF::WTFThreadData::stack): Deleted.

2017-07-01  Dan Bernstein  <mitz@apple.com>

        [iOS] Remove code only needed when building for iOS 9.x
        https://bugs.webkit.org/show_bug.cgi?id=174068

        Reviewed by Tim Horton.

        * wtf/Platform.h:
        * wtf/mac/DeprecatedSymbolsUsedBySafari.mm:
        * wtf/spi/darwin/dyldSPI.h:

2017-07-01  Caio Lima  <ticaiolima@gmail.com>

        [JSC] WTFGetBacktrace can return numberOfFrames == 0 in some architectures
        https://bugs.webkit.org/show_bug.cgi?id=172768

        Reviewed by Mark Lam.

        In some architectures, like ARMv6 running on a Raspberry pi, the
        backtrace function from "execinfo.h" is returning 0. In
        that case, the RELEASE_ASSERT in StackTrace::captureStackTrace
        fails causing a runtime crash.
        This patch is adding a guard for the case described above to
        avoid a runtime crash in such case.

        * wtf/StackTrace.cpp:
        (WTF::StackTrace::captureStackTrace):

2017-07-01  Dan Bernstein  <mitz@apple.com>

        [macOS] Remove code only needed when building for OS X Yosemite
        https://bugs.webkit.org/show_bug.cgi?id=174067

        Reviewed by Tim Horton.

        * Configurations/Base.xcconfig:
        * Configurations/DebugRelease.xcconfig:
        * wtf/Platform.h:
        * wtf/mac/AppKitCompatibilityDeclarations.h:
        * wtf/spi/cocoa/SecuritySPI.h:
        * wtf/text/TextBreakIterator.cpp:

2017-07-01  Joseph Pecoraro  <pecoraro@apple.com>

        Add a warning if WEBGL2 is enabled without WEBGL
        https://bugs.webkit.org/show_bug.cgi?id=174054

        Reviewed by Sam Weinig.

        * wtf/FeatureDefines.h:

2017-06-30  Keith Miller  <keith_miller@apple.com>

        Force crashWithInfo to be out of line.
        https://bugs.webkit.org/show_bug.cgi?id=174028

        Reviewed by Filip Pizlo.

        The first pass at making crashes hold information about why they
        were crashing had the problem that it would inline the assertion.
        This meant that clang could coalesce DFG_ASSERTS with other
        assertion failures in the same function. This patch moves it out
        of line to help fix that issue.

        * wtf/Assertions.cpp:
        (WTFCrashWithInfo):
        * wtf/Assertions.h:
        (WTF::isIntegralType):

2017-06-30  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Drop SymbolRegistry::keyForSymbol
        https://bugs.webkit.org/show_bug.cgi?id=174052

        Reviewed by Sam Weinig.

        Since we can know whether a given symbol is registered by checking RegisteredSymbolImpl,
        we do not need to query key string for a given symbol by using SymbolRegistry::keyForSymbol.

        * wtf/text/SymbolImpl.h:
        (WTF::SymbolImpl::extractFoldedString): Deleted.
        * wtf/text/SymbolRegistry.cpp:
        (WTF::SymbolRegistry::keyForSymbol): Deleted.
        * wtf/text/SymbolRegistry.h:

2017-06-29  Jer Noble  <jer.noble@apple.com>

        Make Legacy EME API controlled by RuntimeEnabled setting.
        https://bugs.webkit.org/show_bug.cgi?id=173994

        Reviewed by Sam Weinig.

        * wtf/FeatureDefines.h:

2017-06-30  Ryosuke Niwa  <rniwa@webkit.org>

        Ran sort-Xcode-project-file.

        * WTF.xcodeproj/project.pbxproj:

2017-06-30  Matt Lewis  <jlewis3@apple.com>

        Unreviewed, rolling out r218992.

        The patch broke the iOS device builds.

        Reverted changeset:

        "DFG_ASSERT should allow stuffing registers before trapping."
        https://bugs.webkit.org/show_bug.cgi?id=174005
        http://trac.webkit.org/changeset/218992

2017-06-30  Keith Miller  <keith_miller@apple.com>

        DFG_ASSERT should allow stuffing registers before trapping.
        https://bugs.webkit.org/show_bug.cgi?id=174005

        Reviewed by Mark Lam.

        Add new template functions that enable stuffing up to five values
        into registers before crashing.

        * wtf/Assertions.h:
        (CRASH_WITH_INFO):

2017-06-28  Brent Fulgham  <bfulgham@apple.com>

        Teach ResourceLoadStatistics to recognize changes in the file system
        https://bugs.webkit.org/show_bug.cgi?id=173800
        <rdar://problem/32937842>

        Reviewed by Chris Dumez.

        * wtf/DispatchPtr.h: Added (moved from WebKit2)
        * wtf/Platform.h: Make sure USE_FILE_LOCK is enabled.

2017-06-28  David Kilzer  <ddkilzer@apple.com>

        Fix typo in comment: WordResult => WorkResult

        * wtf/AutomaticThread.h:

2017-06-27  Caio Lima  <ticaiolima@gmail.com>

        [ESnext] Implement Object Rest - Implementing Object Rest Destructuring
        https://bugs.webkit.org/show_bug.cgi?id=167962

        Reviewed by Saam Barati.

        * wtf/HashSet.h:
        (WTF::=):

2017-06-26  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Drop Thread::create(obsolete things) API since we can use lambda
        https://bugs.webkit.org/show_bug.cgi?id=173825

        Reviewed by Saam Barati.

        Thread::create(ThreadFunction, void* data, const char* name) is a bit old API.
        Since we have C++ lambda, the above API is simply unnecessary. And C++ lambda
        based one is better since the above API needs casting data to and from void*.

        * wtf/Function.h:
        Avoid ambiguity.
        * wtf/ParallelJobsGeneric.cpp:
        (WTF::ParallelEnvironment::ThreadPrivate::tryLockFor):
        (WTF::ParallelEnvironment::ThreadPrivate::workerThread): Deleted.
        * wtf/ParallelJobsGeneric.h:
        * wtf/Threading.cpp:
        * wtf/ThreadingWin.cpp:
        (WTF::createThread):

2017-06-25  Yusuke Suzuki  <utatane.tea@gmail.com>

        initializeThreading() [first] causes WTFCrash due to maxSingleAllocationSize not being initialized
        https://bugs.webkit.org/show_bug.cgi?id=173720

        Reviewed by Mark Lam.

        When using std::numeric_limits<size_t>::max() for global variable's initialization,
        it seems that it invokes static constructor to initialize this in VC++.
        We avoid this edge case by introducing a workaround using SIZE_MAX here.

        When I perform git-grep, there is only one site (this) using std::numeric_limits<>::xxx()
        to initialize global variable.

        * wtf/FastMalloc.cpp:

2017-06-25  Konstantin Tokarev  <annulen@yandex.ru>

        Remove excessive headers from JavaScriptCore
        https://bugs.webkit.org/show_bug.cgi?id=173812

        Reviewed by Darin Adler.

        * wtf/Bag.h:

2017-06-23  Keith Miller  <keith_miller@apple.com>

        Switch VMTraps to use halt instructions rather than breakpoint instructions
        https://bugs.webkit.org/show_bug.cgi?id=173677
        <rdar://problem/32178892>

        Reviewed by JF Bastien.

        Remove the Trap signal handler code since it plays badly with lldb and combine
        SIGBUS with SIGSEGV since distiguishing them is generally non-portable.

        Also, update the platform code to only use signaling VMTraps
        on where we have an appropriate instruction (x86 and ARM64).

        * wtf/Platform.h:
        * wtf/threads/Signals.cpp:
        (WTF::fromMachException):
        (WTF::toMachMask):
        (WTF::installSignalHandler):
        (WTF::jscSignalHandler):
        * wtf/threads/Signals.h:
        (WTF::toSystemSignal):
        (WTF::fromSystemSignal):

2017-06-23  Antti Koivisto  <antti@apple.com>

        Add notifyutil registrations for going in and out of simulated low memory state
        https://bugs.webkit.org/show_bug.cgi?id=173797

        Reviewed by Andreas Kling.

        Add

        notifyutil -p org.WebKit.lowMemory.begin
        notifyutil -p org.WebKit.lowMemory.end

        for debugging.

        * wtf/cocoa/MemoryPressureHandlerCocoa.mm:
        (WTF::MemoryPressureHandler::install):

2017-06-23  Konstantin Tokarev  <annulen@yandex.ru>

        Remove more unused headers from WTF
        https://bugs.webkit.org/show_bug.cgi?id=173761

        Reviewed by Yusuke Suzuki.

        * wtf/Liveness.h:
        * wtf/PageAllocation.h:
        * wtf/ParallelJobs.h:

2017-06-22  Andreas Kling  <akling@apple.com>

        Rename MemoryPressureHandler::setTabCount to setPageCount
        https://bugs.webkit.org/show_bug.cgi?id=173750

        Reviewed by Daniel Bates.

        This function is counting WebCore::Page objects (excluding utility Pages used
        by SVG-as-image and the web inspector) so let's name it appropriately.
        Not all WebKit clients have tabs.

        * wtf/MemoryPressureHandler.cpp:
        (WTF::MemoryPressureHandler::setPageCount):
        (WTF::MemoryPressureHandler::thresholdForMemoryKill):
        (WTF::MemoryPressureHandler::measurementTimerFired):
        (WTF::MemoryPressureHandler::setTabCount): Deleted.
        * wtf/MemoryPressureHandler.h:

2017-06-21  Andreas Kling  <akling@apple.com>

        Increase memory kill limits for WebContent processes that manage multiple tabs.
        https://bugs.webkit.org/show_bug.cgi?id=173674

        Reviewed by Geoffrey Garen.

        When opening <a target=_blank> links, we currently have to use the same WebContent
        process for the new tab, to support scripting the window.opener object.
        This means that some WebContent processes end up hosting multiple tabs, making it
        more likely that those processes will hit the memory limits.

        Address this by adding some additional allowance for multi-tab processes:

            For each additional tab, up to 4 tabs, add 1GB to the memory kill limit.

        * wtf/MemoryPressureHandler.cpp:
        (WTF::thresholdForMemoryKillWithProcessState):
        (WTF::MemoryPressureHandler::setTabCount):
        (WTF::MemoryPressureHandler::thresholdForMemoryKill):
        (WTF::MemoryPressureHandler::measurementTimerFired):
        * wtf/MemoryPressureHandler.h:

2017-06-21  Chris Dumez  <cdumez@apple.com>

        Allow constructing a WTF:Function from a function pointer
        https://bugs.webkit.org/show_bug.cgi?id=173660

        Reviewed by Alex Christensen.

        Allow constructing a WTF:Function from a function pointer and
        assigning a function pointer to a WTF:Function.

        * wtf/Function.h:

2017-06-20  Simon Fraser  <simon.fraser@apple.com>

        Remove WILL_REVEAL_EDGE_EVENTS code
        https://bugs.webkit.org/show_bug.cgi?id=173632

        Reviewed by Sam Weinig, Beth Dakin.

        Remove will-reveal-edge events, which never took off.

        * wtf/FeatureDefines.h:

2017-06-20  Konstantin Tokarev  <annulen@yandex.ru>

        Remove excessive include directives from WTF
        https://bugs.webkit.org/show_bug.cgi?id=173553

        Reviewed by Saam Barati.

        * wtf/AutomaticThread.h:
        * wtf/BagToHashMap.h:
        * wtf/CrossThreadCopier.h:
        * wtf/CrossThreadQueue.h:
        * wtf/DateMath.h:
        * wtf/Expected.h:
        * wtf/HashMap.h:
        * wtf/Indenter.h:
        * wtf/MessageQueue.h:
        * wtf/MetaAllocator.h:
        * wtf/MetaAllocatorHandle.h:
        * wtf/RandomNumberSeed.h:
        * wtf/Ref.h:
        * wtf/RefPtr.h:
        * wtf/RunLoop.h:
        * wtf/SchedulePair.h:
        * wtf/StackStats.h:
        * wtf/SynchronizedFixedQueue.h:
        * wtf/ThreadMessage.h:
        * wtf/Threading.cpp:
        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        * wtf/ThreadingWin.cpp:
        * wtf/WTFThreadData.h:
        * wtf/WorkQueue.h:
        * wtf/glib/GRefPtr.h:
        * wtf/text/AtomicStringTable.h:
        * wtf/text/LineBreakIteratorPoolICU.h:

2017-06-20  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Enable WTF::Signals only when HAVE(MACHINE_CONTEXT) is true
        https://bugs.webkit.org/show_bug.cgi?id=173590

        Reviewed by Carlos Garcia Campos.

        WTF::Signals require a feature rewriting a value of a machine context.
        This is only available under HAVE(MACHINE_CONTEXT).
        This patch disables WTF::Signals on !HAVE(MACHINE_CONTEXT) environments.

        * wtf/threads/Signals.cpp:
        * wtf/threads/Signals.h:

2017-06-20  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Rebaseline std::optional
        https://bugs.webkit.org/show_bug.cgi?id=173582

        Reviewed by JF Bastien.

        Update the copy of our std::optional to the latest version.
        It adds std::optional::has_value() and std::optional::reset().

        * wtf/Optional.h:

2017-06-18  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Include execinfo.h and dlfcn.h based on platform defines
        https://bugs.webkit.org/show_bug.cgi?id=173531

        Reviewed by Alex Christensen.

        execinfo.h and dlfcn.h can be missing in some libc libraries.
        When including it, we should honor platform defines like HAVE(DLADDR).

        * wtf/StackTrace.cpp:

2017-06-18  Darin Adler  <darin@apple.com>

        Fix Ref to deref before assignment, add tests for this to RefPtr, Ref, Function
        https://bugs.webkit.org/show_bug.cgi?id=173526

        Reviewed by Sam Weinig.

        * wtf/Ref.h: Changed operator= to not be defined inside the class definition.
        Added swap functions. Changed operator= implementations to use swap in the
        conventional manner, the same way that RefPtr does.

2017-06-18  Chris Dumez  <cdumez@apple.com>

        Use WTF::Function instead of std::function in WTF/
        https://bugs.webkit.org/show_bug.cgi?id=173519

        Reviewed by Sam Weinig.

        Use WTF::Function instead of std::function in WTF/ to avoid
        copying.

        * wtf/Brigand.h:
        * wtf/Condition.h:
        * wtf/Expected.h:
        * wtf/FunctionDispatcher.h:
        * wtf/MainThread.h:
        * wtf/MemoryPressureHandler.h:
        (WTF::MemoryPressureHandler::setMemoryKillCallback):
        (WTF::MemoryPressureHandler::setMemoryPressureStatusChangedCallback):
        (WTF::MemoryPressureHandler::setDidExceedInactiveLimitWhileActiveCallback):
        * wtf/Optional.h:
        * wtf/ParkingLot.h:
        * wtf/RefCounter.h:
        (WTF::RefCounter<T>::RefCounter):
        * wtf/WorkQueue.h:
        * wtf/linux/MemoryPressureHandlerLinux.cpp:
        (WTF::MemoryPressureHandler::EventFDPoller::EventFDPoller):
        * wtf/text/WTFString.cpp:
        (WTF::String::split):
        * wtf/text/WTFString.h:

2017-06-16  Alex Christensen  <achristensen@webkit.org>

        Fix Mac CMake build.

        * wtf/PlatformMac.cmake:
        Generate MachExceptionsServer.h

2017-06-16  Wenson Hsieh  <wenson_hsieh@apple.com>

        [iOS DnD] Upstream iOS drag and drop implementation into OpenSource WebKit
        https://bugs.webkit.org/show_bug.cgi?id=173366
        <rdar://problem/32767014>

        Reviewed by Tim Horton.

        Define ENABLE_DRAG_SUPPORT as 1 by default and 0 for iOS, and define ENABLE_DATA_INTERACTION as 0 by default.
        These are overridden to both be 1 for iOS 11+ in the FeatureDefines.xcconfig within each individual project.

        * wtf/Platform.h:

2017-06-15  Chris Dumez  <cdumez@apple.com>

        Fix typo in XPCSPI.h
        https://bugs.webkit.org/show_bug.cgi?id=173426

        Reviewed by Alex Christensen.

        We should check if xpc_release is defined before defining it,
        not xpc_retain.

        * wtf/spi/darwin/XPCSPI.h:

2017-06-15  Konstantin Tokarev  <annulen@yandex.ru>

        Implement FALLTHROUGH macro for compilers other than Clang
        https://bugs.webkit.org/show_bug.cgi?id=173385

        Reviewed by Alex Christensen.

        FALLTHROUGH should be able to use [[gnu::fallthrough]] attribute of
        GCC, and [[fallthrough]] from C++17, whichever is available.

        * wtf/Compiler.h:

2017-06-14  Nael Ouedraogo  <nael.ouedraogo@crf.canon.fr>

        MediaSource duration attribute should not be equal to Infinity when set to a value greater than 2^64
        https://bugs.webkit.org/show_bug.cgi?id=171668

        Reviewed by Jer Noble.

        MediaSource duration attribute is a double represented in MediaSource by a MediaTime instance created with
        MediaTime::CreateWithDouble(). This method implements an overflow control mechanism which sets MediaTime to
        Infinity when the double value passed as argument is greater than 2^64.

        This patch removes the overflow control mechanism when time value is represented as a double. This patch also
        modifies the behavior of mathematical operations between a double MediaTime and rational MediaTime: the rational
        MediaTime is converted to a double before applying the operation. Double MediaTime precision is the same as for
        double. Overflow mechanisms still apply to the conversion of a double MediaTime to rational with setTimescale()
        method. No behavior change for rational MediaTime.

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::createWithFloat):
        (WTF::MediaTime::createWithDouble):
        (WTF::MediaTime::operator+):
        (WTF::MediaTime::operator-):

2017-06-13  Zan Dobersek  <zdobersek@igalia.com>

        [GTK][WPE] Use CMAKE_THREAD_LIBS_INIT in WTF platform CMake files
        https://bugs.webkit.org/show_bug.cgi?id=173310

        Reviewed by Xabier Rodriguez-Calvar.

        In the WTF platform CMake files for the GTK+ and WPE ports, use the
        CMAKE_THREAD_LIBS_INIT variable to specify the threading library we
        should be linking against. On some platforms this variable will be
        empty because the given compiler will automatically handle the -pthread
        compiler flag and sort out linking on its own.

        The same approach is already used for the JSCOnly configuration.

        * wtf/PlatformGTK.cmake:
        * wtf/PlatformWPE.cmake:

2017-06-13  Youenn Fablet  <youenn@apple.com>

        Filter SDP from ICE candidates in case of local ICE candidate filtering
        https://bugs.webkit.org/show_bug.cgi?id=173120

        Reviewed by Eric Carlson.

        Adding split helper routine with functor parameter.

        * wtf/text/WTFString.cpp:
        (WTF::String::split):
        * wtf/text/WTFString.h:
        (WTF::String::contains):

2017-06-13  Don Olmstead  <don.olmstead@sony.com>

        [WTF] Remove redundant includes in config.h
        https://bugs.webkit.org/show_bug.cgi?id=173292

        Reviewed by Alex Christensen.

        * config.h:
        * wtf/ExportMacros.h:

2017-06-12  Jer Noble  <jer.noble@apple.com>

        Screen sleeps while doing WebRTC video
        https://bugs.webkit.org/show_bug.cgi?id=173278

        Reviewed by Eric Carlson.

        Drive-by fix: add some generic methods for iterating over collections.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/Algorithms.h: Added.
        (WTF::forEach):
        (WTF::anyOf):
        (WTF::allOf):

2017-06-12  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Move WebKit GType macros to WTF
        https://bugs.webkit.org/show_bug.cgi?id=173249

        Reviewed by Žan Doberšek.

        They can be used by glib-based ports and eventually by JavaScriptCore glib bindings too.

        * wtf/glib/WTFGType.h: Copied from Source/WebKit2/UIProcess/API/gtk/WebKitPrivate.h.

2017-06-11  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Make ThreadMessage portable
        https://bugs.webkit.org/show_bug.cgi?id=172073

        Reviewed by Keith Miller.

        Recently, we change ThreadMessage semantics: message handler
        can be executed in the sender thread.
        This allows ThreadMessage to be implemented in a portable way.

        This patch implements ThreadMessage for all the platforms.
        We use platform-independent Thread APIs, suspend(), resume(),
        and getRegisters().

        * wtf/PlatformRegisters.h:
        (WTF::registersFromUContext):
        * wtf/ThreadMessage.cpp:
        (WTF::sendMessageScoped):
        (WTF::ThreadMessageData::ThreadMessageData): Deleted.
        (): Deleted.
        (WTF::initializeThreadMessages): Deleted.
        (WTF::sendMessageUsingSignal): Deleted.
        (WTF::sendMessageUsingMach): Deleted.
        (WTF::deliverMessagesUsingMach): Deleted.
        * wtf/ThreadMessage.h:
        * wtf/Threading.cpp:
        (WTF::initializeThreading):
        * wtf/Threading.h:
        (WTF::Thread::threadMessages): Deleted.
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::signalHandlerSuspendResume):
        (WTF::threadStateMetadata):
        (WTF::Thread::getRegisters):
        * wtf/threads/Signals.cpp:
        (WTF::handleSignalsWithMach):

2017-06-11  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Drop unnecessary includes in Threading.h
        https://bugs.webkit.org/show_bug.cgi?id=173167

        Reviewed by Darin Adler.

        Threading.h includes bunch of headers. But some of them are not necessary.
        This patch cleans up it a bit.

        * wtf/Assertions.cpp:
        * wtf/LocklessBag.h:
        * wtf/Threading.h:
        * wtf/ThreadingPrimitives.h:

2017-06-10  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Add RegisteredSymbolImpl
        https://bugs.webkit.org/show_bug.cgi?id=173230

        Reviewed by Mark Lam.

        Most symbols are not registered in SymbolRegistry. However, we currently always
        allocate a pointer member to point to a SymbolRegistry, and this pointer is always null.
        SymbolImpl is immutable, and it will never be registered with a SymbolRegistry
        after it is created. Hence, this member is wasteful.

        Instead, we add a new derived class RegisteredSymbolImpl, which will set a flag in
        SymbolImpl to indicate that it is registered with a SymbolRegistry. The only way to
        create a RegisteredSymbolImpl is via a factory method provided by the SymbolRegistry.
        The factory method will pass the SymbolRegistry this pointer to the RegisteredSymbolImpl's
        constructor for initializing the RegisteredSymbolImpl's m_symbolRegistry field.
        By doing so,

        1. We do not need to set m_symbolRegistry after creating a Symbol. It is clean.
        2. We reduce the size of SymbolImpls that do not need to be registered.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::~StringImpl):
        * wtf/text/StringImpl.h:
        * wtf/text/SymbolImpl.cpp:
        (WTF::SymbolImpl::create):
        (WTF::RegisteredSymbolImpl::create):
        * wtf/text/SymbolImpl.h:
        (WTF::SymbolImpl::hashForSymbol):
        (WTF::SymbolImpl::isRegistered):
        (WTF::SymbolImpl::SymbolImpl):
        (WTF::RegisteredSymbolImpl::symbolRegistry):
        (WTF::RegisteredSymbolImpl::clearSymbolRegistry):
        (WTF::RegisteredSymbolImpl::RegisteredSymbolImpl):
        (WTF::SymbolImpl::symbolRegistry):
        * wtf/text/SymbolRegistry.cpp:
        (WTF::SymbolRegistry::~SymbolRegistry):
        (WTF::SymbolRegistry::symbolForKey):
        (WTF::SymbolRegistry::keyForSymbol):
        (WTF::SymbolRegistry::remove):
        * wtf/text/SymbolRegistry.h:

2017-06-10  Dan Bernstein  <mitz@apple.com>

        Reverted r218056 because it made the IDE reindex constantly.

        * Configurations/DebugRelease.xcconfig:

2017-06-10  Dan Bernstein  <mitz@apple.com>

        [Xcode] With Xcode 9 developer beta, everything rebuilds when switching between command-line and IDE
        https://bugs.webkit.org/show_bug.cgi?id=173223

        Reviewed by Sam Weinig.

        The rebuilds were happening due to a difference in the compiler options that the IDE and
        xcodebuild were specifying. Only the IDE was passing the -index-store-path option. To make
        xcodebuild pass that option, too, set CLANG_INDEX_STORE_ENABLE to YES if it is unset, and
        specify an appropriate path in CLANG_INDEX_STORE_PATH.

        * Configurations/DebugRelease.xcconfig:

2017-06-09  Chris Dumez  <cdumez@apple.com>

        Update Thread::create() to take in a WTF::Function instead of a std::function
        https://bugs.webkit.org/show_bug.cgi?id=173175

        Reviewed by Mark Lam.

        Update Thread::create() to take in a WTF::Function instead of a std::function. Unlike
        std::function, WTF:Function is not copyable and does not make implicit copies of captured
        variables. Doing captures such as [string = string.isolatedCopy()] when passing an
        std::function to another thread has lead to bugs in the past due to implicit copying of
        the captured string.

        * wtf/Threading.cpp:
        (WTF::Thread::create):
        * wtf/Threading.h:

2017-06-09  Chris Dumez  <cdumez@apple.com>

        Update WorkQueue::concurrentApply() to take a WTF::Function instead of an std::function
        https://bugs.webkit.org/show_bug.cgi?id=173165

        Reviewed by Saam Barati.

        Update WorkQueue::concurrentApply() to take a WTF::Function instead of an std::function
        as std::function has issues with regards to thread safety.

        * wtf/WorkQueue.h:
        * wtf/cocoa/WorkQueueCocoa.cpp:
        (WTF::WorkQueue::concurrentApply):

2017-06-08  Xabier Rodriguez Calvar  <calvaris@igalia.com>

        MediaTime class has rounding issues in different platforms
        https://bugs.webkit.org/show_bug.cgi?id=172640

        Reviewed by Jer Noble.

        The way a timescale is set when creating a MediaTime from a double
        can create rounding issues in different platforms because in some
        rounding is made and in others, it truncates. This way we ensure a
        common behavior.

        Dumping MediaTimes is also confusing and by the output you don't
        know if it's containing a double or a fraction. Now, if it
        contains a double, it only prints the double because printing the
        fraction is misleading (it currently prints the double read as an
        integer) and if it contains a fraction it shows the fraction and
        its double representation separated by an = instead of a ,.

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::createWithDouble): When creating MediaTime from
        double, we round instead of leaving it to the cast operation.
        (WTF::MediaTime::dump):

2017-06-07  Jer Noble  <jer.noble@apple.com>

        Refactoring: MediaEngineSupportParameters should take a ContentType rather than separate type & codecs strings
        https://bugs.webkit.org/show_bug.cgi?id=173038

        Reviewed by Eric Carlson.

        Drive by fix: add a version of split that takes a UChar and returns a Vector<String>.

        * wtf/text/WTFString.h:
        (WTF::String::split):

2017-06-07  Zan Dobersek  <zdobersek@igalia.com>

        [GCrypt] RSA-PSS support
        https://bugs.webkit.org/show_bug.cgi?id=172856

        Reviewed by Jiewen Tan.

        * wtf/Platform.h: Define HAVE_RSA_PSS to 1 for USE(GCRYPT). Support for RSA-PSS
        is provided by default through the libgcrypt library.

2017-06-06  Chris Dumez  <cdumez@apple.com>

        Unreviewed, rolling out r214974.

        Causes some tabs to start using a huge amount of CPU after 8
        minutes in the background

        Reverted changeset:

        "Make inactive web processes behave as though under memory
        pressure."
        https://bugs.webkit.org/show_bug.cgi?id=170042
        http://trac.webkit.org/changeset/214974

2017-06-06  Don Olmstead  <don.olmstead@am.sony.com>

        [WebCore] Enable REQUEST_ANIMATION_FRAME_TIMER for all ports
        https://bugs.webkit.org/show_bug.cgi?id=172780

        Reviewed by Alex Christensen.

        * wtf/Platform.h:

2017-06-06  Darin Adler  <darin@apple.com>

        Cut down use of WTF_ARRAY_LENGTH
        https://bugs.webkit.org/show_bug.cgi?id=172997

        Reviewed by Chris Dumez.

        * wtf/DateMath.cpp:
        (WTF::equalLettersIgnoringASCIICase): Added helper function template.
        (WTF::parseDateFromNullTerminatedCharacters): Use a modern for loop instead of
        WTF_ARRAY_LENGTH. Use startsWithLettersIgnoringASCIICase and
        equalLettersIgnoringASCIICase instead of strncasecmp.

        * wtf/text/IntegerToStringConversion.h:
        (WTF::numberToStringImpl): Use std::end instead of WTF_ARRAY_LENGTH.
        (WTF::writeNumberToBufferImpl): Ditto.

2017-06-06  Filip Pizlo  <fpizlo@apple.com>

        index out of bound in bytecodebasicblock
        https://bugs.webkit.org/show_bug.cgi?id=172963

        Reviewed by Saam Barati and Mark Lam.

        * wtf/Assertions.h:
        (UNREACHABLE_FOR_PLATFORM):

2017-06-05  Jer Noble  <jer.noble@apple.com>

        Allow clients to specify a list of codecs which should require hardware decode support.
        https://bugs.webkit.org/show_bug.cgi?id=172787

        Reviewed by Alex Christensen.

        Add a couple of convenience methods:
        - a String::split() that returns a vector (rather than taking an out-reference to a vector).
        - A Vector::map() template which takes a Callable and returns a Vector of a different type.

        * wtf/Vector.h:
        (WTF::Vector::map):
        * wtf/text/WTFString.h:
        (WTF::String::split):

2017-06-04  Konstantin Tokarev  <annulen@yandex.ru>

        Fix build of Windows-specific code with ICU 59.1
        https://bugs.webkit.org/show_bug.cgi?id=172729

        Reviewed by Darin Adler.

        * wtf/text/win/WCharStringExtras.h: Added new header file wuth helper
        functions for conversion between WTF::String and wchart_t*.
        (WTF::stringToNullTerminatedWChar):
        (WTF::wcharToString):
        (WTF::nullTerminatedWCharToString):

2017-06-02  Stephan Szabo  <stephan.szabo@am.sony.com>

        [JSCOnly] Build static jsc.exe on Windows
        https://bugs.webkit.org/show_bug.cgi?id=172833

        Reviewed by Konstantin Tokarev.

        * wtf/PlatformJSCOnly.cmake:

2017-06-02  Simon Fraser  <simon.fraser@apple.com>

        Get <chrono> out of StdLibExtras.h
        https://bugs.webkit.org/show_bug.cgi?id=172744

        Reviewed by Zalan Bujtas.

        We hates std::chrono. Don't include it everywhere to discourage use.

        * wtf/StdLibExtras.h:

2017-06-02  Filip Pizlo  <fpizlo@apple.com>

        Atomics.load and Atomics.store need to be fully fenced
        https://bugs.webkit.org/show_bug.cgi?id=172844

        Reviewed by Keith Miller.
        
        Add loadFullyFenced and storeFullyFenced to Atomic<>.

        * wtf/Atomics.h:
        (WTF::Atomic::loadFullyFenced):
        (WTF::Atomic::storeRelaxed):
        (WTF::Atomic::storeFullyFenced):
        (WTF::atomicLoadFullyFenced):
        (WTF::atomicStoreFullyFenced):

2017-06-01  Keith Miller  <keith_miller@apple.com>

        Undo rollout in r217638 with bug fix
        https://bugs.webkit.org/show_bug.cgi?id=172824

        Unreviewed, reland patch with unused set_state code removed.

        * Configurations/WTF.xcconfig:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/Platform.h:
        * wtf/PlatformRegisters.h:
        (WTF::registersFromUContext):
        * wtf/StackBounds.h:
        (WTF::StackBounds::StackBounds):
        * wtf/ThreadHolder.cpp:
        (WTF::ThreadHolder::~ThreadHolder):
        * wtf/ThreadMessage.cpp:
        (WTF::sendMessageUsingSignal):
        (WTF::sendMessageUsingMach):
        (WTF::deliverMessagesUsingMach):
        (WTF::sendMessageScoped):
        * wtf/ThreadMessage.h:
        (WTF::sendMessage):
        * wtf/Threading.h:
        (WTF::Thread::machThread):
        * wtf/mac/MachExceptions.defs: Copied from Source/WTF/wtf/ThreadMessage.h.
        * wtf/threads/Signals.cpp:
        (WTF::startMachExceptionHandlerThread):
        (WTF::fromMachException):
        (WTF::toMachMask):
        (WTF::handleSignalsWithMach):
        (WTF::setExceptionPorts):
        (WTF::activeThreads):
        (WTF::registerThreadForMachExceptionHandling):
        (WTF::unregisterThreadForMachExceptionHandling):
        (WTF::installSignalHandler):
        (WTF::jscSignalHandler):
        * wtf/threads/Signals.h:

2017-05-31  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r217611 and r217631.
        https://bugs.webkit.org/show_bug.cgi?id=172785

        "caused wasm-hashset-many.html to become flaky." (Requested by
        keith_miller on #webkit).

        Reverted changesets:

        "Reland r216808, underlying lldb bug has been fixed."
        https://bugs.webkit.org/show_bug.cgi?id=172759
        http://trac.webkit.org/changeset/217611

        "Use dispatch queues for mach exceptions"
        https://bugs.webkit.org/show_bug.cgi?id=172775
        http://trac.webkit.org/changeset/217631

2017-05-31  Keith Miller  <keith_miller@apple.com>

        Use dispatch queues for mach exceptions
        https://bugs.webkit.org/show_bug.cgi?id=172775

        Reviewed by Geoffrey Garen.

        This patch adds support for using a dispatch queue to handle our
        mach exceptions. We use a high priority concurrent dispatch queue
        to handle our mach exceptions. We don't know the priority of the
        thread whose exception we are handling so the most conservative
        answer is to respond with a high priority. These events are both
        rare and usually quite fast so it is likely not a significant cost
        when the thread with an exception has a low priority.

        * wtf/threads/Signals.cpp:
        (WTF::startMachExceptionHandlerThread):

2017-05-31  Keith Miller  <keith_miller@apple.com>

        Reland r216808, underlying lldb bug has been fixed.
        https://bugs.webkit.org/show_bug.cgi?id=172759

        Unreviewed, relanding old patch. See: rdar://problem/31183352

        * Configurations/WTF.xcconfig:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/Platform.h:
        * wtf/PlatformRegisters.h:
        (WTF::registersFromUContext):
        * wtf/StackBounds.h:
        (WTF::StackBounds::StackBounds):
        * wtf/ThreadHolder.cpp:
        (WTF::ThreadHolder::~ThreadHolder):
        * wtf/ThreadMessage.cpp:
        (WTF::sendMessageUsingSignal):
        (WTF::sendMessageUsingMach):
        (WTF::deliverMessagesUsingMach):
        (WTF::sendMessageScoped):
        * wtf/ThreadMessage.h:
        (WTF::sendMessage):
        * wtf/Threading.h:
        (WTF::Thread::machThread):
        * wtf/mac/MachExceptions.defs: Copied from Source/WTF/wtf/ThreadMessage.h.
        * wtf/threads/Signals.cpp:
        (WTF::startMachExceptionHandlerThread):
        (WTF::fromMachException):
        (WTF::toMachMask):
        (WTF::handleSignalsWithMach):
        (WTF::setExceptionPorts):
        (WTF::activeThreads):
        (WTF::registerThreadForMachExceptionHandling):
        (WTF::unregisterThreadForMachExceptionHandling):
        (WTF::installSignalHandler):
        (WTF::jscSignalHandler):
        * wtf/threads/Signals.h:

2017-05-31  Matt Lewis  <jlewis3@apple.com>

        Unreviewed, rolling out r217603.

        This patch broke the internal builds.

        Reverted changeset:

        "Get <chrono> out of StdLibExtras.h"
        https://bugs.webkit.org/show_bug.cgi?id=172744
        http://trac.webkit.org/changeset/217603

2017-05-31  Simon Fraser  <simon.fraser@apple.com>

        Get <chrono> out of StdLibExtras.h
        https://bugs.webkit.org/show_bug.cgi?id=172744

        Reviewed by Saam Barati.

        We hates std::chrono. Don't include it everywhere to discourage use.

        * wtf/StdLibExtras.h:

2017-05-30  Ryosuke Niwa  <rniwa@webkit.org>

        Only include DataDetectorsUI headers in iOS
        https://bugs.webkit.org/show_bug.cgi?id=172633

        Reviewed by David Kilzer.

        Enable data detectors only on iOS and not other variants of iOS.

        * wtf/FeatureDefines.h:
        * wtf/Platform.h:

2017-05-29  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, disable faster Interpreter::getOpcodeID for ARM_THUMB2 with non-Darwin OSes
        https://bugs.webkit.org/show_bug.cgi?id=172686

        Because of test failures.

        * wtf/Platform.h:

2017-05-28  Dan Bernstein  <mitz@apple.com>

        [Xcode] ALWAYS_SEARCH_USER_PATHS is set to YES
        https://bugs.webkit.org/show_bug.cgi?id=172691

        Reviewed by Tim Horton.

        * Configurations/Base.xcconfig: Set ALWAYS_SEARCH_USER_PATHS to NO.

2017-05-28  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC][Linux][FreeBSD] Use faster Interpreter::getOpcodeID()
        https://bugs.webkit.org/show_bug.cgi?id=172686

        Reviewed by Mark Lam.

        As of r217526, JSC gets faster Interpreter::getOpcodeID() by
        embedding OpcodeID value just before the LLInt machine code
        handler pointer. By doing so, we can retrieve OpcodeID from
        the LLInt machine code handler by dereferencing the code
        pointer. `*((int*)ptr - 1)`.

        This patch allows Linux and FreeBSD environments to use this
        optimization.

        * wtf/Platform.h:

2017-05-28  Mark Lam  <mark.lam@apple.com>

        Implement a faster Interpreter::getOpcodeID().
        https://bugs.webkit.org/show_bug.cgi?id=172669

        Reviewed by Saam Barati.

        Added the USE(LLINT_EMBEDDED_OPCODE_ID) configuration.

        * wtf/Platform.h:

2017-05-26  Brent Fulgham  <bfulgham@apple.com>

        [WK2] Address thread safety issues with ResourceLoadStatistics
        https://bugs.webkit.org/show_bug.cgi?id=172519
        <rdar://problem/31707642>

        Reviewed by Chris Dumez.

        Add a new specialization for HashSet.

        * wtf/CrossThreadCopier.h:

2017-05-26  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r217458.

        This change caused 55 JSC test failures.

        Reverted changeset:

        "Date should use historical data if it's available."
        https://bugs.webkit.org/show_bug.cgi?id=172592
        http://trac.webkit.org/changeset/217458

2017-05-25  Keith Miller  <keith_miller@apple.com>

        Date should use historical data if it's available.
        https://bugs.webkit.org/show_bug.cgi?id=172592

        Reviewed by Mark Lam.

        The spec previously disallowed using historical data for Dates.
        This is no longer the case. Additionally, not using historical
        data, when available, seems unfortunate for users. This patch
        removes the code dropping historical data.

        * wtf/DateMath.cpp:
        (WTF::calculateLocalTimeOffset):
        (WTF::msToMilliseconds): Deleted.

2017-05-25  Yusuke Suzuki  <utatane.tea@gmail.com>

        [Win] ASSERTION FAILED: !HashTranslator::equal(KeyTraits::emptyValue(), key)
        https://bugs.webkit.org/show_bug.cgi?id=172586

        Reviewed by Brent Fulgham.

        In ThreadHolder for Windows, we need to construct HashMap<ThreadIdentifier, ThreadHolder*>.
        The problem is that ThreadHolder::platformInitialize touches Thread::id() even before Thread
        is not established. In that case, id() returns incorrect value.

        But, calling ThreadHolder::initialize() after waiting for completion of Thread::establish() is
        not a good idea. Since we already have NewThreadContext->creationMutex, we can wait for completion
        of Thread::establish() easily. However, if we do so, Thread::create() returns RefPtr<Thread> that
        may not call ThreadHolder::initialize() in its thread yet. In that case, ThreadHolder::get() fails.
        Thus, Windows WTF::waitForThreadCompletion implementation becomes broken. We can add a new mutex
        to wait for completion of ThreadHolder::initialize in the creator of the thread (like a ping-pong!).
        But it overly complicates the implementation.

        The following is overly complicated initialization phase.

        Creator -> AC mutex(1) -------> establishment -> RL mutex(1) ----------------------> AC mutex(2) ->

                               Thread -----------------> AC mutex(1) -> ThreadHolder init -> RL mutex(2) ->

        So, instead, in this patch, we just use Thread::currentID(). When calling ThreadHolder::initialize(),
        we pass ThreadIdentifier by using Thread::currentID(). This implementation works great because,

        1. ThreadHolder::initialize requires ThreadIdentifier only in Windows environment because Pthread
           ThreadHolder does not create HashMap<>. And this is used for obsolete Threading APIs. Thus this
           hack will be removed in the near future.

        2. In Windows, Thread::currentID() can return a valid value without using ThreadHolder. And it does
           not require Thread establishment. So, calling currentID() to initialize ThreadHolder is ok in
           Windows.

        * wtf/ThreadHolder.cpp:
        (WTF::ThreadHolder::initialize): Deleted.
        * wtf/ThreadHolder.h:
        * wtf/ThreadHolderPthreads.cpp:
        (WTF::ThreadHolder::initialize):
        * wtf/ThreadHolderWin.cpp:
        (WTF::ThreadHolder::initialize):
        (WTF::ThreadHolder::platformInitialize): Deleted.
        * wtf/ThreadingWin.cpp:
        (WTF::wtfThreadEntryPoint):

2017-05-25  Adrian Perez de Castro  <aperez@igalia.com>

        Clang warns about (intended) returning pointer to stack location in WTF/wtf/ThreadingPthreads.cpp
        https://bugs.webkit.org/show_bug.cgi?id=172595

        Reviewed by Mark Lam.

        * wtf/ThreadingPthreads.cpp: Use a #pragma to silence Clang warning about returning a
        pointer to the stack (which is intended)

2017-05-25  David Kilzer  <ddkilzer@apple.com>

        REGRESSION (r217416): Using #pragma once in WTFString.h broke the build

        * wtf/text/WTFString.h: Switch back to #ifndef/#define/#endif.

2017-05-25  David Kilzer  <ddkilzer@apple.com>

        Make a change to force a build on the Apple bots

        * wtf/text/WTFString.h: Use #pragma once.

2017-05-24  Andreas Kling  <akling@apple.com>

        Disable memory kill mechanisms when running with FastMalloc disabled.
        https://bugs.webkit.org/show_bug.cgi?id=172550
        <rdar://problem/32181908>

        Reviewed by Antti Koivisto.

        If someone is using WebKit with a non-standard allocator, they are likely trying to debug
        or test something, and suddenly getting killed is not gonna help with that.

        * wtf/MemoryPressureHandler.cpp:
        (WTF::MemoryPressureHandler::setShouldUsePeriodicMemoryMonitor):

2017-05-22  Jiewen Tan  <jiewen_tan@apple.com>

        [WebCrypto] Support RSA-PSS
        https://bugs.webkit.org/show_bug.cgi?id=170869
        <rdar://problem/31640672>

        Reviewed by Brent Fulgham.

        * wtf/Platform.h:
        Add a flag to enable RSA-PSS in the future.

2017-05-23  Myles C. Maxfield  <mmaxfield@apple.com>

        Remove dead ENABLE(FONT_LOAD_EVENTS) code
        https://bugs.webkit.org/show_bug.cgi?id=172517

        Rubber-stamped by Simon Fraser.

        * wtf/FeatureDefines.h:

2017-05-23  Don Olmstead  <don.olmstead@am.sony.com>

        [WTF] Export additional symbols in threading
        https://bugs.webkit.org/show_bug.cgi?id=171952

        Reviewed by Konstantin Tokarev.

        * wtf/ThreadMessage.h:
        * wtf/threads/Signals.h:

2017-05-23  Tomas Popela  <tpopela@redhat.com>

        [WTF] Compilation fails with system malloc
        https://bugs.webkit.org/show_bug.cgi?id=172445

        Reviewed by Michael Catanzaro.

        We are using the bmalloc even if the system malloc should be used.
        Don't use bmalloc if the system malloc is requested and add the
        missing implementation for computeRAMSize() on UNIX that's utilizing
        the sysinfo() call.

        * wtf/RAMSize.cpp:
        (WTF::computeRAMSize):

2017-05-22  Brian Burg  <bburg@apple.com>

        Add a debugging macro that sleeps a thread until a debugger attaches
        https://bugs.webkit.org/show_bug.cgi?id=171575

        Reviewed by Mark Lam.

        This is really useful for debugging early errors if for some reason you can't
        launch a process directly from the debugger easily, such as Web Content processes.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/Assertions.h:
        Always define the WTFBreakpointTrap() macro. Still make it an error if the CPU
        type isn't supported for OS(DARWIN); if used on other platforms, cause a WTFCrash()
        with a comment that indicates this is not implemented.

        * wtf/DebugUtilities.h: Added.

2017-05-19  Don Olmstead  <don.olmstead@am.sony.com>

        [WTF] Remove PLATFORM(WIN) references
        https://bugs.webkit.org/show_bug.cgi?id=172301

        Reviewed by Yusuke Suzuki.

        * wtf/MemoryPressureHandler.cpp:
        * wtf/MemoryPressureHandler.h:
        * wtf/Platform.h:

2017-05-19  Don Olmstead  <don.olmstead@am.sony.com>

        [CMake] Add HAVE check for __int128_t
        https://bugs.webkit.org/show_bug.cgi?id=172317

        Reviewed by Yusuke Suzuki.

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::setTimeScale):
        * wtf/Platform.h:

2017-05-18  Andreas Kling  <akling@apple.com>

        [WK2] Notify WebPageProxy client when an active process goes over the inactive memory limit
        https://bugs.webkit.org/show_bug.cgi?id=172244
        <rdar://problem/31800943>

        Reviewed by Geoffrey Garen.

        Add an installable callback to MemoryPressureHandler that gets invoked when an active process
        exceeds the kill limit for an inactive process.

        This allows a UI client to become aware that backgrounding a tab may cause it to get killed.

        * wtf/MemoryPressureHandler.cpp:
        (WTF::thresholdForMemoryKillWithProcessState):
        (WTF::MemoryPressureHandler::thresholdForMemoryKill):
        (WTF::MemoryPressureHandler::measurementTimerFired):
        (WTF::MemoryPressureHandler::doesExceedInactiveLimitWhileActive):
        (WTF::MemoryPressureHandler::doesNotExceedInactiveLimitWhileActive):
        * wtf/MemoryPressureHandler.h:
        (WTF::MemoryPressureHandler::setDidExceedInactiveLimitWhileActiveCallback):

2017-05-18  Geoffrey Garen  <ggaren@apple.com>

        AutomaticThread should wait longer before timing out
        https://bugs.webkit.org/show_bug.cgi?id=172292

        Reviewed by Filip Pizlo.

        Increased the idle timeout from 1s => 10s.

        This reduces the number of thread restarts on JetStream from
        ~150 => ~0. It also matches other thread pool APIs on Darwin.

        Intuitively, it seems wrong for helper threads to idle exit during
        hardcore benchmarking.

        This patch in combination with a bmalloc fix seems to be a 1%-2% JetStream
        speedup on my Mac Pro.

        A nice side-benefit is that per-thread traces are easier to read.

        * wtf/AutomaticThread.cpp:
        (WTF::AutomaticThread::start):
        * wtf/AutomaticThread.h:

2017-05-18  Don Olmstead  <don.olmstead@am.sony.com>

        [Win] Remove usage of _snprintf
        https://bugs.webkit.org/show_bug.cgi?id=172251

        Reviewed by Per Arne Vollan.

        * wtf/DataLog.cpp:
        (WTF::initializeLogFileOnce):
        (WTF::setDataFile):

2017-05-15  Mark Lam  <mark.lam@apple.com>

        Rolling out r214038 and r213697: Crashes when using computed properties with rest destructuring and object spread.
        https://bugs.webkit.org/show_bug.cgi?id=172147

        Rubber-stamped by Saam Barati.

        * wtf/HashSet.h:
        (WTF::=):

2017-05-14  Chris Dumez  <cdumez@apple.com>

        Drop PassRefPtr class from WTF
        https://bugs.webkit.org/show_bug.cgi?id=172091

        Reviewed by Alex Christensen.

        Drop PassRefPtr class from WTF as it is no longer used or needed.
        Also drop RefPtr::release() for the same reasons.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/CrossThreadCopier.cpp:
        * wtf/CrossThreadCopier.h:
        * wtf/Forward.h:
        * wtf/PassRefPtr.h: Removed.
        * wtf/RefPtr.h:
        (WTF::refIfNotNull):
        (WTF::derefIfNotNull):
        (WTF::RefPtr::RefPtr):
        (WTF::RefPtr::release): Deleted.
        * wtf/SizeLimits.cpp:
        * wtf/Vector.h:

2017-05-13  Chris Dumez  <cdumez@apple.com>

        Stop using RefPtr::release()
        https://bugs.webkit.org/show_bug.cgi?id=172074

        Reviewed by Geoffrey Garen.

        * wtf/win/WorkQueueWin.cpp:
        (WTF::WorkQueue::dispatchAfter):

2017-05-13  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r216808.
        https://bugs.webkit.org/show_bug.cgi?id=172075

        caused lldb to hang when debugging (Requested by smfr on
        #webkit).

        Reverted changeset:

        "Use Mach exceptions instead of signals where possible"
        https://bugs.webkit.org/show_bug.cgi?id=171865
        http://trac.webkit.org/changeset/216808

2017-05-12  Keith Miller  <keith_miller@apple.com>

        Use Mach exceptions instead of signals where possible
        https://bugs.webkit.org/show_bug.cgi?id=171865

        Reviewed by Mark Lam.

        This patch enables using mach exceptions on darwin. The way the
        mach exception api works is that we create a mach port, which is
        like a file descriptor.  We then wait for a message to arrive on
        that port in a thread. When another thread raises an exception (say
        due to a bad memory access) the OS sends our thread a message. The
        payload of that message is the register file of the crashing
        thread. We then call our custom handlers that change the state as
        needed. In order to restart the thread we send a payload back to
        the OS with an updated register file along with a success message
        header.

        This patch also makes thread messages work without signals by
        simply suspending the thread, and then running the message at that
        time.

        You can read more about mach exceptions here:
        http://www.cs.cmu.edu/afs/cs/project/mach/public/doc/unpublished/exception.ps
        and the Mach interface Generator (MiG) here:
        http://www.cs.cmu.edu/afs/cs/project/mach/public/doc/unpublished/mig.ps

        * Configurations/WTF.xcconfig:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/Platform.h:
        * wtf/PlatformRegisters.h:
        (WTF::registersFromUContext):
        * wtf/StackBounds.h:
        (WTF::StackBounds::StackBounds):
        * wtf/ThreadHolder.cpp:
        (WTF::ThreadHolder::~ThreadHolder):
        * wtf/ThreadMessage.cpp:
        (WTF::sendMessageUsingSignal):
        (WTF::sendMessageUsingMach):
        (WTF::deliverMessagesUsingMach):
        (WTF::sendMessageScoped):
        * wtf/ThreadMessage.h:
        (WTF::sendMessage):
        * wtf/Threading.h:
        (WTF::Thread::machThread):
        * wtf/mac/MachExceptions.defs: Copied from Source/WTF/wtf/ThreadMessage.h.
        * wtf/threads/Signals.cpp:
        (WTF::startMachExceptionHandlerThread):
        (WTF::fromMachException):
        (WTF::toMachMask):
        (WTF::handleSignalsWithMach):
        (WTF::setExceptionPorts):
        (WTF::activeThreads):
        (WTF::registerThreadForMachExceptionHandling):
        (WTF::unregisterThreadForMachExceptionHandling):
        (WTF::installSignalHandler):
        (WTF::jscSignalHandler):
        * wtf/threads/Signals.h:

2017-05-12  Ting-Wei Lan  <lantw44@gmail.com>

        Include algorithm before using std::min
        https://bugs.webkit.org/show_bug.cgi?id=171733

        Reviewed by Chris Dumez.

        * wtf/text/StringCommon.h:

2017-05-12  Andreas Kling  <akling@apple.com>

        More aggressive memory kill limits.
        https://bugs.webkit.org/show_bug.cgi?id=172037
        <rdar://problem/31969082>

        Reviewed by Michael Saboff.

        Bring down the memory kill limits to 4GB for active processes, and 2GB for inactive.
        Also make MemoryUsagePolicy::Strict kick in above 1.5GB.

        * wtf/MemoryPressureHandler.cpp:
        (WTF::MemoryPressureHandler::thresholdForMemoryKill):
        (WTF::thresholdForPolicy):

2017-05-12  Michael Saboff  <msaboff@apple.com>

        [iOS] Use memory footprint to dynamically adjust behavior of allocators
        https://bugs.webkit.org/show_bug.cgi?id=171944

        Reviewed by Filip Pizlo.

        Moved the non-Windows implementation of RAMSize() to bmalloc/AvailableMemory.cpp and
        called the function availableMemory().

        * wtf/RAMSize.cpp:
        (WTF::computeRAMSize):

2017-05-12  Claudio Saavedra  <csaavedra@igalia.com>

        [WPE] Add MemoryFootprintLinux to build

        Unreviewed build fix after r216731.

        * wtf/PlatformWPE.cmake:

2017-05-12  Csaba Osztrogonác  <ossy@webkit.org>

        Unreviewed trivial JSCOnly buildfix after r216731.
        https://bugs.webkit.org/show_bug.cgi?id=171693

        * wtf/PlatformJSCOnly.cmake:

2017-05-11  Yusuke Suzuki  <utatane.tea@gmail.com>

        [Win] Implement memoryFootprint for Windows
        https://bugs.webkit.org/show_bug.cgi?id=171693

        Reviewed by Alex Christensen.

        This patch implements memoryFootprint for Windows. In Windows, we calculate the size
        of private working set. This can be done by enumerating private pages in working set.

        And we also split MemoryFootprint.cpp to cocoa, linux, and win versions.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/MallocPtr.h:
        (WTF::MallocPtr::operator*):
        (WTF::MallocPtr::operator->):
        * wtf/PlatformGTK.cmake:
        * wtf/PlatformJSCOnly.cmake:
        * wtf/PlatformMac.cmake:
        * wtf/PlatformWin.cmake:
        * wtf/cocoa/MemoryFootprintCocoa.cpp: Copied from Source/WTF/wtf/MemoryFootprint.cpp.
        (WTF::memoryFootprint):
        * wtf/linux/MemoryFootprintLinux.cpp: Renamed from Source/WTF/wtf/MemoryFootprint.cpp.
        (WTF::forEachLine):
        (WTF::memoryFootprint):
        * wtf/win/MemoryFootprintWin.cpp: Added.
        (WTF::memoryFootprint):

2017-05-11  Don Olmstead  <don.olmstead@am.sony.com>

        [CMake] Add HAVE check for regex.h
        https://bugs.webkit.org/show_bug.cgi?id=171950

        Reviewed by Michael Catanzaro.

        * wtf/Platform.h:

2017-05-11  Chris Dumez  <cdumez@apple.com>

        Annotate Ref::ptr() with RETURNS_NONNULL
        https://bugs.webkit.org/show_bug.cgi?id=171996

        Reviewed by Andreas Kling.

        Annotate Ref::ptr() with RETURNS_NONNULL as it can never return null.

        * wtf/Ref.h:
        (WTF::Ref::ptr): Deleted.

2017-05-11  Joseph Pecoraro  <pecoraro@apple.com>

        Remove Vibration API
        https://bugs.webkit.org/show_bug.cgi?id=171766

        Rubber-stamped by Alexey Proskuryakov.

        * wtf/FeatureDefines.h:

2017-05-09  Sam Weinig  <sam@webkit.org>

        Remove support for legacy Notifications
        https://bugs.webkit.org/show_bug.cgi?id=171487

        Reviewed by Jon Lee.

        * wtf/FeatureDefines.h:
        Remove definition of ENABLE_LEGACY_NOTIFICATIONS.

2017-05-10  Adrian Perez de Castro  <aperez@igalia.com>

        Remove some last remnants of the EFL port
        https://bugs.webkit.org/show_bug.cgi?id=171922

        Reviewed by Antonio Gomes.

        The EFL port is no more.

        * wtf/PlatformEfl.cmake: Removed.

2017-05-10  Fujii Hironori  <Hironori.Fujii@sony.com>

        [Win] StaticStringImpl in HTMLNames.cpp aren't constructed
        https://bugs.webkit.org/show_bug.cgi?id=171800

        Reviewed by Yusuke Suzuki.

        Global variables of StaticStringImpl in HTMLNames.cpp aren't
        constructed on Windows since Bug 171586. It seems that
        reinterpret_cast prevents constexpr's compile time initialization
        in VC++.

        * wtf/text/StringImpl.h:
        (WTF::StringImplShape::StringImplShape): Added const char* and
        const char16_t* members in the union. Do not use reinterpret_cast
        in constexpr constructors.

2017-05-09  Mark Lam  <mark.lam@apple.com>

        Force StaticStringImpl constructor to use the constexpr versions of StringImplShape constructors.
        https://bugs.webkit.org/show_bug.cgi?id=171861

        Reviewed by Yusuke Suzuki.

        This is strictly necessary for correctness of the StaticStringImpl implementation.
        We force the constructor selection by adding an extra dummy argument to the
        constexpr versions of the StringImplShape constructors to disambiguate them from
        the non-constexpr versions.

        * wtf/text/StringImpl.h:
        (WTF::StringImplShape::StringImplShape):
        (WTF::StringImpl::StaticStringImpl::StaticStringImpl):

2017-05-09  Zan Dobersek  <zdobersek@igalia.com>

        Upstream the WPE port
        https://bugs.webkit.org/show_bug.cgi?id=171110

        Reviewed by Alex Christensen.

        * wtf/Platform.h:
        * wtf/PlatformWPE.cmake: Added.
        * wtf/glib/RunLoopSourcePriority.h:

2017-05-08  Mark Lam  <mark.lam@apple.com>

        Speculative Windows build fix after r216428.
        https://bugs.webkit.org/show_bug.cgi?id=171776

        Not reviewed.

        * wtf/StackTrace.h:

2017-05-08  Mark Lam  <mark.lam@apple.com>

        Introduce ExceptionScope::assertNoException() and releaseAssertNoException().
        https://bugs.webkit.org/show_bug.cgi?id=171776

        Reviewed by Keith Miller.

        1. Add an option to skip some number of top frames when capturing the StackTrace.
        2. Add an option to use an indentation string when dumping the StackTrace.

        * wtf/StackTrace.cpp:
        (WTF::StackTrace::captureStackTrace):
        (WTF::StackTrace::dump):
        * wtf/StackTrace.h:

2017-05-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Use memoryFootprint for MemoryUsage retrieval in Linux
        https://bugs.webkit.org/show_bug.cgi?id=171757

        Reviewed by Michael Catanzaro.

        This patch leverages memoryFootprint() to retrieve physical footprint in Linux.

        * wtf/linux/MemoryPressureHandlerLinux.cpp:
        (WTF::MemoryPressureHandler::ReliefLogger::platformMemoryUsage):

2017-05-05  Don Olmstead  <don.olmstead@am.sony.com>

        [WTF] Do not export deleted constructor in StringView
        https://bugs.webkit.org/show_bug.cgi?id=171751

        Reviewed by Alexey Proskuryakov.

        * wtf/text/StringView.h:

2017-05-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        [GTK][JSCOnly] Merge MainThread implementations and use generic one
        https://bugs.webkit.org/show_bug.cgi?id=171738

        Reviewed by Michael Catanzaro.

        GLib MainThread implementation is generic enough to be used in JSCOnly.
        We move it to generic/ and GTK (GLib ports) and JSCOnly use it.
        And we also drop GLib MainThread's isMainThread function because
        generic thread ID one is enough.

        This patch also cleans up initializing main thread code by using std::call_once.

        * wtf/MainThread.cpp:
        (WTF::initializeMainThread):
        (WTF::isMainThread):
        (WTF::initializeMainThreadToProcessMainThread):
        (WTF::initializeWebThread):
        (WTF::canAccessThreadLocalDataForThread):
        (WTF::initializeMainThreadOnce): Deleted.
        (WTF::initializeMainThreadToProcessMainThreadOnce): Deleted.
        (WTF::initializeWebThreadOnce): Deleted.
        * wtf/PlatformGTK.cmake:
        * wtf/PlatformJSCOnly.cmake:
        * wtf/generic/MainThreadGeneric.cpp:
        (WTF::MainThreadDispatcher::MainThreadDispatcher):
        (WTF::MainThreadDispatcher::schedule):
        (WTF::MainThreadDispatcher::fired):
        (WTF::scheduleDispatchFunctionsOnMainThread):
        * wtf/glib/MainThreadGLib.cpp: Removed.

2017-05-04  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r216206.
        https://bugs.webkit.org/show_bug.cgi?id=171714

        Multiple LayoutTests crashing in Document::page() (Requested
        by ap on #webkit).

        Reverted changeset:

        "Remove support for legacy Notifications"
        https://bugs.webkit.org/show_bug.cgi?id=171487
        http://trac.webkit.org/changeset/216206

2017-05-04  Don Olmstead  <don.olmstead@am.sony.com>

        [Win] Remove redundant macros that are set in the CMake config
        https://bugs.webkit.org/show_bug.cgi?id=171571

        Reviewed by Brent Fulgham.

        * config.h:

2017-05-04  Mark Lam  <mark.lam@apple.com>

        NeverDestroyed<String>(ASCIILiteral(...)) is not thread safe.
        https://bugs.webkit.org/show_bug.cgi?id=171586
        <rdar://problem/31873190>

        Reviewed by Yusuke Suzuki.

        StaticStringImpl is meant to be thread-safe.  However, it has a bug: it did not
        set the s_hashFlagDidReportCost flag.  As a result, if cost() is called on it,
        different threads may try to change its flags bits at the same time.  This patch
        changes StaticStringImpl to always set the s_hashFlagDidReportCost flag.

        Also factored out StringImplShape and made StringImpl and StaticStringImpl extend
        it.  This makes it more clear that the 2 are intended to have the same shape.
        Note: there is already a static_assert that the 2 have the same size.  This
        change also ensures that they both have the same shape, which is a requirement in
        order for StaticStringImpl to work.

        Introduced the MAKE_STATIC_STRING_IMPL macro as a convenient way to instantiate
        StaticStringImpls from literal strings.  This allows us to trivially change

            NeverDestroyed<String> myString(ASCIILiteral("myString"));

        to ...

            NeverDestroyed<String> myString(MAKE_STATIC_STRING_IMPL("myString"));

        and by so doing, make it thread-safe.

        MAKE_STATIC_STRING_IMPL instantiates a lambda function to create the static
        StaticStringImpls.

        * wtf/text/StringImpl.h:
        (WTF::StringImplShape::StringImplShape):
        (WTF::StringImpl::StringImpl):
        (WTF::StringImpl::cost):
        (WTF::StringImpl::setHash):
        (WTF::StringImpl::StaticStringImpl::StaticStringImpl):
        (WTF::StringImpl::StaticStringImpl::operator StringImpl&):
        * wtf/text/WTFString.h:
        (WTF::String::String):
        * wtf/text/icu/TextBreakIteratorICU.h:
        (WTF::caretRules):

2017-05-04  Sam Weinig  <sam@webkit.org>

        Remove support for legacy Notifications
        https://bugs.webkit.org/show_bug.cgi?id=171487

        Reviewed by Jon Lee.

        * wtf/FeatureDefines.h:
        Remove definition of ENABLE_LEGACY_NOTIFICATIONS.

2017-05-04  Yusuke Suzuki  <utatane.tea@gmail.com>

        [GTK][JSCOnly] Implement memoryFootprint for Linux
        https://bugs.webkit.org/show_bug.cgi?id=171680

        Reviewed by Carlos Alberto Lopez Perez.

        Darwin's phys_footprint returns the amount of dirty anonymous memory in the process.
        This patch implements the same thing in Linux by reading /proc/self/smaps.
        We sum sizes of private dirty pages in anonymous regions.

        * wtf/MemoryFootprint.cpp:
        (WTF::forEachLine):
        (WTF::memoryFootprint):

2017-05-03  Mark Lam  <mark.lam@apple.com>

        Use the CLoop for CPU(ARM64E).
        https://bugs.webkit.org/show_bug.cgi?id=171620
        <rdar://problem/31973027>

        Reviewed by Geoffrey Garen.

        * wtf/Platform.h:

2017-05-02  Daniel Bates  <dabates@apple.com>

        Fix the build after <https://trac.webkit.org/changeset/216102>
        (https://bugs.webkit.org/show_bug.cgi?id=170925)

        Export into global scope ASCIICaseInsensitiveStringViewHashTranslator.

        Also fix indentation of member functions of ASCIICaseInsensitiveStringViewHashTranslator.

        * wtf/text/StringHash.h:

2017-05-02  Daniel Bates  <dabates@apple.com>

        Using StringView.split() instead of String.split() in some places
        https://bugs.webkit.org/show_bug.cgi?id=170925

        Reviewed by Darin Adler and Sam Weinig.

        * wtf/HashMap.h: Add HashMap::get() overload that takes a HashTranslator.
        * wtf/text/StringHash.h:
        (WebCore::ASCIICaseInsensitiveStringViewHashTranslator::hash): Added.
        (WebCore::ASCIICaseInsensitiveStringViewHashTranslator::equal): Added.

2017-05-01  Dan Bernstein  <mitz@apple.com>

        [Xcode] It’s easy to accidentally install a WTF header outside /usr/local/include/wtf
        https://bugs.webkit.org/show_bug.cgi?id=171533

        Reviewed by Andy Estes.

        * WTF.xcodeproj/project.pbxproj: Removed the WTF target’s Headers build phase. Its existence
          was making it easy to accidentally add a header to the target and make it Private, which
          would have Xcode install a copy of it right under /usr/local/include, in addition to the
          copy installed under /usr/local/include/wtf by the Copy WTF Headers target.
          Also got rid of INSTALL_PATH_PREFIX in the script build phase in the Copy WTF Headers
          target, because it is being never set anymore.

2017-05-01  Dan Bernstein  <mitz@apple.com>

        WTF installs an extra copy of a header outside /usr/local/include/wtf

        * WTF.xcodeproj/project.pbxproj: Demoted CPUTime.h from Private to Project.

2017-05-01  Daniel Bates  <dabates@apple.com>

        Cleanup: Change ASCIICaseInsensitiveHash from a class to a struct
        https://bugs.webkit.org/show_bug.cgi?id=171460

        Reviewed by Sam Weinig.

        All of the members of ASCIICaseInsensitiveHash have public visibility.
        We are underutilizing the purpose of a class - defaults to private
        visibility of members. We should change ASCIICaseInsensitiveHash from
        a class to a struct, which by definition defaults to public visibility
        for members.

        * wtf/text/StringHash.h:

2017-04-29  Yusuke Suzuki  <utatane.tea@gmail.com>

        Move WebCore CPUTime to WTF and implement it in all the platforms
        https://bugs.webkit.org/show_bug.cgi?id=171477

        Reviewed by Chris Dumez.

        We move WebCore::CPUTime to WTF::CPUTime since it is useful even in JSC
        and it does not depend on any external libraries.
        And we additionally implement WTF::CPUTime in all the platforms: Windows and Unix.

        In CPUTime, instead of holding int64_t, we hold MonotonicTime and Seconds.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/CPUTime.cpp: Copied from Source/WebCore/platform/CPUTime.cpp.
        (WTF::CPUTime::percentageCPUUsageSince):
        * wtf/CPUTime.h: Renamed from Source/WebCore/platform/CPUTime.h.
        * wtf/PlatformEfl.cmake:
        * wtf/PlatformGTK.cmake:
        * wtf/PlatformJSCOnly.cmake:
        * wtf/PlatformMac.cmake:
        * wtf/PlatformWin.cmake:
        * wtf/cocoa/CPUTimeCocoa.mm: Renamed from Source/WebCore/platform/cocoa/CPUTimeCocoa.mm.
        (WTF::timeValueToMicroseconds):
        (WTF::CPUTime::get):
        * wtf/unix/CPUTimeUnix.cpp: Renamed from Source/WebCore/platform/CPUTime.cpp.
        (WTF::timevalToSeconds):
        (WTF::CPUTime::get):
        * wtf/win/CPUTimeWin.cpp: Added.
        (WTF::fileTimeToSeconds):
        (WTF::CPUTime::get):

2017-04-28  Simon Fraser  <simon.fraser@apple.com>

        Add system trace points for Document::updateTouchEventRegions()
        https://bugs.webkit.org/show_bug.cgi?id=171470
        rdar://problem/31901239

        Reviewed by Tim Horton.

        Add trace markers for updateTouchEventRegions.

        * wtf/SystemTracing.h:

2017-04-28  Daniel Bates  <dabates@apple.com>

        Add StringView::toExistingAtomicString()
        https://bugs.webkit.org/show_bug.cgi?id=171405

        Reviewed by Andreas Kling.

        Similar to the reasons for JSString::toExistingAtomicString() we should expose a way to
        convert a StringView to an existing atomic string. Looking up an atomic string is more
        efficient that creating one, which requires a lookup and memory allocation.

        We are not making use of StringView::toExistingAtomicString() now, but will in the patch
        for <https://bugs.webkit.org/show_bug.cgi?id=170925>.

        * wtf/text/AtomicStringImpl.cpp:
        (WTF::AtomicStringImpl::lookUp): Modified to take a const LChar*/UChar*.
        (WTF::AtomicStringImpl::lookUpInternal): Renamed to AtomicStringImpl::lookup() to avoid
        an extra function call.
        * wtf/text/AtomicStringImpl.h:
        * wtf/text/StringView.h:
        (WTF::StringView::toExistingAtomicString): Added.

2017-04-28  Chris Dumez  <cdumez@apple.com>

        Update DOMTokenList.replace() to match the latest DOM specification
        https://bugs.webkit.org/show_bug.cgi?id=171388

        Reviewed by Alex Christensen.

        Add Vector::findMatching() API which takes in a lambda function for convenience.
        Add optional startIndex parameter to Vector::removeFirstMatching() / removeAllMatching()
        to remove items only after given index.

        * wtf/Vector.h:
        (WTF::minCapacity>::findMatching):
        (WTF::minCapacity>::find):
        (WTF::minCapacity>::removeFirstMatching):
        (WTF::minCapacity>::removeAllMatching):

2017-04-27  Carlos Garcia Campos  <cgarcia@igalia.com>

        Move UUID from WebCore/platform to WTF
        https://bugs.webkit.org/show_bug.cgi?id=171372

        Reviewed by Michael Catanzaro.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/UUID.cpp: Renamed from Source/WebCore/platform/UUID.cpp.
        * wtf/UUID.h: Renamed from Source/WebCore/platform/UUID.h.

2017-04-26  Keith Miller  <keith_miller@apple.com>

        LocklessBag needs a destructor
        https://bugs.webkit.org/show_bug.cgi?id=171334

        Reviewed by Mark Lam.

        Currently, if the bag is destructed any remaining nodes in the bag will
        be leaked.

        * wtf/LocklessBag.h:
        (WTF::LocklessBag::consumeAll):
        (WTF::LocklessBag::~LocklessBag):
        * wtf/threads/Signals.cpp:
        (WTF::jscSignalHandler):
        (WTF::installSignalHandler):

2017-04-26  Don Olmstead  <don.olmstead@am.sony.com>

        [ARM] Enable GCC visibility
        https://bugs.webkit.org/show_bug.cgi?id=171296

        Reviewed by Michael Catanzaro.

        * wtf/Platform.h:

2017-04-26  Yusuke Suzuki  <utatane.tea@gmail.com>

        sendMessageScoped's signal handler calls LocklessBag::consumeAll, which causes heap deallocation in signal handler and leads deadlock
        https://bugs.webkit.org/show_bug.cgi?id=171319

        Reviewed by Keith Miller.

        In sendMessageScoped, we call LocklessBag<SignalHandler>::consumeAll `thread->threadMessages().consumeAll()`.
        In LocklessBag::consumeAll, we call `delete` on Nodes.
        The problem is that this is called under the context of signal handler. Thus, when calling this, the original
        thread may hold the lock in bmalloc. In that case, this `delete` call attempts to lock the heap lock recursively,
        and causes deadlock.

        Instead, this patch transfers the LocklessBag's Node to the sender thread. And the sender thread deletes it instead.

        * wtf/LocklessBag.h:
        (WTF::LocklessBag::consumeAllWithNode):
        * wtf/ThreadMessage.cpp:
        (WTF::ThreadMessageData::ThreadMessageData):
        (WTF::sendMessageScoped):

2017-04-25  Don Olmstead  <don.olmstead@am.sony.com>

        [Win] Use Clang's __has_declspec_attribute for export macros
        https://bugs.webkit.org/show_bug.cgi?id=171240

        Reviewed by Alex Christensen.

        * wtf/Compiler.h:
        * wtf/ExportMacros.h:
        * wtf/Platform.h:

2017-04-25  Keith Miller  <keith_miller@apple.com>

        Our signal handler shouldn't print when sigaction succeeds
        https://bugs.webkit.org/show_bug.cgi?id=171286

        Reviewed by Michael Saboff.

        It turns out !result is not the same as !!result.

        * wtf/threads/Signals.cpp:
        (WTF::jscSignalHandler):

2017-04-25  Myles C. Maxfield  <mmaxfield@apple.com>

        Add performance test for FontCache::systemFallbackForCharacters()
        https://bugs.webkit.org/show_bug.cgi?id=170842

        Reviewed by Tim Horton.

        * wtf/unicode/CharacterNames.h:

2017-04-24  Andy VanWagoner  <thetalecrafter@gmail.com>

        Clean up ICU headers
        https://bugs.webkit.org/show_bug.cgi?id=170997

        Reviewed by JF Bastien.

        Update all icu headers to 55.1

        * icu/LICENSE: Update copyright
        * icu/README: Explain ICU headers for OS X better
        * icu/unicode/localpointer.h:
        (LocalPointer::LocalPointer):
        (LocalPointer::adoptInsteadAndCheckErrorCode):
        * icu/unicode/platform.h:
        * icu/unicode/putil.h:
        * icu/unicode/std_string.h:
        * icu/unicode/ubrk.h:
        * icu/unicode/uchar.h:
        * icu/unicode/ucnv.h:
        * icu/unicode/ucol.h:
        * icu/unicode/uconfig.h:
        * icu/unicode/ucurr.h:
        * icu/unicode/uloc.h:
        * icu/unicode/umachine.h:
        * icu/unicode/unistr.h:
        (UnicodeString::getArrayStart):
        (UnicodeString::UnicodeString):
        (UnicodeString::hasShortLength):
        (UnicodeString::getShortLength):
        (UnicodeString::length):
        (UnicodeString::getCapacity):
        (UnicodeString::isBogus):
        (UnicodeString::isWritable):
        (UnicodeString::isBufferWritable):
        (UnicodeString::getBuffer):
        (UnicodeString::isEmpty):
        (UnicodeString::setZeroLength):
        (UnicodeString::setShortLength):
        (UnicodeString::setLength):
        (UnicodeString::setToEmpty):
        (UnicodeString::remove):
        * icu/unicode/urename.h:
        * icu/unicode/uscript.h:
        * icu/unicode/uset.h:
        * icu/unicode/ustring.h:
        * icu/unicode/utf8.h:
        * icu/unicode/utypes.h:
        * icu/unicode/uvernum.h:

2017-04-24  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, fix Windows build after r215715
        https://bugs.webkit.org/show_bug.cgi?id=171199

        * wtf/StackTrace.h:

2017-04-24  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Move JSC tools/StackTrace to WTF and unify stack trace dump code
        https://bugs.webkit.org/show_bug.cgi?id=171199

        Reviewed by Mark Lam.

        JSC tools/StackTrace's dump code is almost identical to WTF Assertions'
        stack trace dump code. This patch moves tools/StackTrace to WTF and use
        it in Assertions. It unifies the two duplicate implementations into one.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/Assertions.cpp:
        * wtf/CMakeLists.txt:
        * wtf/Platform.h:
        * wtf/StackTrace.cpp: Renamed from Source/JavaScriptCore/tools/StackTrace.cpp.
        (WTF::StackTrace::captureStackTrace):
        (WTF::StackTrace::dump):
        * wtf/StackTrace.h: Copied from Source/JavaScriptCore/tools/StackTrace.h.
        (WTF::StackTrace::StackTrace):
        (WTF::StackTrace::stack):
        (WTF::StackTrace::DemangleEntry::mangledName):
        (WTF::StackTrace::DemangleEntry::demangledName):
        (WTF::StackTrace::DemangleEntry::DemangleEntry):
        * wtf/SystemFree.h: Renamed from Source/JavaScriptCore/tools/StackTrace.h.
        (WTF::SystemFree::operator()):

2017-04-24  Yusuke Suzuki  <utatane.tea@gmail.com>

        [AppleWin] The procedure entry point ?waitForThreadCompletion@WTF@@YAHI@Z could not be located in the dynamic link library WebKitQuartzCoreAdditions.dll
        https://bugs.webkit.org/show_bug.cgi?id=171029

        Reviewed by Brent Fulgham.

        While WTF Threading APIs are updated, WebKitQuartzCoreAdditions.dll in Windows uses some of the old APIs,
        waitForThreadCompletion and createThread. This patch implements both on top of the new APIs.
        These APIs are only exposed in Windows for this compatibility problem and new code should not use it.

        * wtf/ThreadHolder.cpp:
        (WTF::ThreadHolder::initialize):
        * wtf/ThreadHolder.h:
        * wtf/ThreadHolderWin.cpp:
        (WTF::ThreadHolder::get):
        (WTF::ThreadHolder::platformInitialize):
        (WTF::ThreadHolder::destruct):
        * wtf/Threading.h:
        * wtf/ThreadingWin.cpp:
        (WTF::createThread):
        (WTF::waitForThreadCompletion):

2017-04-24  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Switch to use ENABLE_REMOTE_INSPECTOR instead of ENABLE_INSPECTOR_SERVER for the remote inspector
        https://bugs.webkit.org/show_bug.cgi?id=166680

        Reviewed by Michael Catanzaro.

        Add GRefPtr hash traits to allow using GRefPtr as a key of HashMaps.

        * wtf/glib/GRefPtr.h:
        (WTF::HashTraits<GRefPtr<P>>::emptyValue):
        (WTF::HashTraits<GRefPtr<P>>::peek):
        (WTF::HashTraits<GRefPtr<P>>::customDeleteBucket):

2017-04-22  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Get stack pointer without pthread attr
        https://bugs.webkit.org/show_bug.cgi?id=171162

        Reviewed by Mark Lam.

        If HAVE(MACHINE_CONTEXT) is not enabled, we get stack base and boundary by using
        pthread_attr functions. However, it is wrong since this function can be called
        after the thread is suspended. In that case, we should not call any functions
        that is not async signal safe. For example, pthread_getattr_np calls malloc.

        Instead we use getApproximateStackPointer(), which returns approximate stack pointer.

        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::getApproximateStackPointer):
        (WTF::isOnAlternativeSignalStack):
        When gathering conservative roots, we should keep stack pointer pointing stack.
        And if concurrent GC is enabled, we always need to keep the above invariant.
        So, we do not support alternative signal stack.

        (WTF::Thread::signalHandlerSuspendResume):
        (WTF::Thread::getRegisters):

2017-04-22  Yusuke Suzuki  <utatane.tea@gmail.com>

        REGRESSION(r215638): [Linux] Several worker tests are crashing in Thread::signalHandlerSuspendResume after r215638
        https://bugs.webkit.org/show_bug.cgi?id=171159

        Reviewed by Michael Catanzaro.

        Now, SIGUSR2 is used by ThreadMessage. Instead SIGUSR1 becomes empty.
        We should use some signal, that is not managed by WTF Signal mechanism
        because the behaivor of this suspend and resume is a bit tricky.
        For example, we set a bit tricky signal mask to sigaction to temporary
        block SIGUSR2 in the handler to avoid nested SIGUSR2. And we cannot
        use ThreadMessage to implement this mechanism because this suspend
        and resume handler will stop in the middle of the handler by sigsuspend.
        It is not the expected semantics by ThreadMessage.

        So now, we use SIGUSR1 instead. And we note that SIGUSR1 is used for
        pthread ports.

        * wtf/ThreadingPthreads.cpp:
        * wtf/threads/Signals.h:

2017-04-20  Sam Weinig  <sam@webkit.org>

        Split cryptographic digest computation and parsing out of CSP code so it can be reused
        https://bugs.webkit.org/show_bug.cgi?id=171076

        Reviewed by Chris Dumez.

        * wtf/text/Base64.cpp:
        (WTF::base64Decode):
        (WTF::base64URLDecode):
        Add overloads for base64Decode and base64URLDecode that take a StringView, to avoid allocations
        of Strings.

        * wtf/text/Base64.h:
        (WTF::isBase64OrBase64URLCharacter):
        Move helper predicate used for parsing either type of Base64 encoded string from WebCore.

2017-04-21  Keith Miller  <keith_miller@apple.com>

        Unreviewed, rolling out r215634.

        underlying build issues should have been fixed

        Reverted changeset:

        "Unreviewed, rolling out r215620 and r215623."
        https://bugs.webkit.org/show_bug.cgi?id=171139
        http://trac.webkit.org/changeset/215634

2017-04-21  Keith Miller  <keith_miller@apple.com>

        Remove LL/SC from Atomics
        https://bugs.webkit.org/show_bug.cgi?id=171141

        Reviewed by Saam Barati.

        Adding load link and store conditionally was not an actual progression
        and the existing code is causing problems for users of Atomics. So let's
        get rid of it.

        * wtf/Atomics.h:
        (WTF::hasFence):
        (WTF::Atomic::exchange):
        (WTF::Atomic::transaction):
        (WTF::Atomic::transactionRelaxed):
        (WTF::Atomic::prepare): Deleted.
        (WTF::Atomic::attempt): Deleted.
        * wtf/Bitmap.h:
        (WTF::WordType>::concurrentTestAndSet):
        (WTF::WordType>::concurrentTestAndClear):
        * wtf/LockAlgorithm.h:
        (WTF::LockAlgorithm::lockFast):
        (WTF::LockAlgorithm::unlockFast):

2017-04-21  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r215620 and r215623.
        https://bugs.webkit.org/show_bug.cgi?id=171139

        broke arm64 build (Requested by keith_miller on #webkit).

        Reverted changesets:

        "Add signaling API"
        https://bugs.webkit.org/show_bug.cgi?id=170976
        http://trac.webkit.org/changeset/215620

        "Unreviewed, fix Cloop build."
        http://trac.webkit.org/changeset/215623

2017-04-20  Keith Miller  <keith_miller@apple.com>

        Add signaling API
        https://bugs.webkit.org/show_bug.cgi?id=170976

        Reviewed by Filip Pizlo.

        This patch adds a bunch of new functionality to WTF. First, it add
        a new data structure of a lockless bag. The LocklessBag class can
        be used as either a multi-writer multi-reader lockless bag or a
        multi-writer single consumer lockless bag.

        Next, this patch adds an abstraction around sigaction in WTF.
        Basically, you can add a handler, which can be an arbitrary
        lambda. Although it should still be safe for the signal you are
        handling.  the signal handler manager will then do all the
        appropriate handling of chaining:

        In the SIGUSR case we always forward the signal to any other
        non-default handler installed before us. We need to do this,
        otherwise, since it's not possible to tell if a SIGUSR was
        intended exlusively for our handlers. Signal handlers don't record
        how many times they were sent only that there is at least one
        unhandled signal.

        In the faulting cases we require that every handle be able to
        recognise a fault they installed, vs crashes. If none of our
        handlers claim to have handled the fault we will forward the
        fault. If a handler was installed before the first fault handler
        we simply call that handler and rely on them to take the
        appropriate action. If no handler was installed before our first
        handler we restore the default handler and allow the fault to
        happen again.

        Finally, this patch adds a signal based messaging system.  This
        system allows the user to run an arbitrary lambda from the SIGUSR2
        signal handler of any target WTF::Thread. This is already in use
        for the VMTraps API which allows us to kill rogue VMs by sending
        the VM's running WTF::Thread a SIGUSR and requesting it jetison
        all optimized code and throw an uncatchable exception from all
        function entries/loop backedges.  In the future, we will also use
        this API for Wasm to reset the instruction caches in currently
        executing Wasm threads.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/Atomics.h:
        (WTF::Atomic::Atomic):
        * wtf/LocklessBag.h: Added.
        (WTF::LocklessBag::LocklessBag):
        (WTF::LocklessBag::add):
        (WTF::LocklessBag::iterate):
        (WTF::LocklessBag::consumeAll):
        * wtf/ThreadMessage.cpp: Added.
        (WTF::ThreadMessageData::ThreadMessageData):
        (WTF::initializeThreadMessages):
        (WTF::sendMessageScoped):
        * wtf/ThreadMessage.h: Added.
        (WTF::sendMessage):
        * wtf/Threading.cpp:
        (WTF::initializeThreading):
        * wtf/Threading.h:
        (WTF::Thread::threadMessages):
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::currentMayBeNull):
        (WTF::Thread::current):
        (WTF::Thread::signal):
        * wtf/threads/Signals.cpp: Added.
        (WTF::jscSignalHandler):
        (WTF::installSignalHandler):
        * wtf/threads/Signals.h: Added.
        (WTF::toSystemSignal):
        (WTF::fromSystemSignal):

2017-04-21  Konstantin Tokarev  <annulen@yandex.ru>

        [cmake] WTF target should not have wtf and subdirectries in public interface
        https://bugs.webkit.org/show_bug.cgi?id=171115

        Reviewed by Michael Catanzaro.

        In r209665 WEBCORE_FRAMEWORK macro started to export INCLUDE_DIRECTORIES of
        targets as their public interface, so that linked targets can use them
        implicitly without copying directory lists around. This matches existing
        practice for all targets except WTF, headers from which are always included
        with full path starting from "<wtf/...".

        Since r209665 it became possible to include headers from wtf or its
        subdirectories in CMake builds without using "<wtf/..." path. It should
        not be allowed.

        * wtf/CMakeLists.txt: WTF/wtf and its sudirectories should not be in
        public include paths of WTF target.

2017-04-20  Sam Weinig  <sam@webkit.org>

        Move notFound into its own file
        https://bugs.webkit.org/show_bug.cgi?id=170972

        Reviewed by Zalan Bujtas.

        It is odd to require including <wtf/Vector.h> just to use WTF::notFound.
        This is not causing any current problems, but does in few changes I have
        queued up.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/NotFound.h: Added.
        * wtf/Vector.h:
        * wtf/text/StringCommon.h:

2017-04-20  Filip Pizlo  <fpizlo@apple.com>

        Optimize SharedArrayBuffer in the DFG+FTL
        https://bugs.webkit.org/show_bug.cgi?id=164108

        Reviewed by Saam Barati.
        
        Made small changes as part of benchmarking the JS versions of these locks.

        * benchmarks/LockSpeedTest.cpp:
        * benchmarks/ToyLocks.h:
        * wtf/Range.h:
        (WTF::Range::dump):

2017-04-19  Youenn Fablet  <youenn@apple.com>

        [Win] Activate streams API by default
        https://bugs.webkit.org/show_bug.cgi?id=171000

        Reviewed by Brent Fulgham.

        * wtf/FeatureDefines.h:

2017-04-19  David Kilzer  <ddkilzer@apple.com>

        Vector.h: error: 'auto' not allowed in lambda parameter
        <https://webkit.org/b/171010>
        <rdar://problem/31716076>

        Reviewed by Saam Barati.

        * wtf/Vector.h:
        (WTF::removeRepeatedElements): Replace 'auto' with a specific
        type, 'T', based on a Vector<> template type.

2017-04-19  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r215518.

        This change appears to have broken the Windows build.

        Reverted changeset:

        "Move notFound into its own file"
        https://bugs.webkit.org/show_bug.cgi?id=170972
        http://trac.webkit.org/changeset/215518

2017-04-19  Sam Weinig  <sam@webkit.org>

        Move notFound into its own file
        https://bugs.webkit.org/show_bug.cgi?id=170972

        Reviewed by Zalan Bujtas.

        It is odd to require including <wtf/Vector.h> just to use WTF::notFound.
        This is not causing any current problems, but does in few changes I have
        queued up.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/NotFound.h: Added.
        * wtf/Vector.h:
        * wtf/text/StringCommon.h:

2017-04-18  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GLIB] Define priorities also for async network IO tasks
        https://bugs.webkit.org/show_bug.cgi?id=170905

        Reviewed by Žan Doberšek.

        Add AsyncIONetwork, DiskCacheRead and DiskCacheWrite priorities.

        * wtf/glib/RunLoopSourcePriority.h:

2017-04-18  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC][GTK] glib RunLoop does not accept negative start interval
        https://bugs.webkit.org/show_bug.cgi?id=170775

        Reviewed by Saam Barati.

        RunLoop::Timer for glib does not accept negative start interval.
        We use 0_s if the given value is negative.

        * wtf/glib/RunLoopGLib.cpp:
        (WTF::RunLoop::TimerBase::secondsUntilFire):

2017-04-17  Alex Christensen  <achristensen@webkit.org>

        Allow Variants of RetainPtrs
        https://bugs.webkit.org/show_bug.cgi?id=170923

        Reviewed by Tim Horton and Sam Weinig.

        * wtf/RetainPtr.h:
        (WTF::RetainPtr::operator&): Deleted.
        Operator& was causing a compile error when making Variant<RetainPtr<T>, ...>
        and because it is strange and only used once, let's just remove it.
        * wtf/Variant.h:
        (WTF::get):
        (WTF::get_if):
        Use std::addressof instead of operator& which could be overloaded to return any type with any meaning.

2017-04-17  Youenn Fablet  <youenn@apple.com>

        Disable outdated WritableStream API
        https://bugs.webkit.org/show_bug.cgi?id=170749
        <rdar://problem/31446233>

        Reviewed by Alex Christensen.

        Replacing READABLE_STREAM_API, READABLE_BYTE_STREAM_API and WRITABLE_STREAM_API compilation flag by:
        - A STREAMS_API compilation flag.
        - A ReadableByteStreamAPI and WritableStreamAPI runtime flags, turned off except for RWT and DRT.

        * wtf/FeatureDefines.h:

2017-04-17  Dan Bernstein  <mitz@apple.com>

        [Cocoa] Move isNullFunctionPointer down into WTF
        https://bugs.webkit.org/show_bug.cgi?id=170892

        Reviewed by Sam Weinig.

        Test: TestWebKitAPI/Tests/WTF/darwin/WeakLinking.cpp

        * WTF.xcodeproj/project.pbxproj: Added reference to new file.
        * wtf/darwin: Added.
        * wtf/darwin/WeakLinking.h: Added.
        (WTF::isNullFunctionPointer): Copied from ResourceLoadStatisticsClassifierCocoa.cpp in
          WebKit2 and changed into a function template that works with any function pointer.

2017-04-17  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r215366.

        This test is failing on performance bots.

        Reverted changeset:

        "Add performance test for asking the platform for a font for
        U+2060 WORD JOINER"
        https://bugs.webkit.org/show_bug.cgi?id=170842
        http://trac.webkit.org/changeset/215366

2017-04-17  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSCOnly] Fix build failures in macOS
        https://bugs.webkit.org/show_bug.cgi?id=170887

        Reviewed by Alex Christensen.

        JSCOnly port does not use mac/MainThread.cpp.
        We change the ifdef gurard to use generic implementaion in JSCOnly on macOS.

        * wtf/MainThread.cpp:
        * wtf/PlatformJSCOnly.cmake:

2017-04-17  JF Bastien  <jfbastien@apple.com>

        B3: don't allow unsigned offsets in Value
        https://bugs.webkit.org/show_bug.cgi?id=170692

        Reviewed by Filip Pizlo.

        Add C++17's std::conjunction type trait, except for Microsoft VS
        2015 update 2 and later because it adds the logical operator type
        traits, event when C++ is pre-2017:
        https://blogs.msdn.microsoft.com/vcblog/2016/01/22/vs-2015-update-2s-stl-is-c17-so-far-feature-complete/

        * wtf/StdLibExtras.h:

2017-04-14  Mark Lam  <mark.lam@apple.com>

        Update architectures in xcconfig files.
        https://bugs.webkit.org/show_bug.cgi?id=170867
        <rdar://problem/31628104>

        Reviewed by Joseph Pecoraro.

        * Configurations/Base.xcconfig:

2017-04-14  Myles C. Maxfield  <mmaxfield@apple.com>

        Add performance test for asking the platform for a font for U+2060 WORD JOINER
        https://bugs.webkit.org/show_bug.cgi?id=170842

        Reviewed by Tim Horton.

        * wtf/unicode/CharacterNames.h:

2017-04-13  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Date.parse should accept wider range of representation
        https://bugs.webkit.org/show_bug.cgi?id=170720

        Reviewed by Darin Adler.

        We would like to relax Date.parse to accept the representation "May 8".
        At that time, we choose `2000` as a default year. This is because of
        the following reason.

        1. According to the V8, this default value is compatible to the old KJS. While current V8 uses 2001,
           SpiderMonkey does not have such a fallback path. So this reason is not big deal.

        2. It is a leap year. When using `new Date("Feb 29")`, we assume that people want to save month and day.
           Leap year can save user inputs if they is valid. If we use the current year instead, the current year
           may not be a leap year. In that case, `new Date("Feb 29").getMonth()` becomes 2 (March).

        * wtf/DateMath.cpp:
        (WTF::parseDateFromNullTerminatedCharacters):

2017-04-13  Dan Bernstein  <mitz@apple.com>

        WTF installs an extra copy of a header outside /usr/local/include/wtf

        * WTF.xcodeproj/project.pbxproj: Demoted PriorityQueue.h from Private to Project.

2017-04-13  Oliver Hunt  <oliver@apple.com>

        allocationSize should use safe arithmetic by default
        https://bugs.webkit.org/show_bug.cgi?id=170804

        Reviewed by JF Bastien.

        Make all allocationSize() functions work in terms
        of Checked<size_t>

        * wtf/text/StringImpl.h:
        (WTF::StringImpl::allocationSize):
        (WTF::StringImpl::tailOffset):

2017-04-13  JF Bastien  <jfbastien@apple.com>

        WebAssembly: manage memory better
        https://bugs.webkit.org/show_bug.cgi?id=170628

        Reviewed by Keith Miller, Michael Saboff.

        Re-use a VM tag which was intended for JavaScript core, was then
        used by our GC, and is now unused. If I don't do this then
        WebAssembly fast memories will make vmmap look super weird because
        it'll look like multi-gigabyte of virtual memory are allocated as
        part of our process' regular memory!

        Separately I need to update vmmap and other tools to print the
        right name. Right now this tag gets identified as "JS garbage
        collector".

        * wtf/OSAllocator.h:
        * wtf/VMTags.h:

2017-04-13  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Use proper ifdef guard for code using MachineContext
        https://bugs.webkit.org/show_bug.cgi?id=170800

        Reviewed by Carlos Alberto Lopez Perez.

        SamplingProfiler and FastMemory rely on MachineContext feature.

        * wtf/Platform.h:

2017-04-12  Dan Bernstein  <mitz@apple.com>

        [Mac] Future-proof .xcconfig files
        https://bugs.webkit.org/show_bug.cgi?id=170802

        Reviewed by Tim Horton.

        * Configurations/Base.xcconfig:
        * Configurations/DebugRelease.xcconfig:

2017-04-12  Yusuke Suzuki  <utatane.tea@gmail.com>

        Use HAVE(MACHINE_CONTEXT) instead of USE(MACHINE_CONTEXT)
        https://bugs.webkit.org/show_bug.cgi?id=170770

        Rubber stamped by Mark Lam.

        * wtf/Platform.h:
        * wtf/PlatformRegisters.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::getRegisters):

2017-04-12  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Clean up heap/MachineStackMarker by introducing USE(MACHINE_CONTEXT)
        https://bugs.webkit.org/show_bug.cgi?id=170770

        Reviewed by Mark Lam.

        We add a new define USE_MACHINE_CONTEXT, which becomes true if mcontext_t exists
        and we know the way to retrieve values from mcontext_t.

        * wtf/Platform.h:
        * wtf/PlatformRegisters.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::getRegisters):

2017-04-12  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Introduce Thread class and use RefPtr<Thread> and align Windows Threading implementation semantics to Pthread one
        https://bugs.webkit.org/show_bug.cgi?id=170502

        Reviewed by Mark Lam.

        This patch is refactoring of WTF Threading mechanism to merge JavaScriptCore's threading extension to WTF Threading.
        Previously, JavaScriptCore requires richer threading features (such as suspending and resuming threads), and they
        are implemented for PlatformThread in JavaScriptCore. But these features should be implemented in WTF Threading side
        instead of maintaining JSC's own threading features too. This patch removes these features from JSC and move it to
        WTF Threading.

        However, current WTF Threading has one problem: Windows version of WTF Threading has different semantics from Pthreads
        one. In Windows WTF Threading, we cannot perform any operation after the target thread is detached: WTF Threading stop
        tracking the state of the thread once the thread is detached. But this is not the same to Pthreads one. In Pthreads,
        pthread_detach just means that the resource of the thread will be destroyed automatically. While some operations like
        pthread_join will be rejected, some operations like pthread_kill will be accepted.

        The problem is that detached thread can be suspended and resumed in JSC. For example, in jsc.cpp, we start the worker
        thread and detach it immediately. In worker thread, we will create VM and thus concurrent GC will suspend and resume
        the detached thread. However, in Windows WTF Threading, we have no reference to the detached thread. Thus we cannot
        perform suspend and resume operations onto the detached thread.

        To solve the problem, we change Windows Threading mechanism drastically to align it to the Pthread semantics. In the
        new Threading, we have RefPtr<Thread> class. It holds a handle to a platform thread. We can perform threading operations
        with this class. For example, Thread::suspend is offered. And we use destructor of the thread local variable to release
        the resources held by RefPtr<Thread>. In Windows, Thread::detach does nothing because the resource will be destroyed
        automatically by RefPtr<Thread>.

        To do so, we introduce ThreadHolder for Windows. This is similar to the previous ThreadIdentifierData for Pthreads.
        It holds RefPtr<Thread> in the thread local storage (technically, it is Fiber Local Storage in Windows). Thread::current()
        will return this reference.

        The problematic situation is that the order of the deallocation of the thread local storage is not defined. So we should
        not touch thread local storage in the destructor of the thread local storage. To avoid such edge cases, we have
        currentThread() / Thread::currentID() APIs. They are safe to be called even in the destructor of the other thread local
        storage. And in Windows, in the FLS destructor, we will create the thread_local variable to defer the destruction of
        the ThreadHolder. We ensure that this destructor is called after the other FLS destructors are called in Windows 10.

        This patch is performance neutral.

        * WTF.xcodeproj/project.pbxproj:
        * benchmarks/ConditionSpeedTest.cpp:
        * benchmarks/LockFairnessTest.cpp:
        * benchmarks/LockSpeedTest.cpp:
        * wtf/AutomaticThread.cpp:
        (WTF::AutomaticThread::start):
        * wtf/CMakeLists.txt:
        * wtf/MainThread.h:
        * wtf/MemoryPressureHandler.h:
        * wtf/ParallelJobsGeneric.cpp:
        (WTF::ParallelEnvironment::ThreadPrivate::tryLockFor):
        (WTF::ParallelEnvironment::ThreadPrivate::workerThread):
        * wtf/ParallelJobsGeneric.h:
        (WTF::ParallelEnvironment::ThreadPrivate::ThreadPrivate): Deleted.
        * wtf/ParkingLot.cpp:
        (WTF::ParkingLot::forEachImpl):
        * wtf/ParkingLot.h:
        (WTF::ParkingLot::forEach):
        * wtf/PlatformRegisters.h: Renamed from Source/JavaScriptCore/runtime/PlatformThread.h.
        * wtf/RefPtr.h:
        (WTF::RefPtr::RefPtr):
        * wtf/ThreadFunctionInvocation.h:
        (WTF::ThreadFunctionInvocation::ThreadFunctionInvocation):
        * wtf/ThreadHolder.cpp: Added.
        (WTF::ThreadHolder::~ThreadHolder):
        (WTF::ThreadHolder::initialize):
        * wtf/ThreadHolder.h: Renamed from Source/WTF/wtf/ThreadIdentifierDataPthreads.h.
        (WTF::ThreadHolder::thread):
        (WTF::ThreadHolder::ThreadHolder):
        * wtf/ThreadHolderPthreads.cpp: Renamed from Source/WTF/wtf/ThreadIdentifierDataPthreads.cpp.
        (WTF::ThreadHolder::initializeOnce):
        (WTF::ThreadHolder::current):
        (WTF::ThreadHolder::destruct):
        * wtf/ThreadHolderWin.cpp: Added.
        (WTF::threadMapMutex):
        (WTF::threadMap):
        (WTF::ThreadHolder::initializeOnce):
        (WTF::ThreadHolder::current):
        (WTF::ThreadHolder::destruct):
        * wtf/ThreadSpecific.h:
        * wtf/Threading.cpp:
        (WTF::Thread::normalizeThreadName):
        (WTF::threadEntryPoint):
        (WTF::Thread::create):
        (WTF::Thread::setCurrentThreadIsUserInteractive):
        (WTF::Thread::setCurrentThreadIsUserInitiated):
        (WTF::Thread::setGlobalMaxQOSClass):
        (WTF::Thread::adjustedQOSClass):
        (WTF::Thread::dump):
        (WTF::initializeThreading):
        (WTF::normalizeThreadName): Deleted.
        (WTF::createThread): Deleted.
        (WTF::setCurrentThreadIsUserInteractive): Deleted.
        (WTF::setCurrentThreadIsUserInitiated): Deleted.
        (WTF::setGlobalMaxQOSClass): Deleted.
        (WTF::adjustedQOSClass): Deleted.
        * wtf/Threading.h:
        (WTF::Thread::id):
        (WTF::Thread::operator==):
        (WTF::Thread::operator!=):
        (WTF::Thread::joinableState):
        (WTF::Thread::didBecomeDetached):
        (WTF::Thread::didJoin):
        (WTF::Thread::hasExited):
        (WTF::currentThread):
        * wtf/ThreadingPthreads.cpp:
        (WTF::Thread::Thread):
        (WTF::Thread::~Thread):
        (WTF::Thread::signalHandlerSuspendResume):
        (WTF::Thread::initializePlatformThreading):
        (WTF::initializeCurrentThreadEvenIfNonWTFCreated):
        (WTF::wtfThreadEntryPoint):
        (WTF::Thread::createInternal):
        (WTF::Thread::initializeCurrentThreadInternal):
        (WTF::Thread::changePriority):
        (WTF::Thread::waitForCompletion):
        (WTF::Thread::detach):
        (WTF::Thread::current):
        (WTF::Thread::currentID):
        (WTF::Thread::signal):
        (WTF::Thread::resume):
        (WTF::Thread::getRegisters):
        (WTF::Thread::didExit):
        (WTF::Thread::establish):
        (WTF::PthreadState::PthreadState): Deleted.
        (WTF::PthreadState::joinableState): Deleted.
        (WTF::PthreadState::pthreadHandle): Deleted.
        (WTF::PthreadState::didBecomeDetached): Deleted.
        (WTF::PthreadState::didExit): Deleted.
        (WTF::PthreadState::didJoin): Deleted.
        (WTF::PthreadState::hasExited): Deleted.
        (WTF::threadMapMutex): Deleted.
        (WTF::initializeThreading): Deleted.
        (WTF::threadMap): Deleted.
        (WTF::identifierByPthreadHandle): Deleted.
        (WTF::establishIdentifierForPthreadHandle): Deleted.
        (WTF::pthreadHandleForIdentifierWithLockAlreadyHeld): Deleted.
        (WTF::createThreadInternal): Deleted.
        (WTF::initializeCurrentThreadInternal): Deleted.
        (WTF::changeThreadPriority): Deleted.
        (WTF::waitForThreadCompletion): Deleted.
        (WTF::detachThread): Deleted.
        (WTF::threadDidExit): Deleted.
        (WTF::currentThread): Deleted.
        (WTF::signalThread): Deleted.
        * wtf/ThreadingWin.cpp:
        (WTF::Thread::Thread):
        (WTF::Thread::~Thread):
        (WTF::Thread::initializeCurrentThreadInternal):
        (WTF::Thread::initializePlatformThreading):
        (WTF::wtfThreadEntryPoint):
        (WTF::Thread::createInternal):
        (WTF::Thread::changePriority):
        (WTF::Thread::waitForCompletion):
        (WTF::Thread::detach):
        (WTF::Thread::resume):
        (WTF::Thread::getRegisters):
        (WTF::Thread::current):
        (WTF::Thread::currentID):
        (WTF::Thread::didExit):
        (WTF::Thread::establish):
        (WTF::initializeCurrentThreadInternal): Deleted.
        (WTF::threadMapMutex): Deleted.
        (WTF::initializeThreading): Deleted.
        (WTF::threadMap): Deleted.
        (WTF::storeThreadHandleByIdentifier): Deleted.
        (WTF::threadHandleForIdentifier): Deleted.
        (WTF::clearThreadHandleForIdentifier): Deleted.
        (WTF::createThreadInternal): Deleted.
        (WTF::changeThreadPriority): Deleted.
        (WTF::waitForThreadCompletion): Deleted.
        (WTF::detachThread): Deleted.
        (WTF::currentThread): Deleted.
        * wtf/WorkQueue.cpp:
        (WTF::WorkQueue::concurrentApply):
        * wtf/WorkQueue.h:
        * wtf/cocoa/WorkQueueCocoa.cpp:
        (WTF::dispatchQOSClass):
        * wtf/generic/WorkQueueGeneric.cpp:
        (WorkQueue::platformInitialize):
        (WorkQueue::platformInvalidate):
        * wtf/linux/MemoryPressureHandlerLinux.cpp:
        (WTF::MemoryPressureHandler::EventFDPoller::EventFDPoller):
        (WTF::MemoryPressureHandler::EventFDPoller::~EventFDPoller):
        * wtf/win/MainThreadWin.cpp:
        (WTF::initializeMainThreadPlatform):

2017-04-11  Zan Dobersek  <zdobersek@igalia.com>

        [GTK] Use the DisplayRefreshMonitor facilities
        https://bugs.webkit.org/show_bug.cgi?id=170599

        Reviewed by Carlos Garcia Campos.

        * wtf/Platform.h: Enable USE_REQUEST_ANIMATION_FRAME_DISPLAY_MONITOR for the GTK+ port.
        * wtf/glib/RunLoopSourcePriority.h: Add the DisplayRefreshMonitorTimer entry that
        matches the value of LayerFlushTimer.

2017-04-11  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WebCore][JSC] ResourceUsageData.{timeOfNextEdenCollection,timeOfNextFullCollection} should be MonotonicTime
        https://bugs.webkit.org/show_bug.cgi?id=170725

        Reviewed by Sam Weinig.

        Make MonotonicTime more constexpr friendly mainly to annotate MonotonicTime::nan() as constexpr.

        * wtf/MonotonicTime.h:
        (WTF::MonotonicTime::MonotonicTime):
        (WTF::MonotonicTime::fromRawSeconds):
        (WTF::MonotonicTime::infinity):
        (WTF::MonotonicTime::nan):
        (WTF::MonotonicTime::secondsSinceEpoch):
        (WTF::MonotonicTime::operator bool):
        (WTF::MonotonicTime::operator+):
        (WTF::MonotonicTime::operator-):
        (WTF::MonotonicTime::operator==):
        (WTF::MonotonicTime::operator!=):
        (WTF::MonotonicTime::operator<):
        (WTF::MonotonicTime::operator>):
        (WTF::MonotonicTime::operator<=):
        (WTF::MonotonicTime::operator>=):

2017-04-11  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, build fix for Windows port after r215228
        https://bugs.webkit.org/show_bug.cgi?id=170723

        * wtf/win/RunLoopWin.cpp:
        (WTF::RunLoop::TimerBase::timerFired):

2017-04-11  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC][GTK] Use RunLoop::Timer in GTK port
        https://bugs.webkit.org/show_bug.cgi?id=170723

        Reviewed by Carlos Garcia Campos.

        Add secondsUntilFire method. And add setName and setPriority
        for GTK RunLoop::Timer.

        * wtf/RunLoop.h:
        * wtf/cf/RunLoopCF.cpp:
        (WTF::RunLoop::TimerBase::secondsUntilFire):
        * wtf/generic/RunLoopGeneric.cpp:
        (WTF::RunLoop::TimerBase::secondsUntilFire):
        * wtf/glib/RunLoopGLib.cpp:
        (WTF::RunLoop::TimerBase::setName):
        (WTF::RunLoop::TimerBase::secondsUntilFire):
        * wtf/win/RunLoopWin.cpp:
        (WTF::RunLoop::TimerBase::timerFired):
        (WTF::RunLoop::TimerBase::start):
        (WTF::RunLoop::TimerBase::isActive):
        (WTF::RunLoop::TimerBase::secondsUntilFire):

2017-04-11  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Enable JSRunLoopTimer for JSCOnly and Windows
        https://bugs.webkit.org/show_bug.cgi?id=170655

        Reviewed by Carlos Garcia Campos.

        This patch makes RunLoop::Timer in Generic and Windows thread-safe to use it
        in JSC's JSRunLoopTimer. Eventually, we would like to replace JSRunLoopTimer's
        platform-dependent implementation to WTF::RunLoop::Timer.

        * wtf/RunLoop.h:
        * wtf/cf/RunLoopCF.cpp:
        (WTF::RunLoop::TimerBase::start):
        * wtf/generic/RunLoopGeneric.cpp:
        (WTF::RunLoop::TimerBase::ScheduledTask::EarliestSchedule::operator()):
        (WTF::RunLoop::populateTasks):
        (WTF::RunLoop::runImpl):
        (WTF::RunLoop::schedule):
        (WTF::RunLoop::scheduleAndWakeUp):
        (WTF::RunLoop::TimerBase::~TimerBase):
        (WTF::RunLoop::TimerBase::start):
        (WTF::RunLoop::TimerBase::stop):
        (WTF::RunLoop::TimerBase::isActive):
        * wtf/glib/RunLoopGLib.cpp:
        (WTF::RunLoop::TimerBase::TimerBase):
        * wtf/win/RunLoopWin.cpp:
        (WTF::RunLoop::TimerBase::timerFired):
        (WTF::RunLoop::TimerBase::start):
        (WTF::RunLoop::TimerBase::stop):
        (WTF::RunLoop::TimerBase::isActive):

2017-04-11  Zan Dobersek  <zdobersek@igalia.com>

        REGRESSION(r213645): It made JSC tests super slow and timeout on AArch64 Linux
        https://bugs.webkit.org/show_bug.cgi?id=169510

        Reviewed by Saam Barati.

        Add the `volatile` qualifiers for ASM statements that set up ldxr and stxr
        instruction calls when HAVE(LL_SC) is enabled for aarch64 platforms.

        This avoids indefinite execution when running GCC-compiled JSC on Linux.
        Specific bug or expected behavior that differs from Clang wasn't determined.

        HAVE(LL_SC) is re-enabled on non-Darwin aarch64 platforms.

        * wtf/Atomics.h:
        * wtf/Platform.h:

2017-04-10  Thorsten Glaser  <tg@mirbsd.de>

        [GTK] Fix x32 build
        https://bugs.webkit.org/show_bug.cgi?id=170673

        Reviewed by Carlos Alberto Lopez Perez.

        * wtf/Platform.h:

2017-04-09  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Annotate Seconds' member functions and operators with constexpr
        https://bugs.webkit.org/show_bug.cgi?id=170662

        Reviewed by Daniel Bates.

        Annotate Seconds' member functions and operators with constexpr.
        It allows us to use Seconds calculation in compile time and use these
        calculation for static const global variables.

        operator% is an exception: it uses fmod and it is not offered as constexpr.

        * wtf/MathExtras.h:
        (defaultMinimumForClamp):
        (defaultMaximumForClamp):
        (clampToAccepting64):
        Super unfortunate ugly code. This is because GCC 4.9 does not support C++14 relaxed constexpr.

        * wtf/Seconds.h:
        (WTF::Seconds::Seconds):
        (WTF::Seconds::value):
        (WTF::Seconds::minutes):
        (WTF::Seconds::seconds):
        (WTF::Seconds::milliseconds):
        (WTF::Seconds::microseconds):
        (WTF::Seconds::nanoseconds):
        (WTF::Seconds::operator bool):
        (WTF::Seconds::operator+):
        (WTF::Seconds::operator-):
        (WTF::Seconds::operator*):
        (WTF::Seconds::operator/):
        (WTF::Seconds::operator==):
        (WTF::Seconds::operator!=):
        (WTF::Seconds::operator<):
        (WTF::Seconds::operator>):
        (WTF::Seconds::operator<=):
        (WTF::Seconds::operator>=):

2017-04-09  Chris Dumez  <cdumez@apple.com>

        Start dropping Timer API dealing with double
        https://bugs.webkit.org/show_bug.cgi?id=170649

        Reviewed by Yusuke Suzuki.

        Start dropping Timer API dealing with double as people should use Seconds now.

        * wtf/RunLoopTimer.h:
        * wtf/glib/MainThreadGLib.cpp:
        (WTF::MainThreadDispatcher::schedule):

2017-04-07  Keith Miller  <keith_miller@apple.com>

        Unreviewed, remove constexpr function since GTK didn't like it.

        * wtf/PriorityQueue.h:
        (WTF::PriorityQueue::parentOf):

2017-04-07  Chris Dumez  <cdumez@apple.com>

        Start using MonotonicTime / Seconds in Timer class
        https://bugs.webkit.org/show_bug.cgi?id=170625

        Reviewed by Simon Fraser.

        Add modulo operator to MonotonicTime.

        * wtf/MonotonicTime.h:
        (WTF::MonotonicTime::operator%):

2017-04-07  Keith Miller  <keith_miller@apple.com>

        Add a PriorityQueue class
        https://bugs.webkit.org/show_bug.cgi?id=170579

        Reviewed by Saam Barati.

        This patch adds a new PriorityQueue class that is backed by
        WTF::Vector.  It also has a number of other niceties such as being
        able to iterate the queue and increase or decrease keys.

        One note is that increaseKey and decreaseKey are O(n) rather than
        O(log(n)).  Traditionally, the lookup of the key is done with a
        hash map but that's not feasible here.  This is because unless the
        queue's element type is a pointer there is no good way maintain a
        persistent reference to every entry in the queue while we sift.
        The only way to update the location of an entry is to do a hash
        table lookup with the entry's hash but this is probably more
        expensive than just doing a linear search.

        Also, add comparison operator functions, which can be passed to PriorityQueue.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/MathExtras.h:
        (isLessThan):
        (isLessThanEqual):
        (isGreaterThan):
        (isGreaterThanEqual):
        * wtf/PriorityQueue.h: Added.
        (WTF::PriorityQueue::size):
        (WTF::PriorityQueue::isEmpty):
        (WTF::PriorityQueue::enqueue):
        (WTF::PriorityQueue::peek):
        (WTF::PriorityQueue::dequeue):
        (WTF::PriorityQueue::decreaseKey):
        (WTF::PriorityQueue::increaseKey):
        (WTF::PriorityQueue::begin):
        (WTF::PriorityQueue::end):
        (WTF::PriorityQueue::isValidHeap):
        (WTF::PriorityQueue::parentOf):
        (WTF::PriorityQueue::leftChildOf):
        (WTF::PriorityQueue::rightChildOf):
        (WTF::PriorityQueue::siftUp):
        (WTF::PriorityQueue::siftDown):

2017-04-07  Alex Christensen  <achristensen@webkit.org>

        Use audit_token_t instead of pid_t for checking sandbox of other processes
        https://bugs.webkit.org/show_bug.cgi?id=170616
        <rdar://problem/31158189>

        Reviewed by Daniel Bates.

        * wtf/spi/darwin/SandboxSPI.h:
        Declare more SPI.

2017-04-07  Ting-Wei Lan  <lantw44@gmail.com>

        Include cstdio before using sscanf and stderr
        https://bugs.webkit.org/show_bug.cgi?id=170098

        Reviewed by Michael Catanzaro.

        * wtf/NumberOfCores.cpp:

2017-04-07  Saam Barati  <sbarati@apple.com>

        WebAssembly: Make to a compilation API that allows for multi-VM concurrent compilations of Wasm Modules
        https://bugs.webkit.org/show_bug.cgi?id=170488

        Reviewed by JF Bastien.

        * wtf/SharedTask.h: Make SharedTaskFunctor forward its arguments.

2017-04-07  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Update the priorities used in glib main loop sources
        https://bugs.webkit.org/show_bug.cgi?id=170457

        Reviewed by Žan Doberšek.

        Add an enum to define prirorities used in different GLib main sources. It allows to give them a better name
        than high, low, medium, etc., but also to document them and other GLib based ports can define their own
        values without changing all the places where they are used. The default values are based on the priorities
        pre-defined by GLib.

        * wtf/glib/MainThreadGLib.cpp:
        (WTF::MainThreadDispatcher::MainThreadDispatcher):
        * wtf/glib/RunLoopGLib.cpp:
        (WTF::RunLoop::RunLoop):
        (WTF::RunLoop::dispatchAfter):
        (WTF::RunLoop::TimerBase::TimerBase):
        * wtf/glib/RunLoopSourcePriority.h: Added.
        * wtf/linux/MemoryPressureHandlerLinux.cpp:
        (WTF::MemoryPressureHandler::EventFDPoller::EventFDPoller):

2017-04-06  Filip Pizlo  <fpizlo@apple.com>

        Linear scan should run liveness only once
        https://bugs.webkit.org/show_bug.cgi?id=170569

        Reviewed by Keith Miller.
        
        Have Liveness<> call Adapter::prepareToCompute(), since this makes it a lot easier to implement
        constraint generation, since the constraint generator now gets to run after the Adapter is fully
        constructed.
        
        * wtf/IndexMap.h:
        (WTF::IndexMap::append): Also make this a bit more versatile.
        * wtf/Liveness.h:
        (WTF::Liveness::LocalCalc::Iterable::contains):
        (WTF::Liveness::Iterable::contains):
        (WTF::Liveness::compute):

2017-04-06  Andreas Kling  <akling@apple.com>

        Kill any WebContent process using over 16 GB of memory.
        https://bugs.webkit.org/show_bug.cgi?id=170515
        <rdar://problem/29930931>

        Reviewed by Antti Koivisto.

        Restructure the code since it was getting out of sync with the intended behavior.
        Now there's a thresholdForMemoryKill() which returns the current memory limit based
        on the process status.

        The memory usage policy is separated from the killing, and now only drives the
        asynchronous invocations of pressure relief that occur when we pass over one of
        the policy edges (now 1GB for Conservative, 2GB for Strict.)

        Removed the "Panic" policy and moved the memory kill logic to shrinkOrDie().

        Behavior as of this patch:

            - Everyone gets killed over 16 GB.
            - Inactive processes get killed over 4 GB.
            - Strict memory usage policy kicks in at 2 GB.
            - Conservative memory usage policy at 1 GB.

        Like before, we make a best-effort attempt to free up memory before killing the process.

        * wtf/MemoryPressureHandler.cpp:
        (WTF::toString):
        (WTF::MemoryPressureHandler::thresholdForMemoryKill):
        (WTF::thresholdForPolicy):
        (WTF::policyForFootprint):
        (WTF::MemoryPressureHandler::shrinkOrDie):
        (WTF::MemoryPressureHandler::setMemoryUsagePolicyBasedOnFootprint):
        (WTF::MemoryPressureHandler::measurementTimerFired):
        * wtf/MemoryPressureHandler.h:

2017-04-05  Andreas Kling  <akling@apple.com>

        Make inactive web processes behave as though under memory pressure.
        https://bugs.webkit.org/show_bug.cgi?id=170042
        <rdar://problem/31038445>

        Reviewed by Antti Koivisto.

        Once a web process becomes inactive, let's try to reduce its impact
        on memory usage by treating it as if it's under memory pressure until
        it becomes active.

        * wtf/MemoryPressureHandler.cpp:
        (WTF::MemoryPressureHandler::setProcessState):
        (WTF::MemoryPressureHandler::isUnderMemoryPressure):
        * wtf/MemoryPressureHandler.h:
        (WTF::MemoryPressureHandler::isUnderMemoryPressure): Deleted.

2017-04-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Suppress warnings in GCC
        https://bugs.webkit.org/show_bug.cgi?id=170501

        Reviewed by Keith Miller.

        Add a new macro UNUSED_FUNCTION to annotate unused static functions.
        #pragma GCC diagnostic ignored "-Wunused-function" does not work.

        * wtf/Compiler.h:

2017-04-04  Filip Pizlo  <fpizlo@apple.com>

        Air::eliminateDeadCode() should not use a HashSet
        https://bugs.webkit.org/show_bug.cgi?id=170487

        Reviewed by Saam Barati.
        
        BitVector::iterator knows when it's at the end. Expose this functionality.

        * wtf/BitVector.h:
        (WTF::BitVector::iterator::isAtEnd):

2017-04-04  Keith Miller  <keith_miller@apple.com>

        WebAssembly: ModuleInformation should be a ref counted thing that can be shared across threads.
        https://bugs.webkit.org/show_bug.cgi?id=170478

        Reviewed by Saam Barati.

        This adds a new String::fromUTF8 that converts a vector of characters to
        a string.

        Also, it cleans up some style.

        * wtf/text/WTFString.h:
        (WTF::String::fromUTF8):
        * wtf/unicode/UTF8.cpp:
        (WTF::Unicode::convertLatin1ToUTF8):

2017-04-04  Filip Pizlo  <fpizlo@apple.com>

        B3::fixSSA() needs a tune-up
        https://bugs.webkit.org/show_bug.cgi?id=170485

        Reviewed by Saam Barati.
        
        This makes IndexSparseSet capable of being used as a map if you instantiate it with
        KeyValuePair<unsigned, ValueType>.

        * wtf/HashTraits.h:
        * wtf/IndexSparseSet.h:
        (WTF::DefaultIndexSparseSetTraits::create):
        (WTF::DefaultIndexSparseSetTraits::key):
        (WTF::OverflowHandler>::IndexSparseSet):
        (WTF::OverflowHandler>::add):
        (WTF::OverflowHandler>::set):
        (WTF::OverflowHandler>::remove):
        (WTF::OverflowHandler>::clear):
        (WTF::OverflowHandler>::size):
        (WTF::OverflowHandler>::isEmpty):
        (WTF::OverflowHandler>::contains):
        (WTF::OverflowHandler>::sort):
        (WTF::IndexSparseSet<OverflowHandler>::IndexSparseSet): Deleted.
        (WTF::IndexSparseSet<OverflowHandler>::add): Deleted.
        (WTF::IndexSparseSet<OverflowHandler>::remove): Deleted.
        (WTF::IndexSparseSet<OverflowHandler>::clear): Deleted.
        (WTF::IndexSparseSet<OverflowHandler>::size): Deleted.
        (WTF::IndexSparseSet<OverflowHandler>::isEmpty): Deleted.
        (WTF::IndexSparseSet<OverflowHandler>::contains): Deleted.
        (WTF::IndexSparseSet<OverflowHandler>::sort): Deleted.
        * wtf/Liveness.h:
        (WTF::Liveness::LocalCalc::Iterable::iterator::iterator):
        (WTF::Liveness::workset):

2017-04-04  Filip Pizlo  <fpizlo@apple.com>

        Don't need to Air::reportUsedRegisters for wasm at -O1
        https://bugs.webkit.org/show_bug.cgi?id=170459

        Reviewed by Saam Barati.
        
        Just moved the liveness computation into a method, which enabled me to do the profiling
        that I used to write this patch.

        * wtf/Liveness.h:
        (WTF::Liveness::Liveness):
        (WTF::Liveness::compute):

2017-04-03  Filip Pizlo  <fpizlo@apple.com>

        Air liveness should build constraints and solve them rather than repeatedly parsing IR
        https://bugs.webkit.org/show_bug.cgi?id=170421

        Reviewed by Saam Barati.

        * wtf/Vector.h:
        (WTF::minCapacity>::appendIfNotContains): Because sometimes Vector<> is the best kind of set.

2017-04-03  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Introduce WTF::RandomDevice which keeps /dev/urandom opened
        https://bugs.webkit.org/show_bug.cgi?id=170095

        Reviewed by Michael Catanzaro.

        In this patch, we introduce RandomDevice, which keeps /dev/urandom opened
        to avoid repeatedly open and close urandom file descriptor in Linux.

        The purpose is similar to std::random_device, but WTF::RandomDevice explicitly
        avoids using ARC4, which is recently attempted to be removed from the WebKit
        tree[1].

        [1]: https://trac.webkit.org/r214329

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/OSRandomSource.cpp:
        (WTF::cryptographicallyRandomValuesFromOS):
        (WTF::crashUnableToOpenURandom): Deleted.
        (WTF::crashUnableToReadFromURandom): Deleted.
        * wtf/RandomDevice.cpp: Copied from Source/WTF/wtf/OSRandomSource.cpp.
        (WTF::crashUnableToOpenURandom):
        (WTF::crashUnableToReadFromURandom):
        (WTF::RandomDevice::RandomDevice):
        (WTF::RandomDevice::~RandomDevice):
        (WTF::RandomDevice::cryptographicallyRandomValues):
        * wtf/RandomDevice.h: Added.

2017-04-03  Filip Pizlo  <fpizlo@apple.com>

        WTF::Liveness should have an API that focuses on actions at instruction boundaries
        https://bugs.webkit.org/show_bug.cgi?id=170407

        Reviewed by Keith Miller.
        
        Change the Liveness<> API to handle early and late things in one lump inside forEachUse
        and forEachDef functions. This reduces the amount of different functions that Liveness<>
        expects from its adaptor. This makes it easier to implement optimizations that cache the
        use/def behavior of each instruction boundary.

        * wtf/Liveness.h:
        (WTF::Liveness::Liveness):
        (WTF::Liveness::LocalCalc::execute):

2017-04-01  Csaba Osztrogonác  <ossy@webkit.org>

        Mac cmake buildfix after 214586.
        https://bugs.webkit.org/show_bug.cgi?id=170381

        Unreviewed.

        * wtf/BlockPtr.h:

2017-03-30  Filip Pizlo  <fpizlo@apple.com>

        Air should support linear scan for optLevel<2
        https://bugs.webkit.org/show_bug.cgi?id=170161

        Reviewed by Saam Barati.
        
        This change introduces a new low-latency register allocator. It can allocate registers very
        quickly by doing a relatively poor job. Implementing this algorithm required beefing up some of
        our core algorithms.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Deque.h: Make it possible to do some basic priority queueing with this data structure.
        (WTF::inlineCapacity>::removeAllMatching):
        (WTF::inlineCapacity>::appendAndBubble):
        (WTF::inlineCapacity>::takeLast):
        * wtf/IndexKeyType.h: Added. This makes it possible to use IndexMap and IndexSet with value or pointer types. Previously they just worked with pointer types.
        (WTF::IndexKeyType::index):
        * wtf/IndexMap.h: Adopt IndexKeyType.
        (WTF::IndexMap::operator[]):
        (WTF::IndexMap::append):
        * wtf/IndexSet.h: Adopt IndexKeyType.
        (WTF::IndexSet::add):
        (WTF::IndexSet::addAll):
        (WTF::IndexSet::remove):
        (WTF::IndexSet::contains):
        (WTF::IndexSet::Iterable::iterator::operator*):
        * wtf/Range.h: Added. This used to be B3::HeapRange. This generalizes that data structure to any kind of range stuff.
        (WTF::Range::Range):
        (WTF::Range::top):
        (WTF::Range::operator==):
        (WTF::Range::operator!=):
        (WTF::Range::operator bool):
        (WTF::Range::operator|):
        (WTF::Range::operator|=):
        (WTF::Range::begin):
        (WTF::Range::end):
        (WTF::Range::overlaps):
        (WTF::Range::dump):
        * wtf/RangeSet.h:
        (WTF::RangeSet::add):

2017-03-25  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Move platformThreadSignal to WTF
        https://bugs.webkit.org/show_bug.cgi?id=170097

        Reviewed by Mark Lam.

        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::signalThread):

2017-03-26  Filip Pizlo  <fpizlo@apple.com>

        B3::fixSSA should do liveness pruning
        https://bugs.webkit.org/show_bug.cgi?id=170111

        Reviewed by Saam Barati.
        
        Move Air::Liveness<> to WTF::Liveness<>. This is pretty easy since Air::Liveness<> was
        already fairly generic. It leverages the CFG concept so that it can understand many
        different kinds of basic blocks. It doesn't try to understand the contents of basic
        blocks; it just asks the adaptor for the block size and asks for the early/late
        uses/defs of each thing in the block.
        
        This makes it easy to create a B3::VariableLiveness, which fixSSA then uses for
        pruning. One of the new features is the Liveness::LiveAtHead nested class, which you
        instantiate if you want to perform liveAtHead queries, which SSA construction wants to
        do.
        
        This also fixes https://bugs.webkit.org/show_bug.cgi?id=170102#c12

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Liveness.h: Added.
        (WTF::Liveness::Liveness):
        (WTF::Liveness::LocalCalc::LocalCalc):
        (WTF::Liveness::LocalCalc::Iterable::Iterable):
        (WTF::Liveness::LocalCalc::Iterable::iterator::iterator):
        (WTF::Liveness::LocalCalc::Iterable::iterator::operator++):
        (WTF::Liveness::LocalCalc::Iterable::iterator::operator*):
        (WTF::Liveness::LocalCalc::Iterable::iterator::operator==):
        (WTF::Liveness::LocalCalc::Iterable::iterator::operator!=):
        (WTF::Liveness::LocalCalc::Iterable::begin):
        (WTF::Liveness::LocalCalc::Iterable::end):
        (WTF::Liveness::LocalCalc::Iterable::contains):
        (WTF::Liveness::LocalCalc::live):
        (WTF::Liveness::LocalCalc::isLive):
        (WTF::Liveness::LocalCalc::execute):
        (WTF::Liveness::rawLiveAtHead):
        (WTF::Liveness::Iterable::Iterable):
        (WTF::Liveness::Iterable::iterator::iterator):
        (WTF::Liveness::Iterable::iterator::operator*):
        (WTF::Liveness::Iterable::iterator::operator++):
        (WTF::Liveness::Iterable::iterator::operator==):
        (WTF::Liveness::Iterable::iterator::operator!=):
        (WTF::Liveness::Iterable::begin):
        (WTF::Liveness::Iterable::end):
        (WTF::Liveness::Iterable::contains):
        (WTF::Liveness::liveAtHead):
        (WTF::Liveness::liveAtTail):
        (WTF::Liveness::workset):
        (WTF::Liveness::LiveAtHead::LiveAtHead):
        (WTF::Liveness::LiveAtHead::isLiveAtHead):

2017-03-25  Filip Pizlo  <fpizlo@apple.com>

        Air::Liveness shouldn't need HashSets
        https://bugs.webkit.org/show_bug.cgi?id=170102

        Reviewed by Yusuke Suzuki.

        * wtf/IndexSparseSet.h: Add some helpers for a HashSet-free liveness analysis.
        (WTF::IndexSparseSet::values):
        (WTF::IndexSparseSet<OverflowHandler>::sort):
        * wtf/StdLibExtras.h:
        (WTF::mergeDeduplicatedSorted): Rapidly merge two sorted lists that don't have duplicates to produce a new sorted list that doesn't have duplicates.
        * wtf/Vector.h:
        (WTF::minCapacity>::uncheckedAppend): Inline this!
        (WTF::removeRepeatedElements): This is a version of std::unique() that works naturally for Vectors.

2017-03-26  Filip Pizlo  <fpizlo@apple.com>

        Air should use RegisterSet for RegLiveness
        https://bugs.webkit.org/show_bug.cgi?id=170108

        Reviewed by Yusuke Suzuki.

        * wtf/Atomics.h:
        (WTF::ensurePointer): This is a useful replacement for std::once, which requires less fencing.
        * wtf/Bitmap.h: Add more utilities.
        (WTF::Bitmap::iterator::iterator): An iterator for set bits.
        (WTF::Bitmap::iterator::operator*):
        (WTF::Bitmap::iterator::operator++):
        (WTF::Bitmap::iterator::operator==):
        (WTF::Bitmap::iterator::operator!=):
        (WTF::Bitmap::begin):
        (WTF::Bitmap::end):
        (WTF::WordType>::subsumes): a.subsumes(b) if all of b's set bits are set in a.
        (WTF::WordType>::findBit): find next set or clear bit.

2017-03-24  JF Bastien  <jfbastien@apple.com>

        WebAssembly: store state in TLS instead of on VM
        https://bugs.webkit.org/show_bug.cgi?id=169611

        Reviewed by Filip Pizlo.

        * wtf/FastTLS.h: reserve one key for WebAssembly, delete a bunch
        of dead code which clang couldn't compile (it's valid GCC assembly
        which LLVM dislikes).

2017-03-24  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r214351.

        This change caused API test
        WebKit1.DidCreateJavaScriptContextBackForwardCacheTest to
        fail.

        Reverted changeset:

        "Make inactive web processes behave as though under memory
        pressure."
        https://bugs.webkit.org/show_bug.cgi?id=170042
        http://trac.webkit.org/changeset/214351

2017-03-24  Chris Dumez  <cdumez@apple.com>

        Unreviewed, rolling out r214329.

        Significantly regressed Speedometer

        Reverted changeset:

        "window.crypto.getRandomValues() uses the insecure RC4 RNG"
        https://bugs.webkit.org/show_bug.cgi?id=169623
        http://trac.webkit.org/changeset/214329

2017-03-24  Andreas Kling  <akling@apple.com>

        Make inactive web processes behave as though under memory pressure.
        <https://webkit.org/b/170042>

        Reviewed by Antti Koivisto.

        Once a web process becomes inactive, let's try to reduce its impact
        on memory usage by treating it as if it's under memory pressure until
        it becomes active.

        * wtf/MemoryPressureHandler.cpp:
        (WTF::MemoryPressureHandler::setProcessState):
        (WTF::MemoryPressureHandler::isUnderMemoryPressure):
        * wtf/MemoryPressureHandler.h:
        (WTF::MemoryPressureHandler::isUnderMemoryPressure): Deleted.

2017-03-23  Michael Catanzaro  <mcatanzaro@igalia.com>

        window.crypto.getRandomValues() uses the insecure RC4 RNG
        https://bugs.webkit.org/show_bug.cgi?id=169623

        Reviewed by Alex Christensen.

        Remove the RC4 random generator in favor of using OS randomness for now. This is basically
        a merge of https://codereview.chromium.org/1431233002 from Blink, original author "eroman".

        * wtf/CryptographicallyRandomNumber.cpp:
        (WTF::cryptographicallyRandomNumber):
        (WTF::cryptographicallyRandomValues):
        (): Deleted.

2017-03-23  Tomas Popela  <tpopela@redhat.com>

        Fix uninitialized public members in WTF
        https://bugs.webkit.org/show_bug.cgi?id=169676

        Reviewed by Michael Catanzaro.

        Found by Coverity scan.

        * wtf/Bag.h:
        * wtf/HashTable.h:
        * wtf/HashTraits.h:
        * wtf/Insertion.h:
        * wtf/OrderMaker.h:
        * wtf/ParallelJobsGeneric.h:

2017-03-22  Andreas Kling  <akling@apple.com>

        Let MemoryPressureHandler track whether the process is active or inactive.
        <https://webkit.org/b/169990>

        Reviewed by Antti Koivisto.

        An active process is a process that meets any of these criteria:

            - Has had a visible Page in an active window in the last hour
            - Is playing audio

        This replaces the old mechanism where MemoryPressureHandler would invoke
        a callback to know whether the process was eligible for a memory kill.
        Instead we now plumb the relevant information down from WebCore and kill
        based on this activity state.

        * wtf/MemoryPressureHandler.cpp:
        (WTF::MemoryPressureHandler::measurementTimerFired):
        (WTF::MemoryPressureHandler::setProcessState):
        * wtf/MemoryPressureHandler.h:
        (WTF::MemoryPressureHandler::setMemoryKillCallback):
        (WTF::MemoryPressureHandler::processState):
        (WTF::MemoryPressureHandler::setProcessIsEligibleForMemoryKillCallback): Deleted.

2017-03-20  Simon Fraser  <simon.fraser@apple.com>

        Add a system trace point for memory warning handling
        https://bugs.webkit.org/show_bug.cgi?id=169893

        Reviewed by Zalan Bujtas.

        Make it possible to pass data to the Begin trace point.

        * wtf/SystemTracing.h:
        (WTF::TraceScope::TraceScope):

2017-03-17  Said Abou-Hallawa  <sabouhallawa@apple.com>

        Time channel attack on SVG Filters
        https://bugs.webkit.org/show_bug.cgi?id=118689

        Reviewed by Simon Fraser.

        Performing arithmetic operations on subnormal floating-point numbers is
        very expensive. Normalizing the floating-point number to the minimum normal
        value should accelerate the calculations and there won't be a noticeable
        difference in the result since all the subnormal values and the minimum
        normal value are all very close to zero.

        * wtf/MathExtras.h:
        (normalizedFloat):

2017-03-11  Filip Pizlo  <fpizlo@apple.com>

        Air should be powerful enough to support Tmp-splitting
        https://bugs.webkit.org/show_bug.cgi?id=169515

        Reviewed by Saam Barati.
        
        Teach IndexMap how to handle types that don't have a default constructor. This makes it
        easy to create a IndexMap<BasicBlock, InsertionSet>, which is a super powerful
        construct.

        * wtf/IndexMap.h:
        (WTF::IndexMap::IndexMap):
        (WTF::IndexMap::resize):
        (WTF::IndexMap::clear):

2017-03-16  Simon Fraser  <simon.fraser@apple.com>

        Improve the system tracing points
        https://bugs.webkit.org/show_bug.cgi?id=169790

        Reviewed by Zalan Bujtas.

        Use a more cohesive set of system trace points that give a good overview of what
        WebKit is doing. Added points for resource loading, render tree building, sync messages
        to the web process, async image decode, WASM and fetching cookies.

        * wtf/SystemTracing.h:

2017-03-16  Carlos Garcia Campos  <cgarcia@igalia.com>

        [UNIX] Implement currentSearchLocaleID() and currentTextBreakLocaleID()
        https://bugs.webkit.org/show_bug.cgi?id=169745

        Reviewed by Yusuke Suzuki.

        Add a common implementation for Unix based ports using setlocale.

        * wtf/PlatformGTK.cmake:
        * wtf/PlatformJSCOnly.cmake:
        * wtf/text/gtk/TextBreakIteratorInternalICUGtk.cpp: Removed.
        * wtf/text/unix/TextBreakIteratorInternalICUUnix.cpp: Renamed from Source/WTF/wtf/text/jsconly/TextBreakIteratorInternalICUJSCOnly.cpp.
        (WTF::currentSearchLocaleID):
        (WTF::currentTextBreakLocaleID):

2017-03-16  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GLIB] MainThread implementation is not GTK+ specific
        https://bugs.webkit.org/show_bug.cgi?id=169736

        Reviewed by Yusuke Suzuki.

        It's implemented in MainThreadGLib.cpp for glib based ports, so ifdefs in MainThread should not be
        PLATFORM(GTK) but USE(GLIB).

        * wtf/MainThread.cpp:
        * wtf/MainThread.h:

2017-03-15  Carlos Alberto Lopez Perez  <clopez@igalia.com>

        [CMake][JSCOnly] Fix build with GLib event loop
        https://bugs.webkit.org/show_bug.cgi?id=169730

        Reviewed by Michael Catanzaro.

        * wtf/MainThread.cpp:
        * wtf/PlatformJSCOnly.cmake: WorkQueueGLib was removed in r199713.

2017-03-15  Dean Jackson  <dino@apple.com>

        Sort Xcode project files
        https://bugs.webkit.org/show_bug.cgi?id=169669

        Reviewed by Antoine Quint.

        * WTF.xcodeproj/project.pbxproj:

2017-03-14  Filip Pizlo  <fpizlo@apple.com>

        Fix some typos in this benchmark.

        Rubber stamped by Saam Barati.

        * benchmarks/HashSetDFGReplay.cpp:
        (main):

2017-03-14  Filip Pizlo  <fpizlo@apple.com>

        Record the HashSet/HashMap operations in DFG/FTL/B3 and replay them in a benchmark
        https://bugs.webkit.org/show_bug.cgi?id=169590

        Reviewed by Saam Barati.
        
        This adds LoggingHashSet and LoggingHashMap, which are drop-in replacements for HashSet and
        HashMap that log everything that they do, so that you can replay it later.
        
        This also adds a benchmark (HashSetDFGReplay) based on doing a recording of some of the HashSets
        in the DFG compiler.

        * WTF.xcodeproj/project.pbxproj:
        * benchmarks/HashSetDFGReplay.cpp: Added.
        (benchmark):
        (main):
        * wtf/CMakeLists.txt:
        * wtf/GlobalVersion.cpp: Added.
        (WTF::newGlobalVersion):
        * wtf/GlobalVersion.h: Added.
        * wtf/HashMap.h:
        (WTF::X>::swap):
        * wtf/HashSet.h:
        (WTF::V>::addVoid):
        * wtf/LoggingHashID.h: Added.
        (WTF::LoggingHashID::LoggingHashID):
        (WTF::LoggingHashID::dump):
        * wtf/LoggingHashMap.h: Added.
        * wtf/LoggingHashSet.h: Added.
        * wtf/LoggingHashTraits.h: Added.
        (WTF::LoggingHashKeyTraits::print):
        (WTF::LoggingHashValueTraits::print):

2017-03-13  Jer Noble  <jer.noble@apple.com>

        Make classes used by Media Stream encode/decode friendly
        https://bugs.webkit.org/show_bug.cgi?id=169567

        Reviewed by Eric Carlson.

        * wtf/MediaTime.h:
        (WTF::MediaTime::encode):
        (WTF::MediaTime::decode):

2017-03-14  Yusuke Suzuki  <utatane.tea@gmail.com>

        Add secondsAs<T> methods to Seconds to convert it to integers with clamp
        https://bugs.webkit.org/show_bug.cgi?id=169537

        Reviewed by Carlos Garcia Campos.

        When using the usual static_cast, infinity becomes 0 accidentally.
        It is not intended value when using Seconds for timeout value.
        Instead, we use clampToAccepting64 to convert Seconds to
        integer values to pass them to the system functions.

        * wtf/MathExtras.h:
        (clampToAccepting64):
        * wtf/Seconds.h:
        (WTF::Seconds::minutesAs):
        (WTF::Seconds::secondsAs):
        (WTF::Seconds::millisecondsAs):
        (WTF::Seconds::microsecondsAs):
        (WTF::Seconds::nanosecondsAs):
        * wtf/cocoa/WorkQueueCocoa.cpp:
        (WTF::WorkQueue::dispatchAfter):
        * wtf/glib/RunLoopGLib.cpp:
        (WTF::RunLoop::dispatchAfter):
        (WTF::RunLoop::TimerBase::updateReadyTime):

2017-03-13  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC][Linux] Implement VMTrap in Linux ports
        https://bugs.webkit.org/show_bug.cgi?id=169436

        Reviewed by Mark Lam.

        Enable VMTrap mechanism for Linux and FreeBSD.

        * wtf/Platform.h:

2017-03-13  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Clean up RunLoop and WorkQueue with Seconds and Function
        https://bugs.webkit.org/show_bug.cgi?id=169537

        Reviewed by Sam Weinig.

        This patch modernizes RunLoop and WorkQueue.

        1. Use Ref<> aggressively
        2. Use Seconds instead of chrono times
        3. Use Function<> instead of std::function

        * wtf/MainThread.cpp:
        (WTF::dispatchFunctionsFromMainThread):
        * wtf/RunLoop.h:
        * wtf/WorkQueue.h:
        * wtf/cocoa/WorkQueueCocoa.cpp:
        (WTF::WorkQueue::dispatch):
        (WTF::WorkQueue::dispatchAfter):
        (WTF::WorkQueue::concurrentApply):
        * wtf/generic/MainThreadGeneric.cpp:
        (WTF::scheduleDispatchFunctionsOnMainThread):
        * wtf/generic/RunLoopGeneric.cpp:
        (WTF::RunLoop::TimerBase::ScheduledTask::create):
        (WTF::RunLoop::TimerBase::ScheduledTask::EarliestSchedule::operator()):
        (WTF::RunLoop::populateTasks):
        (WTF::RunLoop::runImpl):
        (WTF::RunLoop::schedule):
        (WTF::RunLoop::scheduleAndWakeUp):
        (WTF::RunLoop::dispatchAfter):
        (WTF::RunLoop::TimerBase::start):
        * wtf/generic/WorkQueueGeneric.cpp:
        (WorkQueue::dispatch):
        (WorkQueue::dispatchAfter):
        * wtf/glib/RunLoopGLib.cpp:
        (WTF::DispatchAfterContext::DispatchAfterContext):
        (WTF::RunLoop::dispatchAfter):
        (WTF::RunLoop::TimerBase::updateReadyTime):
        (WTF::RunLoop::TimerBase::start):
        * wtf/win/WorkQueueWin.cpp:
        (WTF::WorkQueue::performWorkOnRegisteredWorkThread):
        (WTF::WorkQueue::dispatch):
        (WTF::WorkQueue::dispatchAfter):

2017-03-13  Chris Dumez  <cdumez@apple.com>

        [WK2] Only report background WebProcesses as unresponsive in the background after 90 seconds
        https://bugs.webkit.org/show_bug.cgi?id=169425
        <rdar://problem/30954003>

        Reviewed by Andreas Kling.

        * wtf/RunLoop.h:
        (WTF::RunLoop::TimerBase::startRepeating):
        (WTF::RunLoop::TimerBase::startOneShot):
        Add overloads to RunLoop::Timer that take Seconds in parameter,
        for convenience.

        * wtf/Seconds.h:
        (WTF::Seconds::fromHours):
        (WTF::seconds_literals::operator _h):
        Allow _h suffix for initializing Seconds type to hours.

2017-03-11  Csaba Osztrogonác  <ossy@webkit.org>

        REGRESSION(r213645): It made JSC tests super slow and timeout on AArch64 Linux
        https://bugs.webkit.org/show_bug.cgi?id=169510

        Unreviewed, disable LL_SC on Linux to unbreak this platform.

        * wtf/Atomics.h:
        * wtf/Platform.h:

2017-03-10  Filip Pizlo  <fpizlo@apple.com>

        The JITs should be able to emit fast TLS loads
        https://bugs.webkit.org/show_bug.cgi?id=169483

        Reviewed by Keith Miller.

        Consolidated what we know about fast TLS in FastTLS.h.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/FastTLS.h: Added.
        (WTF::loadFastTLS):
        (WTF::fastTLSOffsetForKey):
        * wtf/Platform.h:
        * wtf/WTFThreadData.cpp:
        (WTF::WTFThreadData::createAndRegisterForGetspecificDirect):
        * wtf/WTFThreadData.h:
        (WTF::wtfThreadData):

2017-03-10  Mark Lam  <mark.lam@apple.com>

        Turn ENABLE(MASM_PROBE) on by default for OS(DARWIN) release builds.
        https://bugs.webkit.org/show_bug.cgi?id=169493

        Reviewed by Saam Barati.

        MASM_PROBE was already enabled for debug builds.  This change makes it so that we
        don't have to rebuild the world every time we need to use it on a release build.

        * wtf/Platform.h:

2017-03-10  Csaba Osztrogonác  <ossy@webkit.org>

        Unreviewed AArch64 Linux buildfix after r213645.
        https://bugs.webkit.org/show_bug.cgi?id=169300

        * wtf/Atomics.h: intptr_t and int64_t are typedefs for long int on Linux.
        They are different types only on Darwin platforms.

2017-03-09  Caio Lima  <ticaiolima@gmail.com>

        [ESnext] Implement Object Rest - Implementing Object Rest Destructuring
        https://bugs.webkit.org/show_bug.cgi?id=167962

        Reviewed by Keith Miller.

        * wtf/HashSet.h:
        (WTF::=):

2017-03-09  Youenn Fablet  <youenn@apple.com>

        Activate VideoToolbox when WebRTC is enabled on iOS
        https://bugs.webkit.org/show_bug.cgi?id=169423

        Reviewed by Jon Lee.

        * wtf/Platform.h: Activate VIDEOTOOLBOX if WEBRTC is enabled.

2017-03-09  Filip Pizlo  <fpizlo@apple.com>

        std::isnan/isinf/isfinite should work with WTF time classes
        https://bugs.webkit.org/show_bug.cgi?id=164991

        Reviewed by Darin Adler.
        
        The consensus view (see comments in https://bugs.webkit.org/show_bug.cgi?id=152045) of how
        to check if something is NaN is to use std::isnan(). To be able to do that for time
        classes, they need to provide their own isnan() overhload. This also provides isinf()
        overloads.

        * wtf/MonotonicTime.h:
        (std::isnan):
        (std::isinf):
        * wtf/Seconds.h:
        (std::isnan):
        (std::isinf):
        * wtf/TimeWithDynamicClockType.h:
        (std::isnan):
        (std::isinf):
        * wtf/WallTime.h:
        (std::isnan):
        (std::isinf):

2017-03-09  Mark Lam  <mark.lam@apple.com>

        Use const AbstractLocker& (instead of const LockHolder&) in more places.
        https://bugs.webkit.org/show_bug.cgi?id=169424

        Reviewed by Filip Pizlo.

        * wtf/RunLoop.h:
        * wtf/generic/RunLoopGeneric.cpp:
        (WTF::RunLoop::wakeUp):
        (WTF::RunLoop::schedule):

2017-03-09  Mark Lam  <mark.lam@apple.com>

        Make the VM Traps mechanism non-polling for the DFG and FTL.
        https://bugs.webkit.org/show_bug.cgi?id=168920
        <rdar://problem/30738588>

        Reviewed by Filip Pizlo.

        Make StackBounds more useful for checking if a pointer is within stack bounds.

        * wtf/MetaAllocator.cpp:
        (WTF::MetaAllocator::isInAllocatedMemory):
        * wtf/MetaAllocator.h:
        * wtf/Platform.h:
        * wtf/StackBounds.h:
        (WTF::StackBounds::emptyBounds):
        (WTF::StackBounds::StackBounds):
        (WTF::StackBounds::isEmpty):
        (WTF::StackBounds::contains):

2017-03-07  Filip Pizlo  <fpizlo@apple.com>

        WTF should make it super easy to do ARM concurrency tricks
        https://bugs.webkit.org/show_bug.cgi?id=169300

        Reviewed by Mark Lam.
        
        This adds Atomic<>::loadLink and Atomic<>::storeCond, available only when HAVE(LL_SC).
        
        It abstracts loadLink/storeCond behind prepare/attempt. You can write prepare/attempt
        loops whenever your loop fits into the least common denominator of LL/SC and CAS.
        
        This modifies Atomic<>::transaction to use prepare/attempt. So, if you write your loop
        using Atomic<>::transaction, then you get LL/SC for free.

        Depending on the kind of transaction you are doing, you may not want to perform an LL
        until you have a chance to just load the current value. Atomic<>::transaction() assumes
        that you do not care to have any ordering guarantees in that case. If you think that
        the transaction has a good chance of aborting this way, you want
        Atomic<>::transaction() to first do a plain load. But if you don't think that such an
        abort is likely, then you want to go straight to the LL. The API supports this concept
        via TransactionAbortLikelihood.
        
        Additionally, this redoes the depend/consume API to be dead simple. Dependency is
        unsigned. You get a dependency on a loaded value by just saying
        dependency(loadedValue). You consume the dependency by using it as a bonus index to
        some pointer dereference. This is made easy with the consume<T*>(ptr, dependency)
        helper. In those cases where you want to pass around both a computed value and a
        dependency, there's DependencyWith<T>. But you won't need it in most cases. The loaded
        value or any value computed from the loaded value is a fine input to dependency()!
        
        This change updates a bunch of hot paths to use the new APIs. Using transaction() gives
        us optimal LL/SC loops for object marking and lock acquisition.
        
        This change also updates a bunch of hot paths to use dependency()/consume().
        
        This is a significant Octane/splay speed-up on ARM.

        * wtf/Atomics.h:
        (WTF::hasFence):
        (WTF::Atomic::prepare):
        (WTF::Atomic::attempt):
        (WTF::Atomic::transaction):
        (WTF::Atomic::transactionRelaxed):
        (WTF::nullDependency):
        (WTF::dependency):
        (WTF::DependencyWith::DependencyWith):
        (WTF::dependencyWith):
        (WTF::consume):
        (WTF::Atomic::tryTransactionRelaxed): Deleted.
        (WTF::Atomic::tryTransaction): Deleted.
        (WTF::zeroWithConsumeDependency): Deleted.
        (WTF::consumeLoad): Deleted.
        * wtf/Bitmap.h:
        (WTF::WordType>::get):
        (WTF::WordType>::concurrentTestAndSet):
        (WTF::WordType>::concurrentTestAndClear):
        * wtf/LockAlgorithm.h:
        (WTF::LockAlgorithm::lockFast):
        (WTF::LockAlgorithm::unlockFast):
        (WTF::LockAlgorithm::unlockSlow):
        * wtf/Platform.h:

2017-03-08  Anders Carlsson  <andersca@apple.com>

        Simplify the PaymentCoordinator interface
        https://bugs.webkit.org/show_bug.cgi?id=169382
        Part of rdar://problem/28880714.

        Reviewed by Tim Horton.

        * wtf/EnumTraits.h:
        Fix a build warning.

2017-03-06  Andreas Kling  <akling@apple.com>

        [iOS] Report domains crashing under memory pressure via enhanced privacy logging.
        <https://webkit.org/b/169133>
        <rdar://problem/29964017>

        Reviewed by Antti Koivisto.

        Add a mechanism for getting a callback when the memory pressure status changes.

        * wtf/MemoryPressureHandler.cpp:
        (WTF::MemoryPressureHandler::measurementTimerFired):
        (WTF::MemoryPressureHandler::beginSimulatedMemoryPressure):
        (WTF::MemoryPressureHandler::endSimulatedMemoryPressure):
        (WTF::MemoryPressureHandler::setUnderMemoryPressure):
        (WTF::MemoryPressureHandler::memoryPressureStatusChanged):
        * wtf/MemoryPressureHandler.h:
        (WTF::MemoryPressureHandler::setMemoryPressureStatusChangedCallback):
        (WTF::MemoryPressureHandler::setUnderMemoryPressure): Deleted.

2017-03-03  Jer Noble  <jer.noble@apple.com>

        [Win64] '__int128_t': undeclared identifier in MediaTime.cpp
        https://bugs.webkit.org/show_bug.cgi?id=169123

        Reviewed by Alex Christensen.

        Don't perform the 128-bit optimized path on Windows, where the __int128_t intrinsic isn't available.

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::setTimeScale):

2017-03-03  Keith Miller  <keith_miller@apple.com>

        WASM should support faster loads.
        https://bugs.webkit.org/show_bug.cgi?id=162693

        Reviewed by Saam Barati.

        Add new forms of dataLog that take a boolean which describes if the log should happen. This makes cases where we have a static const bool for printing nicer since you can do:

        dataLogIf(verbose, things, to, print);

        instead of:

        if (verbose)
            dataLog(things, to, print);

        Also, add a operator! to Ref that has the same semantics as C++ refs.

        * wtf/DataLog.h:
        (WTF::dataLogLn):
        (WTF::dataLogIf):
        (WTF::dataLogLnIf):
        * wtf/Ref.h:
        (WTF::Ref::operator!):

2017-03-02  Jer Noble  <jer.noble@apple.com>

        Sufficently large timeValue and timeScale arguments to MediaTime will cause wrapping in toTimeScale().
        https://bugs.webkit.org/show_bug.cgi?id=169098

        Reviewed by Keith Miller.

        Use a non-standard but Clang & GCC supported __int128_t type extension to do the 128-bit math rather than
        rolling our own. Since this is only available in 64-bit builds, for 32-bit, just fix the underlying 128-bit
        math.

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::setTimeScale):

2017-03-01  Konstantin Tokarev  <annulen@yandex.ru>

        Removed unused WTF_COMPILER_SUPPORTS_CXX_USER_LITERALS macro
        https://bugs.webkit.org/show_bug.cgi?id=168969

        Reviewed by Darin Adler.

        * wtf/Compiler.h:

2017-03-01  Tomas Popela  <tpopela@redhat.com>

        [WTF] va_list is not ended in StringPrintStream
        https://bugs.webkit.org/show_bug.cgi?id=169035

        Reviewed by Michael Saboff.

        Also fix whitespace errors while touching this file.

        * wtf/StringPrintStream.cpp:
        (WTF::StringPrintStream::vprintf):
        (WTF::StringPrintStream::increaseSize):

2017-03-01  Andreas Kling  <akling@apple.com>

        Move MemoryPressureHandler to WTF
        <https://webkit.org/b/168908>

        Reviewed by Sam Weinig.

        Move MemoryPressureHandler down to WTF so it can be used from JavaScriptCore.

        I had to do a blind rewrite of the Windows memory checking timer since it can
        no longer use WebCore::Timer. I also moved the Win32Handle helper class to WTF.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/MemoryPressureHandler.cpp: Renamed from Source/WebCore/platform/MemoryPressureHandler.cpp.
        (WTF::MemoryPressureHandler::singleton):
        (WTF::MemoryPressureHandler::MemoryPressureHandler):
        (WTF::MemoryPressureHandler::setShouldUsePeriodicMemoryMonitor):
        (WTF::toString):
        (WTF::thresholdForPolicy):
        (WTF::policyForFootprint):
        (WTF::MemoryPressureHandler::measurementTimerFired):
        (WTF::MemoryPressureHandler::beginSimulatedMemoryPressure):
        (WTF::MemoryPressureHandler::endSimulatedMemoryPressure):
        (WTF::MemoryPressureHandler::releaseMemory):
        (WTF::MemoryPressureHandler::ReliefLogger::logMemoryUsageChange):
        (WTF::MemoryPressureHandler::install):
        (WTF::MemoryPressureHandler::uninstall):
        (WTF::MemoryPressureHandler::holdOff):
        (WTF::MemoryPressureHandler::respondToMemoryPressure):
        (WTF::MemoryPressureHandler::platformReleaseMemory):
        (WTF::MemoryPressureHandler::ReliefLogger::platformMemoryUsage):
        (WTF::MemoryPressureHandler::platformInitialize):
        * wtf/MemoryPressureHandler.h: Renamed from Source/WebCore/platform/MemoryPressureHandler.h.
        (WTF::MemoryPressureHandler::setMemoryKillCallback):
        (WTF::MemoryPressureHandler::setProcessIsEligibleForMemoryKillCallback):
        (WTF::MemoryPressureHandler::setLowMemoryHandler):
        (WTF::MemoryPressureHandler::isUnderMemoryPressure):
        (WTF::MemoryPressureHandler::setUnderMemoryPressure):
        (WTF::MemoryPressureHandler::ReliefLogger::ReliefLogger):
        (WTF::MemoryPressureHandler::ReliefLogger::~ReliefLogger):
        (WTF::MemoryPressureHandler::ReliefLogger::logString):
        (WTF::MemoryPressureHandler::ReliefLogger::setLoggingEnabled):
        (WTF::MemoryPressureHandler::ReliefLogger::loggingEnabled):
        (WTF::MemoryPressureHandler::ReliefLogger::MemoryUsage::MemoryUsage):
        * wtf/PlatformEfl.cmake:
        * wtf/PlatformGTK.cmake:
        * wtf/PlatformMac.cmake:
        * wtf/PlatformWin.cmake:
        * wtf/cocoa/MemoryPressureHandlerCocoa.mm: Renamed from Source/WebCore/platform/cocoa/MemoryPressureHandlerCocoa.mm.
        (WTF::MemoryPressureHandler::platformReleaseMemory):
        (WTF::MemoryPressureHandler::install):
        (WTF::MemoryPressureHandler::uninstall):
        (WTF::MemoryPressureHandler::holdOff):
        (WTF::MemoryPressureHandler::respondToMemoryPressure):
        (WTF::MemoryPressureHandler::ReliefLogger::platformMemoryUsage):
        * wtf/linux/CurrentProcessMemoryStatus.cpp: Renamed from Source/WebCore/platform/linux/CurrentProcessMemoryStatus.cpp.
        (WTF::systemPageSize):
        (WTF::currentProcessMemoryStatus):
        * wtf/linux/CurrentProcessMemoryStatus.h: Renamed from Source/WebCore/platform/linux/CurrentProcessMemoryStatus.h.
        * wtf/linux/MemoryPressureHandlerLinux.cpp: Renamed from Source/WebCore/platform/linux/MemoryPressureHandlerLinux.cpp.
        (WTF::MemoryPressureHandler::EventFDPoller::EventFDPoller):
        * wtf/win/MemoryPressureHandlerWin.cpp: Renamed from Source/WebCore/platform/win/MemoryPressureHandlerWin.cpp.
        (WTF::MemoryPressureHandler::platformInitialize):
        (WTF::MemoryPressureHandler::windowsMeasurementTimerFired):
        (WTF::MemoryPressureHandler::platformReleaseMemory):
        (WTF::MemoryPressureHandler::install):
        (WTF::MemoryPressureHandler::uninstall):
        (WTF::MemoryPressureHandler::holdOff):
        (WTF::MemoryPressureHandler::respondToMemoryPressure):
        (WTF::MemoryPressureHandler::ReliefLogger::platformMemoryUsage):
        * wtf/win/Win32Handle.h: Renamed from Source/WebCore/platform/win/Win32Handle.h.
        (WTF::Win32Handle::Win32Handle):
        (WTF::Win32Handle::~Win32Handle):
        (WTF::Win32Handle::clear):
        (WTF::Win32Handle::isValid):
        (WTF::Win32Handle::get):
        (WTF::Win32Handle::release):
        (WTF::Win32Handle::operator=):

2017-02-28  Chris Dumez  <cdumez@apple.com>

        [iOS] Throttle requestAnimationFrame to 30fps in low power mode
        https://bugs.webkit.org/show_bug.cgi?id=168837
        <rdar://problem/30700929>

        Reviewed by Simon Fraser.

        Add support for operator -= on WTF::OptionSet for convenience:
            set -= Enum::A;
        looks much better than:
            set = set - Enum::A;

        * wtf/OptionSet.h:
        (WTF::OptionSet::operator-=):

2017-02-28  Michael Saboff  <msaboff@apple.com>

        Add ability to configure JSC options from a file
        https://bugs.webkit.org/show_bug.cgi?id=168914

        Reviewed by Filip Pizlo.

        Added the ability to set options and DataLog file location via a configuration file.
        The pathname can include the printf style "%pid", which will be replaced with the
        current process id.

        * wtf/DataLog.cpp:
        (WTF::initializeLogFileOnce):
        (WTF::setDataFile):
        * wtf/DataLog.h:

2017-02-27  Andy Estes  <aestes@apple.com>

        [iOS] Enable file replacement
        https://bugs.webkit.org/show_bug.cgi?id=168907
        <rdar://problem/22258242>

        Reviewed by David Kilzer.

        * wtf/FeatureDefines.h: Set ENABLE_FILE_REPLACEMENT to 1 on all Cocoa platforms.

2017-02-27  Myles C. Maxfield  <mmaxfield@apple.com>

        Rename ICU cursor iterator to caret iterator
        https://bugs.webkit.org/show_bug.cgi?id=168206

        Reviewed by Simon Fraser.

        * wtf/text/TextBreakIterator.cpp:
        (WTF::mapModeToBackingIterator):
        * wtf/text/TextBreakIterator.h:
        * wtf/text/cf/TextBreakIteratorCF.h:
        (WTF::TextBreakIteratorCF::TextBreakIteratorCF):
        * wtf/text/icu/TextBreakIteratorICU.h:
        (WTF::caretRules):
        (WTF::TextBreakIteratorICU::TextBreakIteratorICU):
        (WTF::cursorRules): Deleted.
        * wtf/text/mac/TextBreakIteratorInternalICUMac.mm:
        (WTF::mapModeToBackingIterator):

2017-02-27  Myles C. Maxfield  <mmaxfield@apple.com>

        Use RAII for ICU breaking iterators
        https://bugs.webkit.org/show_bug.cgi?id=168203

        Reviewed by Simon Fraser.

        * wtf/text/TextBreakIterator.h:
        (WTF::CachedTextBreakIterator::CachedTextBreakIterator):
        (WTF::CachedTextBreakIterator::~CachedTextBreakIterator):
        (WTF::CachedTextBreakIterator::preceding):
        (WTF::CachedTextBreakIterator::following):
        (WTF::CachedTextBreakIterator::isBoundary):

2017-02-24  Jer Noble  <jer.noble@apple.com>

        Add public method to MediaTime for doing timeScale conversion.
        https://bugs.webkit.org/show_bug.cgi?id=168860

        Reviewed by Eric Carlson.

        The newly public method, modeled on CMTimeConvertScale, allows callers to specify what rounding technique
        will be used when converting to a new time scale.

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::toTimeScale):
        (WTF::MediaTime::setTimeScale):
        * wtf/MediaTime.h:

2017-02-26  Myles C. Maxfield  <mmaxfield@apple.com>

        Stop compiling our own cursorMovementIterator()
        https://bugs.webkit.org/show_bug.cgi?id=168211

        Reviewed by David Hyatt.

        This patch creates a unified Text Breaking API, which can be backed by either ICU
        or CoreFoundation (for ports which can use it). Rather than using inheritance and
        virtual functions to implement this, because there are only two subclasses, the
        simpler option of just using a Variant is used instead. There is also a cache which
        allows you to reuse iterators without reconstructing them. This cache is better
        than the previous method of having a single static iterator because the cache
        lets you use two iterators simultaneously.

        In the future, I will hook up all iterators to use this shared class. However, for
        this patch, I've only hooked up the caret position iterator (backed by CoreFoundation
        on Cocoa ports and UBRK_CHARACTER on other ports). 

        * WTF.xcodeproj/project.pbxproj:
        * wtf/spi/cf/CFStringSPI.h: Added.
        * wtf/text/TextBreakIterator.cpp:
        (WTF::initializeIteratorWithRules): Deleted.
        (WTF::cursorMovementIterator): Deleted.
        * wtf/text/TextBreakIterator.h:
        (WTF::TextBreakIterator::preceding):
        (WTF::TextBreakIterator::following):
        (WTF::TextBreakIterator::isBoundary):
        (WTF::TextBreakIterator::setText):
        (WTF::TextBreakIterator::mode):
        (WTF::TextBreakIterator::locale):
        (WTF::TextBreakIteratorCache::singleton):
        (WTF::TextBreakIteratorCache::take):
        (WTF::TextBreakIteratorCache::put):
        (WTF::TextBreakIteratorCache::TextBreakIteratorCache):
        * wtf/text/cf/TextBreakIteratorCF.h: Added.
        (WTF::TextBreakIteratorCF::TextBreakIteratorCF):
        (WTF::TextBreakIteratorCF::setText):
        (WTF::TextBreakIteratorCF::preceding):
        (WTF::TextBreakIteratorCF::following):
        (WTF::TextBreakIteratorCF::isBoundary):
        * wtf/text/icu/TextBreakIteratorICU.h: Added.
        (WTF::TextBreakIteratorICU::set8BitText):
        (WTF::TextBreakIteratorICU::TextBreakIteratorICU):
        (WTF::TextBreakIteratorICU::operator=):
        (WTF::TextBreakIteratorICU::~TextBreakIteratorICU):
        (WTF::TextBreakIteratorICU::setText):
        (WTF::TextBreakIteratorICU::preceding):
        (WTF::TextBreakIteratorICU::following):
        (WTF::TextBreakIteratorICU::isBoundary):
        * wtf/text/icu/UTextProviderLatin1.h:
        * wtf/text/mac/TextBreakIteratorInternalICUMac.mm:
        (WTF::mapModeToBackingIterator):
        (WTF::TextBreakIterator::TextBreakIterator):

2017-02-24  Joseph Pecoraro  <pecoraro@apple.com>

        [Resource Timing] Gather timing information with reliable responseEnd time
        https://bugs.webkit.org/show_bug.cgi?id=168351

        Reviewed by Alex Christensen.

        * wtf/persistence/Coders.h:
        (WTF::Persistence::Coder<Seconds>::encode):
        (WTF::Persistence::Coder<Seconds>::decode):

2017-02-24  Keith Miller  <keith_miller@apple.com>

        Rubber-stamped by Chris Dumez.

        Replace typename Bool with typename BoolType because X11 has
        #define Bool int for some unknown reason...

        * wtf/HashFunctions.h:
        (WTF::TupleHash::allTrue):
        * wtf/HashTraits.h:
        (WTF::TupleHashTraits::allTrue):

2017-02-24  Chris Dumez  <cdumez@apple.com>

        Unreviewed, rolling out r212944.

        Caused a lot of failures on the debug bots

        Reverted changeset:

        "[Resource Timing] Gather timing information with reliable
        responseEnd time"
        https://bugs.webkit.org/show_bug.cgi?id=168351
        http://trac.webkit.org/changeset/212944

2017-02-24  Keith Miller  <keith_miller@apple.com>

        We should be able to use std::tuples as keys in HashMap
        https://bugs.webkit.org/show_bug.cgi?id=168805

        Reviewed by Filip Pizlo.

        This patch adds support for using std::tupeles as the key
        type in HashMap. It is equivalent to doing a sequence of
        std::pairs but has a nicer syntax.

        * wtf/HashFunctions.h:
        (WTF::TupleHash::hash):
        (WTF::TupleHash::equal):
        (WTF::TupleHash::allTrue):
        * wtf/HashTraits.h:
        (WTF::TupleHashTraits::allTrue):
        (WTF::TupleHashTraits::emptyValue):
        (WTF::TupleHashTraits::constructDeletedValue):
        (WTF::TupleHashTraits::isDeletedValue):

2017-02-24  Alex Christensen  <achristensen@webkit.org>

        Prepare to enable WebRTC on iOS
        https://bugs.webkit.org/show_bug.cgi?id=168811

        Reviewed by Youenn Fablet.

        * wtf/Platform.h:

2017-02-23  Joseph Pecoraro  <pecoraro@apple.com>

        [Resource Timing] Gather timing information with reliable responseEnd time
        https://bugs.webkit.org/show_bug.cgi?id=168351

        Reviewed by Alex Christensen.

        * wtf/persistence/Coders.h:
        (WTF::Persistence::Coder<Seconds>::encode):
        (WTF::Persistence::Coder<Seconds>::decode):

2017-02-22  Carlos Garcia Campos  <cgarcia@igalia.com>

        Better handle Thread and RunLoop initialization
        https://bugs.webkit.org/show_bug.cgi?id=167828

        Reviewed by Yusuke Suzuki.

        Make initialization functions more independent so that they can run in different
        order. WTF::initializeMainThread initializes WTF threading, so that neither WTF nor JSC theading need to be
        initialized before. RunLoop::initializeMainRunLoop() requires main thread to be initialized in some
        ports, so it initializes main thread too. WebKit1 always calls WTF::initializeMainThreadToProcessMainThread()
        before RunLoop::initializeMainRunLoop() so there's no problem there. GC threads are initialized alwayas by the
        main thread. The rules should be simpler now:

          - JSC::initializeThreading: should always be called when JSC is used.
          - WTF::initializeThreading: only needs to be explicitly called when JSC is not used and process doesn't
            initialize a main thread or main run loop.
          - WTF::initializeMainThread: only needs to be explicitly called if process initializes a main thread but not a
            main run loop.
          - WTF::initializeMainThreadToProcessMainThread(): should always be called in WebKit1 before
            RunLoop::initializeMainRunLoop().
          - RunLoop::initializeMainRunLoop(): to initialize the main run loop. The only requirement is JSC::initializeThreading()
            to be called before if JSC is used.

        * wtf/MainThread.cpp:
        (WTF::initializeMainThreadOnce): Use pthread_once to initialize the main thread also in GTK+ port.
        (WTF::initializeMainThreadToProcessMainThreadOnce): Call initializeThreading() before the platform
        initialization and initializeGCThreads() after it.
        (WTF::initializeMainThread): Ditto.
        * wtf/RunLoop.cpp:
        (WTF::RunLoop::initializeMainRunLoop): Call initializeMainThread().
        * wtf/glib/MainThreadGLib.cpp:
        (WTF::initializeMainThreadPlatform):
        (WTF::isMainThread):
        * wtf/mac/MainThreadMac.mm:
        (WTF::initializeMainThreadPlatform): Remove call to initializeGCThreads().
        (WTF::initializeMainThreadToProcessMainThreadPlatform): Ditto.

2017-02-22  Myles C. Maxfield  <mmaxfield@apple.com>

        [Cocoa] Remove Yosemite-specific font lookup code
        https://bugs.webkit.org/show_bug.cgi?id=168682

        Reviewed by Zalan Bujtas.

        * wtf/Platform.h:

2017-02-22  Keith Miller  <keith_miller@apple.com>

        Remove the demand executable allocator
        https://bugs.webkit.org/show_bug.cgi?id=168754

        Reviewed by Saam Barati.

        * wtf/Platform.h:

2017-02-22  Alex Christensen  <achristensen@webkit.org>

        Re-commit part of r212812 accidentally rolled out with r212841.
        https://bugs.webkit.org/show_bug.cgi?id=167293

        * wtf/Platform.h:
        Use libwebrtc on Mac if webrtc is enabled.

2017-02-22  Alex Christensen  <achristensen@webkit.org>

        Fix ASAN build after activating libwebrtc.

        * wtf/Ref.h:
        __asan_address_is_poisoned returns an int, not a bool.
        This didn't cause a problem before because we didn't include the real definition anywhere,
        but libwebrtc includes <sanitizer/asan_interface.h> directly now so the return types need to be correct.

2017-02-22  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Test fast/events/message-port-postMessage-recursive.html times out
        https://bugs.webkit.org/show_bug.cgi?id=168570

        Reviewed by Michael Catanzaro.

        This has recently been added and the patch is good. It's just revealing a problem with our timers. The test is
        posting a message recursively, and also starts a timeout timer to finish the test. The timeout timer is never
        fired for us, because WebCore timers have lower priority than the one used by postMessage. ScriptExecutionContext
        uses Document::postTask, that uses scheduleOnMainThread, that uses RunLoop::dispatch(). We are not setting any
        priority for the timer used by RunLoop::dispatch, so it's using the default.
        Use a RunLoop::Timer to schedule tasks to the main thread instead of using RunLoop::dispatch(). This allows us
        to use a different priority, that is now set to G_PRIORITY_HIGH_IDLE + 20 to match WebCore timers. But it also
        avoids the double queue we had with RunLoop::dispatch(), because scheduleOnMainThread() also queues the tasks.

        * wtf/glib/MainThreadGLib.cpp:
        (WTF::MainThreadDispatcher::MainThreadDispatcher):
        (WTF::MainThreadDispatcher::schedule):
        (WTF::MainThreadDispatcher::fired):
        (WTF::scheduleDispatchFunctionsOnMainThread):

2017-02-21  Youenn Fablet  <youenn@apple.com>

        [WebRTC][Mac] Activate libwebrtc
        https://bugs.webkit.org/show_bug.cgi?id=167293

        Reviewed by Alex Christensen.

        * wtf/Platform.h:

2017-02-20  Filip Pizlo  <fpizlo@apple.com>

        The collector thread should only start when the mutator doesn't have heap access
        https://bugs.webkit.org/show_bug.cgi?id=167737

        Reviewed by Keith Miller.
        
        Extend the use of AbstractLocker so that we can use more locking idioms.

        * wtf/AutomaticThread.cpp:
        (WTF::AutomaticThreadCondition::notifyOne):
        (WTF::AutomaticThreadCondition::notifyAll):
        (WTF::AutomaticThreadCondition::add):
        (WTF::AutomaticThreadCondition::remove):
        (WTF::AutomaticThreadCondition::contains):
        (WTF::AutomaticThread::AutomaticThread):
        (WTF::AutomaticThread::tryStop):
        (WTF::AutomaticThread::isWaiting):
        (WTF::AutomaticThread::notify):
        (WTF::AutomaticThread::start):
        (WTF::AutomaticThread::threadIsStopping):
        * wtf/AutomaticThread.h:
        * wtf/NumberOfCores.cpp:
        (WTF::numberOfProcessorCores):
        * wtf/ParallelHelperPool.cpp:
        (WTF::ParallelHelperClient::finish):
        (WTF::ParallelHelperClient::claimTask):
        (WTF::ParallelHelperPool::Thread::Thread):
        (WTF::ParallelHelperPool::didMakeWorkAvailable):
        (WTF::ParallelHelperPool::hasClientWithTask):
        (WTF::ParallelHelperPool::getClientWithTask):
        * wtf/ParallelHelperPool.h:

2017-02-21  Alex Christensen  <achristensen@webkit.org>

        Unreviewed, rolling out r212699.

        Internal build not ready

        Reverted changeset:

        "[WebRTC][Mac] Activate libwebrtc"
        https://bugs.webkit.org/show_bug.cgi?id=167293
        http://trac.webkit.org/changeset/212699

2017-02-20  Youenn Fablet  <youenn@apple.com>

        [WebRTC][Mac] Activate libwebrtc
        https://bugs.webkit.org/show_bug.cgi?id=167293

        Reviewed by Alex Christensen.

        * wtf/Platform.h:

2017-02-20  Mark Lam  <mark.lam@apple.com>

        [Re-landing] CachedCall should let GC know to keep its arguments alive.
        https://bugs.webkit.org/show_bug.cgi?id=168567
        <rdar://problem/30475767>

        Reviewed by Saam Barati.

        Added a WTF_FORBID_HEAP_ALLOCATION that will cause a compilation failure if
        a class declared with it is malloced.

        While this doesn't prevent that class declared WTF_FORBID_HEAP_ALLOCATION from
        being embedded in another class that is heap allocated, it does at minimum
        document the intent and gives the users of this class a chance to do the
        right thing.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/ForbidHeapAllocation.h: Added.

2017-02-20  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r212685.

        This change broke the 32-bit Sierra build.

        Reverted changeset:

        "Resource Load Statistics: Add alternate classification
        method"
        https://bugs.webkit.org/show_bug.cgi?id=168347
        http://trac.webkit.org/changeset/212685

2017-02-20  John Wilander  <wilander@apple.com>

        Resource Load Statistics: Add alternate classification method
        https://bugs.webkit.org/show_bug.cgi?id=168347
        <rdar://problem/30352793>

        Reviewed by Alex Christensen.

        * wtf/Platform.h:
            Added support for HAVE(CORE_PREDICTION).

2017-02-20  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r212618.
        https://bugs.webkit.org/show_bug.cgi?id=168609

        "Appears to cause PLT regression" (Requested by mlam on
        #webkit).

        Reverted changeset:

        "CachedCall should let GC know to keep its arguments alive."
        https://bugs.webkit.org/show_bug.cgi?id=168567
        http://trac.webkit.org/changeset/212618

2017-02-20  Carlos Garcia Campos  <cgarcia@igalia.com>

        Unreviewed, rolling out r212622.

        Caused several test failures

        Reverted changeset:

        "[GTK] Test fast/events/message-port-postMessage-
        recursive.html times out"
        https://bugs.webkit.org/show_bug.cgi?id=168570
        http://trac.webkit.org/changeset/212622

2017-02-19  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Test fast/events/message-port-postMessage-recursive.html times out
        https://bugs.webkit.org/show_bug.cgi?id=168570

        Reviewed by Michael Catanzaro.

        This has recently been added and the patch is good. It's just revealing a problem with our timers. The test is
        posting a message recursively, and also starts a timeout timer to finish the test. The timeout timer is never
        fired for us, because WebCore timers have lower priority than the one used by
        postMessage. ScriptExecutionContext uses Document::postTask, that uses scheduleOnMainThread, that uses
        RunLoop::dispatch(). We are not setting any priority for the timer used by RunLoop::dispatch, so it's using the
        default. RunLoop::dispatch is normally used to schedule tasks between threads, or just to ensure something is
        run in a different run loop iteration, but in general nothing urgent as a graphics redraw or something like
        that. It's quite common to use g_idle_add to schedule tasks between threads, so I think it makes sense to use
        G_PRIORITY_DEFAULT_IDLE for the RunLoop timer.

        * wtf/glib/RunLoopGLib.cpp:
        (WTF::RunLoop::RunLoop):

2017-02-19  Mark Lam  <mark.lam@apple.com>

        CachedCall should let GC know to keep its arguments alive.
        https://bugs.webkit.org/show_bug.cgi?id=168567
        <rdar://problem/30475767>

        Reviewed by Saam Barati.

        Added a WTF_FORBID_HEAP_ALLOCATION that will cause a compilation failure if
        a class declared with it is malloced.

        While this doesn't prevent that class declared WTF_FORBID_HEAP_ALLOCATION from
        being embedded in another class that is heap allocated, it does at minimum
        document the intent and gives the users of this class a chance to do the
        right thing.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/ForbidHeapAllocation.h: Added.

2017-02-19  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r212466.
        https://bugs.webkit.org/show_bug.cgi?id=168577

        causes crashes on AArch64 on linux, maybe it's causing crashes
        on iOS too (Requested by pizlo on #webkit).

        Reverted changeset:

        "The collector thread should only start when the mutator
        doesn't have heap access"
        https://bugs.webkit.org/show_bug.cgi?id=167737
        http://trac.webkit.org/changeset/212466

2017-02-18  Chris Dumez  <cdumez@apple.com>

        Recursive MessagePort.postMessage() calls causes tab to become unresponsive
        https://bugs.webkit.org/show_bug.cgi?id=168548
        <rdar://problem/29808005>

        Reviewed by Darin Adler.

        Add API to retrieve all messages in the queue at once.

        * wtf/MessageQueue.h:

2017-02-16  Alex Christensen  <achristensen@webkit.org>

        Remove EFL-specific files in Source.

        Rubber-stamped by Anders Carlsson.

        * wtf/text/efl: Removed.
        * wtf/text/efl/TextBreakIteratorInternalICUEfl.cpp: Removed.

2017-02-10  Filip Pizlo  <fpizlo@apple.com>

        The collector thread should only start when the mutator doesn't have heap access
        https://bugs.webkit.org/show_bug.cgi?id=167737

        Reviewed by Keith Miller.
        
        Extend the use of AbstractLocker so that we can use more locking idioms.

        * wtf/AutomaticThread.cpp:
        (WTF::AutomaticThreadCondition::notifyOne):
        (WTF::AutomaticThreadCondition::notifyAll):
        (WTF::AutomaticThreadCondition::add):
        (WTF::AutomaticThreadCondition::remove):
        (WTF::AutomaticThreadCondition::contains):
        (WTF::AutomaticThread::AutomaticThread):
        (WTF::AutomaticThread::tryStop):
        (WTF::AutomaticThread::isWaiting):
        (WTF::AutomaticThread::notify):
        (WTF::AutomaticThread::start):
        (WTF::AutomaticThread::threadIsStopping):
        * wtf/AutomaticThread.h:
        * wtf/NumberOfCores.cpp:
        (WTF::numberOfProcessorCores): Allow this to be overridden for testing.
        * wtf/ParallelHelperPool.cpp:
        (WTF::ParallelHelperClient::finish):
        (WTF::ParallelHelperClient::claimTask):
        (WTF::ParallelHelperPool::Thread::Thread):
        (WTF::ParallelHelperPool::didMakeWorkAvailable):
        (WTF::ParallelHelperPool::hasClientWithTask):
        (WTF::ParallelHelperPool::getClientWithTask):
        * wtf/ParallelHelperPool.h:

2017-02-16  Anders Carlsson  <andersca@apple.com>

        Remove EFL from WTF
        https://bugs.webkit.org/show_bug.cgi?id=168452

        Reviewed by Alex Christensen.

        * wtf/CurrentTime.cpp:
        * wtf/DisallowCType.h:
        * wtf/FeatureDefines.h:
        * wtf/MainThread.cpp:
        * wtf/MainThread.h:
        * wtf/Platform.h:
        * wtf/RunLoop.h:
        * wtf/WorkQueue.h:
        * wtf/efl/DispatchQueueEfl.cpp: Removed.
        * wtf/efl/DispatchQueueEfl.h: Removed.
        * wtf/efl/DispatchQueueWorkItemEfl.h: Removed.
        * wtf/efl/EflTypedefs.h: Removed.
        * wtf/efl/MainThreadEfl.cpp: Removed.
        * wtf/efl/RunLoopEfl.cpp: Removed.
        * wtf/efl/UniquePtrEfl.h: Removed.
        * wtf/efl/WorkQueueEfl.cpp: Removed.

2017-02-13  Alex Christensen  <achristensen@webkit.org>

        URLs with an invalid IPv4 address should be invalid
        https://bugs.webkit.org/show_bug.cgi?id=168260

        Reviewed by Tim Horton.

        * wtf/Expected.h:
        (WTF::Expected::value):
        Added missing WTFMove for rvalue Expected::value().

2017-02-13  Said Abou-Hallawa  <sabouhallawa@apple.com>

        The current frame of an image should not deleted if another frame is asynchronously being decoded
        https://bugs.webkit.org/show_bug.cgi?id=167618

        Reviewed by Simon Fraser.

        Add ASSERT_IMPLIES() which should fire when a condition is true but the
        assertion is false.

        * wtf/Assertions.h:

2017-02-13  Brady Eidson  <beidson@apple.com>

        Followup to: Replace all WebKit Library Version checks in WK2 with SDK version checks.
        https://bugs.webkit.org/show_bug.cgi?id=168124

        Reviewed by Geoffrey Garen.

        * wtf/spi/darwin/dyldSPI.h:

2017-02-13  Myles C. Maxfield  <mmaxfield@apple.com>

        Update custom line breaking iterators to the latest version of Unicode
        https://bugs.webkit.org/show_bug.cgi?id=168182

        Reviewed by Zalan Bujtas.

        ICU 55.1 supports loose / normal / strict line breaking rules. The oldest platform we ship
        on has a version of ICU >= that one. Therefore, we don't need to compile our own rules;
        we can just use ICU's rules.

        * wtf/text/LineBreakIteratorPoolICU.h:
        (WTF::LineBreakIteratorPool::makeLocaleWithBreakKeyword):
        (WTF::LineBreakIteratorPool::take):
        * wtf/text/TextBreakIterator.cpp:
        (WTF::acquireLineBreakIterator):
        (WTF::openLineBreakIterator):
        (WTF::mapLineIteratorModeToRules): Deleted.
        (WTF::isCJKLocale): Deleted.
        * wtf/text/TextBreakIterator.h:
        (WTF::LazyLineBreakIterator::LazyLineBreakIterator):
        (WTF::LazyLineBreakIterator::mode):
        (WTF::LazyLineBreakIterator::get):
        (WTF::LazyLineBreakIterator::resetStringAndReleaseIterator):
        (WTF::LazyLineBreakIterator::isLooseCJKMode): Deleted.

2017-02-10  Dan Bernstein  <mitz@apple.com>

        [Xcode] WTF installs extra copies of two headers outside /usr/local/include/wtf
        https://bugs.webkit.org/show_bug.cgi?id=168160

        Reviewed by Sam Weinig.

        * WTF.xcodeproj/project.pbxproj: Demoted OrdinalNumber.h MemoryFootprint.h from Private to
          Project.

2017-02-10  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r212139.
        https://bugs.webkit.org/show_bug.cgi?id=168152

        Caused some assertions (Requested by JoePeck on #webkit).

        Reverted changeset:

        "Fix misleading comment in RunLoop.h"
        https://bugs.webkit.org/show_bug.cgi?id=167832
        http://trac.webkit.org/changeset/212139

2017-02-10  Joseph Pecoraro  <pecoraro@apple.com>

        Fix misleading comment in RunLoop.h
        https://bugs.webkit.org/show_bug.cgi?id=167832

        Reviewed by Sam Weinig.

        * wtf/RunLoop.h:
        Mac initialization used to force using CFRunLoopGetMain(). Now however it just
        uses RunLoop::current which uses CFRunLoopGetCurrent(). So this comment that
        it can be done on any thread is misleading and can lead to incorrect behavior
        if it is actually done on a non-main thread on Mac.

2017-02-09  Alex Christensen  <achristensen@webkit.org>

        Unreviewed, rolling out r212040.

        Broke build.  I'm not surprised

        Reverted changeset:

        "[WebRTC][Mac] Activate libwebrtc"
        https://bugs.webkit.org/show_bug.cgi?id=167293
        http://trac.webkit.org/changeset/212040

2017-02-09  Youenn Fablet  <youenn@apple.com>

        [WebRTC][Mac] Activate libwebrtc
        https://bugs.webkit.org/show_bug.cgi?id=167293

        Reviewed by Alex Christensen.

        * wtf/Platform.h:

2017-02-09  Brady Eidson  <beidson@apple.com>

        Transition "WebKit Library Version" checks to SDK version checks.
        <rdar://problem/30313696> and https://bugs.webkit.org/show_bug.cgi?id=168056

        Reviewed by Geoffrey Garen.

        * wtf/spi/darwin/dyldSPI.h: Add entries for the iOS 10.3, macOS 10.11, and macOS 10.12.4 SDKs.

2017-02-09  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r211980 and r211987.
        https://bugs.webkit.org/show_bug.cgi?id=168072

        Caused API test WebKit2.DuplicateCompletionHandlerCalls to
        fail (Requested by ryanhaddad on #webkit).

        Reverted changesets:

        "Transition "WebKit Library Version" checks to SDK version
        checks."
        https://bugs.webkit.org/show_bug.cgi?id=168056
        http://trac.webkit.org/changeset/211980

        "Build fix for APPLE_INTERNAL_SDK builds after r211980."
        http://trac.webkit.org/changeset/211987

2017-02-09  Alexey Proskuryakov  <ap@apple.com>

        Remove unused WebThreadRunSync
        https://bugs.webkit.org/show_bug.cgi?id=168024

        Reviewed by Tim Horton.

        * wtf/ios/WebCoreThread.cpp:
        * wtf/ios/WebCoreThread.h:

2017-02-09  Brady Eidson  <beidson@apple.com>

        Build fix for APPLE_INTERNAL_SDK builds after r211980.

        Unreviewed.

        * wtf/spi/darwin/dyldSPI.h:

2017-02-09  Brady Eidson  <beidson@apple.com>

        Transition "WebKit Library Version" checks to SDK version checks.
        <rdar://problem/30313696> and https://bugs.webkit.org/show_bug.cgi?id=168056

        Reviewed by Geoffrey Garen.

        * wtf/spi/darwin/dyldSPI.h: Add entries for the iOS 10.3, macOS 10.11, and macOS 10.12.4 SDKs.

2017-02-06  Jer Noble  <jer.noble@apple.com>

        Playback stalls when a SourceBuffer append causes frame eviction
        https://bugs.webkit.org/show_bug.cgi?id=167834

        Reviewed by Eric Carlson.

        Optimize the MediaTime class; specifically the compare() method. The class only
        needs 6 bits to store the TimeFlags, so make that a uint8_t rather than uint32_t.
        The implementation is slightly simpler if the TimeScale is unsigned, so make that
        a uint32_t rather than int32_t. Inline the comparison operators. Optimize the equality
        comparison by bitwise-and'ing the flags together and masking the result. Optimize for
        common comparison scenarios (equal timeScales, equal timeValues(), etc.). Attempt the
        mathematically simpler simpler method for comparing ratios, and only fall back to the
        complex method if the results of multiplying the timeScale by the timeValue overflows.

        * wtf/MediaTime.cpp:
        (WTF::greatestCommonDivisor):
        (WTF::leastCommonMultiple):
        (WTF::signum):
        (WTF::MediaTime::MediaTime):
        (WTF::MediaTime::createWithFloat):
        (WTF::MediaTime::createWithDouble):
        (WTF::MediaTime::operator+):
        (WTF::MediaTime::operator-):
        (WTF::MediaTime::operator!):
        (WTF::MediaTime::operator bool):
        (WTF::MediaTime::compare):
        (WTF::MediaTime::setTimeScale):
        (WTF::abs):
        (WTF::MediaTime::operator<): Deleted.
        (WTF::MediaTime::operator>): Deleted.
        (WTF::MediaTime::operator!=): Deleted.
        (WTF::MediaTime::operator==): Deleted.
        (WTF::MediaTime::operator>=): Deleted.
        (WTF::MediaTime::operator<=): Deleted.
        * wtf/MediaTime.h:

2017-02-04  Michael Catanzaro  <mcatanzaro@igalia.com>

        [GTK] Fix huge ENABLE_RESOURCE_USAGE warning spam

        Unreviewed. We shouldn't redefine ENABLE_RESOURCE_USAGE in Platform.h as
        it's already defined in cmakeconfig.h.

        * wtf/Platform.h:

2017-02-03  Joseph Pecoraro  <pecoraro@apple.com>

        Performance Timing: Convert WTF::MonotonicTime and WTF::Seconds
        https://bugs.webkit.org/show_bug.cgi?id=167768

        Reviewed by Geoffrey Garen.

        * wtf/Stopwatch.h:
        (WTF::Stopwatch::elapsedTimeSince):
        (WTF::Stopwatch::elapsedTimeSinceMonotonicTime): Deleted.

2017-02-03  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Add initial implementation of resource usage overlay
        https://bugs.webkit.org/show_bug.cgi?id=167731

        Reviewed by Michael Catanzaro.

        Enable RESOURCE_USAGE for GTK+ port too.

        * wtf/Platform.h:

2017-02-02  Andreas Kling  <akling@apple.com>

        [Mac] In-process memory pressure monitor for WebContent processes AKA websam
        <https://webkit.org/b/167491>
        <rdar://problem/30116072>

        Reviewed by Antti Koivisto.

        Add a WTF helper function for getting the current process's memory footprint.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/MemoryFootprint.cpp:
        (WTF::memoryFootprint):
        * wtf/MemoryFootprint.h:

2017-02-02  Mark Lam  <mark.lam@apple.com>

        Add a SIGILL crash analyzer to make debugging SIGILLs easier.
        https://bugs.webkit.org/show_bug.cgi?id=167714
        <rdar://problem/30318237>

        Reviewed by Filip Pizlo.

        * wtf/StdLibExtras.h:

2017-02-02  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r211571 and r211582.
        https://bugs.webkit.org/show_bug.cgi?id=167751

        This change caused API test WebKit1.MemoryPressureHandler to
        fail with an assertion. (Requested by ryanhaddad on #webkit).

        Reverted changesets:

        "[Mac] In-process memory pressure monitor for WebContent
        processes."
        https://bugs.webkit.org/show_bug.cgi?id=167491
        http://trac.webkit.org/changeset/211571

        "Unreviewed attempt to fix the Windows build after r211571."
        http://trac.webkit.org/changeset/211582

2017-02-02  Andreas Kling  <akling@apple.com>

        [Mac] In-process memory pressure monitor for WebContent processes.
        <https://webkit.org/b/167491>
        <rdar://problem/30116072>

        Reviewed by Antti Koivisto.

        Add a WTF helper function for getting the current process's memory footprint.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/MemoryFootprint.cpp:
        (WTF::memoryFootprint):
        * wtf/MemoryFootprint.h:

2017-02-01  Wenson Hsieh  <wenson_hsieh@apple.com>

        Unreviewed, fix the WebKit nightly open source build
        <rdar://problem/30308635>

        We cannot assume all internal SDKs have the latest WebKitAdditions, so we need an explicit header check here.

        * wtf/Platform.h:

2017-02-01  Andreas Kling  <akling@apple.com>

        Implement the alwaysRunsAtBackgroundPriority WK2 setting using thread QoS.
        <https://webkit.org/b/167387>
        <rdar://problem/29711409>

        Reviewed by Antti Koivisto.

        Add a new mechanism for overriding the max thread QoS level globally:

            void setGlobalMaxQOSClass(qos_class_t)
            qos_class_t adjustedQOSClass(qos_class_t)

        The QoS cap applies to all newly created threads, threads that try to override
        their QoS class manually, and also passed down to bmalloc.

        * wtf/Threading.cpp:
        (WTF::setCurrentThreadIsUserInteractive):
        (WTF::setCurrentThreadIsUserInitiated):
        (WTF::setGlobalMaxQOSClass):
        (WTF::adjustedQOSClass):
        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::createThreadInternal):
        * wtf/cocoa/WorkQueueCocoa.cpp:
        (WTF::dispatchQOSClass):

2017-01-31  Antti Koivisto  <antti@apple.com>

        Teach cache coders to encode time_points
        https://bugs.webkit.org/show_bug.cgi?id=167670

        Reviewed by Andreas Kling.

        * wtf/persistence/Coders.h:
        (WTF::Persistence::Coder<std::chrono::system_clock::time_point>::encode):
        (WTF::Persistence::Coder<std::chrono::system_clock::time_point>::decode):

2017-01-31  Joseph Pecoraro  <pecoraro@apple.com>

        Removed unused m_nestedCount from RunLoop
        https://bugs.webkit.org/show_bug.cgi?id=167674

        Reviewed by Sam Weinig.

        * wtf/RunLoop.h:
        * wtf/cf/RunLoopCF.cpp:
        (WTF::RunLoop::RunLoop):
        (WTF::RunLoop::run):

2017-01-31  Filip Pizlo  <fpizlo@apple.com>

        The mutator should be able to perform increments of GC work
        https://bugs.webkit.org/show_bug.cgi?id=167528

        Reviewed by Keith Miller and Geoffrey Garen.

        We want dataLog to be locked even if you're not logging to a file!

        * wtf/DataLog.cpp:
        (WTF::initializeLogFileOnce):

2017-01-28  Wenson Hsieh  <wenson_hsieh@apple.com>

        Check USE(APPLE_INTERNAL_SDK) instead of specific headers when importing from WebKitAdditions
        https://bugs.webkit.org/show_bug.cgi?id=167555

        Reviewed by Dan Bernstein.

        Instead of guarding #import <WebKitAdditions/*> on the existence of the imported file, consult
        USE(APPLE_INTERNAL_SDK) instead.

        * wtf/Platform.h:

2017-01-26  Saam Barati  <sbarati@apple.com>

        Harden how the compiler references GC objects
        https://bugs.webkit.org/show_bug.cgi?id=167277
        <rdar://problem/30179506>

        Reviewed by Filip Pizlo.

        I made TinyPtrSet use bitwise_cast instead of static_cast
        for its singleEntry() function so that it can work on pointer-like
        types just as it can on actual pointer types.
        
        An example of where this matters is when you have TinyPtrSet<T>
        where T is defined to be a struct which wraps a pointer, e.g:
        
        struct T {
            void* m_pointer;
        }

        * wtf/TinyPtrSet.h:
        (WTF::TinyPtrSet::singleEntry):

2017-01-25  Wenson Hsieh  <wenson_hsieh@apple.com>

        Introduce an item-provider-based pasteboard wrapper
        https://bugs.webkit.org/show_bug.cgi?id=167410

        Reviewed by Enrica Casucci.

        Adds an additional feature flag.

        * wtf/FeatureDefines.h:

2017-01-25  Konstantin Tokarev  <annulen@yandex.ru>

        Removed leftovers of pre-2015 VisualStudio support
        https://bugs.webkit.org/show_bug.cgi?id=167434

        Reviewed by Alex Christensen.

        * wtf/Compiler.h:
        * wtf/Platform.h:
        * wtf/StringExtras.h:

2017-01-25  Chris Dumez  <cdumez@apple.com>

        Disable Download attribute support on iOS
        https://bugs.webkit.org/show_bug.cgi?id=167337
        <rdar://problem/30154148>

        Reviewed by Alexey Proskuryakov.

        Disable Download attribute support on iOS as it currently does not work.

        * wtf/FeatureDefines.h:

2017-01-25  Wenson Hsieh  <wenson_hsieh@apple.com>

        Add a hook to include additional feature defines
        https://bugs.webkit.org/show_bug.cgi?id=167403

        Reviewed by Enrica Casucci.

        * wtf/Platform.h: Include AdditionalFeatureDefines.h, if it exists.

2017-01-24  Joseph Pecoraro  <pecoraro@apple.com>

        Fold USER_TIMING into WEB_TIMING and make it a RuntimeEnabledFeature
        https://bugs.webkit.org/show_bug.cgi?id=167394

        Reviewed by Ryosuke Niwa.

        * wtf/FeatureDefines.h:

2017-01-24  Konstantin Tokarev  <annulen@yandex.ru>

        VS2015 supports ref qualifiers
        https://bugs.webkit.org/show_bug.cgi?id=167368

        Reviewed by Sam Weinig.

        * wtf/Compiler.h: Enable
        WTF_COMPILER_SUPPORTS_CXX_REFERENCE_QUALIFIED_FUNCTIONS for VS2015

2017-01-24  Daniel Bates  <dabates@apple.com>

        StringView.split() should use an iterator design pattern instead of allocating a Vector
        https://bugs.webkit.org/show_bug.cgi?id=163225

        Reviewed by Darin Adler.

        Implement StringView.split() using an iterator design.

        Using an iterator design avoids the need to allocate a Vector of StringView objects,
        which is space-inefficient and error prone as the returned Vector may outlive the
        lifetime of the underlying string associated with the split (as StringView is a non-
        owning reference to a string).

        StringView.split() now returns a StringView::SplitResult object that implements begin()/end()
        to support iterating over StringView substrings delimited by the specified separator
        character. For example, to iterate over the 'c'-separated substrings of a StringView v,
        you can write:

        for (StringView substring : v.split('c'))
            // Do something with substring.

        * wtf/text/StringView.cpp:
        (WTF::StringView::SplitResult::Iterator::findNextSubstring): Advances the iterator to point to the
        next substring.
        (WTF::StringView::split): Modified to return a SplitResult::Iterator object instead of a Vector<StringView>.
        * wtf/text/StringView.h:
        (WTF::StringView::SplitResult::SplitResult):
        (WTF::StringView::SplitResult::Iterator::Iterator):
        (WTF::StringView::SplitResult::Iterator::operator*):
        (WTF::StringView::SplitResult::Iterator::operator==):
        (WTF::StringView::SplitResult::Iterator::operator!=):
        Implements the iterator interface.

2017-01-20  Joseph Pecoraro  <pecoraro@apple.com>

        Remove outdated ENABLE(CSP_NEXT) build flag
        https://bugs.webkit.org/show_bug.cgi?id=167252

        Reviewed by Brent Fulgham.

        * wtf/FeatureDefines.h:

2017-01-17  Andreas Kling  <akling@apple.com>

        Annotate FastMalloc functions with returns_nonnull attribute.
        <https://webkit.org/b/167144>

        Reviewed by Antti Koivisto.

        Decorate fastMalloc() and friends with __attribute__((returns_nonnull)) for supporting
        compilers that can do useful things with that information.

        * wtf/Compiler.h:
        * wtf/FastMalloc.h:

2017-01-17  Joseph Pecoraro  <pecoraro@apple.com>

        ENABLE(USER_TIMING) Not Defined for Apple Windows or OS X Ports
        https://bugs.webkit.org/show_bug.cgi?id=116551
        <rdar://problem/13949830>

        Reviewed by Alex Christensen.

        * wtf/FeatureDefines.h:

2017-01-16  Joseph Pecoraro  <pecoraro@apple.com>

        Remove the REQUEST_ANIMATION_FRAME flag
        https://bugs.webkit.org/show_bug.cgi?id=156980
        <rdar://problem/25906849>

        Reviewed by Simon Fraser.

        * wtf/FeatureDefines.h:

2017-01-15  Sam Weinig  <sam@webkit.org>

        Add the ability to use numbers in makeString()
        https://bugs.webkit.org/show_bug.cgi?id=167087

        Reviewed by Darin Adler.

        Allow numbers to be easily used in makeString() and tryMakeString().

        For instance, you can now write:
            int amount = 7;
            auto foo = makeString("There are ", amount, " apples in the cart");

        * WTF.xcodeproj/project.pbxproj:
        Add new file.

        * wtf/text/IntegerToStringConversion.h:
        (WTF::writeNumberToBufferImpl):
        (WTF::writeNumberToBufferSigned):
        (WTF::writeNumberToBufferUnsigned):
        (WTF::lengthOfNumberAsStringImpl):
        (WTF::lengthOfNumberAsStringSigned):
        (WTF::lengthOfNumberAsStringUnsigned):
        Add variants of integer writing code that compute the length of the string
        that would be produced and writes the string to an existing buffer.

        (WTF::IntegerToStringConversionTrait<AtomicString>::flush): Deleted.
        (WTF::IntegerToStringConversionTrait<String>::flush): Deleted.
        (WTF::IntegerToStringConversionTrait<StringBuilder>::flush): Deleted.
        Move these traits to their respective classes.

        * wtf/text/AtomicString.h:
        (WTF::IntegerToStringConversionTrait<AtomicString>::flush):
        * wtf/text/StringBuilder.h:
        (WTF::IntegerToStringConversionTrait<StringBuilder>::flush):
        * wtf/text/WTFString.h:
        (WTF::IntegerToStringConversionTrait<String>::flush):
        Traits moved here from IntegerToStringConversion.h

        * wtf/text/StringConcatenateNumbers.h: Added.
        (WTF::StringTypeAdapter<int>::StringTypeAdapter<int>):
        (WTF::StringTypeAdapter<int>::length):
        (WTF::StringTypeAdapter<int>::is8Bit):
        (WTF::StringTypeAdapter<int>::writeTo):
        (WTF::StringTypeAdapter<int>::toString):
        (WTF::StringTypeAdapter<unsigned>::StringTypeAdapter<unsigned>):
        (WTF::StringTypeAdapter<unsigned>::length):
        (WTF::StringTypeAdapter<unsigned>::is8Bit):
        (WTF::StringTypeAdapter<unsigned>::writeTo):
        (WTF::StringTypeAdapter<unsigned>::toString):
        (WTF::StringTypeAdapter<float>::StringTypeAdapter<float>):
        (WTF::StringTypeAdapter<float>::length):
        (WTF::StringTypeAdapter<float>::is8Bit):
        (WTF::StringTypeAdapter<float>::writeTo):
        (WTF::StringTypeAdapter<float>::toString):
        (WTF::StringTypeAdapter<double>::StringTypeAdapter<double>):
        (WTF::StringTypeAdapter<double>::length):
        (WTF::StringTypeAdapter<double>::is8Bit):
        (WTF::StringTypeAdapter<double>::writeTo):
        (WTF::StringTypeAdapter<double>::toString):
        Add basic adaptors for int, unsigned, float, and double.

        (WTF::FormattedNumber::fixedPrecision):
        (WTF::FormattedNumber::fixedWidth):
        (WTF::FormattedNumber::length):
        (WTF::FormattedNumber::buffer):
        (WTF::FormattedNumber::stringView):
        (WTF::StringTypeAdapter<FormattedNumber>::StringTypeAdapter<FormattedNumber>):
        (WTF::StringTypeAdapter<FormattedNumber>::length):
        (WTF::StringTypeAdapter<FormattedNumber>::is8Bit):
        (WTF::StringTypeAdapter<FormattedNumber>::writeTo):
        (WTF::StringTypeAdapter<FormattedNumber>::toString):
        Add a special class, FormattedNumber, and an adaptor for it, allowing for
        fixedPrecision and fixedWidth representation of doubles.

2017-01-14  Yusuke Suzuki  <utatane.tea@gmail.com>

        WebAssembly: Suppress warnings & errors in GCC
        https://bugs.webkit.org/show_bug.cgi?id=167049

        Reviewed by Sam Weinig.

        * wtf/LEBDecoder.h:
        (WTF::LEBDecoder::decodeInt):
        If T = int, it performs `-1 << shift`. It causes
        warning in GCC. Instead, we first cast it to the
        UnsignedT, perform operation and re-cast to the
        T.

2017-01-13  Joseph Pecoraro  <pecoraro@apple.com>

        Remove ENABLE(DETAILS_ELEMENT) guards
        https://bugs.webkit.org/show_bug.cgi?id=167042

        Reviewed by Alex Christensen.

        * wtf/FeatureDefines.h:

2017-01-11  Darin Adler  <darin@apple.com>

        Remove PassRefPtr from more of "platform"
        https://bugs.webkit.org/show_bug.cgi?id=166809

        Reviewed by Sam Weinig.

        * wtf/Ref.h: Changed the template so that a const Ref<T> does not prohibit non-const
        use of T. We can still use const Ref<const T> to express that. The earlier design
        was intentional, but was not consistent with either actual references or with
        other smart pointer classes like RefPtr. One way to see how much better this is,
        is to see all the many, many cases where we have const_cast just to work around
        this. I searched for those and included fixes for many in this patch.

2017-01-12  Chris Dumez  <cdumez@apple.com>

        [iOS] Implement support for KeyboardEvent.code
        https://bugs.webkit.org/show_bug.cgi?id=166932
        <rdar://problem/29972518>

        Reviewed by Darin Adler.

        Enable KEYBOARD_CODE_ATTRIBUTE feature on iOS.

        * wtf/FeatureDefines.h:

2017-01-11  Andreas Kling  <akling@apple.com>

        Crash when WebCore's GC heap grows way too large.
        <https://webkit.org/b/166875>
        <rdar://problem/27896585>

        Reviewed by Mark Lam.

        Publish the WTF::GB constant.

        * wtf/StdLibExtras.h:

2017-01-11  Anders Carlsson  <andersca@apple.com>

        navigator.plugins.refresh and WKContextRefreshPlugIns doesn't pick up changes to already-present plug-ins
        https://bugs.webkit.org/show_bug.cgi?id=166942
        rdar://problem/29839194

        Reviewed by Sam Weinig.

        * wtf/spi/cf/CFBundleSPI.h:
        Add SPI declaration.

2017-01-06  Gustavo Noronha Silva  <gustavo.noronha@collabora.co.uk>

        [GTK] Should support key and code properties on keyboard events
        https://bugs.webkit.org/show_bug.cgi?id=166759

        Reviewed by Carlos Garcia Campos.

        * wtf/FeatureDefines.h: enable key and code properties support for GTK.

2017-01-08  Antti Koivisto  <antti@apple.com>

        Move cache coders to WTF
        https://bugs.webkit.org/show_bug.cgi?id=166825

        Rubber-stamped by Sam Weinig.

        Make it possible to use robust serialization of WTF types on the lower levels of the stack.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/persistence: Added.
        * wtf/persistence/Coder.h: Copied from Source/WebKit2/NetworkProcess/cache/NetworkCacheCoder.h.
        (WebKit::NetworkCache::Coder::encode): Deleted.
        (WebKit::NetworkCache::Coder::decode): Deleted.
        * wtf/persistence/Coders.cpp: Copied from Source/WebKit2/NetworkProcess/cache/NetworkCacheCoders.cpp.
        (WebKit::NetworkCache::Coder<AtomicString>::encode): Deleted.
        (WebKit::NetworkCache::Coder<AtomicString>::decode): Deleted.
        (WebKit::NetworkCache::Coder<CString>::encode): Deleted.
        (WebKit::NetworkCache::Coder<CString>::decode): Deleted.
        (WebKit::NetworkCache::Coder<String>::encode): Deleted.
        (WebKit::NetworkCache::decodeStringText): Deleted.
        (WebKit::NetworkCache::Coder<String>::decode): Deleted.
        (WebKit::NetworkCache::Coder<SHA1::Digest>::encode): Deleted.
        (WebKit::NetworkCache::Coder<SHA1::Digest>::decode): Deleted.
        (WebKit::NetworkCache::Coder<WebCore::HTTPHeaderMap>::encode): Deleted.
        (WebKit::NetworkCache::Coder<WebCore::HTTPHeaderMap>::decode): Deleted.
        * wtf/persistence/Coders.h: Copied from Source/WebKit2/NetworkProcess/cache/NetworkCacheCoders.h.
        (WebKit::NetworkCache::Coder<std::optional<T>>::encode): Deleted.
        (WebKit::NetworkCache::Coder<std::optional<T>>::decode): Deleted.
        * wtf/persistence/Decoder.cpp: Copied from Source/WebKit2/NetworkProcess/cache/NetworkCacheDecoder.cpp.
        (WebKit::NetworkCache::Decoder::Decoder): Deleted.
        (WebKit::NetworkCache::Decoder::~Decoder): Deleted.
        (WebKit::NetworkCache::Decoder::bufferIsLargeEnoughToContain): Deleted.
        (WebKit::NetworkCache::Decoder::decodeFixedLengthData): Deleted.
        (WebKit::NetworkCache::Decoder::decodeNumber): Deleted.
        (WebKit::NetworkCache::Decoder::decode): Deleted.
        (WebKit::NetworkCache::Decoder::verifyChecksum): Deleted.
        * wtf/persistence/Decoder.h: Copied from Source/WebKit2/NetworkProcess/cache/NetworkCacheDecoder.h.
        (WebKit::NetworkCache::Decoder::length): Deleted.
        (WebKit::NetworkCache::Decoder::currentOffset): Deleted.
        (WebKit::NetworkCache::Decoder::decodeEnum): Deleted.
        (WebKit::NetworkCache::Decoder::decode): Deleted.
        (WebKit::NetworkCache::Decoder::bufferIsLargeEnoughToContain): Deleted.
        * wtf/persistence/Encoder.cpp: Copied from Source/WebKit2/NetworkProcess/cache/NetworkCacheEncoder.cpp.
        (WebKit::NetworkCache::Encoder::Encoder): Deleted.
        (WebKit::NetworkCache::Encoder::~Encoder): Deleted.
        (WebKit::NetworkCache::Encoder::grow): Deleted.
        (WebKit::NetworkCache::Encoder::updateChecksumForData): Deleted.
        (WebKit::NetworkCache::Encoder::encodeFixedLengthData): Deleted.
        (WebKit::NetworkCache::Encoder::encodeNumber): Deleted.
        (WebKit::NetworkCache::Encoder::encode): Deleted.
        (WebKit::NetworkCache::Encoder::encodeChecksum): Deleted.
        * wtf/persistence/Encoder.h: Copied from Source/WebKit2/NetworkProcess/cache/NetworkCacheEncoder.h.
        (WebKit::NetworkCache::Encoder::encodeEnum): Deleted.
        (WebKit::NetworkCache::Encoder::encode): Deleted.
        (WebKit::NetworkCache::Encoder::operator<<): Deleted.
        (WebKit::NetworkCache::Encoder::buffer): Deleted.
        (WebKit::NetworkCache::Encoder::bufferSize): Deleted.
        (WebKit::NetworkCache::Encoder::updateChecksumForNumber): Deleted.

2017-01-08  Konstantin Tokarev  <annulen@yandex.ru>

        Introduce CPU(X86_SSE2) instead of various SSE2 checks
        https://bugs.webkit.org/show_bug.cgi?id=166808

        Reviewed by Michael Catanzaro.

        Now copyLCharsFromUCharSource can use SSE2 implementation on non-Darwin
        OSes, and all SSE2 code paths are available for MSVC on x86 if /arch:SSE2
        or higher is enabled, and for MSVC on x86_64.

        * wtf/Platform.h:
        * wtf/text/ASCIIFastPath.h:
        (WTF::copyLCharsFromUCharSource):

2017-01-05  Myles C. Maxfield  <mmaxfield@apple.com>

        Carets can split up marriages and families
        https://bugs.webkit.org/show_bug.cgi?id=166711
        <rdar://problem/29019333>

        Reviewed by Alex Christensen.

        There are four code points which should be allowed to accept emoji modifiers:
        - U+1F46A FAMILY
        - U+1F46B MAN AND WOMAN HOLDING HANDS
        - U+1F46C TWO MEN HOLDING HANDS
        - U+1F46D TWO WOMEN HOLDING HANDS

        Even though macOS's and iOS's emoji keyboard don't allow users to actually type
        these combinations, we may still receive them from other platforms. We should
        therefore treat these as joining sequences. Rendering isn't a problem because
        the fonts accept the emoji modifiers, but our caret placement code isn't educated
        about it. Currently, we treat these emoji groups as ligatures, allowing the caret
        to be placed between the two code points, which visually shows as being horizontally
        centered in the glyph. Instead, we should treat these code points as accepting
        emoji modifiers.

        Tests: editing/caret/emoji.html
               editing/caret/ios/emoji.html

        * wtf/text/TextBreakIterator.cpp:
        (WTF::cursorMovementIterator):

2017-01-05  Filip Pizlo  <fpizlo@apple.com>

        AutomaticThread timeout shutdown leaves a small window where notify() would think that the thread is still running
        https://bugs.webkit.org/show_bug.cgi?id=166742

        Reviewed by Geoffrey Garen.
        
        Remove the use of the RAII ThreadScope, since the use of RAII helped make this bug possible:
        we'd do ~ThreadScope after we had done ~LockHolder, so in between when we decided to shut
        down a thread and when it reported itself as being shut down, there was a window where a
        notify() call would get confused.
        
        Now, we run all thread shutdown stuff while the lock is held. We release the lock last. One
        API implication is that threadWillStop becomes threadIsStopping and it's called while the
        lock is held. This seems benign.

        * wtf/AutomaticThread.cpp:
        (WTF::AutomaticThread::start):
        (WTF::AutomaticThread::threadIsStopping):
        (WTF::AutomaticThread::ThreadScope::ThreadScope): Deleted.
        (WTF::AutomaticThread::ThreadScope::~ThreadScope): Deleted.
        (WTF::AutomaticThread::threadWillStop): Deleted.
        * wtf/AutomaticThread.h:

2017-01-04  Darin Adler  <darin@apple.com>

        Remove PassRefPtr use from the "html" directory, other improvements
        https://bugs.webkit.org/show_bug.cgi?id=166635

        Reviewed by Alex Christensen.

        * wtf/RefPtr.h:
        (WTF::makeRefPtr): Added.

2017-01-04  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed build fix after r210313
        https://bugs.webkit.org/show_bug.cgi?id=166676

        Revert `#pragma once` to ifdefs due to build failure.

        * wtf/text/StringView.h:

2017-01-04  Yusuke Suzuki  <utatane.tea@gmail.com>

        Limit thread name appropriately
        https://bugs.webkit.org/show_bug.cgi?id=166676

        Reviewed by Sam Weinig.

        In some platform, the max length of thread names are limited.
        For example, the number of the max length is 32 in Windows and
        16 in Linux. But the specified thread name is typically long
        in WebKit like "com.apple.CoreIPC.ReceiveQueue"

        We port the logic substring the thread name in
        generic/WorkQueueGeneric.cpp to Threading. It retrieves the name
        "ReceiveQueue" from "com.apple.CoreIPC.ReceiveQueue". And apply
        the appropriate the thread name limit and use it on Linux and
        Windows environment.

        * wtf/Threading.cpp:
        (WTF::normalizeThreadName):
        (WTF::createThread):
        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::initializeCurrentThreadInternal):
        * wtf/ThreadingWin.cpp:
        (WTF::initializeCurrentThreadInternal):
        * wtf/generic/WorkQueueGeneric.cpp:
        (WorkQueue::platformInitialize):
        * wtf/text/StringView.h:
        (WTF::StringView::left):
        (WTF::StringView::right):
        (WTF::StringView::reverseFind):

2017-01-04  Sam Weinig  <sam@webkit.org>

        REGRESSION (r210257): com.apple.WebKit.WebContent.Development crashed in com.apple.WebCore: WebCore::ExceptionOr<WTF::Ref<WebCore::Database> >::operator= + 14
        <rdar://problem/29866398> 

        * wtf/Expected.h:
        (WTF::Expected::swap):
        Add missing calls to destroy() when moving things over each other in a union.

2017-01-03  Yusuke Suzuki  <utatane.tea@gmail.com>

        Use prctl to name thread on Linux
        https://bugs.webkit.org/show_bug.cgi?id=166663

        Reviewed by Michael Catanzaro.

        It is quite useful if we can name threads. This name will be shown in GDB.
        While macOS uses pthread_setname_np, we can use prctl on Linux.

        * wtf/ThreadingPthreads.cpp:
        (WTF::initializeCurrentThreadInternal):

2017-01-03  Yusuke Suzuki  <utatane.tea@gmail.com>

        WorkQueueGeneric's platformInvalidate() can deadlock when called on the RunLoop's thread
        https://bugs.webkit.org/show_bug.cgi?id=166645

        Reviewed by Carlos Garcia Campos.

        WorkQueue can be destroyed on its invoking thread itself.
        The scenario is the following.

            1. Create WorkQueue (in thread A).
            2. Dispatch a task (in thread A, dispatching a task to thread B).
            3. Deref in thread A.
            4. The task is executed in thread B.
            5. Deref in thread B.
            6. The WorkQueue is destroyed, calling platformInvalidate in thread B.

        In that case, if platformInvalidate waits thread B's termination, it causes deadlock.
        We do not need to wait the thread termination.

        * wtf/WorkQueue.h:
        * wtf/generic/WorkQueueGeneric.cpp:
        (WorkQueue::platformInitialize):
        (WorkQueue::platformInvalidate):

2017-01-03  Sam Weinig  <sam@webkit.org>

        Make WTF::Expected support Ref template parameters
        https://bugs.webkit.org/show_bug.cgi?id=166662

        Reviewed by Alex Christensen.

        Tests: Added to TestWebKitAPI/Expected.cpp

        * wtf/Expected.h:
        (WTF::UnexpectedType::value):
        Add overloads based on this value type to allow getting at the value
        as an rvalue for moving the error into the Expected.

        (WTF::Expected::Expected):
        Add overload that takes an ErrorType/UnexpectedType<ErrorType> as an rvalue.

        (WTF::Expected::swap):
        Move the temporary value/error rather than copying.

2017-01-02  Julien Brianceau  <jbriance@cisco.com>

        Remove sh4 specific code from JavaScriptCore
        https://bugs.webkit.org/show_bug.cgi?id=166640

        Reviewed by Filip Pizlo.

        * wtf/Platform.h:

2017-01-02  Yusuke Suzuki  <utatane.tea@gmail.com>

        Leverage Substring to create new AtomicStringImpl for StaticStringImpl and SymbolImpl
        https://bugs.webkit.org/show_bug.cgi?id=166636

        Reviewed by Darin Adler.

        Previously we always create the full atomic string if we need to create the same string
        based on the given value. For example, when generating AtomicStringImpl from the SymbolImpl,
        we need to create a new AtomicStringImpl since SymbolImpl never becomes `isAtomic() == true`.
        But it is costly.

        This patch leverages the substring system of StringImpl. Instead of allocating the completely
        duplicate string, we create a substring StringImpl that shares the same content with the
        base string.

        * wtf/text/AtomicStringImpl.cpp:
        (WTF::stringTable):
        (WTF::addToStringTable):
        (WTF::addSubstring):
        (WTF::AtomicStringImpl::addSlowCase):
        (WTF::AtomicStringImpl::remove):
        (WTF::AtomicStringImpl::lookUpSlowCase):
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::StaticStringImpl::operator StringImpl&):

2017-01-02  Yusuke Suzuki  <utatane.tea@gmail.com>

        Use StaticStringImpl instead of StaticASCIILiteral
        https://bugs.webkit.org/show_bug.cgi?id=166586

        Reviewed by Darin Adler.

        It is more handy way to define static StringImpl. It calculates the length
        and hash value by using the constexpr constructor and function. So we do
        not need to calculate these things in Perl script.
        And it allows us to use StaticStringImpl in the hand written C++ code.
        Previously, we need to calculate the length and hash value by hand if we
        would like to use StaticASCIILiteral in the hand written C++ code, and it
        meant that we cannot use it at all in the hand written C++ code.

        * wtf/text/AtomicStringImpl.cpp:
        (WTF::AtomicStringImpl::addSlowCase):
        (WTF::AtomicStringImpl::lookUpSlowCase):
        * wtf/text/AtomicStringImpl.h:
        * wtf/text/StringImpl.h:
        * wtf/text/SymbolImpl.h:
        * wtf/text/UniquedStringImpl.h:

2017-01-02  Andreas Kling  <akling@apple.com>

        Discard media controls JS/CSS caches under memory pressure.
        <https://webkit.org/b/166639>

        Reviewed by Antti Koivisto.

        * wtf/text/WTFString.h:
        (WTF::String::clearImplIfNotShared): Add a helper for clearing a String if the underlying
        StringImpl is not referenced by anyone else.

2016-12-22  Mark Lam  <mark.lam@apple.com>

        De-duplicate finally blocks.
        https://bugs.webkit.org/show_bug.cgi?id=160168

        Reviewed by Saam Barati.

        Added some methods to bring SegmentedVector closer to parity with Vector.

        * wtf/SegmentedVector.h:
        (WTF::SegmentedVector::first):
        (WTF::SegmentedVector::last):
        (WTF::SegmentedVector::takeLast):

2016-12-19  Mark Lam  <mark.lam@apple.com>

        Rolling out r209974 and r209952. They break some websites in mysterious ways. Step 2: Rollout r209952.
        https://bugs.webkit.org/show_bug.cgi?id=166049

        Not reviewed.

        * wtf/SegmentedVector.h:
        (WTF::SegmentedVector::last):
        (WTF::SegmentedVector::first): Deleted.
        (WTF::SegmentedVector::takeLast): Deleted.

2016-12-16  Mark Lam  <mark.lam@apple.com>

        Add predecessor info to dumps from JSC_dumpBytecodeLivenessResults=true.
        https://bugs.webkit.org/show_bug.cgi?id=165958

        Reviewed by Keith Miller.

        Added some methods to bring SegmentedVector closer to parity with Vector.

        * wtf/SegmentedVector.h:
        (WTF::SegmentedVector::first):
        (WTF::SegmentedVector::last):
        (WTF::SegmentedVector::takeLast):

2016-12-16  Michael Saboff  <msaboff@apple.com>

        REGRESSION: HipChat and Mail sometimes hang beneath JSC::Heap::lastChanceToFinalize()
        https://bugs.webkit.org/show_bug.cgi?id=165962

        Reviewed by Filip Pizlo.

        There is an inherent race in Condition::waitFor() where the timeout can happen just before
        a notify from another thread.

        Fixed this by adding a condition variable and flag to each AutomaticThread.  The flag
        is used to signify to a notifying thread that the thread is waiting.  That flag is set
        in the waiting thread before calling waitFor() and cleared by another thread when it
        notifies the thread.  The access to that flag happens when the lock is held.
        Now the waiting thread checks if the flag after a timeout to see that it in fact should
        proceed like a normal notification.

        The added condition variable allows us to target a specific thread.  We used to keep a list
        of waiting threads, now we keep a list of all threads.  To notify one thread, we look for
        a waiting thread and notify it directly.  If we can't find a waiting thread, we start a
        sleeping thread.

        We notify all threads by waking all waiting threads and starting all sleeping threads.

        * wtf/AutomaticThread.cpp:
        (WTF::AutomaticThreadCondition::notifyOne):
        (WTF::AutomaticThreadCondition::notifyAll):
        (WTF::AutomaticThread::isWaiting):
        (WTF::AutomaticThread::notify):
        (WTF::AutomaticThread::start):
        * wtf/AutomaticThread.h:

2016-12-15  Myles C. Maxfield  <mmaxfield@apple.com>

        Unreviewed build fix after r209910

        Unreviewed.

        * wtf/Platform.h:

2016-12-15  Myles C. Maxfield  <mmaxfield@apple.com>

        Stop reinterpret_casting UBreakIterators to the undefined type TextBreakIterator
        https://bugs.webkit.org/show_bug.cgi?id=165931

        We have a class declaration for TextBreakIterator but no definition for it. When we
        create an ICU UBreakIterator, we immediately reinterpret_cast it to this undefined
        type, and pass it around our code inside WebCore. Then, whenever we want to actually
        use this iterator, we reinterpret_cast it back to UBreakIterator. This is likely due
        to some ports historically implementing breaking interators on top of other libraries
        other than ICU; however, now, all ports use ICU. Because this internal type is not
        helpful and just adds confusion, we should just call our breaking iterators what
        they are: UBreakIterators.

        This patch is a mechanical replacement of TextBreakIterator to UBreakIterator and
        removes the functions we were calling which pass through directly to ubrk_*().

        Reviewed by Alex Christensen.

        * wtf/text/LineBreakIteratorPoolICU.h:
        (WTF::LineBreakIteratorPool::take):
        (WTF::LineBreakIteratorPool::put):
        * wtf/text/StringView.cpp:
        (WTF::StringView::GraphemeClusters::Iterator::Impl::computeIndexEnd):
        * wtf/text/TextBreakIterator.cpp:
        (WTF::initializeIterator):
        (WTF::initializeIteratorWithRules):
        (WTF::setTextForIterator):
        (WTF::setContextAwareTextForIterator):
        (WTF::wordBreakIterator):
        (WTF::sentenceBreakIterator):
        (WTF::cursorMovementIterator):
        (WTF::acquireLineBreakIterator):
        (WTF::releaseLineBreakIterator):
        (WTF::openLineBreakIterator):
        (WTF::closeLineBreakIterator):
        (WTF::getNonSharedCharacterBreakIterator):
        (WTF::cacheNonSharedCharacterBreakIterator):
        (WTF::isWordTextBreak):
        (WTF::numGraphemeClusters):
        (WTF::numCharactersInGraphemeClusters):
        (WTF::textBreakFirst): Deleted.
        (WTF::textBreakLast): Deleted.
        (WTF::textBreakNext): Deleted.
        (WTF::textBreakPrevious): Deleted.
        (WTF::textBreakPreceding): Deleted.
        (WTF::textBreakFollowing): Deleted.
        (WTF::textBreakCurrent): Deleted.
        (WTF::isTextBreak): Deleted.
        * wtf/text/TextBreakIterator.h:
        (WTF::LazyLineBreakIterator::lastCharacter):
        (WTF::LazyLineBreakIterator::secondToLastCharacter):
        (WTF::LazyLineBreakIterator::setPriorContext):
        (WTF::LazyLineBreakIterator::updatePriorContext):
        (WTF::LazyLineBreakIterator::resetPriorContext):
        (WTF::LazyLineBreakIterator::priorContextLength):
        (WTF::LazyLineBreakIterator::get):
        (WTF::NonSharedCharacterBreakIterator::operator UBreakIterator*):
        (WTF::NonSharedCharacterBreakIterator::operator TextBreakIterator*): Deleted.

2016-12-15  Myles C. Maxfield  <mmaxfield@apple.com>

        Sort Xcode project files
        https://bugs.webkit.org/show_bug.cgi?id=165937

        Reviewed by Simon Fraser.

        * WTF.xcodeproj/project.pbxproj:

2016-12-15  Konstantin Tokarev  <annulen@yandex.ru>

        Added missing override and final specifiers
        https://bugs.webkit.org/show_bug.cgi?id=165903

        Reviewed by Darin Adler.

        * wtf/RunLoop.h:

2016-12-15  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] Optimize Kraken stringify
        https://bugs.webkit.org/show_bug.cgi?id=165857

        Reviewed by Darin Adler.

        Kraken json-stringify-tinderbox performance heavily relies on StringBuilder::appendQuotedJSONString.
        According to the result produced by Linux `perf`, it occupies 28% of execution time.

        We tighten the hottest loop in the above function. We create the super fast path for non escaping case.
        And add " and \ cases (since including " in the string is common). Then we fallback to the slow case.

        It improves the performance 5.5% in Kraken json-stringify-tinderbox in MBP.

            Performance result in my MBP (dandelion).

                Collected 100 samples per benchmark/VM, with 100 VM invocations per benchmark. Emitted a call to gc()
                between sample measurements. Used 1 benchmark iteration per VM invocation for warm-up. Used the
                jsc-specific preciseTime() function to get microsecond-level timing. Reporting benchmark execution times
                with 95% confidence intervals in milliseconds.

                                                   baseline                  patched

                json-stringify-tinderbox        29.243+-0.241      ^      27.701+-0.235         ^ definitely 1.0557x faster

                <arithmetic>                    29.243+-0.241      ^      27.701+-0.235         ^ definitely 1.0557x faster

            Performance result in my Linux laptop (hanayamata).

                Collected 100 samples per benchmark/VM, with 100 VM invocations per benchmark. Emitted a call to gc()
                between sample measurements. Used 1 benchmark iteration per VM invocation for warm-up. Used the
                jsc-specific preciseTime() function to get microsecond-level timing. Reporting benchmark execution times
                with 95% confidence intervals in milliseconds.

                                                   baseline                  patched

                json-stringify-tinderbox        26.711+-0.475      ^      25.255+-0.034         ^ definitely 1.0577x faster

                <arithmetic>                    26.711+-0.475      ^      25.255+-0.034         ^ definitely 1.0577x faster

        * wtf/text/StringBuilder.cpp:
        (WTF::appendQuotedJSONStringInternalSlow):
        (WTF::appendQuotedJSONStringInternal):

2016-12-14  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r209795.
        https://bugs.webkit.org/show_bug.cgi?id=165853

        rolled out the wrong revision (Requested by pizlo on #webkit).

        Reverted changeset:

        "MarkedBlock::marksConveyLivenessDuringMarking should take
        into account collection scope"
        https://bugs.webkit.org/show_bug.cgi?id=165741
        http://trac.webkit.org/changeset/209795

2016-12-14  Enrique Ocaña González  <eocanha@igalia.com>

        REGRESSION(r207879-207891): [GStreamer] Introduced many layout test failures and crashes, bots exiting early
        https://bugs.webkit.org/show_bug.cgi?id=164022

        Reviewed by Xabier Rodriguez-Calvar.

        * wtf/glib/GLibUtilities.h:
        Added new macros to convert gulong to/from gpointer.

2016-12-14  Gavin Barraclough  <barraclough@apple.com>

        MarkedBlock::marksConveyLivenessDuringMarking should take into account collection scope
        https://bugs.webkit.org/show_bug.cgi?id=165741

        Unreviewed, re-landing this with fix (revert erroneous change to Options).

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/DataLog.cpp:
        (WTF::initializeLogFileOnce):
        (WTF::initializeLogFile):
        (WTF::dataFile):
        * wtf/DataLog.h:
        * wtf/LockedPrintStream.cpp: Added.
        (WTF::LockedPrintStream::LockedPrintStream):
        (WTF::LockedPrintStream::~LockedPrintStream):
        (WTF::LockedPrintStream::vprintf):
        (WTF::LockedPrintStream::flush):
        (WTF::LockedPrintStream::begin):
        (WTF::LockedPrintStream::end):
        * wtf/LockedPrintStream.h: Added.
        * wtf/PrintStream.cpp:
        (WTF::PrintStream::printfVariableFormat):
        (WTF::PrintStream::begin):
        (WTF::PrintStream::end):
        * wtf/PrintStream.h:
        (WTF::PrintStream::atomically):
        (WTF::PrintStream::print):
        (WTF::PrintStream::println):
        (WTF::PrintStream::printImpl):
        (WTF::>::unpack):
        (WTF::FormatImpl::FormatImpl):
        (WTF::FormatImpl::dump):
        (WTF::format):
        (WTF::printInternal):
        * wtf/RecursiveLockAdapter.h: Added.
        (WTF::RecursiveLockAdapter::RecursiveLockAdapter):
        (WTF::RecursiveLockAdapter::lock):
        (WTF::RecursiveLockAdapter::unlock):
        (WTF::RecursiveLockAdapter::tryLock):
        (WTF::RecursiveLockAdapter::isLocked):
        * wtf/WordLock.cpp:
        * wtf/WordLock.h:

2016-12-14  Gavin Barraclough  <barraclough@apple.com>

        MarkedBlock::marksConveyLivenessDuringMarking should take into account collection scope
        https://bugs.webkit.org/show_bug.cgi?id=165741

        Unreviewed rollout due to performance regression.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/DataLog.cpp:
        (WTF::initializeLogFileOnce):
        (WTF::initializeLogFile):
        (WTF::dataFile):
        * wtf/DataLog.h:
        * wtf/LockedPrintStream.cpp: Removed.
        * wtf/LockedPrintStream.h: Removed.
        * wtf/PrintStream.cpp:
        (WTF::PrintStream::printfVariableFormat): Deleted.
        (WTF::PrintStream::begin): Deleted.
        (WTF::PrintStream::end): Deleted.
        * wtf/PrintStream.h:
        (WTF::PrintStream::print):
        (WTF::PrintStream::println):
        (WTF::PrintStream::atomically): Deleted.
        (WTF::PrintStream::printImpl): Deleted.
        (): Deleted.
        (WTF::>::unpack): Deleted.
        (WTF::FormatImpl::FormatImpl): Deleted.
        (WTF::FormatImpl::dump): Deleted.
        (WTF::format): Deleted.
        * wtf/RecursiveLockAdapter.h: Removed.
        * wtf/WordLock.cpp:
        * wtf/WordLock.h:

2016-12-13  JF Bastien  <jfbastien@apple.com>

        std::expected: fix rvalue forwarding issues
        https://bugs.webkit.org/show_bug.cgi?id=165812

        Reviewed by Mark Lam.

        * wtf/Expected.h:
        (WTF::UnexpectedType::UnexpectedType):
        (WTF::ExpectedDetail::Base::Base):
        (WTF::Expected::Expected):

2016-12-13  Chris Dumez  <cdumez@apple.com>

        Unreviewed, rolling out r209544.

        Looks like r209489 did not cause the performance regression
        after all

        Reverted changeset:

        "Unreviewed, rolling out r209489."
        https://bugs.webkit.org/show_bug.cgi?id=165550
        http://trac.webkit.org/changeset/209544

2016-12-13  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r209725.
        https://bugs.webkit.org/show_bug.cgi?id=165811

        "Broke ARMv7 builds" (Requested by msaboff on #webkit).

        Reverted changeset:

        "REGRESSION(r209653): speedometer crashes making virtual slow
        path tailcalls"
        https://bugs.webkit.org/show_bug.cgi?id=165748
        http://trac.webkit.org/changeset/209725

2016-12-13  JF Bastien  <jfbastien@apple.com>

        [WTF] Turn tryMakeString(), makeString() into variadic templates
        https://bugs.webkit.org/show_bug.cgi?id=147142

        Reviewed by Mark Lam.

        I wrote this patch while improving WebAssembly's error messages,
        and only found this bug afterwards. My implementation does the
        bare minimum to make this code variadic without changing
        behavior. I think it's better to go with this baby step first, and
        improve the code later.

        Notable, for my WebAssembly patch I also taught the code to handle
        integers and other types (including WebAssembly types). A
        follow-up could rely on ADL magic to pretty-format these other
        types.

        * wtf/text/StringConcatenate.h:
        (WTF::sumWithOverflow): This unconditionally does the sum for all
        inputs, which the compiler is more likely to appreciate (because
        it's the common case) compared to testing for overflow and bailing
        on each addition
        (WTF::are8Bit): are: the plural of is!
        (WTF::makeStringAccumulator): accumulate strings
        (WTF::tryMakeStringFromAdapters): a small helper which creates the string adapters
        (WTF::tryMakeString): expose out of WTF, since it's part of this file's used API
        (WTF::makeString): make it variadic

2016-12-13  Konstantin Tokarev  <annulen@yandex.ru>

        Unreviewed, silence -Wsuggest-attribute for GCC with pragmas

        * wtf/PrintStream.cpp:
        (WTF::PrintStream::printfVariableFormat):

2016-12-12  Michael Saboff  <msaboff@apple.com>

        REGRESSION(r209653): speedometer crashes making virtual slow path tailcalls
        https://bugs.webkit.org/show_bug.cgi?id=165748

        Reviewed by Filip Pizlo.

        Rolling back in r209653, r209654, r209663, and r209673.

        * wtf/Platform.h:

2016-12-12  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r209703.
        https://bugs.webkit.org/show_bug.cgi?id=165749

        Broke Apple builds (Requested by annulen|home on #webkit).

        Reverted changeset:

        "Unreviewed, use WTF_ATTRIBUTE_PRINTF instead of clang pragma"
        http://trac.webkit.org/changeset/209703

2016-12-12  Konstantin Tokarev  <annulen@yandex.ru>

        Unreviewed, use WTF_ATTRIBUTE_PRINTF instead of clang pragma

        * wtf/PrintStream.cpp:
        (WTF::PrintStream::printfVariableFormat):
        * wtf/PrintStream.h:

2016-12-11  Konstantin Tokarev  <annulen@yandex.ru>

        Unreviewed, guarded clang pragma with COMPILER(CLANG) to fix -Werror

        * wtf/PrintStream.cpp:
        (WTF::PrintStream::printfVariableFormat):

2016-12-11  Filip Pizlo  <fpizlo@apple.com>

        Change to use #pragma once (requested by Darin Adler).

        * wtf/RecursiveLockAdapter.h:

2016-12-11  Filip Pizlo  <fpizlo@apple.com>

        Change to use #pragma once (requested by Darin Adler).

        * wtf/LockedPrintStream.h:

2016-12-10  Filip Pizlo  <fpizlo@apple.com>

        MarkedBlock::marksConveyLivenessDuringMarking should take into account collection scope
        https://bugs.webkit.org/show_bug.cgi?id=165741

        Reviewed by Saam Barati.
        
        To find this bug, I needed to seriously beef up our logging infrastructure.
        
        It's now the case that:
        
            dataLog(...);
        
        will print its output atomically. This happens with some careful magic:
        
        - dataFile() is now a LockedPrintStream that locks around print().
        
        - The lock is a recursive lock via RecursiveLockAdapter<>, so if the dump methods end
          up calling back into dataLog() then it just works. This is important: say the dump()
          calls a getter that itself does logging, maybe because it's encountering badness and
          wants to report it before crashing).
        
        - The lock is a WordLock so that ParkingLot and Lock can keep using dataLog() for
          debugging. We probably won't need to debug WordLock anytime soon - the algorithm is
          so simple.
        
        - LockedPrintStream::print(...) causes the print callbacks of its arguments to run on
          the underlying PrintStream, so that you don't need to do recursive lock acquisition
          on each individual argument and whatever printing it does recursively.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/DataLog.cpp:
        (WTF::initializeLogFileOnce):
        (WTF::initializeLogFile):
        (WTF::dataFile):
        * wtf/DataLog.h:
        * wtf/LockedPrintStream.cpp: Added.
        (WTF::LockedPrintStream::LockedPrintStream):
        (WTF::LockedPrintStream::~LockedPrintStream):
        (WTF::LockedPrintStream::vprintf):
        (WTF::LockedPrintStream::flush):
        (WTF::LockedPrintStream::begin):
        (WTF::LockedPrintStream::end):
        * wtf/LockedPrintStream.h: Added.
        * wtf/PrintStream.cpp:
        (WTF::PrintStream::printfVariableFormat):
        (WTF::PrintStream::begin):
        (WTF::PrintStream::end):
        * wtf/PrintStream.h:
        (WTF::PrintStream::atomically):
        (WTF::PrintStream::print):
        (WTF::PrintStream::println):
        (WTF::PrintStream::printImpl):
        (WTF::>::unpack):
        (WTF::FormatImpl::FormatImpl):
        (WTF::FormatImpl::dump):
        (WTF::format):
        (WTF::printInternal):
        * wtf/RecursiveLockAdapter.h: Added.
        (WTF::RecursiveLockAdapter::RecursiveLockAdapter):
        (WTF::RecursiveLockAdapter::lock):
        (WTF::RecursiveLockAdapter::unlock):
        (WTF::RecursiveLockAdapter::tryLock):
        (WTF::RecursiveLockAdapter::isLocked):
        * wtf/WordLock.cpp:
        * wtf/WordLock.h:

2016-12-11  Darin Adler  <darin@apple.com>

        Use std::vsnprintf instead of vasprintf
        https://bugs.webkit.org/show_bug.cgi?id=165740

        Reviewed by Sam Weinig.

        * wtf/Platform.h: Remove HAVE_VASPRINTF.
        * wtf/StringExtras.h: Change the vsnprintf workaround to be used only
        in older versions of Visual Studio, since the problem it works around
        was resolved in Visual Studio 2015.

2016-12-10  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r209653, r209654, r209663, and
        r209673.
        https://bugs.webkit.org/show_bug.cgi?id=165739

        speedometer crashes (Requested by pizlo on #webkit).

        Reverted changesets:

        "JSVALUE64: Pass arguments in platform argument registers when
        making JavaScript calls"
        https://bugs.webkit.org/show_bug.cgi?id=160355
        http://trac.webkit.org/changeset/209653

        "Unreviewed build fix for 32 bit builds."
        http://trac.webkit.org/changeset/209654

        "Unreviewed build fix for the CLOOP after r209653"
        http://trac.webkit.org/changeset/209663

        "REGRESSION(r209653) Crash in CallFrameShuffler::snapshot()"
        https://bugs.webkit.org/show_bug.cgi?id=165728
        http://trac.webkit.org/changeset/209673

2016-12-10  Chris Dumez  <cdumez@apple.com>

        Avoid calling shrink() in the Vector destructor
        https://bugs.webkit.org/show_bug.cgi?id=165675

        Reviewed by Daniel Bates.

        Avoid calling shrink() in the Vector destructor to avoid function call
        overhead and unnecessarily reseting m_size to 0.

        * wtf/Vector.h:
        (WTF::Vector::~Vector):
        (WTF::Vector::asanSetBufferSizeToFullCapacity):
        (WTF::minCapacity>::asanSetBufferSizeToFullCapacity):

2016-12-09  Michael Saboff  <msaboff@apple.com>

        JSVALUE64: Pass arguments in platform argument registers when making JavaScript calls
        https://bugs.webkit.org/show_bug.cgi?id=160355

        Reviewed by Filip Pizlo.

        Added a new build option ENABLE_VM_COUNTERS to enable JIT'able counters.
        The default is for the option to be off.

        * wtf/Platform.h:
        Added ENABLE_VM_COUNTERS

2016-12-09  Geoffrey Garen  <ggaren@apple.com>

        Deploy OrdinalNumber in JSC::SourceCode
        https://bugs.webkit.org/show_bug.cgi?id=165687

        Reviewed by Michael Saboff.

        * wtf/text/OrdinalNumber.h:
        (WTF::OrdinalNumber::operator>): Added a >.

2016-12-09  Geoffrey Garen  <ggaren@apple.com>

        TextPosition and OrdinalNumber should be more like idiomatic numbers
        https://bugs.webkit.org/show_bug.cgi?id=165678

        Reviewed by Filip Pizlo.

        * wtf/text/TextPosition.h:
        (WTF::TextPosition::minimumPosition): Deleted. Just use the default
        constructor. Other numbers use their default constructors to mean zero.

        Any time you need a comment that says "used as a default value", that's
        a pretty good indicator that it should be the default constructor.

2016-12-09  Geoffrey Garen  <ggaren@apple.com>

        Moved OrdinalNumber into its own file
        https://bugs.webkit.org/show_bug.cgi?id=165663

        Reviewed by Saam Barati.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/text/OrdinalNumber.h: Copied from Source/WTF/wtf/text/TextPosition.h.
        (WTF::TextPosition::TextPosition): Deleted.
        (WTF::TextPosition::operator==): Deleted.
        (WTF::TextPosition::operator!=): Deleted.
        (WTF::TextPosition::minimumPosition): Deleted.
        (WTF::TextPosition::belowRangePosition): Deleted.
        * wtf/text/TextPosition.h:
        (WTF::OrdinalNumber::fromZeroBasedInt): Deleted.
        (WTF::OrdinalNumber::fromOneBasedInt): Deleted.
        (WTF::OrdinalNumber::OrdinalNumber): Deleted.
        (WTF::OrdinalNumber::zeroBasedInt): Deleted.
        (WTF::OrdinalNumber::oneBasedInt): Deleted.
        (WTF::OrdinalNumber::operator==): Deleted.
        (WTF::OrdinalNumber::operator!=): Deleted.
        (WTF::OrdinalNumber::first): Deleted.
        (WTF::OrdinalNumber::beforeFirst): Deleted.

2016-12-08  David Kilzer  <ddkilzer@apple.com>

        Always check the return value of pthread_key_create()
        <https://webkit.org/b/165274>

        Reviewed by Darin Adler.

        * wtf/ThreadIdentifierDataPthreads.cpp:
        (WTF::ThreadIdentifierData::initializeOnce): Make the code more
        readable by assigning a variable to the result of
        pthread_key_create().  This matches the idiom used elsewhere.

2016-12-08  Keith Miller  <keith_miller@apple.com>

        Add 64-bit signed LEB decode method
        https://bugs.webkit.org/show_bug.cgi?id=165630

        Reviewed by Ryosuke Niwa.

        Add int64 LEB decode and fix some 64-bit specific issues
        with the decoder. There is also a fix where we would allow
        LEBs with canonical length + 1 size that is fixed by this
        patch.

        * wtf/LEBDecoder.h:
        (WTF::LEBDecoder::decodeUInt):
        (WTF::LEBDecoder::decodeInt):
        (WTF::LEBDecoder::decodeUInt32):
        (WTF::LEBDecoder::decodeUInt64):
        (WTF::LEBDecoder::decodeInt32):
        (WTF::LEBDecoder::decodeInt64):

2016-12-08  Anders Carlsson  <andersca@apple.com>

        Defer sending Mach messages if the queue is full
        https://bugs.webkit.org/show_bug.cgi?id=165622
        rdar://problem/29518036

        Reviewed by Brady Eidson.

        Add new SPI.

        * wtf/spi/darwin/XPCSPI.h:

2016-12-06  Filip Pizlo  <fpizlo@apple.com>

        Concurrent GC should be stable enough to land enabled on X86_64
        https://bugs.webkit.org/show_bug.cgi?id=164990

        Reviewed by Geoffrey Garen.
        
        Adds the ability to say:
        
        auto locker = holdLock(any type of lock)
        
        Instead of having to say:
        
        Locker<LockType> locker(locks of type LockType)
        
        I think that we should use "auto locker = holdLock(lock)" as the default way that we acquire
        locks unless we need to use a special locker type.
        
        This also adds the ability to safepoint a lock. Safepointing a lock is basically a super fast
        way of unlocking it fairly and then immediately relocking it - i.e. letting anyone who is
        waiting to run without losing steam of there is noone waiting.

        * wtf/Lock.cpp:
        (WTF::LockBase::safepointSlow):
        * wtf/Lock.h:
        (WTF::LockBase::safepoint):
        * wtf/LockAlgorithm.h:
        (WTF::LockAlgorithm::safepointFast):
        (WTF::LockAlgorithm::safepoint):
        (WTF::LockAlgorithm::safepointSlow):
        * wtf/Locker.h:
        (WTF::AbstractLocker::AbstractLocker):
        (WTF::Locker::tryLock):
        (WTF::Locker::operator bool):
        (WTF::Locker::Locker):
        (WTF::Locker::operator=):
        (WTF::holdLock):
        (WTF::tryHoldLock):

2016-12-08  Chris Dumez  <cdumez@apple.com>

        Unreviewed, rolling out r209489.

        Likely caused large regressions on JetStream, Sunspider and
        Speedometer

        Reverted changeset:

        "Add system trace points for JavaScript VM entry/exit"
        https://bugs.webkit.org/show_bug.cgi?id=165550
        http://trac.webkit.org/changeset/209489

2016-12-07  Simon Fraser  <simon.fraser@apple.com>

        Add system trace points for JavaScript VM entry/exit
        https://bugs.webkit.org/show_bug.cgi?id=165550

        Reviewed by Tim Horton.
        
        Add trace points for entry/exit into/out of the JS VM.

        * wtf/SystemTracing.h:

2016-12-06  Alexey Proskuryakov  <ap@apple.com>

        Correct SDKROOT values in xcconfig files
        https://bugs.webkit.org/show_bug.cgi?id=165487
        rdar://problem/29539209

        Reviewed by Dan Bernstein.

        Fix suggested by Dan Bernstein.

        * Configurations/DebugRelease.xcconfig:

2016-12-06  Michael Saboff  <msaboff@apple.com>

        REGRESSION(r209399): Causes crashes when dumping JIT disassembly
        https://bugs.webkit.org/show_bug.cgi?id=165483

        Reviewed by Geoffrey Garen.

        Fixed the RELEASE_ASSERT() to check that the 6 character string is terminated by a null
        character.

        * wtf/SixCharacterHash.cpp:
        (WTF::sixCharacterHashStringToInteger):

2016-12-04  Darin Adler  <darin@apple.com>

        Use ASCIICType more, and improve it a little bit
        https://bugs.webkit.org/show_bug.cgi?id=165360

        Reviewed by Sam Weinig.

        * wtf/ASCIICType.h: Added declarations of all the functions to the top of the file,
        so we have a list of what's available, not just a mix of that and the implementation.

        * wtf/HexNumber.h:
        (WTF::Internal::hexDigitsForMode): Moved lowerHexDigits and upperHexDigits
        inside this function.
        (WTF::appendByteAsHex): Use auto.
        (WTF::placeByteAsHexCompressIfPossible): Ditto.
        (WTF::placeByteAsHex): Ditto.
        (WTF::appendUnsignedAsHex): Ditto.
        (WTF::appendUnsigned64AsHex): Ditto.
        (WTF::appendUnsignedAsHexFixedSize): Ditto.
        (WTF::isHexDigit): Deleted.
        (WTF::uncheckedHexDigit): Deleted.
        (WTF::hexDigitValue): Deleted.
        (WTF::uncheckedHexDigitValue): Deleted.

        * wtf/SixCharacterHash.cpp:
        (WTF::sixCharacterHashStringToInteger): Use isASCIIUpper, isASCIILower, and
        isASCIIDigit. Also added some FIXMEs; for some reason this function uses
        RELEASE_ASSERT to abort if the passed-in string is not six characters long,
        and it's not clear to me why this is so critical to assert.
        (WTF::integerToSixCharacterHashString): Moved the table inside this function,
        obviating the need for a macro named TABLE.

        * wtf/dtoa/bignum.cc:
        (WTF::double_conversion::HexCharValue): Deleted.
        (WTF::double_conversion::Bignum::AssignHexString): Use toASCIIHexValue.
        * wtf/dtoa/double-conversion.cc:
        (WTF::double_conversion::StringToDoubleConverter::StringToDouble): Use isASCIIDigit.

        * wtf/text/StringBuilder.cpp:
        (WTF::appendQuotedJSONStringInternal): Use upperNibbleToASCIIHexDigit and
        lowerNibbleToASCIIHexDigit.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::convertToUppercaseWithoutLocale): Use toASCIIUpper.
        Removed the workaround for a bug that was fixed in Visual Studio 2013.

2016-12-05  Joseph Pecoraro  <pecoraro@apple.com>

        REGRESSION(r208985): SafariForWebKitDevelopment Symbol Not Found looking for method with WTF::Optional
        https://bugs.webkit.org/show_bug.cgi?id=165351

        Reviewed by Yusuke Suzuki.

        Include a slimmed down version of WTF::Optional which older versions
        of Safari still depend on for a JavaScriptCore exported symbol.
        To prevent misuse name it WTF::DeprecatedOptional and use it only in
        the one instance it is needed.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/DeprecatedOptional.h: Added.
        (WTF::Optional::operator bool):
        (WTF::Optional::value):
        (WTF::Optional::asPtr):

2016-12-05  Konstantin Tokarev  <annulen@yandex.ru>

        Add __STDC_FORMAT_MACROS before inttypes.h is included
        https://bugs.webkit.org/show_bug.cgi?id=165374

        We need formatting macros like PRIu64 to be available in all places where
        inttypes.h header is used. All these usages get inttypes.h definitions
        via wtf/Assertions.h header, except SQLiteFileSystem.cpp where formatting
        macros are not used anymore since r185129.

        This patch fixes multiple build errors with MinGW and reduces number of
        independent __STDC_FORMAT_MACROS uses in the code base.

        Reviewed by Darin Adler.

        * wtf/Assertions.h: Define __STDC_FORMAT_MACROS.
        * wtf/StdLibExtras.h: Remove definition of PRId64 for Windows, as we
        have __STDC_FORMAT_MACROS defined now.

2016-12-03  Yusuke Suzuki  <utatane.tea@gmail.com>

        Refactor SymbolImpl layout
        https://bugs.webkit.org/show_bug.cgi?id=165247

        Reviewed by Darin Adler.

        This patch moves SymbolImpl initialization from StringImpl to SymbolImpl.
        In SymbolImpl, we create the appropriate fields. At that time, these fields
        should be aligned to the BufferSubstring StringImpl.

        And we newly create the `m_flags` in SymbolImpl. Instead of using special
        StringImpl::null(), we store s_flagIsNullSymbol flag here. In WTF, we have
        the invariant that StringImpl::empty() is the only atomic empty string.
        But StringImpl::null() breaks this invariant. Using a special flag is safer
        way to represent the null Symbol `Symbol()`.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/StdLibExtras.h:
        (WTF::roundUpToMultipleOfImpl0):
        (WTF::roundUpToMultipleOfImpl):
        (WTF::roundUpToMultipleOf):
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::~StringImpl):
        (WTF::StringImpl::createSymbol): Deleted.
        (WTF::StringImpl::createNullSymbol): Deleted.
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::isAtomic):
        (WTF::StringImpl::StringImpl):
        (WTF::StringImpl::requiresCopy):
        (WTF::StringImpl::isNullSymbol): Deleted.
        (WTF::StringImpl::symbolAwareHash): Deleted.
        (WTF::StringImpl::existingSymbolAwareHash): Deleted.
        (WTF::StringImpl::null): Deleted.
        (WTF::StringImpl::extractFoldedStringInSymbol): Deleted.
        (WTF::StringImpl::symbolRegistry): Deleted.
        (WTF::StringImpl::hashForSymbol): Deleted.
        * wtf/text/StringStatics.cpp:
        (WTF::StringImpl::nextHashForSymbol): Deleted.
        * wtf/text/SymbolImpl.cpp: Copied from Source/WTF/wtf/text/SymbolRegistry.cpp.
        (WTF::SymbolImpl::nextHashForSymbol):
        (WTF::SymbolImpl::create):
        (WTF::SymbolImpl::createNullSymbol):
        * wtf/text/SymbolImpl.h:
        (WTF::SymbolImpl::hashForSymbol):
        (WTF::SymbolImpl::symbolRegistry):
        (WTF::SymbolImpl::isNullSymbol):
        (WTF::SymbolImpl::extractFoldedString):
        (WTF::SymbolImpl::SymbolImpl):
        (WTF::StringImpl::symbolAwareHash):
        (WTF::StringImpl::existingSymbolAwareHash):
        * wtf/text/SymbolRegistry.cpp:
        (WTF::SymbolRegistry::~SymbolRegistry):
        (WTF::SymbolRegistry::symbolForKey):
        (WTF::SymbolRegistry::keyForSymbol):
        * wtf/text/UniquedStringImpl.h:
        (WTF::UniquedStringImpl::UniquedStringImpl):

2016-12-01  Yusuke Suzuki  <utatane.tea@gmail.com>

        Introduce StringImpl::StaticStringImpl with constexpr constructor
        https://bugs.webkit.org/show_bug.cgi?id=165093

        Reviewed by Darin Adler.

        This patch adds new class, StringImpl::StaticStringImpl.
        By using this class, we can easily create static StringImpls.
        This class has constexpr constructor. You can initialize instances
        of this class as global static variables without invoking global
        constructors.

        We already have similar system, StaticASCIILiteral. But using it
        requires some special perl script since we need to calculate
        hash value. On the other hand, we can use StaticStringImpl without
        any script supports since we implement constexpr hash function.
        In the future, we will replace all the use of StaticASCIILiteral
        with this StaticStringImpl.

        We define empty / null strings as StaticStringImpl. And we make
        StringImpl::empty() & StringImpl::null() inline functions.

        * wtf/Hasher.h:
        (WTF::StringHasher::hashWithTop8BitsMasked):
        (WTF::StringHasher::hash):
        (WTF::StringHasher::finalize):
        (WTF::StringHasher::finalizeAndMaskTop8Bits):
        (WTF::StringHasher::computeLiteralHash):
        (WTF::StringHasher::computeLiteralHashAndMaskTop8Bits):
        (WTF::StringHasher::avalancheBits3):
        (WTF::StringHasher::avalancheBits2):
        (WTF::StringHasher::avalancheBits1):
        (WTF::StringHasher::avalancheBits0):
        (WTF::StringHasher::avalancheBits):
        (WTF::StringHasher::avoidZero):
        (WTF::StringHasher::processPendingCharacter):
        (WTF::StringHasher::calculateWithRemainingLastCharacter1):
        (WTF::StringHasher::calculateWithRemainingLastCharacter0):
        (WTF::StringHasher::calculateWithRemainingLastCharacter):
        (WTF::StringHasher::calculate1):
        (WTF::StringHasher::calculate0):
        (WTF::StringHasher::calculate):
        (WTF::StringHasher::computeLiteralHashImpl):
        * wtf/text/StringImpl.cpp:
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::StaticStringImpl::StaticStringImpl):
        (WTF::StringImpl::null):
        (WTF::StringImpl::empty):
        * wtf/text/StringStatics.cpp:
        (WTF::StringImpl::null): Deleted.
        (WTF::StringImpl::empty): Deleted.

2016-11-30  Darin Adler  <darin@apple.com>

        Roll out StringBuilder changes from the previous patch.
        They were a slowdown on a Kraken JSON test.

        * wtf/text/StringBuilder.cpp:
        * wtf/text/StringBuilder.h:
        Roll out changes from below.

2016-11-30  Darin Adler  <darin@apple.com>

        Streamline and speed up tokenizer and segmented string classes
        https://bugs.webkit.org/show_bug.cgi?id=165003

        And do it without re-introducing:

        REGRESSION (r209058): API test StringBuilderTest.Equal crashing
        https://bugs.webkit.org/show_bug.cgi?id=165142

        Reviewed by Sam Weinig.

        * wtf/text/StringBuilder.cpp:
        (WTF::StringBuilder::bufferCharacters<LChar>): Moved this here from
        the header since it is only used inside the class. Also renamed from
        getBufferCharacters.
        (WTF::StringBuilder::bufferCharacters<UChar>): Ditto.
        (WTF::StringBuilder::appendUninitializedUpconvert): Added. Helper
        for the upconvert case in the 16-bit overload of StrinBuilder::append.
        (WTF::StringBuilder::append): Changed to use appendUninitializedUpconvert.
        (WTF::quotedJSONStringLength): Added. Used in new appendQuotedJSONString
        implementation below that now correctly determines the size of what will
        be appended by walking thorugh the string twice.
        (WTF::appendQuotedJSONStringInternal): Moved the code that writes the
        quote marks in here. Also made a few coding style tweaks.
        (WTF::StringBuilder::appendQuotedJSONString): Rewrote to use a much
        simpler algorithm that grows the string the same way the append function
        does. The old code would use reserveCapacity in a way that was costly when
        doing a lot of appends on the same string, and also allocated far too much
        memory for normal use cases where characters did not need to be turned
        into escape sequences.

        * wtf/text/StringBuilder.h:
        (WTF::StringBuilder::append): Tweaked style a bit, fixed a bug where the
        m_is8Bit field wasn't set correctly in one case, optimized the function that
        adds substrings for the case where this is the first append and the substring
        happens to cover the entire string. Also clarified the assertions and removed
        an unneeded check from that substring overload.
        (WTF::equal): Reimplemented, using equalCommon. Added an overload of the equal
        function just for the case where the arguments are StringBuilder, String.
        This is needed because of the peculiar behavior of is8Bit in String, different
        from any of our other string classes. I think we should consider changing
        String::is8Bit to return true for null strings. We could then remove this
        overload and probably remove other checks for null and zero length elsewhere
        that are also needed only to avoid calling is8Bit on a null String.

2016-11-29  JF Bastien  <jfbastien@apple.com>

        WebAssembly JS API: improve Instance
        https://bugs.webkit.org/show_bug.cgi?id=164757

        Reviewed by Keith Miller.

        * wtf/Expected.h:
        (WTF::ExpectedDetail::destroy): silence a warning

2016-11-29  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r209058 and r209074.
        https://bugs.webkit.org/show_bug.cgi?id=165188

        These changes caused API test StringBuilderTest.Equal to crash
        and/or fail. (Requested by ryanhaddad on #webkit).

        Reverted changesets:

        "Streamline and speed up tokenizer and segmented string
        classes"
        https://bugs.webkit.org/show_bug.cgi?id=165003
        http://trac.webkit.org/changeset/209058

        "REGRESSION (r209058): API test StringBuilderTest.Equal
        crashing"
        https://bugs.webkit.org/show_bug.cgi?id=165142
        http://trac.webkit.org/changeset/209074

2016-11-29  Simon Fraser  <simon.fraser@apple.com>

        Allow TracePoint to take arbitrary data
        https://bugs.webkit.org/show_bug.cgi?id=165182

        Reviewed by Tim Horton.

        Allow TracePoint() to take four numeric arguments, for arbitrary data.

        #pragma once

        * wtf/SystemTracing.h:
        (WTF::TracePoint):

2016-11-29  Andy Estes  <aestes@apple.com>

        [Cocoa] Enable two clang warnings recommended by Xcode
        https://bugs.webkit.org/show_bug.cgi?id=164498

        Reviewed by Mark Lam.

        * Configurations/Base.xcconfig: Enabled CLANG_WARN_INFINITE_RECURSION and CLANG_WARN_SUSPICIOUS_MOVE.

2016-11-29  Darin Adler  <darin@apple.com>

        REGRESSION (r209058): API test StringBuilderTest.Equal crashing
        https://bugs.webkit.org/show_bug.cgi?id=165142

        * wtf/text/StringBuilder.h: Added an overload of the equal function just
        for the case where the arguments are StringBuilder, String. This is needed
        because of the peculiar behavior of is8Bit in String, different from any of
        our other string classes. I think we should consider changing String::is8Bit
        to return true for null strings. We could then remove this overload and
        probably remove other checks for null and zero length elsewhere that are
        also needed only to avoid calling is8Bit on a null String.

2016-11-29  Wenson Hsieh  <wenson_hsieh@apple.com>

        Scroll snapping on Mac should use AppKit animations
        https://bugs.webkit.org/show_bug.cgi?id=147261
        <rdar://problem/29395293>

        Reviewed by Brent Fulgham.

        Introduce HAVE(NSSCROLLING_FILTERS), which is on for macOS El Capitan and later.

        * wtf/Platform.h:

2016-11-28  Darin Adler  <darin@apple.com>

        Streamline and speed up tokenizer and segmented string classes
        https://bugs.webkit.org/show_bug.cgi?id=165003

        Reviewed by Sam Weinig.

        * wtf/text/StringBuilder.cpp:
        (WTF::StringBuilder::bufferCharacters<LChar>): Moved this here from
        the header since it is only used inside the class. Also renamed from
        getBufferCharacters.
        (WTF::StringBuilder::bufferCharacters<UChar>): Ditto.
        (WTF::StringBuilder::appendUninitializedUpconvert): Added. Helper
        for the upconvert case in the 16-bit overload of StrinBuilder::append.
        (WTF::StringBuilder::append): Changed to use appendUninitializedUpconvert.
        (WTF::quotedJSONStringLength): Added. Used in new appendQuotedJSONString
        implementation below that now correctly determines the size of what will
        be appended by walking thorugh the string twice.
        (WTF::appendQuotedJSONStringInternal): Moved the code that writes the
        quote marks in here. Also made a few coding style tweaks.
        (WTF::StringBuilder::appendQuotedJSONString): Rewrote to use a much
        simpler algorithm that grows the string the same way the append function
        does. The old code would use reserveCapacity in a way that was costly when
        doing a lot of appends on the same string, and also allocated far too much
        memory for normal use cases where characters did not need to be turned
        into escape sequences.

        * wtf/text/StringBuilder.h:
        (WTF::StringBuilder::append): Tweaked style a bit, fixed a bug where the
        m_is8Bit field wasn't set correctly in one case, optimized the function that
        adds substrings for the case where this is the first append and the substring
        happens to cover the entire string. Also clarified the assertions and removed
        an unneeded check from that substring overload.
        (WTF::equal): Reimplemented, using equalCommon.

2016-11-26  Yusuke Suzuki  <utatane.tea@gmail.com>

        [WTF] Import std::optional reference implementation as WTF::Optional
        https://bugs.webkit.org/show_bug.cgi?id=164199

        Reviewed by Saam Barati and Sam Weinig.

        Import std::optional reference implementation offered by the C++17
        original proposal paper. It has the same interface and functionality
        to the C++17's one. Previous WTF::Optional lacks several functionalities.
        The largest one is the correct constexpr constructors. This fact prevents
        us from using Optional<literal type> in constexpr context in WebKit.

        In WebKit, we do not allow global constructors. So only the constexpr
        constructor is the way to use WTF::Optional in the static const
        global variables. WTF::Optional is used in DOMJIT::Effect and
        we would like to emit static const global variables that includes
        this DOMJIT::Effect. That is the main motivation of this work.
        This functionality allows the IDL code generator to emit DOMJIT
        signatures as static const global variables.

        We import the reference implementation one instead of LLVM libc++'s one.
        This is because LLVM libc++'s one depends on many macro and type_traits
        offered by libc++ implementation. And adopting it to WebKit requires
        large modification compared to this reference implementation one.
        Furthermore, it is difficult to compile libc++'s optional in old GCC and VC++.
        It also requires some more modifications. To keep the thing simple,
        we import the reference implementation one now. Once C++17 is released
        and we update the compiler baseline, we can smoothly switch to the standard
        library's std::optional.

        We also add support for the environment that does not use exceptions to this
        reference implementation.

        And we also add valueOrCompute helper function. That keeps the extended
        functionality that previous WTF::Optional has.

        * wtf/CrossThreadQueue.h:
        (WTF::CrossThreadQueue<DataType>::tryGetMessage):
        * wtf/Expected.h:
        (WTF::makeExpected):
        * wtf/Forward.h:
        * wtf/HashTraits.h:
        (WTF::HashTraits<Ref<P>>::take):
        * wtf/MainThread.cpp:
        (WTF::initializeGCThreads):
        (WTF::mayBeGCThread):
        * wtf/MainThread.h:
        * wtf/Optional.h:
        (std::detail_::is_assignable::has_assign):
        (std::detail_::has_overloaded_addressof::has_overload):
        (std::detail_::static_addressof):
        (std::detail_::convert):
        (std::nullopt_t::nullopt_t):
        (std::bad_optional_access::bad_optional_access):
        (std::optional_base::optional_base):
        (std::optional_base::~optional_base):
        (std::constexpr_optional_base::constexpr_optional_base):
        (std::optional::dataptr):
        (std::optional::contained_val):
        (std::optional::__NOEXCEPT_):
        (std::optional::optional):
        (std::optional::operator=):
        (std::optional::emplace):
        (std::optional::operator ->):
        (std::optional::operator *):
        (std::optional::value):
        (std::optional::value_or):
        (std::operator==):
        (std::operator!=):
        (std::operator<):
        (std::operator>):
        (std::operator<=):
        (std::operator>=):
        (std::__NOEXCEPT_):
        (std::make_optional):
        (std::hash<std::optional<T>>::operator()):
        (WTF::NulloptTag::NulloptTag): Deleted.
        (WTF::Optional::Optional): Deleted.
        (WTF::Optional::~Optional): Deleted.
        (WTF::Optional::operator=): Deleted.
        (WTF::Optional::operator bool): Deleted.
        (WTF::Optional::operator->): Deleted.
        (WTF::Optional::operator*): Deleted.
        (WTF::Optional::value): Deleted.
        (WTF::Optional::valueOr): Deleted.
        (WTF::Optional::valueOrCompute): Deleted.
        (WTF::Optional::asPtr): Deleted.
        (WTF::Optional::destroy): Deleted.
        (WTF::operator==): Deleted.
        (WTF::operator!=): Deleted.
        (WTF::makeOptional): Deleted.
        (WTF::printInternal): Deleted.
        * wtf/text/StringView.cpp:
        (WTF::StringView::GraphemeClusters::Iterator::Impl::Impl):
        (WTF::StringView::GraphemeClusters::Iterator::Iterator):
        * wtf/text/StringView.h:

2016-11-26  Simon Fraser  <simon.fraser@apple.com>

        Migrate some layout timer-related code from std::chrono to Seconds and MonotonicTime
        https://bugs.webkit.org/show_bug.cgi?id=164992

        Reviewed by Darin Adler.

        Add Seconds::zero() as a nicer way to express Seconds(0). 

        * wtf/Seconds.h:
        (WTF::Seconds::zero):

2016-11-26  Simon Fraser  <simon.fraser@apple.com>

        Add literals for various time units
        https://bugs.webkit.org/show_bug.cgi?id=165074

        Reviewed by Filip Pizlo.
        
        Add _min, _s, _ms, _us and _ns literals for easy creation of Seconds from long double
        and unsigned long long types (those allowed for custom literals).
        
        Add minutes-related functions (there are one or two use cases in WebCore).

        * wtf/Seconds.h:
        (WTF::Seconds::minutes):
        (WTF::Seconds::fromMinutes):
        (WTF::Seconds::fromMilliseconds):
        (WTF::Seconds::fromMicroseconds):
        (WTF::Seconds::fromNanoseconds):
        (WTF::operator _min):
        (WTF::operator _s):
        (WTF::operator _ms):
        (WTF::operator _us):
        (WTF::operator _ns):

2016-11-22  Darin Adler  <darin@apple.com>

        One more tiny bit of follow-up.

        * wtf/text/TextBreakIterator.cpp:
        (WTF::numCharactersInGraphemeClusters): Removed unneeded always-true check.

2016-11-22  Darin Adler  <darin@apple.com>

        Quick follow-up to previous patch.

        * wtf/text/TextBreakIterator.cpp:
        (WTF::numCharactersInGraphemeClusters): Removed incorrect assertion.

2016-11-22  Darin Adler  <darin@apple.com>

        Make normal case fast in the input element limitString function
        https://bugs.webkit.org/show_bug.cgi?id=165023

        Reviewed by Dan Bernstein.

        * wtf/text/LineBreakIteratorPoolICU.h: Removed many unneeded includes.
        Simplified the class a bit, removing some extra definitions.
        (WTF::LineBreakIteratorPool::sharedPool): Use NeverDestroyed instead of new.
        (WTF::LineBreakIteratorPool::makeLocaleWithBreakKeyword): Reimplemented in
        a simpler way without using StringBuilder. Also updated for change to
        LineBreakIteratorMode.
        (WTF::LineBreakIteratorPool::put): Use uncheckedAppend since the code is
        careful to only use the inline capacity in the vector.

        * wtf/text/TextBreakIterator.cpp: Moved some includes in here from the header.
        (WTF::mapLineIteratorModeToRules): Updated for change to LineBreakIteratorMode.
        (WTF::openLineBreakIterator): Ditto.
        (WTF::numGraphemeClusters): Added a fast path for all 8-bit strings; don't
        use ICU for that case, even if there is a CR character in it.
        (WTF::numCharactersInGraphemeClusters): Added a fast path for strings that are
        short enough to entirely fit without even looking at the characters; that's a
        case we likely hit all the time. Also added a fast path for all 8-bit strings.

        * wtf/text/TextBreakIterator.h: Changed LineBreakIteratorMode to be an enum
        class and not repeat UAX14 in the names of the modes. Initialize data members
        in the class definition rather than the constructors.

2016-11-21  Mark Lam  <mark.lam@apple.com>

        Hasher::addCharacters() should be able to handle zero length strings.
        https://bugs.webkit.org/show_bug.cgi?id=165024

        Reviewed by Yusuke Suzuki.

        Currently, it will fail to handle zero length strings if it has a pending
        character.  The fix is simply to return early if length is 0. 

        * wtf/Hasher.h:
        (WTF::StringHasher::addCharacters):

2016-11-18  Jeremy Jones  <jeremyj@apple.com>

        Add runtime flag to enable pointer lock. Enable pointer lock feature for mac.
        https://bugs.webkit.org/show_bug.cgi?id=163801

        Reviewed by Simon Fraser.

        * wtf/FeatureDefines.h: ENABLE_POINTER_LOCK true for Mac.

2016-11-17  Saam Barati  <sbarati@apple.com>

        Remove async/await compile time flag and enable tests
        https://bugs.webkit.org/show_bug.cgi?id=164828
        <rdar://problem/28639334>

        Reviewed by Yusuke Suzuki.

        * wtf/FeatureDefines.h:

2016-11-17  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSC] WTF::TemporaryChange with WTF::SetForScope
        https://bugs.webkit.org/show_bug.cgi?id=164761

        Reviewed by Saam Barati.

        JavaScriptCore's bytecompiler/SetForScope.h is completely the same
        to WTF::TemporaryChange. SetForScope sounds better name since it
        says that this object works as Scope.

        We rename WTF::TemporaryChange to WTF::SetForScope. And replace
        all the use to this WTF::SetForScope.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/SetForScope.h: Renamed from Source/WTF/wtf/TemporaryChange.h.
        (WTF::SetForScope::SetForScope):
        (WTF::SetForScope::~SetForScope):

2016-11-16  Yusuke Suzuki  <utatane.tea@gmail.com>

        [ES6][WebCore] Change ES6_MODULES compile time flag to runtime flag
        https://bugs.webkit.org/show_bug.cgi?id=164827

        Reviewed by Ryosuke Niwa.

        * wtf/FeatureDefines.h:

2016-11-16  Carlos Alberto Lopez Perez  <clopez@igalia.com>

        [JSC] Build broken for 32-bit x86 after r208306 with GCC 4.9
        https://bugs.webkit.org/show_bug.cgi?id=164588

        Reviewed by Mark Lam.

        Provide assembly for executing the cpuid instruction when compiling
        in PIC mode with the GCC 4.9 EBX on 32-bit x86.

        Note that the values returned by cpuid here are not used. The purpose
        of calling this instruction is to force the CPU to complete and sync
        any buffered modifications on registers, memory or flags before
        fetching and executing the next instruction.

        * wtf/Atomics.h:
        (WTF::x86_cpuid):

2016-11-15  Filip Pizlo  <fpizlo@apple.com>

        Rename CONCURRENT_JIT/ConcurrentJIT to CONCURRENT_JS/ConcurrentJS
        https://bugs.webkit.org/show_bug.cgi?id=164791

        Reviewed by Geoffrey Garen.
        
        Both the concurrent GC and the concurrent JIT rely on concurrency support in fundamental
        JSC runtime components like JSValue. So, the thing that guards it should be a "feature"
        called CONCURRENT_JS not CONCURRENT_JIT.

        * wtf/Platform.h:

2016-11-15  Filip Pizlo  <fpizlo@apple.com>

        The concurrent GC should have a timeslicing controller
        https://bugs.webkit.org/show_bug.cgi?id=164783

        Reviewed by Geoffrey Garen.

        * wtf/LockAlgorithm.h: Added some comments.
        * wtf/Seconds.h: Added support for modulo. It's necessary for timeslicing.
        (WTF::Seconds::operator%):
        (WTF::Seconds::operator%=):

2016-11-11  Filip Pizlo  <fpizlo@apple.com>

        The GC should be optionally concurrent and disabled by default
        https://bugs.webkit.org/show_bug.cgi?id=164454

        Reviewed by Geoffrey Garen.
        
        The reason why I went to such great pains to make WTF::Lock fit in two bits is that I
        knew that I would eventually need to stuff one into some miscellaneous bits of the
        JSCell header. That time has come, because the concurrent GC has numerous race
        conditions in visitChildren that can be trivially fixed if each object just has an
        internal lock. Some cell types might use it to simply protect their entire visitChildren
        function and anything that mutates the fields it touches, while other cell types might
        use it as a "lock of last resort" to handle corner cases of an otherwise wait-free or
        lock-free algorithm. Right now, it's used to protect certain transformations involving
        indexing storage.
        
        To make this happen, I factored the WTF::Lock algorithm into a LockAlgorithm struct that
        is templatized on lock type (uint8_t for WTF::Lock), the isHeldBit value (1 for
        WTF::Lock), and the hasParkedBit value (2 for WTF::Lock). This could have been done as
        a templatized Lock class that basically contains Atomic<LockType>. You could then make
        any field into a lock by bitwise_casting it to TemplateLock<field type, bit1, bit2>. But
        this felt too dirty, so instead, LockAlgorithm has static methods that take
        Atomic<LockType>& as their first argument. I think that this makes it more natural to
        project a LockAlgorithm onto an existing Atomic<> field. Sadly, some places have to cast
        their non-Atomic<> field to Atomic<> in order for this to work. Like so many other things
        we do, this just shows that the C++ style of labeling fields that are subject to atomic
        ops as atomic is counterproductive. Maybe some day I'll change LockAlgorithm to use our
        other Atomics API, which does not require Atomic<>.
        
        WTF::Lock now uses LockAlgorithm. The slow paths are still outlined. I don't feel too
        bad about the LockAlgorithm.h header being included in so many places because we change
        that algorithm so infrequently.
        
        Also, I added a hasElapsed(time) function. This function makes it so much more natural
        to write timeslicing code, which the concurrent GC has to do a lot of.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/ListDump.h:
        * wtf/Lock.cpp:
        (WTF::LockBase::lockSlow):
        (WTF::LockBase::unlockSlow):
        (WTF::LockBase::unlockFairlySlow):
        (WTF::LockBase::unlockSlowImpl): Deleted.
        * wtf/Lock.h:
        (WTF::LockBase::lock):
        (WTF::LockBase::tryLock):
        (WTF::LockBase::unlock):
        (WTF::LockBase::unlockFairly):
        (WTF::LockBase::isHeld):
        (): Deleted.
        * wtf/LockAlgorithm.h: Added.
        (WTF::LockAlgorithm::lockFastAssumingZero):
        (WTF::LockAlgorithm::lockFast):
        (WTF::LockAlgorithm::lock):
        (WTF::LockAlgorithm::tryLock):
        (WTF::LockAlgorithm::unlockFastAssumingZero):
        (WTF::LockAlgorithm::unlockFast):
        (WTF::LockAlgorithm::unlock):
        (WTF::LockAlgorithm::unlockFairly):
        (WTF::LockAlgorithm::isLocked):
        (WTF::LockAlgorithm::lockSlow):
        (WTF::LockAlgorithm::unlockSlow):
        * wtf/TimeWithDynamicClockType.cpp:
        (WTF::hasElapsed):
        * wtf/TimeWithDynamicClockType.h:

2016-11-14  JF Bastien  <jfbastien@apple.com>

        Expected: add missing `inline`
        https://bugs.webkit.org/show_bug.cgi?id=164735

        Reviewed by Yusuke Suzuki.

        Free functions and full template specializations need to be
        `inline`, or in a .cpp file, otherwise each .o creates a duplicate
        symbol which makes the linker very sad.

        * wtf/Expected.h:
        (WTF::ExpectedDetail::Throw):
        (WTF::makeExpected):

2016-11-14  Mark Lam  <mark.lam@apple.com>

        Build fix after r208690.
        https://bugs.webkit.org/show_bug.cgi?id=164681

        Not reviewed.

        * wtf/FastMalloc.h:

2016-11-13  Mark Lam  <mark.lam@apple.com>

        Add debugging facility to limit the max single allocation size.
        https://bugs.webkit.org/show_bug.cgi?id=164681

        Reviewed by Keith Miller.

        This is useful for simulating memory allocation failures on resource constraint
        devices for testing purposes.

        This facility is only conditionally compiled in on debug builds.  It does not
        have any burden on release builds at all.  When in use, the max single allocation
        size limit applies to individual allocations.  For malloc (and similar), the
        allocation will crash in FastMalloc if the requested size exceeds the set max
        single allocation size.  For tryMalloc (and similar), the allocation returns
        nullptr if the requested size exceeds the set max single allocation size.  The
        max single allocation size is set to std::numeric_limit<size_t>::max() by default
        (i.e. when not set and no limit is in effect).

        Also fixed non-bmalloc versions of fastAlignedMalloc() to crash when allocation
        fails.

        * wtf/FastMalloc.cpp:
        (WTF::fastSetMaxSingleAllocationSize):
        (WTF::fastAlignedMalloc):
        (WTF::tryFastAlignedMalloc):
        (WTF::tryFastMalloc):
        (WTF::fastMalloc):
        (WTF::tryFastCalloc):
        (WTF::fastCalloc):
        (WTF::fastRealloc):
        * wtf/FastMalloc.h:

2016-11-13  JF Bastien  <jfbastien@apple.com>

        Implement WTF::Expected
        https://bugs.webkit.org/show_bug.cgi?id=164526

        Reviewed by Yusuke Suzuki.

        std::expected isn't in C++17, and may be in C++20. It's a nice
        complement to std::any / std::optional because it's a type-tagged
        union which has a single expected result but could also contain an
        error.

        This would be useful in the WebAssembly parser, for example.

        Using this implementation will allow us to provide feedback to the
        standards committee and guide std::expected's design before it
        gets standardized. I've already sent a bunch of feedback to the
        author based on my experience implementing this.

        This could supplement WTF::Either and WTF::ExceptionOr.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/Compiler.h: Add RELAXED_CONSTEXPR
        * wtf/Expected.h: Added.
        (WTF::UnexpectedType::UnexpectedType):
        (WTF::UnexpectedType::value):
        (WTF::operator==):
        (WTF::operator!=):
        (WTF::operator<):
        (WTF::operator>):
        (WTF::operator<=):
        (WTF::operator>=):
        (WTF::makeUnexpected):
        (WTF::ExpectedDetail::Throw):
        (WTF::ExpectedDetail::ConstexprBase::ConstexprBase):
        (WTF::ExpectedDetail::Base::Base):
        (WTF::ExpectedDetail::Base::~Base):
        (WTF::Expected::Expected):
        (WTF::Expected::operator=):
        (WTF::Expected::swap):
        (WTF::Expected::operator->):
        (WTF::Expected::operator*):
        (WTF::Expected::operator bool):
        (WTF::Expected::hasValue):
        (WTF::Expected::value):
        (WTF::Expected::error):
        (WTF::Expected::getUnexpected):
        (WTF::Expected::valueOr):
        (WTF::swap):
        (WTF::makeExpected):
        (WTF::makeExpectedFromError):

2016-11-11  Alex Christensen  <achristensen@webkit.org>

        Allow mutable lambdas in HashMap::ensure
        https://bugs.webkit.org/show_bug.cgi?id=164642

        Reviewed by Sam Weinig.

        * wtf/HashMap.h:
        (WTF::HashMapEnsureTranslator::translate):
        (WTF::X>::removeIf):

2016-11-11  Beth Dakin  <bdakin@apple.com>

        Get touch bar code building for open source builds
        https://bugs.webkit.org/show_bug.cgi?id=164610

        Reviewed by Wenson Hsieh.

        * wtf/Platform.h:

2016-11-10  JF Bastien  <jfbastien@apple.com>

        ASSERTION FAILED: length > offset encountered with wasm.yaml/wasm/js-api/test_Module.js.default-wasm
        https://bugs.webkit.org/show_bug.cgi?id=164597

        Reviewed by Keith Miller.

        Decoding at end of file should fail, not assert.

        * wtf/LEBDecoder.h:
        (WTF::LEBDecoder::decodeUInt):
        (WTF::LEBDecoder::decodeInt32):

2016-11-10  Alex Christensen  <achristensen@webkit.org>

        Remove unused CFURLCACHE code
        https://bugs.webkit.org/show_bug.cgi?id=164551

        Reviewed by Antti Koivisto.

        * wtf/Platform.h:

2016-11-09  Alex Christensen  <achristensen@webkit.org>

        Allow RefPtrs of const ThreadSafeRefCounted types
        https://bugs.webkit.org/show_bug.cgi?id=164548

        Reviewed by Tim Horton.

        * wtf/ThreadSafeRefCounted.h:
        Make m_refCount mutable like we did with RefCounted in r203257.

2016-11-09  Chris Dumez  <cdumez@apple.com>

        [Mac] Stop using deprecated AppKit enumeration values
        https://bugs.webkit.org/show_bug.cgi?id=164494

        Reviewed by Darin Adler.

        Stop using deprecated AppKit enumeration values.

        * wtf/mac/AppKitCompatibilityDeclarations.h:

2016-11-05  Konstantin Tokarev  <annulen@yandex.ru>

        Fixed compilation of LLInt with MinGW
        https://bugs.webkit.org/show_bug.cgi?id=164449

        Reviewed by Michael Catanzaro.

        MinGW uses LLIntAssembly.h with GNU assembler syntax, just like GCC on
        other platforms.

        * wtf/InlineASM.h: Define LOCAL_LABEL_STRING as .L#name for MinGW.

2016-11-05  Konstantin Tokarev  <annulen@yandex.ru>

        [MinGW] Fixed C99/C++11 format attributes in printf-like functions
        https://bugs.webkit.org/show_bug.cgi?id=164448

        Reviewed by Michael Catanzaro.

        By default MinGW uses printf-like function provided in msvcrt.dll,
        however they miss support for C99/C++11 format attributes. Use MinGW
        implementations instead.

        * wtf/Assertions.h: Use gnu_printf format in WTF_ATTRIBUTE_PRINTF

2016-11-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        [JSCOnly] RunLoopGeneric should adopt MonotonicTime / WallTime change
        https://bugs.webkit.org/show_bug.cgi?id=164447

        Reviewed by Csaba Osztrogonác.

        Build fix for JSCOnly.

        * wtf/generic/RunLoopGeneric.cpp:
        (WTF::RunLoop::TimerBase::ScheduledTask::create):
        (WTF::RunLoop::TimerBase::ScheduledTask::ScheduledTask):
        (WTF::RunLoop::TimerBase::ScheduledTask::scheduledTimePoint):
        (WTF::RunLoop::TimerBase::ScheduledTask::updateReadyTime):
        (WTF::RunLoop::populateTasks):
        (WTF::RunLoop::dispatchAfter):
        (WTF::RunLoop::TimerBase::start):

2016-11-04  Filip Pizlo  <fpizlo@apple.com>

        WTF::ParkingLot should stop using std::chrono because std::chrono::duration casts are prone to overflows
        https://bugs.webkit.org/show_bug.cgi?id=152045

        Reviewed by Andy Estes.
        
        We used to use 'double' for all time measurements. Sometimes it was milliseconds,
        sometimes it was seconds. Sometimes we measured a span of time, sometimes we spoke of time
        since some epoch. When we spoke of time since epoch, we either used a monotonic clock or
        a wall clock. The type - always 'double' - never told us what kind of time we had, even
        though there were roughly six of them (sec interval, ms interval, sec since epoch on wall,
        ms since epoch on wall, sec since epoch monotonic, ms since epoch monotonic).
        
        At some point, we thought that it would be a good idea to replace these doubles with
        std::chrono. But since replacing some things with std::chrono, we found it to be terribly
        inconvenient:
        
        - Outrageous API. I never want to say std::chrono::milliseconds(blah). I never want to say
          std::chrono::steady_clock::timepoint. The syntax for duration_cast is ugly, and ideally
          duration_cast would not even be a thing.
        
        - No overflow protection. std::chrono uses integers by default and using anything else is
          clumsy. But the integer math is done without regard for the rough edges of integer math,
          so any cast between std::chrono types risks overflow. Any comparison risks overflow
          because it may do conversions silently. We have even found bugs where some C++
          implementations had more overflows than others, which ends up being a special kind of
          hell. In many cases, the overflow also has nasal demons.
        
        It's an error to represent time using integers. It would have been excusable back when
        floating point math was not guaranteed to be supported on all platforms, but that would
        have been a long time ago. Time is a continuous, infinite concept and it's a perfect fit
        for floating point:
        
        - Floating point preserves precision under multiplication in all but extreme cases, so
          using floating point for time means that unit conversions are almost completely
          lossless. This means that we don't have to think very hard about what units to use. In
          this patch, we use seconds almost everywhere. We only convert at boundaries, like an API
          boundary that wants something other than seconds.
        
        - Floating point makes it easy to reason about infinity, which is something that time code
          wants to do a lot. Example: when would you like to timeout? Infinity please! This is the
          most elegant way of having an API support both a timeout variant and a no-timeout
          variant.

        - Floating point does well-understood things when math goes wrong, and these things are
          pretty well optimized to match what a mathematician would do when computing with real
          numbers represented using scientific notation with a finite number of significant
          digits. This means that time math under floating point looks like normal math. On the
          other hand, std::chrono time math looks like garbage because you have to always check
          for multiple possible UB corners whenever you touch large integers. Integers that
          represent time are very likely to be large and you don't have to do much to overflow
          them. At this time, based on the number of bugs we have already seen due to chrono
          overflows, I am not certain that we even understand what are all of the corner cases
          that we should even check for.
        
        This patch introduces a new set of timekeeping classes that are all based on double, and
        all internally use seconds. These classes support algebraic typing. The classes are:
        
        - Seconds: this is for measuring a duration.
        - WallTime: time since epoch according to a wall clock (aka real time clock).
        - MonotonicTime: time since epoch according to a monotonic clock.
        - ClockType: enum that says either Wall or Monotonic.
        - TimeWithDynamicClockType: a tuple of double and ClockType, which represents either a
          wall time or a monotonic time.
        
        All of these classes behave like C++ values and are cheap to copy around since they are
        very nearly POD. This supports comprehensive conversions between the various time types.
        Most of this is by way of algebra. Here are just some of the rules we recognize:
        
        WallTime = WallTime + Seconds
        Seconds = WallTime - WallTime
        MonotonicTime = MonotonicTime + Seconds
        etc...
        
        We support negative, infinite, and NaN times because math.
        
        We support conversions between MonotonicTime and WallTime, like:
        
        WallTime wt = mt.approximateWallTime()
        
        This is called this "approximate" because the only way to do it is to get the current time
        on both clocks and convert relative to that.
        
        Many of our APIs would be happy using whatever notion of time the user wanted to use. For
        those APIs, which includes Condition and ParkingLot, we have TimeWithDynamicClockType. You
        can automatically convert WallTime or MonotonicTime to TimeWithDynamicClockType. This
        means that if you use a WallTime with Condition::waitUntil, then Condition's internal
        logic for when it should wake up makes its decision based on the current WallTime - but if
        you use MonotonicTime then waitUntil will make its decision based on current
        MonotonicTime. This is a greater level of flexibility than chrono allowed, since chrono
        did not have the concept of a dynamic clock type.
        
        This patch does not include conversions between std::chrono and these new time classes,
        because past experience shows that we're quite bad at getting conversions between
        std::chrono and anything else right. Also, I didn't need such conversion code because this
        patch only converts code that transitively touches ParkingLot and Condition. It was easy
        to get all of that code onto the new time classes.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/AutomaticThread.cpp:
        (WTF::AutomaticThread::start):
        * wtf/CMakeLists.txt:
        * wtf/ClockType.cpp: Added.
        (WTF::printInternal):
        * wtf/ClockType.h: Added.
        * wtf/Condition.h:
        (WTF::ConditionBase::waitUntil):
        (WTF::ConditionBase::waitFor):
        (WTF::ConditionBase::wait):
        (WTF::ConditionBase::waitUntilWallClockSeconds): Deleted.
        (WTF::ConditionBase::waitUntilMonotonicClockSeconds): Deleted.
        (WTF::ConditionBase::waitForSeconds): Deleted.
        (WTF::ConditionBase::waitForSecondsImpl): Deleted.
        (WTF::ConditionBase::waitForImpl): Deleted.
        (WTF::ConditionBase::absoluteFromRelative): Deleted.
        * wtf/CrossThreadQueue.h:
        (WTF::CrossThreadQueue<DataType>::waitForMessage):
        * wtf/CurrentTime.cpp:
        (WTF::sleep):
        * wtf/MessageQueue.h:
        (WTF::MessageQueue::infiniteTime): Deleted.
        * wtf/MonotonicTime.cpp: Added.
        (WTF::MonotonicTime::now):
        (WTF::MonotonicTime::approximateWallTime):
        (WTF::MonotonicTime::dump):
        (WTF::MonotonicTime::sleep):
        * wtf/MonotonicTime.h: Added.
        (WTF::MonotonicTime::MonotonicTime):
        (WTF::MonotonicTime::fromRawDouble):
        (WTF::MonotonicTime::infinity):
        (WTF::MonotonicTime::secondsSinceEpoch):
        (WTF::MonotonicTime::approximateMonotonicTime):
        (WTF::MonotonicTime::operator bool):
        (WTF::MonotonicTime::operator+):
        (WTF::MonotonicTime::operator-):
        (WTF::MonotonicTime::operator+=):
        (WTF::MonotonicTime::operator-=):
        (WTF::MonotonicTime::operator==):
        (WTF::MonotonicTime::operator!=):
        (WTF::MonotonicTime::operator<):
        (WTF::MonotonicTime::operator>):
        (WTF::MonotonicTime::operator<=):
        (WTF::MonotonicTime::operator>=):
        * wtf/ParkingLot.cpp:
        (WTF::ParkingLot::parkConditionallyImpl):
        (WTF::ParkingLot::unparkOne):
        (WTF::ParkingLot::unparkOneImpl):
        (WTF::ParkingLot::unparkCount):
        * wtf/ParkingLot.h:
        (WTF::ParkingLot::parkConditionally):
        (WTF::ParkingLot::compareAndPark):
        * wtf/Seconds.cpp: Added.
        (WTF::Seconds::operator+):
        (WTF::Seconds::operator-):
        (WTF::Seconds::dump):
        (WTF::Seconds::sleep):
        * wtf/Seconds.h: Added.
        (WTF::Seconds::Seconds):
        (WTF::Seconds::value):
        (WTF::Seconds::seconds):
        (WTF::Seconds::milliseconds):
        (WTF::Seconds::microseconds):
        (WTF::Seconds::nanoseconds):
        (WTF::Seconds::fromMilliseconds):
        (WTF::Seconds::fromMicroseconds):
        (WTF::Seconds::fromNanoseconds):
        (WTF::Seconds::infinity):
        (WTF::Seconds::operator bool):
        (WTF::Seconds::operator+):
        (WTF::Seconds::operator-):
        (WTF::Seconds::operator*):
        (WTF::Seconds::operator/):
        (WTF::Seconds::operator+=):
        (WTF::Seconds::operator-=):
        (WTF::Seconds::operator*=):
        (WTF::Seconds::operator/=):
        (WTF::Seconds::operator==):
        (WTF::Seconds::operator!=):
        (WTF::Seconds::operator<):
        (WTF::Seconds::operator>):
        (WTF::Seconds::operator<=):
        (WTF::Seconds::operator>=):
        * wtf/TimeWithDynamicClockType.cpp: Added.
        (WTF::TimeWithDynamicClockType::now):
        (WTF::TimeWithDynamicClockType::nowWithSameClock):
        (WTF::TimeWithDynamicClockType::wallTime):
        (WTF::TimeWithDynamicClockType::monotonicTime):
        (WTF::TimeWithDynamicClockType::approximateWallTime):
        (WTF::TimeWithDynamicClockType::approximateMonotonicTime):
        (WTF::TimeWithDynamicClockType::operator-):
        (WTF::TimeWithDynamicClockType::operator<):
        (WTF::TimeWithDynamicClockType::operator>):
        (WTF::TimeWithDynamicClockType::operator<=):
        (WTF::TimeWithDynamicClockType::operator>=):
        (WTF::TimeWithDynamicClockType::dump):
        (WTF::TimeWithDynamicClockType::sleep):
        * wtf/TimeWithDynamicClockType.h: Added.
        (WTF::TimeWithDynamicClockType::TimeWithDynamicClockType):
        (WTF::TimeWithDynamicClockType::fromRawDouble):
        (WTF::TimeWithDynamicClockType::secondsSinceEpoch):
        (WTF::TimeWithDynamicClockType::clockType):
        (WTF::TimeWithDynamicClockType::withSameClockAndRawDouble):
        (WTF::TimeWithDynamicClockType::operator bool):
        (WTF::TimeWithDynamicClockType::operator+):
        (WTF::TimeWithDynamicClockType::operator-):
        (WTF::TimeWithDynamicClockType::operator+=):
        (WTF::TimeWithDynamicClockType::operator-=):
        (WTF::TimeWithDynamicClockType::operator==):
        (WTF::TimeWithDynamicClockType::operator!=):
        * wtf/WallTime.cpp: Added.
        (WTF::WallTime::now):
        (WTF::WallTime::approximateMonotonicTime):
        (WTF::WallTime::dump):
        (WTF::WallTime::sleep):
        * wtf/WallTime.h: Added.
        (WTF::WallTime::WallTime):
        (WTF::WallTime::fromRawDouble):
        (WTF::WallTime::infinity):
        (WTF::WallTime::secondsSinceEpoch):
        (WTF::WallTime::approximateWallTime):
        (WTF::WallTime::operator bool):
        (WTF::WallTime::operator+):
        (WTF::WallTime::operator-):
        (WTF::WallTime::operator+=):
        (WTF::WallTime::operator-=):
        (WTF::WallTime::operator==):
        (WTF::WallTime::operator!=):
        (WTF::WallTime::operator<):
        (WTF::WallTime::operator>):
        (WTF::WallTime::operator<=):
        (WTF::WallTime::operator>=):
        * wtf/threads/BinarySemaphore.cpp:
        (WTF::BinarySemaphore::wait):
        * wtf/threads/BinarySemaphore.h:

2016-11-03  Filip Pizlo  <fpizlo@apple.com>

        DFG plays fast and loose with the shadow values of a Phi
        https://bugs.webkit.org/show_bug.cgi?id=164309

        Reviewed by Saam Barati.
        
        Made this API use size rather than maxIndex as its initialization parameter, because that's
        less confusing.

        * wtf/IndexSparseSet.h:
        (WTF::IndexSparseSet<OverflowHandler>::IndexSparseSet):

2016-11-03  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r208364.
        https://bugs.webkit.org/show_bug.cgi?id=164402

        broke the build (Requested by smfr on #webkit).

        Reverted changeset:

        "DFG plays fast and loose with the shadow values of a Phi"
        https://bugs.webkit.org/show_bug.cgi?id=164309
        http://trac.webkit.org/changeset/208364

2016-11-03  Filip Pizlo  <fpizlo@apple.com>

        DFG plays fast and loose with the shadow values of a Phi
        https://bugs.webkit.org/show_bug.cgi?id=164309

        Reviewed by Saam Barati.
        
        Made this API use size rather than maxIndex as its initialization parameter, because that's
        less confusing.

        * wtf/IndexSparseSet.h:
        (WTF::IndexSparseSet<OverflowHandler>::IndexSparseSet):

2016-11-03  Konstantin Tokarev  <annulen@yandex.ru>

        Fixes to build JSCOnly on macOS
        https://bugs.webkit.org/show_bug.cgi?id=164379

        Reviewed by Michael Catanzaro.

        * wtf/Platform.h: JSCOnly port should not provide any PLATFORM() macro

2016-11-03  Brady Eidson  <beidson@apple.com>

        IndexedDB 2.0: Support binary keys.
        <rdar://problem/28806927> and https://bugs.webkit.org/show_bug.cgi?id=164359

        Reviewed by Alex Christensen.

        * wtf/Hasher.h:
        (WTF::StringHasher::hashMemory): Teach hashMemory() to handle buffers with odd lengths.

2016-11-02  Filip Pizlo  <fpizlo@apple.com>

        The GC should be in a thread
        https://bugs.webkit.org/show_bug.cgi?id=163562

        Reviewed by Geoffrey Garen and Andreas Kling.
        
        This fixes some bugs and adds a few features.

        * wtf/Atomics.h: The GC may do work on behalf of the JIT. If it does, the main thread needs to execute a cross-modifying code fence. This is cpuid on x86 and I believe it's isb on ARM. It would have been an isync on PPC and I think that isb is the ARM equivalent.
        (WTF::arm_isb):
        (WTF::crossModifyingCodeFence):
        (WTF::x86_ortop):
        (WTF::x86_cpuid):
        * wtf/AutomaticThread.cpp: I accidentally had AutomaticThreadCondition inherit from ThreadSafeRefCounted<AutomaticThread> [sic]. This never crashed before because all of our prior AutomaticThreadConditions were immortal.
        (WTF::AutomaticThread::AutomaticThread):
        (WTF::AutomaticThread::~AutomaticThread):
        (WTF::AutomaticThread::start):
        * wtf/AutomaticThread.h:
        * wtf/MainThread.cpp: Need to allow initializeGCThreads() to be called separately because it's now more than just a debugging thing.
        (WTF::initializeGCThreads):

2016-11-02  Carlos Alberto Lopez Perez  <clopez@igalia.com>

        Clean wrong comment about compositing on the UI process.
        https://bugs.webkit.org/show_bug.cgi?id=164339

        Reviewed by Michael Catanzaro.

        * wtf/Platform.h: The comment about compositing on the UI process
        was added on r109302 but was not removed properly when the Qt port
        was removed from trunk.
        USE_PROTECTION_SPACE_AUTH_CALLBACK has nothing to do with it.

2016-11-02  Alex Christensen  <achristensen@webkit.org>

        Remove Battery Status API from the tree
        https://bugs.webkit.org/show_bug.cgi?id=164213

        Reviewed by Sam Weinig.

        * wtf/FeatureDefines.h:

2016-11-02  Romain Bellessort  <romain.bellessort@crf.canon.fr>

        [Readable Streams API] Enable creation of ReadableByteStreamController
        https://bugs.webkit.org/show_bug.cgi?id=164014

        Reviewed by Youenn Fablet.

        Added flag for the byte stream part of Readable Streams API.

        * wtf/FeatureDefines.h:

2016-11-02  Per Arne Vollan  <pvollan@apple.com>

        [Win] Copy build results to AAS 'Program Files' folder.
        https://bugs.webkit.org/show_bug.cgi?id=164273

        Reviewed by Brent Fulgham.

        The preferred location for the binaries is the AAS 'Program Files' folder.

        * WTF.vcxproj/WTF.proj:

2016-10-29  Filip Pizlo  <fpizlo@apple.com>

        JSC should support SharedArrayBuffer
        https://bugs.webkit.org/show_bug.cgi?id=163986

        Reviewed by Keith Miller.
        
        Adds some small things we need for SharedArrayBuffer.
        
        * wtf/Atomics.h:
        (WTF::Atomic::compareExchangeWeakRelaxed):
        (WTF::Atomic::exchangeAdd):
        (WTF::Atomic::exchangeAnd):
        (WTF::Atomic::exchangeOr):
        (WTF::Atomic::exchangeSub):
        (WTF::Atomic::exchangeXor):
        (WTF::atomicLoad):
        (WTF::atomicStore):
        (WTF::atomicCompareExchangeWeak):
        (WTF::atomicCompareExchangeWeakRelaxed):
        (WTF::atomicCompareExchangeStrong):
        (WTF::atomicExchangeAdd):
        (WTF::atomicExchangeAnd):
        (WTF::atomicExchangeOr):
        (WTF::atomicExchangeSub):
        (WTF::atomicExchangeXor):
        (WTF::atomicExchange):
        (WTF::Atomic::exchangeAndAdd): Deleted.
        (WTF::weakCompareAndSwap): Deleted.
        We need to be able to do atomics operations on naked pointers. We also need to be able to do
        all of the things that std::atomic does. This adds those things and renames
        weakCompareAndSwap to atomicCompareExchangeWeakRelaxed so that we're using consistent
        terminology.
        
        * wtf/Bitmap.h:
        (WTF::WordType>::concurrentTestAndSet): Renamed weakCompareAndSwap.
        (WTF::WordType>::concurrentTestAndClear): Renamed weakCompareAndSwap.
        * wtf/FastBitVector.h:
        (WTF::FastBitVector::atomicSetAndCheck): Renamed weakCompareAndSwap.
        * wtf/ParkingLot.cpp:
        (WTF::ParkingLot::unparkOne):
        (WTF::ParkingLot::unparkCount):
        * wtf/ParkingLot.h:
        Added unparkCount(), which lets you unpark some bounded number of threads and returns the
        number of threads unparked. This is just a modest extension of unparkAll(). unparkAll() now
        just calls unparkCount(ptr, UINT_MAX).

2016-10-30  Frederic Wang  <fwang@igalia.com>

        Use HarfBuzz ot-math API to parse the OpenType MATH table
        https://bugs.webkit.org/show_bug.cgi?id=162671

        Reviewed by Michael Catanzaro.

        * wtf/Platform.h: By default, do not enable internal OpenType MATH parsing on GTK.

2016-10-25  Mark Lam  <mark.lam@apple.com>

        Remove Objective-C GC support
        https://bugs.webkit.org/show_bug.cgi?id=151819
        rdar://problem/23746991

        Reviewed by Dan Bernstein.

        * Configurations/Base.xcconfig:
        * wtf/ThreadingPthreads.cpp:
        (WTF::initializeCurrentThreadInternal): Deleted.
        * wtf/text/cf/StringImplCF.cpp:
        (WTF::StringImpl::createCFString):
        (garbageCollectionEnabled): Deleted.
        (WTF::StringWrapperCFAllocator::create): Deleted.

2015-11-18  Daniel Bates  <dabates@apple.com>

        [iOS] ASSERTION FAILED: temporaryFilePath.last() == '/' in WebCore::openTemporaryFile()
        https://bugs.webkit.org/show_bug.cgi?id=151392
        <rdar://problem/23595341>

        Reviewed by Alexey Proskuryakov.

        Workaround <rdar://problem/23579077> where confstr(_CS_DARWIN_USER_TEMP_DIR, ..., ...) retrieves
        the path to the user temporary directory without a trailing slash in the iOS simulator.

        * wtf/DataLog.cpp:
        (WTF::initializeLogFileOnce):

2015-11-17  Filip Pizlo  <fpizlo@apple.com>

        CheckAdd/Mul should have commutativity optimizations in B3->Air lowering
        https://bugs.webkit.org/show_bug.cgi?id=151214

        Reviewed by Geoffrey Garen.

        Disable my failed attempts at perfect forwarding, since they were incorrect, and caused compile
        errors if you tried to pass an argument that bound to lvalue. This shouldn't affect performance of
        anything we care about, and performance tests seem to confirm that it's all good.

        * wtf/ScopedLambda.h:

2015-11-17  Filip Pizlo  <fpizlo@apple.com>

        Air should lay out code optimally
        https://bugs.webkit.org/show_bug.cgi?id=150478

        Reviewed by Geoffrey Garen.

        * wtf/GraphNodeWorklist.h:
        (WTF::GraphNodeWorklist::push):
        (WTF::GraphNodeWorklist::isEmpty):
        (WTF::GraphNodeWorklist::notEmpty):
        (WTF::GraphNodeWorklist::pop):

2015-11-11  Anders Carlsson  <andersca@apple.com>

        Enable cross-platform context menus by default
        https://bugs.webkit.org/show_bug.cgi?id=151173

        Reviewed by Tim Horton.

        * wtf/Platform.h:

2015-11-12  Csaba Osztrogonác  <ossy@webkit.org>

        Remove ENABLE(SATURATED_LAYOUT_ARITHMETIC) guards
        https://bugs.webkit.org/show_bug.cgi?id=150972

        Reviewed by Darin Adler.

        * wtf/FeatureDefines.h:

2015-11-11  Filip Pizlo  <fpizlo@apple.com>

        B3 should be able to compile and canonicalize Mul
        https://bugs.webkit.org/show_bug.cgi?id=151124

        Reviewed by Geoffrey Garen.

        * wtf/MathExtras.h:
        (WTF::fastLog2):

2015-11-10  Filip Pizlo  <fpizlo@apple.com>

        B3 should be able to compile a program with ChillDiv
        https://bugs.webkit.org/show_bug.cgi?id=151114

        Reviewed by Benjamin Poulain.

        Needed to beef up some compiler algorithms. All of the hardening was about making them
        work with objects that have move semantics but not copy semantics. This arises in B3
        basic block insertion sets.

        * wtf/BubbleSort.h:
        (WTF::bubbleSort):
        * wtf/Insertion.h:
        (WTF::Insertion::Insertion):
        (WTF::Insertion::index):
        (WTF::Insertion::element):
        (WTF::Insertion::operator<):
        (WTF::executeInsertions):

2015-11-10  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Use CROSS_PLATFORM_CONTEXT_MENUS
        https://bugs.webkit.org/show_bug.cgi?id=150642

        Reviewed by Martin Robinson.

        Enable CROSS_PLATFORM_CONTEXT_MENUS for GTK+ port.

        * wtf/Platform.h:

2015-11-09  Anders Carlsson  <andersca@apple.com>

        Introspect reply block types as well
        https://bugs.webkit.org/show_bug.cgi?id=151048

        Reviewed by Tim Horton.

        Fix operator-> implementation.

        * wtf/Optional.h:
        (WTF::Optional::operator->):

2015-11-05  Nikos Andronikos  <nikos.andronikos-webkit@cisra.canon.com.au>

        Add runtime and compile time flags for enabling Web Animations API and model.
        https://bugs.webkit.org/show_bug.cgi?id=150914

        Reviewed by Benjamin Poulain.

        Add ENABLE_WEB_ANIMATIONS compile time flag, runtime flag webAnimationsEnabled and Expose WK2 preference for runtime flag.

        * wtf/FeatureDefines.h:

2015-11-05  Zan Dobersek  <zdobersek@igalia.com>

        [GLib] Avoid gint64, std::chrono::microseconds overflows in RunLoop::TimerBase
        https://bugs.webkit.org/show_bug.cgi?id=150930

        Reviewed by Carlos Garcia Campos.

        In RunLoop::TimerBase::start(), avoid overflowing the std::chrono::microseconds
        value in case the passed-in fire interval (in seconds) is too large (e.g. when
        std::chrono::microseconds::max() is used as the desired interval). This is
        achieved by using the passed-in fire interval, converted in microseconds, only
        if the value of this interval is smaller than std::chrono::microseconds::max().

        In RunLoop::TimerBase::updateReadyTime(), the zero-delay is still considered a
        short cut, but we use G_MAXINT64 in case the sum of the current time and the
        desired fire interval (now in microseconds) would overflow.

        * wtf/glib/RunLoopGLib.cpp:
        (WTF::RunLoop::TimerBase::updateReadyTime):
        (WTF::RunLoop::TimerBase::start):

2015-11-02  Filip Pizlo  <fpizlo@apple.com>

        B3/Air should use bubble sort for their insertion sets, because it's faster than std::stable_sort
        https://bugs.webkit.org/show_bug.cgi?id=150828

        Reviewed by Geoffrey Garen.

        Add a pretty good bubble sort implementation to WTF. This implementation has three
        common tricks:

        - Forward and backward scans. This reduces the severity of certain kinds of bubble sort
          pathologies.

        - Return if a scan finds the list to be sorted. This gives the algorithm one of its most
          attractive properties: it's super fast when the list is already sorted.

        - Each scan eliminates one element from future scans. This makes the algorithm no worse
          than insertion sort.

        Why do we want this? Because bubble sort is a really great stable sort for small lists,
        or large lists in which only a handful of elements are out of order. Compiler insertion
        sets tend to be one of those or somewhere in between: usually they are very small, and
        usually they are sorted. It's rare that an element will be out of order, and when it is,
        it's usually very close to where it's supposed to be.

        This is a significant speed-up for B3 compile times.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/BubbleSort.h: Added.
        (WTF::bubbleSort):
        * wtf/CMakeLists.txt:

2015-11-02  Andy Estes  <aestes@apple.com>

        [Cocoa] Add tvOS and watchOS to SUPPORTED_PLATFORMS
        https://bugs.webkit.org/show_bug.cgi?id=150819

        Reviewed by Dan Bernstein.

        This tells Xcode to include these platforms in its Devices dropdown, making it possible to build in the IDE.

        * Configurations/Base.xcconfig:

2015-11-02  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GLIB] Remove support for GSocket main loop sources from GMainLoopSource
        https://bugs.webkit.org/show_bug.cgi?id=150772

        Reviewed by Žan Doberšek.

        It complicated the code just to make generic what is only used in
        one place.

        * wtf/glib/GMainLoopSource.cpp:
        (WTF::GMainLoopSource::cancel): Deleted.
        (WTF::GMainLoopSource::schedule): Deleted.
        (WTF::GMainLoopSource::scheduleTimeoutSource): Deleted.
        (WTF::GMainLoopSource::scheduleAfterDelay): Deleted.
        (WTF::GMainLoopSource::finishVoidCallback): Deleted.
        (WTF::GMainLoopSource::voidCallback): Deleted.
        (WTF::GMainLoopSource::prepareBoolCallback): Deleted.
        * wtf/glib/GMainLoopSource.h:
        (WTF::GMainLoopSource::Context::operator=): Deleted.

2015-11-02  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GLIB] Remove delete on destroy GMainLoopSources
        https://bugs.webkit.org/show_bug.cgi?id=150771

        Reviewed by Žan Doberšek.

        Delete on destroy sources made the GMainLoopSource implementation
        more complex and they are currently unused.

        * wtf/glib/GMainLoopSource.cpp:
        (WTF::GMainLoopSource::boolCallback):
        (WTF::GMainLoopSource::create): Deleted.
        (WTF::GMainLoopSource::GMainLoopSource): Deleted.
        (WTF::GMainLoopSource::cancel): Deleted.
        (WTF::GMainLoopSource::scheduleAndDeleteOnDestroy): Deleted.
        (WTF::GMainLoopSource::scheduleAfterDelayAndDeleteOnDestroy): Deleted.
        (WTF::GMainLoopSource::voidCallback): Deleted.
        * wtf/glib/GMainLoopSource.h:

2015-11-01  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Use RunLoop in WorkQueue implementation
        https://bugs.webkit.org/show_bug.cgi?id=150770

        Reviewed by Darin Adler.

        Instead of using GMainLoop directly. RunLoop already abstracts the
        GMainLoop details and uses persistent sources making it more efficient.
        For the dispatchAfter implementation we use a helper context class
        and a GSource directly, since we are going to get rid of delete on
        destroy GMainLoop soon and this is the only place where we still
        use them.

        * wtf/RunLoop.h:
        (WTF::RunLoop::mainContext): Return the GMainContext.
        * wtf/WorkQueue.h:
        * wtf/glib/WorkQueueGLib.cpp:
        (WTF::WorkQueue::platformInitialize): The RunLoop needs to be
        created in the worker thread now, so we now use a mutex to wait
        until the thread has started and the RunLoop has been created.
        (WTF::WorkQueue::platformInvalidate): Stop the RunLoop and wait
        until the thread finishes.
        (WTF::WorkQueue::dispatch): Use RunLoop::dispatch().
        (WTF::DispatchAfterContext::DispatchAfterContext):
        (WTF::DispatchAfterContext::~DispatchAfterContext):
        (WTF::DispatchAfterContext::dispatch):
        (WTF::WorkQueue::dispatchAfter):

2015-11-01  Yusuke Suzuki  <utatane.tea@gmail.com>

        [ES6] Support Generator Syntax
        https://bugs.webkit.org/show_bug.cgi?id=150769

        Reviewed by Geoffrey Garen.

        Added ENABLE_ES6_GENERATORS flag.

        * wtf/FeatureDefines.h:

2015-11-01  Darin Adler  <darin@apple.com>

        ASCIICType refinements
        https://bugs.webkit.org/show_bug.cgi?id=150787

        Reviewed by Geoffrey Garen.

        Refined ASCIICType.h by using narrower types. The most valuable part of this
        is the part where the result of toASCIIHexValue is uint8_t instead of int;
        that's slightly better for RGB values that the compiler needs to know fit
        into a byte (coming in some Color work I plan to do soon).

        * wtf/ASCIICType.h: Used CharacterType instead of CharType throughout, and
        also sorted the using declarations at the bottom of the header.
        (WTF::isASCII): Use the name "character" instead of "c".
        (WTF::isASCIIAlpha): Ditto. Also use isASCIILower and toASCIILowerUnchecked
        instead of writing it out.
        (WTF::isASCIIDigit): Ditto.
        (WTF::isASCIIAlphanumeric): Ditto.
        (WTF::isASCIIHexDigit): Ditto. Also use toASCIILowerUnchecked instead of
        writing it out.
        (WTF::isASCIILower): Ditto.
        (WTF::isASCIIBinaryDigit): Ditto. Also removed unneeded parentheses to match
        the style of the rest of the file.
        (WTF::isASCIIOctalDigit): Ditto.
        (WTF::isASCIIPrintable): Ditto.
        (WTF::isASCIISpace): Ditto.
        (WTF::isASCIIUpper): Ditto.
        (WTF::toASCIILower): Ditto. Also use isASCIIUpper instead of writing it out.
        (WTF::toASCIILowerUnchecked): Tweaked comment.
        (WTF::toASCIIUpper): Ditto. Also use isASCIILower instead of writing it out.
        (WTF::toASCIIHexValue): Ditto. Also change return type from int to uint8_t.
        Also broke a single assertion with && into two separate assertions and got
        rid of unnnecessary masking with 0xF0 after shifting left. Also renamed
        arguments for the two argument value so they are more sensible.
        (WTF::lowerNibbleToASCIIHexDigit): Changed argument type to uint8_t, since
        this function does not take a character. Also called it "value" instead of "c".
        Also slightly tweaked how the expression is written.
        (WTF::upperNibbleToASCIIHexDigit): Ditto. Using the more specific type also
        got rid of the need to explicitly mask in this function.
        (WTF::isASCIIAlphaCaselessEqual): Renamed the arguments for greater clarity.
        With the new clearer argument names, the comment was superfluous.

2015-11-01  Filip Pizlo  <fpizlo@apple.com>

        Dominators should be factored out of the DFG
        https://bugs.webkit.org/show_bug.cgi?id=150764

        Reviewed by Geoffrey Garen.

        This takes what used to be DFGDominators.h/DFGDominators.cpp and turns it into a generic
        algorithm that can take any abstract graph. The idea is that you create Dominators<CFG> and
        pass it a CFG object, which defines the types of graph nodes and methods for getting
        successors, predecessors, etc. The DFG now defines a class called CFG, which is a wrapper for
        DFG::Graph that conforms to the thing that wtf/Dominators.h expects.

        When doing things to graphs, it's common to refer to the things in the graph as "nodes".
        Because I intend to reuse the CFG abstraction with many graph algorithms, that abstraction uses
        the term "node" to refer to a DFG basic block. But in Dominators, the method and variable names
        still use "block". This is because although Dominators are applicable to any kind of directed
        graph, it's super unlikely that we will ever use them for anything but compilers. Indeed, the
        only reason why I'm factoring them out of the DFG is so that I can use them with B3 and Air.

        This has the nice side effect that a user of WTF::Dominators<JSC::DFG::CFG> will see familiar
        terminology like "blocksStrictlyDominatedBy(...)" instead of "nodesStrictlyDominatedBy(...)",
        which would be super confusing.

        Overall, wtf/Dominators.h is a combination of what used to be in DFGDominators.h,
        DFGDominators.cpp, DFGNaiveDominators.h, and DFGNaiveDominators.cpp. I only changed code when I
        had to in order to make it generic.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Dominators.h: Added.
        (WTF::Dominators::Dominators):
        (WTF::Dominators::compute):
        (WTF::Dominators::strictlyDominates):
        (WTF::Dominators::dominates):
        (WTF::Dominators::immediateDominatorOf):
        (WTF::Dominators::forAllStrictDominatorsOf):
        (WTF::Dominators::forAllDominatorsOf):
        (WTF::Dominators::forAllBlocksStrictlyDominatedBy):
        (WTF::Dominators::forAllBlocksDominatedBy):
        (WTF::Dominators::strictDominatorsOf):
        (WTF::Dominators::dominatorsOf):
        (WTF::Dominators::blocksStrictlyDominatedBy):
        (WTF::Dominators::blocksDominatedBy):
        (WTF::Dominators::forAllBlocksInDominanceFrontierOf):
        (WTF::Dominators::dominanceFrontierOf):
        (WTF::Dominators::forAllBlocksInIteratedDominanceFrontierOf):
        (WTF::Dominators::forAllBlocksInPrunedIteratedDominanceFrontierOf):
        (WTF::Dominators::iteratedDominanceFrontierOf):
        (WTF::Dominators::dump):
        (WTF::Dominators::LengauerTarjan::LengauerTarjan):
        (WTF::Dominators::LengauerTarjan::compute):
        (WTF::Dominators::LengauerTarjan::immediateDominator):
        (WTF::Dominators::LengauerTarjan::computeDepthFirstPreNumbering):
        (WTF::Dominators::LengauerTarjan::computeSemiDominatorsAndImplicitImmediateDominators):
        (WTF::Dominators::LengauerTarjan::computeExplicitImmediateDominators):
        (WTF::Dominators::LengauerTarjan::link):
        (WTF::Dominators::LengauerTarjan::eval):
        (WTF::Dominators::LengauerTarjan::compress):
        (WTF::Dominators::LengauerTarjan::BlockData::BlockData):
        (WTF::Dominators::NaiveDominators::NaiveDominators):
        (WTF::Dominators::NaiveDominators::dominates):
        (WTF::Dominators::NaiveDominators::dump):
        (WTF::Dominators::NaiveDominators::pruneDominators):
        (WTF::Dominators::ValidationContext::ValidationContext):
        (WTF::Dominators::ValidationContext::reportError):
        (WTF::Dominators::ValidationContext::handleErrors):
        (WTF::Dominators::naiveDominates):
        (WTF::Dominators::forAllBlocksInDominanceFrontierOfImpl):
        (WTF::Dominators::forAllBlocksInIteratedDominanceFrontierOfImpl):
        (WTF::Dominators::BlockData::BlockData):

2015-11-01  Darin Adler  <darin@apple.com>

        Remove some dead and unneeded code (ScrollbarThemeSafari, RenderThemeSafari, OPENCL, a little color space logic)
        https://bugs.webkit.org/show_bug.cgi?id=150783

        Reviewed by Tim Horton.

        * wtf/FeatureDefines.h: Removed the OPENCL feature, no longer supported.

2015-10-31  Filip Pizlo  <fpizlo@apple.com>

        B3::reduceStrength's DCE should be more agro and less wrong
        https://bugs.webkit.org/show_bug.cgi?id=150748

        Reviewed by Geoffrey Garen.

        * wtf/GraphNodeWorklist.h:
        (WTF::GraphNodeWorklist::saw): This method is super useful.

2015-11-01  Philip Chimento  <philip.chimento@gmail.com>

        [GTK] Fix combinations of PLATFORM(GTK) and OS(DARWIN)
        https://bugs.webkit.org/show_bug.cgi?id=144560

        Reviewed by Darin Adler.

        * wtf/Platform.h: Don't USE(ACCELERATE) on PLATFORM(GTK).
        * wtf/WorkQueue.h: Change order of OS(DARWIN) and PLATFORM(GTK)
        checks so that GTK facilities are used even when building the
        GTK platform on Darwin.

2015-11-01  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Use RunLoop::Timer in main thread shared timer GTK+ implementation
        https://bugs.webkit.org/show_bug.cgi?id=150754

        Reviewed by Darin Adler.

        Add API to set the priority of a RunLoop::Timer for GLib.

        * wtf/RunLoop.h:
        * wtf/glib/RunLoopGLib.cpp:
        (WTF::RunLoop::TimerBase::setPriority):

2015-10-31  Andreas Kling  <akling@apple.com>

        Add a debug overlay with information about web process resource usage.
        <https://webkit.org/b/150599>

        Reviewed by Darin Adler.

        Add ENABLE(RESOURCE_USAGE_OVERLAY) flag, enabled on Mac by default.

        * wtf/Platform.h:

2015-10-30  Chris Dumez  <cdumez@apple.com>

        Regression(r191673): Crash in RunLoopTimer::schedule()
        https://bugs.webkit.org/show_bug.cgi?id=150723

        Reviewed by Anders Carlsson.

        We were crashing in RunLoopTimer::schedule() when iterating over the
        SchedulePairHashSet. The reason is that we were passing this
        SchedulePairHashSet from the main thread to a background thread, which
        was not safe because the SchedulePair objects inside the HashSet were
        not ThreadSafeRefCounted. This patch makes them ThreadSafeRefCounted.

        * wtf/SchedulePair.h:

2015-10-30  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Move the socket polling off the WorkQueue
        https://bugs.webkit.org/show_bug.cgi?id=150593

        Reviewed by Anders Carlsson.

        It doesn't really belong to the WorkQueue, it's only used by the
        WebKit2 connection, so it can be moved there.

        * wtf/WorkQueue.h:
        * wtf/glib/WorkQueueGLib.cpp:
        (WTF::WorkQueue::registerSocketEventHandler): Deleted.
        (WTF::WorkQueue::unregisterSocketEventHandler): Deleted.

2015-10-29  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Use a persistent main loop source in RunLoop glib implementation
        https://bugs.webkit.org/show_bug.cgi?id=150590

        Reviewed by Žan Doberšek.

        It's more efficient than creating and destroying a new source for
        every dispatch and it simplifies the code.

        * wtf/RunLoop.h:
        * wtf/glib/MainThreadGLib.cpp:
        (WTF::scheduleDispatchFunctionsOnMainThread): Use
        RunLoop::dispatch() instead of GMainLoopSource::scheduleAndDeleteOnDestroy().
        * wtf/glib/RunLoopGLib.cpp:
        (WTF::RunLoop::RunLoop): Create and setup the persistent source.
        (WTF::RunLoop::~RunLoop): Destroy the persistent source.
        (WTF::RunLoop::stop): Stop the persistent source before stopping
        the main loop.
        (WTF::RunLoop::wakeUp): Make the persistent source active. We
        no longer need to explicitly wakeup the context.
        (WTF::RunLoop::TimerBase::TimerBase): Create and setup the
        persistent source.
        (WTF::RunLoop::TimerBase::~TimerBase): Destroy the persistent source.
        (WTF::RunLoop::TimerBase::updateReadyTime): Set the ready time
        according to the fire interval.
        (WTF::RunLoop::TimerBase::start): Make the persistent source active.
        (WTF::RunLoop::TimerBase::stop): Stop the persistent source.
        (WTF::RunLoop::TimerBase::isActive): Return whether the
        persistent source is active.

2015-10-30  Philippe Normand  <pnormand@igalia.com>

        [GTK][Mac] fix WTF build
        https://bugs.webkit.org/show_bug.cgi?id=150502

        Reviewed by Alex Christensen.

        * wtf/CMakeLists.txt: Add CommonCryptoSPI.h in the headers.

2015-10-29  Alex Christensen  <achristensen@webkit.org>

        Fix Mac CMake build
        https://bugs.webkit.org/show_bug.cgi?id=150686

        Reviewed by Filip Pizlo.

        * wtf/CMakeLists.txt:
        * wtf/Platform.h:
        * wtf/PlatformMac.cmake:

2015-10-29  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r191728.
        https://bugs.webkit.org/show_bug.cgi?id=150668

        Caused a lot of timeouts in layout tests (Requested by KaL on
        #webkit).

        Reverted changeset:

        "[GTK] Use a persistent main loop source in RunLoop glib
        implementation"
        https://bugs.webkit.org/show_bug.cgi?id=150590
        http://trac.webkit.org/changeset/191728

2015-10-29  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Use a persistent main loop source in RunLoop glib implementation
        https://bugs.webkit.org/show_bug.cgi?id=150590

        Reviewed by Žan Doberšek.

        It's more efficient than creating and destroying a new source for
        every dispatch and it simplifies the code.

        * wtf/RunLoop.h:
        * wtf/glib/MainThreadGLib.cpp:
        (WTF::scheduleDispatchFunctionsOnMainThread): Use
        RunLoop::dispatch() instead of GMainLoopSource::scheduleAndDeleteOnDestroy().
        * wtf/glib/RunLoopGLib.cpp:
        (WTF::RunLoop::RunLoop): Create and setup the persistent source.
        (WTF::RunLoop::~RunLoop): Destroy the persistent source.
        (WTF::RunLoop::stop): Stop the persistent source before stopping
        the main loop.
        (WTF::RunLoop::wakeUp): Make the persistent source active. We
        no longer need to explicitly wakeup the context.
        (WTF::RunLoop::TimerBase::TimerBase): Create and setup the
        persistent source.
        (WTF::RunLoop::TimerBase::~TimerBase): Destroy the persistent source.
        (WTF::RunLoop::TimerBase::updateReadyTime): Set the ready time
        according to the fire interval.
        (WTF::RunLoop::TimerBase::start): Make the persistent source active.
        (WTF::RunLoop::TimerBase::stop): Stop the persistent source.
        (WTF::RunLoop::TimerBase::isActive): Return whether the
        persistent source is active.

2015-10-28  Filip Pizlo  <fpizlo@apple.com>

        Unreviewed, make sure B3 is disabled on iOS for now.

        * wtf/Platform.h:

2015-10-28  Filip Pizlo  <fpizlo@apple.com>

        Create a super rough prototype of B3
        https://bugs.webkit.org/show_bug.cgi?id=150280

        Reviewed by Benjamin Poulain.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/HashSet.h:
        (WTF::copyToVector):
        (WTF::=):
        * wtf/ListDump.h:
        (WTF::PointerListDump::PointerListDump):
        (WTF::PointerListDump::dump):
        (WTF::MapDump::MapDump):
        (WTF::listDump):
        (WTF::pointerListDump):
        (WTF::sortedListDump):
        * wtf/MathExtras.h:
        (WTF::leftShiftWithSaturation):
        (WTF::rangesOverlap):
        * wtf/Platform.h:
        * wtf/ScopedLambda.h: Added.
        (WTF::scopedLambda):
        * wtf/SharedTask.h:
        (WTF::createSharedTask):

2015-10-28  Alberto Garcia  <berto@igalia.com>

        [SOUP] Cannot build the network process in glibc-based BSD systems
        https://bugs.webkit.org/show_bug.cgi?id=150618

        Reviewed by Carlos Garcia Campos.

        * wtf/Platform.h: Don't enable HAVE_STAT_BIRTHTIME if the system
        is using glibc.

2015-10-21  Filip Pizlo  <fpizlo@apple.com>

        Factor out the graph node worklists from DFG into WTF
        https://bugs.webkit.org/show_bug.cgi?id=150411

        Reviewed by Geoffrey Garen.

        The new GraphNodeWorklist.h file is basically just the functionality from the old
        DFGBlockWorklist.h, but templatized to work for any graph node type and any kind of graph
        node set.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/GraphNodeWorklist.h: Added.
        (WTF::GraphNodeWorklist::push):
        (WTF::GraphNodeWorklist::notEmpty):
        (WTF::GraphNodeWorklist::pop):
        (WTF::GraphNodeWith::GraphNodeWith):
        (WTF::GraphNodeWith::operator bool):
        (WTF::ExtendedGraphNodeWorklist::ExtendedGraphNodeWorklist):
        (WTF::ExtendedGraphNodeWorklist::forcePush):
        (WTF::ExtendedGraphNodeWorklist::push):
        (WTF::ExtendedGraphNodeWorklist::notEmpty):
        (WTF::ExtendedGraphNodeWorklist::pop):
        (WTF::GraphNodeWithOrder::GraphNodeWithOrder):
        (WTF::GraphNodeWithOrder::operator bool):
        (WTF::PostOrderGraphNodeWorklist::PostOrderGraphNodeWorklist):
        (WTF::PostOrderGraphNodeWorklist::~PostOrderGraphNodeWorklist):
        (WTF::PostOrderGraphNodeWorklist::pushPre):
        (WTF::PostOrderGraphNodeWorklist::pushPost):
        (WTF::PostOrderGraphNodeWorklist::push):
        (WTF::PostOrderGraphNodeWorklist::notEmpty):
        (WTF::PostOrderGraphNodeWorklist::pop):
        * wtf/HashTable.h:
        (WTF::HashTableAddResult::HashTableAddResult):
        (WTF::HashTableAddResult::operator bool):

2015-10-20  Tim Horton  <timothy_horton@apple.com>

        Try to fix the build by disabling MAC_GESTURE_EVENTS on 10.9 and 10.10

        * wtf/FeatureDefines.h:

2015-10-20  Yoav Weiss  <yoav@yoav.ws>

        Rename the PICTURE_SIZES flag to CURRENTSRC
        https://bugs.webkit.org/show_bug.cgi?id=150275

        Reviewed by Dean Jackson.

        * wtf/FeatureDefines.h:

2015-10-19  Beth Dakin  <bdakin@apple.com>

        Build fix.

        * wtf/FeatureDefines.h:

2015-10-19  Tim Horton  <timothy_horton@apple.com>

        Add magnify and rotate gesture event support for Mac
        https://bugs.webkit.org/show_bug.cgi?id=150179
        <rdar://problem/8036240>

        Reviewed by Darin Adler.

        * wtf/FeatureDefines.h:
        New feature flag.

2015-10-17  Mark Lam  <mark.lam@apple.com>

        Add CPU(X86) to the supported MASM_PROBE CPUs. This was accidentally left out in r191197.

        Not reviewed.

        * wtf/Platform.h:

2015-10-16  Mark Lam  <mark.lam@apple.com>

        Always enable MASM_PROBE for debug builds.
        https://bugs.webkit.org/show_bug.cgi?id=150190

        Reviewed by Geoffrey Garen.

        * wtf/Platform.h:

2015-10-14  Andreas Kling  <akling@apple.com>

        REGRESSION(r190882): Concatenating a character array and an empty string is broken.
        <https://webkit.org/b/150135>

        Reviewed by Geoffrey Garen.

        StringAdapter templates for raw character arrays were always using 1 as the array length
        in toString().

        * wtf/text/StringConcatenate.h:

2015-10-14  Per Arne Vollan  <peavo@outlook.com>

        [Win64] Enable concurrent JIT.
        https://bugs.webkit.org/show_bug.cgi?id=150098

        Reviewed by Csaba Osztrogonác.

        * wtf/Platform.h:

2015-10-13  Simon Fraser  <simon.fraser@apple.com>

        Add helper funtion for checking pointer equivalency and use it
        https://bugs.webkit.org/show_bug.cgi?id=150022

        Reviewed by Darin Adler.
        
        Add PointerComparison.h which contains the templated pointer comparison
        function.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/PointerComparison.h: Added.
        (WTF::arePointingToEqualData):

2015-10-12  Andreas Kling  <akling@apple.com>

        "A + B" with strings shouldn't copy if A or B is empty.
        <https://webkit.org/b/150034>

        Reviewed by Anders Carlsson.

        Add a fast path to WTF's operator+ magic for concatenation of two strings where
        one of them is empty. In that case, try to avoid allocation altogether by returning
        the non-empty string.

        Spotted this while analyzing memory peaks during page load; it turns out we were
        duplicating whole text resources (JS, CSS) at the end of decoding, below
        TextResourceDecoder::decodeAndFlush(). That function effectively does:

            return decode() + flush();

        Very often, flush() returns an empty string, so due to the naive operator+,
        we'd allocate a new StringImpl of length (decode().length() + flush().length())
        and copy the return value from decode() into it. So silly!

        Had to make the tryMakeString() machinery use String as a return type instead of
        RefPtr<StringImpl> to make all the right overloads gel. StringTypeAdapter templates
        are now required to provide a toString() function.

        * wtf/text/StringConcatenate.h:
        (WTF::StringTypeAdapter<char>::toString):
        (WTF::StringTypeAdapter<UChar>::toString):
        (WTF::StringTypeAdapter<Vector<char>>::toString):
        (WTF::StringTypeAdapter<String>::toString):
        (WTF::tryMakeString):
        (WTF::makeString):
        * wtf/text/StringOperators.h:
        (WTF::StringAppend::operator String):
        * wtf/text/StringView.h:
        (WTF::StringTypeAdapter<StringView>::toString):

2015-10-12  Filip Pizlo  <fpizlo@apple.com>

        Unreviewed, fix style in the hopes that it fixes Windows.

        * wtf/ParallelHelperPool.cpp:
        (WTF::ParallelHelperClient::~ParallelHelperClient):
        (WTF::ParallelHelperClient::setTask):
        (WTF::ParallelHelperClient::doSomeHelping):
        (WTF::ParallelHelperClient::runTaskInParallel):
        (WTF::ParallelHelperClient::finish):
        (WTF::ParallelHelperClient::claimTask):
        (WTF::ParallelHelperClient::runTask):
        (WTF::ParallelHelperPool::doSomeHelping):
        (WTF::ParallelHelperPool::helperThreadBody):
        * wtf/ParallelHelperPool.h:
        (WTF::ParallelHelperClient::setFunction):
        (WTF::ParallelHelperClient::runFunctionInParallel):
        (WTF::ParallelHelperClient::pool):

2015-10-10  Filip Pizlo  <fpizlo@apple.com>

        FTL should generate code to call slow paths lazily
        https://bugs.webkit.org/show_bug.cgi?id=149936

        Reviewed by Saam Barati.

        Enables SharedTask to handle any function type, not just void().

        It's probably better to use SharedTask instead of std::function in performance-sensitive
        code. std::function uses the system malloc and has copy semantics. SharedTask uses FastMalloc
        and has aliasing semantics. So, you can just trust that it will have sensible performance
        characteristics.

        * wtf/ParallelHelperPool.cpp:
        (WTF::ParallelHelperClient::~ParallelHelperClient):
        (WTF::ParallelHelperClient::setTask):
        (WTF::ParallelHelperClient::doSomeHelping):
        (WTF::ParallelHelperClient::runTaskInParallel):
        (WTF::ParallelHelperClient::finish):
        (WTF::ParallelHelperClient::claimTask):
        (WTF::ParallelHelperClient::runTask):
        (WTF::ParallelHelperPool::doSomeHelping):
        (WTF::ParallelHelperPool::helperThreadBody):
        * wtf/ParallelHelperPool.h:
        (WTF::ParallelHelperClient::setFunction):
        (WTF::ParallelHelperClient::runFunctionInParallel):
        (WTF::ParallelHelperClient::pool):
        * wtf/SharedTask.h:
        (WTF::createSharedTask):
        (WTF::SharedTask::SharedTask): Deleted.
        (WTF::SharedTask::~SharedTask): Deleted.
        (WTF::SharedTaskFunctor::SharedTaskFunctor): Deleted.

2015-10-10  Dan Bernstein  <mitz@apple.com>

        [iOS] Remove unnecessary iOS version checks
        https://bugs.webkit.org/show_bug.cgi?id=150002

        Reviewed by Alexey Proskuryakov.

        * wtf/Platform.h:

2015-10-10  Dan Bernstein  <mitz@apple.com>

        [iOS] Remove project support for iOS 8
        https://bugs.webkit.org/show_bug.cgi?id=149993

        Reviewed by Alexey Proskuryakov.

        * Configurations/Base.xcconfig:
        * Configurations/WTF.xcconfig:
        * Configurations/mbmalloc.xcconfig:

2015-10-08  Joseph Pecoraro  <pecoraro@apple.com>

        Clean up Marked classes
        https://bugs.webkit.org/show_bug.cgi?id=149853

        Reviewed by Darin Adler.

        * wtf/PageBlock.h:
        Remove duplicate using statement.

2015-10-08  Joseph Pecoraro  <pecoraro@apple.com>

        Remove PageReservation.h clang fixme that has been fixed for a while
        https://bugs.webkit.org/show_bug.cgi?id=149908

        Reviewed by Csaba Osztrogonác.

        * wtf/PageReservation.h:
        (WTF::PageReservation::operator bool): Deleted.

2015-10-06  Daniel Bates  <dbates@webkit.org>

        Enable XSLT when building WebKit for iOS using the public iOS SDK
        https://bugs.webkit.org/show_bug.cgi?id=149827

        Reviewed by Alexey Proskuryakov.

        * wtf/FeatureDefines.h:

2015-10-04  Filip Pizlo  <fpizlo@apple.com>

        Inline cache repatching should be throttled if it happens a lot
        https://bugs.webkit.org/show_bug.cgi?id=149796
        rdar://problem/22674436

        Reviewed by Saam Barati.

        Add some helpers for saturated math.

        * wtf/MathExtras.h:
        (WTF::incrementWithSaturation):
        (WTF::leftShiftWithSaturation):

2015-10-01  Brent Fulgham  <bfulgham@apple.com>

        [Win] Unreviewed CMake build fixes.

        * wtf/CMakeLists.txt: Correct build flags to match
        the original project files.

2015-09-30  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r190324.
        https://bugs.webkit.org/show_bug.cgi?id=149671

        Caused flaky crashes, rdar://problem/22916304 (Requested by ap
        on #webkit).

        Reverted changeset:

        "ParallelHelperPool::runFunctionInParallel() shouldn't
        allocate, and ParallelHelperPool.h shouldn't be included
        everywhere"
        https://bugs.webkit.org/show_bug.cgi?id=149635
        http://trac.webkit.org/changeset/190324

2015-09-29  Filip Pizlo  <fpizlo@apple.com>

        ParallelHelperPool::runFunctionInParallel() shouldn't allocate, and ParallelHelperPool.h shouldn't be included everywhere
        https://bugs.webkit.org/show_bug.cgi?id=149635

        Reviewed by Saam Barati.

        * wtf/ParallelHelperPool.h:
        (WTF::ParallelHelperClient::runFunctionInParallel): Stack-allocate the task instead of heap-allocating it.

2015-09-29  Filip Pizlo  <fpizlo@apple.com>

        GC copy phase spans too many files
        https://bugs.webkit.org/show_bug.cgi?id=149586

        Reviewed by Andreas Kling.

        Extract the load balancing algorithm used by the GC's copy phase into a reusable template.
        The GC copy phase now uses this.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/ParallelVectorIterator.h: Added.
        (WTF::ParallelVectorIterator::ParallelVectorIterator):
        (WTF::ParallelVectorIterator::iterate):

2015-09-26  Filip Pizlo  <fpizlo@apple.com>

        Unreviewed, fix Windows build by adding WTF_EXPORT_PRIVATE in various places.

        * wtf/ParallelHelperPool.h:
        (WTF::ParallelHelperClient::setFunction):
        (WTF::ParallelHelperPool::numberOfThreads):

2015-09-24  Filip Pizlo  <fpizlo@apple.com>

        VMs should share GC threads
        https://bugs.webkit.org/show_bug.cgi?id=149433
        rdar://problem/12859344

        Reviewed by Geoffrey Garen.

        This adds two major things to WTF: WeakRandom and ParallelHelperPool. WeakRandom was
        already in JSC; we're just hoisting it into WTF. It's just a weak random number generator
        that's suitable for places where you need just a tiny bit of randomness.

        ParallelHelperPool is a new API that simplifies data-parallel algorithms like the JSC GC.
        In a data-parallel algorithm, we want to run one task on as many cores as possible and let
        the task worry about which subset of the input data to work on. In some cases, the
        algorithm will not need to do any load balancing - and if load balancing is required, it's
        up to the user. This is appropriate in contexts where the load balancing needs to be
        custom-tuned for performance, like the GC's marking phase.

        This new API has three concepts: task, client, and pool. A task is a reference counted
        object with a run() method, which may be run in parallel. It is usually used to wrap a
        functor. A pool is a pool of threads that can run things. A client is a placeholder for a
        task. A client can have zero or one tasks. A client must be registered with a pool. When a
        client has a task, the pool's threads may choose to run it. If a thread starts running a
        task, it will run it to completion. When the task returns on any thread, the client takes
        it to mean that the task should be removed. That means that any currently running instances
        of the task will finish but no new threads will attempt to run the task. You can easily ask
        a client to wait until a task finishes. You can also easily ask a client to run a task on
        the current thread in addition to possibly some helper threads from the pool.

        For some data-parallel algorithms, programming with ParallelHelperPool is as easy as:

        client.runFunctionInParallel(
            [=] () {
                do things;
            });

        Note that you cannot tell ahead of time how many threads will join to help the task.
        Threads may become available after the task has already started running. Those threads may
        join after the other threads have already started. It's not advisable to make algorithmic
        decisions based on client.numberOfActiveThreads(), since that number may change. Usually
        the best way to use ParallelHelperPool is with an algorithm that has its own custom
        worklist. An example of a very simple custom worklist is the one in the JSC GC's copying
        phase - it's just a Vector and an index that indicates the next set of elements to process.

        This new API was initially designed to simplify how GCThread works, by replacing Phase with
        a callback that contains the phase's workload. I then realized that with a few tweaks, I
        could make this somewhat general enough that it might become interesting outside GC. I also
        realized that I could use this to enable thread sharing. So, although the API is kinda
        quirky, it's grounded in the reality of how the JSC GC does parallelism.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/ParallelHelperPool.cpp: Added.
        (WTF::ParallelHelperClient::ParallelHelperClient):
        (WTF::ParallelHelperClient::~ParallelHelperClient):
        (WTF::ParallelHelperClient::setTask):
        (WTF::ParallelHelperClient::finish):
        (WTF::ParallelHelperClient::doSomeHelping):
        (WTF::ParallelHelperClient::runTaskInParallel):
        (WTF::ParallelHelperClient::claimTask):
        (WTF::ParallelHelperClient::runTask):
        (WTF::ParallelHelperPool::ParallelHelperPool):
        (WTF::ParallelHelperPool::~ParallelHelperPool):
        (WTF::ParallelHelperPool::addThreads):
        (WTF::ParallelHelperPool::ensureThreads):
        (WTF::ParallelHelperPool::doSomeHelping):
        (WTF::ParallelHelperPool::didMakeWorkAvailable):
        (WTF::ParallelHelperPool::helperThreadBody):
        (WTF::ParallelHelperPool::hasClientWithTask):
        (WTF::ParallelHelperPool::getClientWithTask):
        (WTF::ParallelHelperPool::waitForClientWithTask):
        * wtf/ParallelHelperPool.h: Added.
        (WTF::ParallelHelperClient::setFunction):
        (WTF::ParallelHelperClient::runFunctionInParallel):
        (WTF::ParallelHelperClient::pool):
        (WTF::ParallelHelperClient::numberOfActiveThreads):
        (WTF::ParallelHelperPool::numberOfThreads):
        * wtf/SharedTask.h: Added.
        (WTF::SharedTask::SharedTask):
        (WTF::SharedTask::~SharedTask):
        (WTF::SharedTaskFunctor::SharedTaskFunctor):
        (WTF::createSharedTask):
        * wtf/WeakRandom.h: Copied from Source/JavaScriptCore/runtime/WeakRandom.h.
        (WTF::WeakRandom::WeakRandom):
        (WTF::WeakRandom::initializeSeed):
        (WTF::WeakRandom::seedUnsafe):
        (WTF::WeakRandom::getUint32):
        (WTF::WeakRandom::advance):
        (JSC::WeakRandom::WeakRandom): Deleted.
        (JSC::WeakRandom::seedUnsafe): Deleted.
        (JSC::WeakRandom::getUint32): Deleted.
        (JSC::WeakRandom::advance): Deleted.
        (JSC::WeakRandom::initializeSeed): Deleted.

2015-09-25  Alex Christensen  <achristensen@webkit.org>

        Clean up CMake build on Mac
        https://bugs.webkit.org/show_bug.cgi?id=149573

        Reviewed by Chris Dumez.

        * wtf/PlatformMac.cmake:

2015-09-25  Alex Christensen  <achristensen@webkit.org>

        [Win] Switch to CMake
        https://bugs.webkit.org/show_bug.cgi?id=148111

        Reviewed by Brent Fulgham.

        * WTF.vcxproj/WTF.proj:

2015-09-25  Joseph Pecoraro  <pecoraro@apple.com>

        Simplify Stopwatch::elapsedTime
        https://bugs.webkit.org/show_bug.cgi?id=149538

        Reviewed by Darin Adler.

        * wtf/Stopwatch.h:
        (WTF::Stopwatch::elapsedTime):
        Simplify by not starting/stopping but just computing without updating members.

2015-09-25  Brent Fulgham  <bfulgham@apple.com>

        [Win] Unreviewed build fix.

        * wtf/FeatureDefines.h: Don't turn STREAMS_API on by default
        on Windows.

2015-09-24  Ryosuke Niwa  <rniwa@webkit.org>

        Ran sort-Xcode-project-file.

        * WTF.xcodeproj/project.pbxproj:

2015-09-23  Andy Estes  <aestes@apple.com>

        Disable QuickLook on watchOS
        https://bugs.webkit.org/show_bug.cgi?id=149508
        <rdar://problem/22517968>

        Reviewed by Dan Bernstein.

        * wtf/Platform.h:

2015-09-22  Andy Estes  <aestes@apple.com>

        Disable QuickLook on tvOS
        https://bugs.webkit.org/show_bug.cgi?id=149492
        <rdar://problem/22741586>

        Reviewed by Dan Bernstein.

        * wtf/Platform.h: Stopped enabling QuickLook on tvOS.

2015-09-22  Filip Pizlo  <fpizlo@apple.com>

        Get rid of ENABLE(PARALLEL_GC)
        https://bugs.webkit.org/show_bug.cgi?id=149436

        Reviewed by Mark Lam.

        We always enable parallel GC everywhere but Windows, and it doesn't look like it was disabled
        there for any good reason. So, get rid of the flag.

        * wtf/MainThread.cpp:
        (WTF::canAccessThreadLocalDataForThread):
        (WTF::initializeGCThreads):
        (WTF::registerGCThread):
        (WTF::isMainThreadOrGCThread):
        * wtf/Platform.h:

2015-09-22  Filip Pizlo  <fpizlo@apple.com>

        Get rid of ENABLE(GGC)
        https://bugs.webkit.org/show_bug.cgi?id=149472

        Reviewed by Mark Hahnenberg and Mark Lam.

        * wtf/Platform.h:

2015-09-21  Filip Pizlo  <fpizlo@apple.com>

        Always use the compiler's CAS implementation and get rid of ENABLE(COMPARE_AND_SWAP)
        https://bugs.webkit.org/show_bug.cgi?id=149438

        Reviewed by Mark Lam.

        * wtf/Atomics.h: Make weakCompareAndSwap() just forward to the system CAS via WTF::Atomic.
        (WTF::weakCompareAndSwap):
        (WTF::weakCompareAndSwapUIntPtr): Deleted.
        (WTF::weakCompareAndSwapSize): Deleted.
        * wtf/Bitmap.h: Small changes to use the new API.
        (WTF::WordType>::concurrentTestAndSet):
        * wtf/Platform.h: Remove ENABLE(COMPARE_AND_SWAP)

2015-09-21  Csaba Osztrogonác  <ossy@webkit.org>

        Remove old GCC cruft from wtf/StdLibExtras.h
        https://bugs.webkit.org/show_bug.cgi?id=149401

        Reviewed by Alex Christensen.

        * wtf/StdLibExtras.h:

2015-09-21  Andy Estes  <aestes@apple.com>

        Disable Parental Controls on the Apple TV platform
        https://bugs.webkit.org/show_bug.cgi?id=149421

        Reviewed by Darin Adler.

        * wtf/Platform.h:

2015-09-21  Filip Pizlo  <fpizlo@apple.com>

        JSC should infer property types
        https://bugs.webkit.org/show_bug.cgi?id=148610

        Reviewed by Geoffrey Garen.

        * wtf/HashTable.h:
        (WTF::HashTableAddResult::HashTableAddResult): Make it possible to say "HashMap::AddResult result" without assigning anything to it yet.
        * wtf/PrintStream.h:
        (WTF::printInternal): Beef up printing of some common WTF types, in particular RefPtr<UniquedStringImpl>.

2015-09-20  Youenn Fablet  <youenn.fablet@crf.canon.fr>

        Remove XHR_TIMEOUT compilation guard
        https://bugs.webkit.org/show_bug.cgi?id=149260

        Reviewed by Benjamin Poulain.

        * wtf/FeatureDefines.h:

2015-09-17  Filip Pizlo  <fpizlo@apple.com>

        Unreviewed, revert unintended change.

        * benchmarks/LockSpeedTest.cpp:
        (main):

2015-09-15  Ryosuke Niwa  <rniwa@webkit.org>

        Add ShadowRoot interface and Element.prototype.attachShadow
        https://bugs.webkit.org/show_bug.cgi?id=149187

        Reviewed by Antti Koivisto.

        * wtf/FeatureDefines.h:


2015-09-11  Keith Miller  <keith_miller@apple.com>

        cryptographicallyRandomValuesFromOS should use CCRandomCopyBytes when available.
        https://bugs.webkit.org/show_bug.cgi?id=148439

        Reviewed by Alexey Proskuryakov.

        Recently, we switched to using arc4random_buf on Darwin but further research indicates that
        arc4random_buf has the same behavior we had before and thus we were just pushing the problem
        further down the stack. CCRandomCopyBytes, however, appears to be more advanced and has much
        better error handling than we had before.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/OSRandomSource.cpp:
        (WTF::cryptographicallyRandomValuesFromOS):
        * wtf/spi/darwin/CommonCryptoSPI.h: Added.

2015-09-08  Filip Pizlo  <fpizlo@apple.com>

        There should be one stub hanging off an inline cache that contains code for all of the cases, rather than forming a linked list consisting of one stub per case
        https://bugs.webkit.org/show_bug.cgi?id=148717

        Reviewed by Michael Saboff.

        Beef up dumping a bit.

        * wtf/PrintStream.h:
        (WTF::pointerDump):
        (WTF::printInternal):

2015-09-08  Mark Lam  <mark.lam@apple.com>

        GC stack scan should include ABI red zone.
        https://bugs.webkit.org/show_bug.cgi?id=148976

        Reviewed by Geoffrey Garen and Benjamin Poulain.

        * wtf/StackBounds.h:
        (WTF::StackBounds::origin):
        (WTF::StackBounds::end):
        (WTF::StackBounds::size):

2015-09-04  Csaba Osztrogonác  <ossy@webkit.org>

        Enable reference qualified functions for GCC
        https://bugs.webkit.org/show_bug.cgi?id=148526

        Reviewed by Darin Adler.

        * wtf/Compiler.h:

2015-09-04  Csaba Osztrogonác  <ossy@webkit.org>

        webkit-unassigned@lists.webkit.org
        https://bugs.webkit.org/show_bug.cgi?id=148525

        Reviewed by Darin Adler.

        * wtf/Compiler.h:

2015-08-29  Zan Dobersek  <zdobersek@igalia.com>

        [WTF] Improve a ParkingLot::parkConditionally() comment for a libstdc++ workaround
        https://bugs.webkit.org/show_bug.cgi?id=148571

        Reviewed by Filip Pizlo.

        * wtf/ParkingLot.cpp:
        (WTF::ParkingLot::parkConditionally): Adjust the comment about the workaround for
        the libstdc++ std::condition_variable implementation, linking to the WebKit bug
        that dissected the problem and the GCC bug that originally reported the problem.

2015-08-28  Anders Carlsson  <andersca@apple.com>

        Remove the #if PLATFORM(MAC) in DeprecatedSymbolsUsedBySafari.mm so we'll actually build it on iOS.

        Reviewed by Dan Bernstein.

        * wtf/mac/DeprecatedSymbolsUsedBySafari.mm:

2015-08-27  Anders Carlsson  <andersca@apple.com>

        Define legacy main thread calling functions for iOS as well
        https://bugs.webkit.org/show_bug.cgi?id=148530

        Reviewed by Tim Horton.

        * wtf/mac/DeprecatedSymbolsUsedBySafari.mm:

2015-08-26  Anders Carlsson  <andersca@apple.com>

        Fix build.

        * wtf/WorkQueue.cpp:

2015-08-26  Anders Carlsson  <andersca@apple.com>

        Add and implement WorkQueue::concurrentApply
        https://bugs.webkit.org/show_bug.cgi?id=148488

        Reviewed by Geoffrey Garen.

        WorkQueue::concurrentApply is modeled after dispatch_apply, and on Cocoa it uses dispatch_apply directly.
        For other ports there's a generic concurrentApply implemented using our threading primitives.
        
        * wtf/NeverDestroyed.h:
        (WTF::LazyNeverDestroyed::operator->):
        * wtf/WorkQueue.cpp:
        (WTF::WorkQueue::concurrentApply):
        * wtf/WorkQueue.h:
        * wtf/cocoa/WorkQueueCocoa.cpp:
        (WTF::WorkQueue::concurrentApply):

2015-08-25  Filip Pizlo  <fpizlo@apple.com>

        Node::origin should be able to tell you if it's OK to exit
        https://bugs.webkit.org/show_bug.cgi?id=145204

        Reviewed by Geoffrey Garen.

        * wtf/Insertion.h:
        (WTF::executeInsertions): Add a useful assertion. This come into play because JSC will use UINT_MAX as "invalid index", and that ought to trigger this assertion.

2015-08-25  Csaba Osztrogonác  <ossy@webkit.org>

        Require GCC version at least 4.9
        https://bugs.webkit.org/show_bug.cgi?id=148430

        Reviewed by Darin Adler.

        * wtf/Compiler.h:

2015-08-22  Anders Carlsson  <andersca@apple.com>

        std::once_flag needs to be static.

        * wtf/mac/DeprecatedSymbolsUsedBySafari.mm:
        (WTF::MainThreadFunctionTracker::singleton):

2015-08-21  Anders Carlsson  <andersca@apple.com>

        Build fix.

        * wtf/MainThread.h:

2015-08-21  Anders Carlsson  <andersca@apple.com>

        Address review feedback from Darin.

        * wtf/MainThread.h:
        * wtf/mac/DeprecatedSymbolsUsedBySafari.mm:
        (WTF::callOnMainThread):
        (WTF::cancelCallOnMainThread):

2015-08-21  Anders Carlsson  <andersca@apple.com>

        Deprecate the old school callOnMainThread/cancelCallOnMainThread functions
        https://bugs.webkit.org/show_bug.cgi?id=148327

        Reviewed by Sam Weinig.

        * wtf/MainThread.cpp:
        (WTF::functionQueue):
        (WTF::dispatchFunctionsFromMainThread):
        (WTF::callOnMainThread):
        Change the function queue to be a queue of std::function<void ()> and get rid of dead code.

        * wtf/MainThread.h:
        Conditionalize callOnMainThread and cancelCallOnMainThread because Safari on Mavericks still expects to them to be
        declared in MainThread.h under 10.9.

        * wtf/mac/DeprecatedSymbolsUsedBySafari.mm:
        Add a MainThreadFunctionTracker singleton that keeps track of scheduled functions so we can ensure that they're not
        called if they're cancelled.

        (WTF::MainThreadFunctionTracker::singleton):
        Return the singleton.

        (WTF::MainThreadFunctionTracker::callOnMainThread):
        Add the function/context pair to our map and schedule the function to be run on the main thread.
        If the function has been removed, don't call it.

        (WTF::MainThreadFunctionTracker::cancelCallOnMainThread):
        Remove all entries with the given function/context pair.

        (WTF::MainThreadFunctionTracker::addFunction):
        Add the function/context pair to the map and return the unique identifier.

        (WTF::MainThreadFunctionTracker::removeIdentifier):
        Look up the identifier and remove it if it still exists. If it exists we know that it hasn't been canceled and that we can call it.

        (WTF::MainThreadFunctionTracker::removeFunctions):
        Remove all function identifiers matched by the function/context pair.

        (WTF::callOnMainThread):
        Implement using MainThreadFunctionTracker.

        (WTF::cancelCallOnMainThread):
        Implement using MainThreadFunctionTracker.

2015-08-21  Anders Carlsson  <andersca@apple.com>

        Get rid of uses of the old callOnMainThread function that takes a function ptr + context
        https://bugs.webkit.org/show_bug.cgi?id=148324

        Reviewed by Tim Horton.

        * wtf/text/cf/StringImplCF.cpp:
        (WTF::StringWrapperCFAllocator::deallocate):
        (WTF::StringWrapperCFAllocator::deallocateOnMainThread): Deleted.

2015-08-20  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r188717 and r188719.
        https://bugs.webkit.org/show_bug.cgi?id=148272

        Broke the Mavericks build (Requested by andersca on #webkit).

        Reverted changesets:

        "Merge Lock and LockBase"
        https://bugs.webkit.org/show_bug.cgi?id=148266
        http://trac.webkit.org/changeset/188717

        "Merge ConditionBase and Condition"
        https://bugs.webkit.org/show_bug.cgi?id=148270
        http://trac.webkit.org/changeset/188719

2015-08-20  Anders Carlsson  <andersca@apple.com>

        Merge ConditionBase and Condition
        https://bugs.webkit.org/show_bug.cgi?id=148270

        Reviewed by Filip Pizlo.

        * wtf/Condition.h:
        Direct initialize m_hasWaiters so Condition gets a constexpr constructor.

        * wtf/Lock.h:
        Remove a now outdated comment.

2015-08-20  Anders Carlsson  <andersca@apple.com>

        Merge Lock and LockBase
        https://bugs.webkit.org/show_bug.cgi?id=148266

        Reviewed by Filip Pizlo.

        * wtf/Atomics.h:
        (WTF::Atomic::Atomic):
        Add a default constructor as well as a constexpr constructor that takes a value.

        * wtf/Lock.cpp:
        (WTF::Lock::lockSlow):
        (WTF::Lock::unlockSlow):
        Rename LockBase to Lock.

        * wtf/Lock.h:
        Rename LockBase to Lock and direct-initialize Atomic to 0. Since the Atomic constructor is constexpr,
        Lock also gets a constexpr constructor. Change the LockBase -> StaticLock typedef and add a fixme.

        * wtf/WordLock.h:
        Direct initialize m_word to 0.

2015-08-19  Filip Pizlo  <fpizlo@apple.com>

        Remove WTF::SpinLock
        https://bugs.webkit.org/show_bug.cgi?id=148208

        Reviewed by Geoffrey Garen.

        Remove the SpinLock.h file and remove references to the SpinLock class. Put the old SpinLock
        algorithm in LockSpeedTest.cpp - which isn't compiled as part of a WTF or WebKit build - just
        so we can still benchmark our locking algorithms against a spinlock baseline.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.xcodeproj/project.pbxproj:
        * benchmarks/LockSpeedTest.cpp:
        * wtf/CMakeLists.txt:
        * wtf/Lock.h:
        * wtf/SpinLock.h: Removed.
        * wtf/WordLock.h:

2015-08-19  Alex Christensen  <achristensen@webkit.org>

        CMake Windows build should not include files directly from other Source directories
        https://bugs.webkit.org/show_bug.cgi?id=148198

        Reviewed by Brent Fulgham.

        * wtf/CMakeLists.txt:
        * wtf/PlatformWin.cmake:

2015-08-18  Filip Pizlo  <fpizlo@apple.com>

        Replace all uses of std::mutex/std::condition_variable with WTF::Lock/WTF::Condition
        https://bugs.webkit.org/show_bug.cgi?id=148140

        Reviewed by Geoffrey Garen.

        Also beef up Condition by giving it a StaticCondition variant.

        * wtf/Condition.h:
        (WTF::ConditionBase::notifyAll):
        (WTF::ConditionBase::waitForSecondsImpl):
        (WTF::ConditionBase::absoluteFromRelative):
        (WTF::Condition::Condition):
        (WTF::Condition::notifyAll): Deleted.
        (WTF::Condition::waitForSecondsImpl): Deleted.
        (WTF::Condition::absoluteFromRelative): Deleted.
        * wtf/CryptographicallyRandomNumber.cpp:
        * wtf/HashTable.cpp:
        (WTF::HashTableStats::recordCollisionAtCount):
        (WTF::HashTableStats::dumpStats):
        (WTF::hashTableStatsMutex): Deleted.
        * wtf/HashTable.h:
        (WTF::KeyTraits>::HashTable):
        (WTF::KeyTraits>::invalidateIterators):
        (WTF::addIterator):
        (WTF::removeIterator):
        * wtf/Lock.h:
        * wtf/MainThread.cpp:
        (WTF::functionQueue):
        (WTF::dispatchFunctionsFromMainThread):
        (WTF::callOnMainThread):
        (WTF::cancelCallOnMainThread):
        (WTF::mainThreadFunctionQueueMutex): Deleted.
        * wtf/StackStats.cpp:
        (WTF::StackStats::PerThreadStats::PerThreadStats):
        (WTF::StackStats::CheckPoint::CheckPoint):
        (WTF::StackStats::CheckPoint::~CheckPoint):
        (WTF::StackStats::probe):
        (WTF::StackStats::LayoutCheckPoint::LayoutCheckPoint):
        (WTF::StackStats::LayoutCheckPoint::~LayoutCheckPoint):
        (WTF::StackStats::initialize): Deleted.
        * wtf/StackStats.h:
        (WTF::StackStats::LayoutCheckPoint::LayoutCheckPoint):
        (WTF::StackStats::probe):
        (WTF::StackStats::initialize): Deleted.
        * wtf/ThreadingPthreads.cpp:
        (WTF::initializeThreading):
        * wtf/mac/DeprecatedSymbolsUsedBySafari.mm:
        (WTF::callOnMainThread):
        (WTF::lockAtomicallyInitializedStaticMutex):
        (WTF::unlockAtomicallyInitializedStaticMutex):
        (WTF::atomicallyInitializedStaticMutex): Deleted.
        * wtf/text/StringView.cpp:
        (WTF::StringView::UnderlyingString::UnderlyingString):
        (WTF::underlyingStrings):
        (WTF::StringView::invalidate):
        (WTF::StringView::adoptUnderlyingString):
        (WTF::StringView::setUnderlyingString):
        (WTF::underlyingStringsMutex): Deleted.
        * wtf/unicode/icu/CollatorICU.cpp:
        (WTF::Collator::Collator):
        (WTF::Collator::~Collator):
        (WTF::cachedCollatorMutex): Deleted.

2015-08-18  Zan Dobersek  <zdobersek@igalia.com>

        [GLib] GMainLoopSource should receive the std::function<> objects through rvalue references
        https://bugs.webkit.org/show_bug.cgi?id=147981

        Reviewed by Carlos Garcia Campos.

        Scheduling methods on GMainLoopSource and GThreadSafeMainLoopSource should
        have the std::function<> objects passed through rvalue references, and should
        move the passed-in objects forward when required.

        * wtf/glib/GMainLoopSource.cpp:
        (WTF::GMainLoopSource::schedule):
        (WTF::GMainLoopSource::scheduleAfterDelay):
        (WTF::GMainLoopSource::scheduleAndDeleteOnDestroy):
        (WTF::GMainLoopSource::scheduleAfterDelayAndDeleteOnDestroy):
        * wtf/glib/GMainLoopSource.h:
        * wtf/glib/GThreadSafeMainLoopSource.cpp:
        (WTF::GThreadSafeMainLoopSource::schedule):
        (WTF::GThreadSafeMainLoopSource::scheduleAfterDelay):
        * wtf/glib/GThreadSafeMainLoopSource.h:

2015-08-18  Eric Carlson  <eric.carlson@apple.com>

        Remove "platform text track menu"
        https://bugs.webkit.org/show_bug.cgi?id=148139

        Reviewed by Jer Noble.

        * wtf/Platform.h: Remove PLATFORM_TEXT_TRACK_MENU.

2015-08-18  Filip Pizlo  <fpizlo@apple.com>

        WTF::Condition should have a fast path for notifyOne/notifyAll that avoids calling unparkOne/unparkAll
        https://bugs.webkit.org/show_bug.cgi?id=148090

        Reviewed by Geoffrey Garen.

        This change makes notifyOne()/notifyAll() blazing fast when nobody is waiting, by using the
        various hooks that ParkingLot gives us to maintain a m_hasWaiters variable. When it's false, it
        means that any unpark operation would simply return immediately.

        This is a 45% speed-up for the 1-producer/1-consumer scenario with a 100-element queue when you
        use the notifyOne()-per-enqueue style. What's cool about this change is that you can now safely
        call notifyOne() (or notifyAll()) out of paranoia, just in case someone might be waiting. It's
        free to do so if nobody is waiting!

        * wtf/Condition.h:
        (WTF::Condition::Condition):
        (WTF::Condition::waitUntil):
        (WTF::Condition::notifyOne):
        (WTF::Condition::notifyAll):

2015-08-17  Filip Pizlo  <fpizlo@apple.com>

        Replace all remaining uses of WTF::Mutex with WTF::Lock
        https://bugs.webkit.org/show_bug.cgi?id=148089

        Reviewed by Geoffrey Garen.

        This also beefs up and rationalizes the Condition API, so that it can deal with units of time
        other than just steady_clock. This makes it easier to port ThreadCondition and
        std::condition_variable code over to Condition. This patch does not take a position on what
        kind of time is best; from reading a lot of the uses in WebCore, it seems like our use of
        double to measure seconds is often nicer than the many different classes in std::chrono.

        Also added a Condition speed test, to make sure that all of this is a good idea. And indeed it
        is. The 1-producer/1-consumer scenario with a 100-element queue runs 36x faster using
        Lock/Condition than Mutex/ThreadCondition when you use the notifyOne()-per-enqueue style. It
        runs 58x faster with Lock/Condition when you use the notifyAll()-at-boundary style. Note that
        I have a bug open for making the notifyOne()-per-enqueue style even faster:
        https://bugs.webkit.org/show_bug.cgi?id=148090. Also, the 10-consumer/10-producer scenario with
        a 100-element queue runs 20x faster with Lock/Condition for notifyOne()-per-enqueue and 30x
        faster with notifyAll()-at-boundary. The only way to tweak the test to get
        Mutex/ThreadCondition to win is to have one producer, one consumer, a 1-element queue, and use
        the notifyOne()-per-enqueue style. In that case, one of the two threads is going to be waiting
        most of the time and the test basically measures wake-up latency and nothing else. Because
        Condition::wait() does a little bit more work than ThreadCondition::wait(),
        Mutex/ThreadCondition end up running 3% faster in this test case. But if you vary any of the
        parameters of the test, Mutex/ThreadCondition ends up losing - all it takes is more threads or
        a queue size of 5 or more. To my knowledge, we never do producer/consumer with a queue bounded
        to one element precisely because that approach is the least efficient regardless of locking
        algorithm. For example, neither WTF::MessageQueue nor DFG::Worklist have any bounds on their
        queue size. So, it seems that replacing all uses of system mutexes and condition variables with
        our own thing is a great idea.

        * benchmarks/LockSpeedTest.cpp:
        * benchmarks/ConditionSpeedTest.cpp: Added.
        * wtf/Condition.h:
        (WTF::Condition::Condition):
        (WTF::Condition::waitUntil):
        (WTF::Condition::waitFor):
        (WTF::Condition::wait):
        (WTF::Condition::waitUntilWallClockSeconds):
        (WTF::Condition::waitUntilMonotonicClockSeconds):
        (WTF::Condition::notifyOne):
        (WTF::Condition::notifyAll):
        (WTF::Condition::waitForSecondsImpl):
        (WTF::Condition::waitForImpl):
        (WTF::Condition::absoluteFromRelative):
        * wtf/MessageQueue.h:
        (WTF::MessageQueue::infiniteTime):
        (WTF::MessageQueue<DataType>::append):
        (WTF::MessageQueue<DataType>::appendAndKill):
        (WTF::MessageQueue<DataType>::appendAndCheckEmpty):
        (WTF::MessageQueue<DataType>::prepend):
        (WTF::MessageQueue<DataType>::removeIf):
        (WTF::MessageQueue<DataType>::isEmpty):
        (WTF::MessageQueue<DataType>::kill):
        (WTF::MessageQueue<DataType>::killed):
        * wtf/ParallelJobsGeneric.cpp:
        (WTF::ParallelEnvironment::ThreadPrivate::execute):
        (WTF::ParallelEnvironment::ThreadPrivate::waitForFinish):
        (WTF::ParallelEnvironment::ThreadPrivate::workerThread):
        * wtf/ParallelJobsGeneric.h:
        * wtf/ParkingLot.cpp:
        (WTF::ParkingLot::parkConditionally):
        * wtf/ParkingLot.h:
        (WTF::ParkingLot::compareAndPark):
        * wtf/ThreadingPthreads.cpp:
        (WTF::initializeThreading):
        * wtf/ThreadingWin.cpp:
        (WTF::initializeThreading):
        * wtf/dtoa.cpp:
        (WTF::pow5mult):
        * wtf/dtoa.h:

2015-08-17  Alex Christensen  <achristensen@webkit.org>

        Build Debug Suffix on Windows with CMake
        https://bugs.webkit.org/show_bug.cgi?id=148083

        Reviewed by Brent Fulgham.

        * wtf/PlatformWin.cmake:
        Add DEBUG_SUFFIX

2015-08-17  Myles C. Maxfield  <mmaxfield@apple.com>

        Implement IntegerHasher
        https://bugs.webkit.org/show_bug.cgi?id=147866

        Reviewed by Darin Adler and Anders Carlsson.

        Rename StringHasher.h to Hasher.h, and include an IntegerHasher class.

        * WTF.vcxproj/WTF.vcxproj: Update to target new file.
        * WTF.vcxproj/WTF.vcxproj.filters: Ditto.
        * WTF.xcodeproj/project.pbxproj: Ditto.
        * wtf/CMakeLists.txt: Ditto.
        * wtf/Hasher.h: Renamed from Source/WTF/wtf/StringHasher.h.
        * wtf/text/CString.cpp: Use new #include
        * wtf/text/StringHash.h: Ditto.
        * wtf/text/StringImpl.h: Ditto.
        * wtf/unicode/UTF8.cpp: Ditto.

2015-08-17  Alex Christensen  <achristensen@webkit.org>

        Move some commands from ./CMakeLists.txt to Source/cmake
        https://bugs.webkit.org/show_bug.cgi?id=148003

        Reviewed by Brent Fulgham.

        * CMakeLists.txt:
        Added commands needed to build WTF by itself.

2015-08-14  Filip Pizlo  <fpizlo@apple.com>

        Use WTF::Lock and WTF::Condition instead of WTF::Mutex, WTF::ThreadCondition, std::mutex, and std::condition_variable
        https://bugs.webkit.org/show_bug.cgi?id=147999

        Reviewed by Geoffrey Garen.

        Relanding after fixing a deadlock on Linux.

        * wtf/Condition.h: "using WTF::Condition".
        * wtf/Lock.h:
        (WTF::LockBase::lock):
        (WTF::LockBase::tryLock): Add tryLock() because it turns out that we use it sometimes.
        (WTF::LockBase::try_lock): unique_lock needs this.
        (WTF::LockBase::unlock):
        * wtf/ParkingLot.cpp:
        (WTF::ParkingLot::parkConditionally): Work around a Linux C++ bug where wait_until with time_point::max() immediately returns and doesn't flash the lock.

2015-08-14  Keith Miller  <keith_miller@apple.com>

        cryptographicallyRandomValuesFromOS should use arc4random_buf on Darwin.
        https://bugs.webkit.org/show_bug.cgi?id=148038

        Reviewed by Geoffrey Garen.

        Currently, we open a file descriptor to /dev/urandom, which can sometimes
        fail to open. Using arc4random_buf instead should get around this issue.

        * wtf/OSRandomSource.cpp:
        (WTF::cryptographicallyRandomValuesFromOS):

2015-08-14  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r188444.
        https://bugs.webkit.org/show_bug.cgi?id=148029

        Broke GTK and EFL (see bug #148027) (Requested by philn on
        #webkit).

        Reverted changeset:

        "Use WTF::Lock and WTF::Condition instead of WTF::Mutex,
        WTF::ThreadCondition, std::mutex, and std::condition_variable"
        https://bugs.webkit.org/show_bug.cgi?id=147999
        http://trac.webkit.org/changeset/188444

2015-08-13  Filip Pizlo  <fpizlo@apple.com>

        Use WTF::Lock and WTF::Condition instead of WTF::Mutex, WTF::ThreadCondition, std::mutex, and std::condition_variable
        https://bugs.webkit.org/show_bug.cgi?id=147999

        Reviewed by Geoffrey Garen.

        * wtf/Condition.h: "using WTF::Condition".
        * wtf/Lock.h:
        (WTF::LockBase::lock):
        (WTF::LockBase::tryLock): Add tryLock() because it turns out that we use it sometimes.
        (WTF::LockBase::try_lock): unique_lock needs this.
        (WTF::LockBase::unlock):

2015-08-13  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r188428.
        https://bugs.webkit.org/show_bug.cgi?id=148015

        broke cmake build (Requested by alexchristensen on #webkit).

        Reverted changeset:

        "Move some commands from ./CMakeLists.txt to Source/cmake"
        https://bugs.webkit.org/show_bug.cgi?id=148003
        http://trac.webkit.org/changeset/188428

2015-08-13  Alex Christensen  <achristensen@webkit.org>

        Move some commands from ./CMakeLists.txt to Source/cmake
        https://bugs.webkit.org/show_bug.cgi?id=148003

        Reviewed by Brent Fulgham.

        * CMakeLists.txt:
        Added commands needed to build WTF by itself.

2015-08-13  Mark Lam  <mark.lam@apple.com>

        WorkQueue::dispatchAfter() on Windows fires early.
        https://bugs.webkit.org/show_bug.cgi?id=147992

        Reviewed by Brent Fulgham.

        The Windows implementation of WorkQueue::dispatchAfter() uses CreateTimerQueueTimer().
        Unfortunately, CreateTimerQueueTimer() is sloppy and can fire early.  We need to compensate
        for this slop to ensure that the specified duration does expire before the callback function
        is called.  Otherwise, the JSC watchdog (which depends on this) can fail randomly.

        * wtf/win/WorkQueueWin.cpp:
        (WTF::WorkQueue::dispatchAfter):

2015-08-13  Filip Pizlo  <fpizlo@apple.com>

        WTF should have a compact Condition object to use with Lock
        https://bugs.webkit.org/show_bug.cgi?id=147986

        Reviewed by Geoffrey Garen.

        Adds a condition variable implementation based on ParkingLot, called simply WTF::Condition.
        It can be used with WTF::Lock or actually any lock implementation. It should even work with
        WTF::SpinLock, WTF::Mutex, or std::mutex. Best of all, Condition only requires one byte.

        ParkingLot almost contained all of the functionality needed to implemenet wait/notify. We
        could have implemented Condition using a 32-bit (or even 64-bit) version that protects
        against a notify that happens just before we park. But, this changes the ParkingLot API to
        give us the ability to run some code between when ParkingLot enqueues the current thread
        and when it actually sleeps. This callback is called with no locks held, so it can call
        unlock() on any kind of lock, so long as that lock's unlock() method doesn't recurse into
        ParkingLot::parkConditionally(). That seems unlikely; unlock() is more likely to call
        ParkingLot::unparkOne() or unparkAll(). WTF::Lock will never call parkConditionally()
        inside unlock(), so WTF::Lock is definitely appropriate for use with Condition.

        Condition supports most of the API that std::condition_variable supports. It does some
        things to try to reduce footgun potential. The preferred timeout form is waitUntil() which
        takes an absolute time from the steady_clock. The only relative timeout form also takes a
        predicate callback, so it's impossible to write the subtly incorrect
        "while (...) wait_for(...)" idiom.

        This patch doesn't actually introduce any uses of WTF::Condition other than the unit tests.
        I'll start switching code over to using WTF::Condition in another patch.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Condition.h: Added.
        (WTF::Condition::Condition):
        (WTF::Condition::waitUntil):
        (WTF::Condition::waitFor):
        (WTF::Condition::wait):
        (WTF::Condition::notifyOne):
        (WTF::Condition::notifyAll):
        * wtf/Lock.cpp:
        (WTF::LockBase::unlockSlow): Make this useful assertion be a release assertion. It catches cases where you unlock the lock even though you don't hold it.
        * wtf/ParkingLot.cpp:
        (WTF::ParkingLot::parkConditionally): Add the beforeSleep() callback.
        (WTF::ParkingLot::unparkOne):
        * wtf/ParkingLot.h:
        (WTF::ParkingLot::compareAndPark):

2015-08-12  Anders Carlsson  <andersca@apple.com>

        Use WTF::Optional in WindowFeatures
        https://bugs.webkit.org/show_bug.cgi?id=147956

        Reviewed by Sam Weinig.

        Add new operators to WTF::Optional to make it more like std::optional.

        * wtf/Optional.h:
        (WTF::Optional::operator->):
        (WTF::Optional::operator*):

2015-08-12  Filip Pizlo  <fpizlo@apple.com>

        WTF::Lock should not suffer from the thundering herd
        https://bugs.webkit.org/show_bug.cgi?id=147947

        Reviewed by Geoffrey Garen.

        This changes Lock::unlockSlow() to use unparkOne() instead of unparkAll(). The problem with
        doing this is that it's not obvious after calling unparkOne() if there are any other threads
        that are still parked on the lock's queue. If we assume that there are and leave the
        hasParkedBit set, then future calls to unlock() will take the slow path. We don't want that
        if there aren't actually any threads parked. On the other hand, if we assume that there
        aren't any threads parked and clear the hasParkedBit, then if there actually were some
        threads parked, then they may never be awoken since future calls to unlock() won't take slow
        path and so won't call unparkOne(). In other words, we need a way to be very precise about
        when we clear the hasParkedBit and we need to do it in a race-free way: it can't be the case
        that we clear the bit just as some thread gets parked on the queue.

        A similar problem arises in futexes, and one of the solutions is to have a thread that
        acquires a lock after parking sets the hasParkedBit. This is what Rusty Russel's usersem
        does. It's a subtle algorithm. Also, it means that if a thread barges in before the unparked
        thread runs, then that barging thread will not know that there are threads parked. This
        could increase the severity of barging.

        Since ParkingLot is a user-level API, we don't have to worry about the kernel-user security
        issues and so we can expose callbacks while ParkingLot is holding its internal locks. This
        change does exactly that for unparkOne(). The new variant of unparkOne() will call a user
        function while the queue from which we are unparking is locked. The callback is told basic
        stats about the queue: did we unpark a thread this time, and could there be more threads to
        unpark in the future. The callback runs while it's impossible for the queue state to change,
        since the ParkingLot's internal locks for the queue is held. This means that
        Lock::unlockSlow() can either clear, or leave, the hasParkedBit while releasing the lock
        inside the callback from unparkOne(). This takes care of the thundering herd problem while
        also reducing the greed that arises from barging threads.

        This required some careful reworking of the ParkingLot algorithm. The first thing I noticed
        was that the ThreadData::shouldPark flag was useless, since it's set exactly when
        ThreadData::address is non-null. Then I had to make sure that dequeue() could lazily create
        both hashtables and buckets, since the "callback is called while queue is locked" invariant
        requires that we didn't exit early due to the hashtable or bucket not being present. Note
        that all of this is done in such a way that the old unparkOne() and unparkAll() don't have
        to create any buckets, though they now may create the hashtable. We don't care as much about
        the hashtable being created by unpark since it's just such an unlikely scenario and it would
        only happen once.

        This change reduces the kernel CPU usage of WTF::Lock for the long critical section test by
        about 8x and makes it always perform as well as WTF::WordLock and WTF::Mutex for that
        benchmark.

        * benchmarks/LockSpeedTest.cpp:
        * wtf/Lock.cpp:
        (WTF::LockBase::unlockSlow):
        * wtf/Lock.h:
        (WTF::LockBase::isLocked):
        (WTF::LockBase::isFullyReset):
        * wtf/ParkingLot.cpp:
        (WTF::ParkingLot::parkConditionally):
        (WTF::ParkingLot::unparkOne):
        (WTF::ParkingLot::unparkAll):
        * wtf/ParkingLot.h:
        * wtf/WordLock.h:
        (WTF::WordLock::isLocked):
        (WTF::WordLock::isFullyReset):

2015-08-11  Filip Pizlo  <fpizlo@apple.com>

        Always use a byte-sized lock implementation
        https://bugs.webkit.org/show_bug.cgi?id=147908

        Reviewed by Geoffrey Garen.

        At the start of my locking algorithm crusade, I implemented Lock, which is a sizeof(void*)
        lock implementation with some nice theoretical properties and good performance. Then I added
        the ParkingLot abstraction and ByteLock. ParkingLot uses Lock in its implementation.
        ByteLock uses ParkingLot to create a sizeof(char) lock implementation that performs like
        Lock.

        It turns out that ByteLock is always at least as good as Lock, and sometimes a lot better:
        it requires 8x less memory on 64-bit systems. It's hard to construct a benchmark where
        ByteLock is significantly slower than Lock, and when you do construct such a benchmark,
        tweaking it a bit can also create a scenario where ByteLock is significantly faster than
        Lock.

        So, the thing that we call "Lock" should really use ByteLock's algorithm, since it is more
        compact and just as fast. That's what this patch does.

        But we still need to keep the old Lock algorithm, because it's used to implement ParkingLot,
        which in turn is used to implement ByteLock. So this patch does this transformation:

        - Move the algorithm in Lock into files called WordLock.h|cpp. Make ParkingLot use
          WordLock.

        - Move the algorithm in ByteLock into Lock.h|cpp. Make everyone who used ByteLock use Lock
          instead. All other users of Lock now get the byte-sized lock implementation.

        - Remove the old ByteLock files.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.xcodeproj/project.pbxproj:
        * benchmarks/LockSpeedTest.cpp:
        (main):
        * wtf/WordLock.cpp: Added.
        (WTF::WordLock::lockSlow):
        (WTF::WordLock::unlockSlow):
        * wtf/WordLock.h: Added.
        (WTF::WordLock::WordLock):
        (WTF::WordLock::lock):
        (WTF::WordLock::unlock):
        (WTF::WordLock::isHeld):
        (WTF::WordLock::isLocked):
        * wtf/ByteLock.cpp: Removed.
        * wtf/ByteLock.h: Removed.
        * wtf/CMakeLists.txt:
        * wtf/Lock.cpp:
        (WTF::LockBase::lockSlow):
        (WTF::LockBase::unlockSlow):
        * wtf/Lock.h:
        (WTF::LockBase::lock):
        (WTF::LockBase::unlock):
        (WTF::LockBase::isHeld):
        (WTF::LockBase::isLocked):
        (WTF::Lock::Lock):
        * wtf/ParkingLot.cpp:

2015-08-11  Filip Pizlo  <fpizlo@apple.com>

        Remove ByteSpinLock
        https://bugs.webkit.org/show_bug.cgi?id=147900

        Rubber stamped by Mark Lam.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/ByteSpinLock.h: Removed.

2015-08-11  Brent Fulgham  <bfulgham@apple.com>

        [Win] Switch Windows build to Visual Studio 2015
        https://bugs.webkit.org/show_bug.cgi?id=147887
        <rdar://problem/22235098>

        Reviewed by Alex Christensen.

        Update Visual Studio project file settings to use the current Visual
        Studio and compiler. Continue targeting binaries to run on our minimum
        supported configuration of Windows 7.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTFGenerated.vcxproj:

2015-08-10  Filip Pizlo  <fpizlo@apple.com>

        WTF should have a ParkingLot for parking sleeping threads, so that locks can fit in 1.6 bits
        https://bugs.webkit.org/show_bug.cgi?id=147665

        Reviewed by Mark Lam.

        This change adds a major new abstraction for concurrency algorithms in WebKit. It's called a
        ParkingLot, and it makes available a thread parking queue for each virtual address in memory.
        The queues are maintained by a data-access-parallel concurrent hashtable implementation. The
        memory usage is bounded at around half a KB per thread.

        The ParkingLot makes it easy to turn any spinlock-based concurrency protocol into one that
        parks threads after a while. Because queue state management is up to the ParkingLot and not
        the user's data structure, this patch uses it to implement a full adaptive mutex in one byte.
        In fact, only three states of that byte are used (0 = available, 1 = locked, 2 = locked and
        there are parked threads). Hence the joke that ParkingLot allows locks that fit in 1.6 bits.

        ByteLock is used as a replacement for ByteSpinLock in JavaScriptCore.

        The API tests for this also demo how to create a completely fair (FIFO) binary semamphore. The
        comment in Lock.h shows how we could accelerate Lock performance using ParkingLot. After we
        are sure that this code works, we can expand the use of ParkingLot. That's covered by
        https://bugs.webkit.org/show_bug.cgi?id=147841.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.xcodeproj/project.pbxproj:
        * benchmarks/LockSpeedTest.cpp:
        (main):
        * wtf/Atomics.h:
        (WTF::Atomic::compareExchangeWeak):
        (WTF::Atomic::compareExchangeStrong):
        * wtf/ByteLock.cpp: Added.
        (WTF::ByteLock::lockSlow):
        (WTF::ByteLock::unlockSlow):
        * wtf/ByteLock.h: Added.
        (WTF::ByteLock::ByteLock):
        (WTF::ByteLock::lock):
        (WTF::ByteLock::unlock):
        (WTF::ByteLock::isHeld):
        (WTF::ByteLock::isLocked):
        * wtf/CMakeLists.txt:
        * wtf/Lock.h:
        * wtf/ParkingLot.cpp: Added.
        (WTF::ParkingLot::parkConditionally):
        (WTF::ParkingLot::unparkOne):
        (WTF::ParkingLot::unparkAll):
        (WTF::ParkingLot::forEach):
        * wtf/ParkingLot.h: Added.
        (WTF::ParkingLot::compareAndPark):

2015-08-11  Brent Fulgham  <bfulgham@apple.com>

        [Win] Unreviewed gardening.

        * WTF.vcxproj/WTF.vcxproj.filters: Place file references so that files appear in correct
        folders in IDE.

2015-08-10  Youenn Fablet  <youenn.fablet@crf.canon.fr>

        Compile warning (-Wsign-compare) on 32-bits at WebCore/platform/FileSystem.cpp
        https://bugs.webkit.org/show_bug.cgi?id=146414

        Reviewed by Darin Adler.

        Added convertSafely routine based on isInBounds routine.
        Updated BoundChecker by adding a third boolean parameter to this template giving whether Target has greater or equal precision than Source.
        Removed BoundCheckElider, which is no longer necessary and had some issues.

        * wtf/CheckedArithmetic.h:
        (WTF::isInBounds):
        (WTF::convertSafely):

2015-08-07  Filip Pizlo  <fpizlo@apple.com>

        Lightweight locks should be adaptive
        https://bugs.webkit.org/show_bug.cgi?id=147545

        Reviewed by Geoffrey Garen.

        A common idiom in WebKit is to use spinlocks. We use them because the lock acquisition
        overhead is lower than system locks and because they take dramatically less space than system
        locks. The speed and space advantages of spinlocks can be astonishing: an uncontended spinlock
        acquire is up to 10x faster and under microcontention - short critical section with two or
        more threads taking turns - spinlocks are up to 100x faster. Spinlocks take only 1 byte or 4
        bytes depending on the flavor, while system locks take 64 bytes or more. Clearly, WebKit
        should continue to avoid system locks - they are just far too slow and far too big.

        But there is a problem with this idiom. System lock implementations will sleep a thread when
        it attempts to acquire a lock that is held, while spinlocks will cause the thread to burn CPU.
        In WebKit spinlocks, the thread will repeatedly call sched_yield(). This is awesome for
        microcontention, but awful when the lock will not be released for a while. In fact, when
        critical sections take tens of microseconds or more, the CPU time cost of our spinlocks is
        almost 100x more than the CPU time cost of a system lock. This case doesn't arise too
        frequently in our current uses of spinlocks, but that's probably because right now there are
        places where we make a conscious decision to use system locks - even though they use more
        memory and are slower - because we don't want to waste CPU cycles when a thread has to wait a
        while to acquire the lock.

        The solution is to just implement a modern adaptive mutex in WTF. Luckily, this isn't a new
        concept. This patch implements a mutex that is reminiscent of the kinds of low-overhead locks
        that JVMs use. The actual implementation here is inspired by some of the ideas from [1]. The
        idea is simple: the fast path is an inlined CAS to immediately acquire a lock that isn't held,
        the slow path tries some number of spins to acquire the lock, and if that fails, the thread is
        put on a queue and put to sleep. The queue is made up of statically allocated thread nodes and
        the lock itself is a tagged pointer: either it is just bits telling us the complete lock state
        (not held or held) or it is a pointer to the head of a queue of threads waiting to acquire the
        lock. This approach gives WTF::Lock three different levels of adaptation: an inlined fast path
        if the lock is not contended, a short burst of spinning for microcontention, and a full-blown
        queue for critical sections that are held for a long time.

        On a locking microbenchmark, this new Lock exhibits the following performance
        characteristics:

        - Lock+unlock on an uncontended no-op critical section: 2x slower than SpinLock and 3x faster
          than a system mutex.

        - Lock+unlock on a contended no-op critical section: 2x slower than SpinLock and 100x faster
          than a system mutex.

        - CPU time spent in lock() on a lock held for a while: same as system mutex, 90x less than a
          SpinLock.

        - Memory usage: sizeof(void*), so on 64-bit it's 8x less than a system mutex but 2x worse than
          a SpinLock.

        This patch replaces all uses of SpinLock with Lock, since our critical sections are not
        no-ops so if you do basically anything in your critical section, the Lock overhead will be
        invisible. Also, in all places where we used SpinLock, we could tolerate 8 bytes of overhead
        instead of 4. Performance benchmarking using JSC macrobenchmarks shows no difference, which is
        as it should be: the purpose of this change is to reduce CPU time wasted, not wallclock time.
        This patch doesn't replace any uses of ByteSpinLock, since we expect that the space benefits
        of having a lock that just uses a byte are still better than the CPU wastage benefits of
        Lock. But, this work will enable some future work to create locks that will fit in just 1.6
        bits: https://bugs.webkit.org/show_bug.cgi?id=147665.
        
        Rolling this back in after fixing Lock::unlockSlow() for architectures that have a truly weak
        CAS. Since the Lock::unlock() fast path can go to slow path spuriously, it may go there even if
        there aren't any threads on the Lock's queue. So, unlockSlow() must be able to deal with the
        possibility of a null queue head.

        [1] http://www.filpizlo.com/papers/pizlo-pppj2011-fable.pdf

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.xcodeproj/project.pbxproj:
        * benchmarks: Added.
        * benchmarks/LockSpeedTest.cpp: Added.
        (main):
        * wtf/Atomics.h:
        (WTF::Atomic::compareExchangeWeak):
        (WTF::Atomic::compareExchangeStrong):
        * wtf/CMakeLists.txt:
        * wtf/Lock.cpp: Added.
        (WTF::LockBase::lockSlow):
        (WTF::LockBase::unlockSlow):
        * wtf/Lock.h: Added.
        (WTF::LockBase::lock):
        (WTF::LockBase::unlock):
        (WTF::LockBase::isHeld):
        (WTF::LockBase::isLocked):
        (WTF::Lock::Lock):
        * wtf/MetaAllocator.cpp:
        (WTF::MetaAllocator::release):
        (WTF::MetaAllocatorHandle::shrink):
        (WTF::MetaAllocator::allocate):
        (WTF::MetaAllocator::currentStatistics):
        (WTF::MetaAllocator::addFreshFreeSpace):
        (WTF::MetaAllocator::debugFreeSpaceSize):
        * wtf/MetaAllocator.h:
        * wtf/SpinLock.h:
        * wtf/ThreadingPthreads.cpp:
        * wtf/ThreadingWin.cpp:
        * wtf/text/AtomicString.cpp:
        * wtf/text/AtomicStringImpl.cpp:
        (WTF::AtomicStringTableLocker::AtomicStringTableLocker):

2015-08-05  Filip Pizlo  <fpizlo@apple.com>

        Unreviewed, roll out http://trac.webkit.org/changeset/187972.

        * wtf/Atomics.cpp:
        (WTF::getSwapLock):
        (WTF::atomicStep):
        * wtf/MessageQueue.h:
        (WTF::MessageQueue::infiniteTime):
        (WTF::MessageQueue<DataType>::append):
        (WTF::MessageQueue<DataType>::appendAndKill):
        (WTF::MessageQueue<DataType>::appendAndCheckEmpty):
        (WTF::MessageQueue<DataType>::prepend):
        (WTF::MessageQueue<DataType>::removeIf):
        (WTF::MessageQueue<DataType>::isEmpty):
        (WTF::MessageQueue<DataType>::kill):
        (WTF::MessageQueue<DataType>::killed):
        * wtf/ParallelJobsGeneric.cpp:
        (WTF::ParallelEnvironment::ThreadPrivate::execute):
        (WTF::ParallelEnvironment::ThreadPrivate::waitForFinish):
        (WTF::ParallelEnvironment::ThreadPrivate::workerThread):
        * wtf/ParallelJobsGeneric.h:
        * wtf/RunLoop.cpp:
        (WTF::RunLoop::performWork):
        (WTF::RunLoop::dispatch):
        * wtf/RunLoop.h:
        * wtf/ThreadSpecificWin.cpp:
        (WTF::destructorsList):
        (WTF::destructorsMutex):
        (WTF::threadSpecificKeyCreate):
        (WTF::threadSpecificKeyDelete):
        (WTF::ThreadSpecificThreadExit):
        * wtf/Threading.cpp:
        (WTF::threadEntryPoint):
        (WTF::createThread):
        * wtf/ThreadingPrimitives.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::threadMapMutex):
        (WTF::initializeThreading):
        (WTF::identifierByPthreadHandle):
        (WTF::establishIdentifierForPthreadHandle):
        (WTF::changeThreadPriority):
        (WTF::waitForThreadCompletion):
        (WTF::detachThread):
        (WTF::threadDidExit):
        (WTF::currentThread):
        (WTF::Mutex::Mutex):
        (WTF::Mutex::~Mutex):
        (WTF::Mutex::lock):
        (WTF::Mutex::tryLock):
        (WTF::Mutex::unlock):
        (WTF::ThreadCondition::~ThreadCondition):
        (WTF::ThreadCondition::wait):
        (WTF::ThreadCondition::timedWait):
        (WTF::DeprecatedMutex::DeprecatedMutex): Deleted.
        (WTF::DeprecatedMutex::~DeprecatedMutex): Deleted.
        (WTF::DeprecatedMutex::lock): Deleted.
        (WTF::DeprecatedMutex::tryLock): Deleted.
        (WTF::DeprecatedMutex::unlock): Deleted.
        * wtf/ThreadingWin.cpp:
        (WTF::initializeCurrentThreadInternal):
        (WTF::threadMapMutex):
        (WTF::initializeThreading):
        (WTF::storeThreadHandleByIdentifier):
        (WTF::threadHandleForIdentifier):
        (WTF::clearThreadHandleForIdentifier):
        (WTF::currentThread):
        (WTF::Mutex::Mutex):
        (WTF::Mutex::~Mutex):
        (WTF::Mutex::lock):
        (WTF::Mutex::tryLock):
        (WTF::Mutex::unlock):
        (WTF::ThreadCondition::~ThreadCondition):
        (WTF::ThreadCondition::wait):
        (WTF::ThreadCondition::timedWait):
        (WTF::DeprecatedMutex::DeprecatedMutex): Deleted.
        (WTF::DeprecatedMutex::~DeprecatedMutex): Deleted.
        (WTF::DeprecatedMutex::lock): Deleted.
        (WTF::DeprecatedMutex::tryLock): Deleted.
        (WTF::DeprecatedMutex::unlock): Deleted.
        * wtf/WorkQueue.h:
        * wtf/dtoa.cpp:
        * wtf/dtoa.h:
        * wtf/efl/DispatchQueueEfl.cpp:
        (DispatchQueue::dispatch):
        (DispatchQueue::performWork):
        (DispatchQueue::performTimerWork):
        (DispatchQueue::insertTimerWorkItem):
        (DispatchQueue::wakeUpThread):
        (DispatchQueue::getNextTimeOut):
        * wtf/efl/DispatchQueueEfl.h:
        * wtf/efl/RunLoopEfl.cpp:
        (WTF::RunLoop::wakeUpEvent):
        (WTF::RunLoop::wakeUp):
        * wtf/threads/BinarySemaphore.cpp:
        (WTF::BinarySemaphore::signal):
        (WTF::BinarySemaphore::wait):
        * wtf/threads/BinarySemaphore.h:
        * wtf/win/WorkQueueWin.cpp:
        (WTF::WorkQueue::handleCallback):
        (WTF::WorkQueue::platformInvalidate):
        (WTF::WorkQueue::dispatch):
        (WTF::WorkQueue::timerCallback):
        (WTF::WorkQueue::dispatchAfter):

2015-08-05  Filip Pizlo  <fpizlo@apple.com>

        Unreviewed, fix Windows.

        * wtf/ThreadSpecificWin.cpp:
        (WTF::destructorsList):
        (WTF::destructorsMutex):
        (WTF::threadSpecificKeyCreate):
        (WTF::threadSpecificKeyDelete):
        (WTF::ThreadSpecificThreadExit):

2015-08-04  Filip Pizlo  <fpizlo@apple.com>

        Rename Mutex to DeprecatedMutex
        https://bugs.webkit.org/show_bug.cgi?id=147675

        Reviewed by Geoffrey Garen.

        * wtf/Atomics.cpp:
        (WTF::getSwapLock):
        (WTF::atomicStep):
        * wtf/MessageQueue.h:
        (WTF::MessageQueue::infiniteTime):
        (WTF::MessageQueue<DataType>::append):
        (WTF::MessageQueue<DataType>::appendAndKill):
        (WTF::MessageQueue<DataType>::appendAndCheckEmpty):
        (WTF::MessageQueue<DataType>::prepend):
        (WTF::MessageQueue<DataType>::removeIf):
        (WTF::MessageQueue<DataType>::isEmpty):
        (WTF::MessageQueue<DataType>::kill):
        (WTF::MessageQueue<DataType>::killed):
        * wtf/ParallelJobsGeneric.cpp:
        (WTF::ParallelEnvironment::ThreadPrivate::execute):
        (WTF::ParallelEnvironment::ThreadPrivate::waitForFinish):
        (WTF::ParallelEnvironment::ThreadPrivate::workerThread):
        * wtf/ParallelJobsGeneric.h:
        * wtf/RunLoop.cpp:
        (WTF::RunLoop::performWork):
        (WTF::RunLoop::dispatch):
        * wtf/RunLoop.h:
        * wtf/Threading.cpp:
        (WTF::threadEntryPoint):
        (WTF::createThread):
        * wtf/ThreadingPrimitives.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::threadMapMutex):
        (WTF::initializeThreading):
        (WTF::identifierByPthreadHandle):
        (WTF::establishIdentifierForPthreadHandle):
        (WTF::changeThreadPriority):
        (WTF::waitForThreadCompletion):
        (WTF::detachThread):
        (WTF::threadDidExit):
        (WTF::currentThread):
        (WTF::DeprecatedMutex::DeprecatedMutex):
        (WTF::DeprecatedMutex::~DeprecatedMutex):
        (WTF::DeprecatedMutex::lock):
        (WTF::DeprecatedMutex::tryLock):
        (WTF::DeprecatedMutex::unlock):
        (WTF::ThreadCondition::~ThreadCondition):
        (WTF::ThreadCondition::wait):
        (WTF::ThreadCondition::timedWait):
        (WTF::Mutex::Mutex): Deleted.
        (WTF::Mutex::~Mutex): Deleted.
        (WTF::Mutex::lock): Deleted.
        (WTF::Mutex::tryLock): Deleted.
        (WTF::Mutex::unlock): Deleted.
        * wtf/ThreadingWin.cpp:
        (WTF::initializeCurrentThreadInternal):
        (WTF::threadMapMutex):
        (WTF::initializeThreading):
        (WTF::storeThreadHandleByIdentifier):
        (WTF::threadHandleForIdentifier):
        (WTF::clearThreadHandleForIdentifier):
        (WTF::currentThread):
        (WTF::DeprecatedMutex::DeprecatedMutex):
        (WTF::DeprecatedMutex::~DeprecatedMutex):
        (WTF::DeprecatedMutex::lock):
        (WTF::DeprecatedMutex::tryLock):
        (WTF::DeprecatedMutex::unlock):
        (WTF::ThreadCondition::~ThreadCondition):
        (WTF::ThreadCondition::wait):
        (WTF::ThreadCondition::timedWait):
        (WTF::Mutex::Mutex): Deleted.
        (WTF::Mutex::~Mutex): Deleted.
        (WTF::Mutex::lock): Deleted.
        (WTF::Mutex::tryLock): Deleted.
        (WTF::Mutex::unlock): Deleted.
        * wtf/WorkQueue.h:
        * wtf/dtoa.cpp:
        * wtf/dtoa.h:
        * wtf/efl/DispatchQueueEfl.cpp:
        (DispatchQueue::dispatch):
        (DispatchQueue::performWork):
        (DispatchQueue::performTimerWork):
        (DispatchQueue::insertTimerWorkItem):
        (DispatchQueue::wakeUpThread):
        (DispatchQueue::getNextTimeOut):
        * wtf/efl/DispatchQueueEfl.h:
        * wtf/efl/RunLoopEfl.cpp:
        (WTF::RunLoop::wakeUpEvent):
        (WTF::RunLoop::wakeUp):
        * wtf/threads/BinarySemaphore.cpp:
        (WTF::BinarySemaphore::signal):
        (WTF::BinarySemaphore::wait):
        * wtf/threads/BinarySemaphore.h:
        * wtf/win/WorkQueueWin.cpp:
        (WTF::WorkQueue::handleCallback):
        (WTF::WorkQueue::platformInvalidate):
        (WTF::WorkQueue::dispatch):
        (WTF::WorkQueue::timerCallback):
        (WTF::WorkQueue::dispatchAfter):

2015-08-04  Alex Christensen  <achristensen@webkit.org>

        Fix quirks with CMake and VS2015
        https://bugs.webkit.org/show_bug.cgi?id=147663

        Reviewed by Brent Fulgham.

        * wtf/Platform.h:
        Build fix after r187908

2015-08-04  Brent Fulgham  <bfulgham@apple.com>

        [Win] Update Apple Windows build for VS2015
        https://bugs.webkit.org/show_bug.cgi?id=147653

        Reviewed by Dean Jackson.

        * WTF.vcxproj/WTF.vcxproj.filters: Drive-by-fix to place files in
        proper project locations in the IDE.
        * wtf/Platform.h: Don't define the _HAS_EXCEPTIONS macro when building with
        Visual Studio 2015.

2015-08-04  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r187815 and r187817.
        https://bugs.webkit.org/show_bug.cgi?id=147644

        Caused lots of Windows crashes (Requested by smfr on #webkit).

        Reverted changesets:

        "[WTF] Turn tryMakeString(), makeString() into variadic
        templates"
        https://bugs.webkit.org/show_bug.cgi?id=147142
        http://trac.webkit.org/changeset/187815

        "Unreviewed build fix."
        http://trac.webkit.org/changeset/187817

2015-08-04  Alex Christensen  <achristensen@webkit.org>

        Enable WebGL on Windows CMake build.
        https://bugs.webkit.org/show_bug.cgi?id=143311

        Reviewed by Csaba Osztrogonác.

        * wtf/FeatureDefines.h:
        Made the CMake feature defines the same as the non-CMake feature defines.

2015-08-03  Csaba Osztrogonác  <ossy@webkit.org>

        Introduce COMPILER(GCC_OR_CLANG) guard and make COMPILER(GCC) true only for GCC
        https://bugs.webkit.org/show_bug.cgi?id=146833

        Reviewed by Alexey Proskuryakov.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h: Removed redundant COMPILER(CLANG) guard.
        * wtf/Atomics.cpp:
        * wtf/Atomics.h:
        (WTF::weakCompareAndSwap):
        (WTF::compilerFence):
        * wtf/Compiler.h:
         - Renamed COMPILER(GCC) to COMPILER(GCC_OR_CLANG), because it is true for both compiler.
         - Added COMPILER(GCC) which is true only for GCC.
         - Moved all GCC related stuff to one block and removed redundant guards accordingly.
         - Removed the unused default false definition of GCC_VERSION_AT_LEAST for non GCC compilers.
        * wtf/ExportMacros.h:
        * wtf/FastMalloc.h:
        * wtf/Platform.h:
        * wtf/StdLibExtras.h:
        * wtf/Vector.h:
        * wtf/text/ASCIIFastPath.h:
        (WTF::copyLCharsFromUCharSource):

2015-08-03  Zan Dobersek  <zdobersek@igalia.com>

        Unreviewed build fix.

        * wtf/text/StringConcatenate.h: Include <tuple> to avoid missing
        std::tuple<> class definitions.

2015-08-03  Zan Dobersek  <zdobersek@igalia.com>

        [WTF] Turn tryMakeString(), makeString() into variadic templates
        https://bugs.webkit.org/show_bug.cgi?id=147142

        Reviewed by Sam Weinig.

        Built upon the original work by Anders Carlsson, Mark Rowe and Sam Weinig.

        Implement tryMakeString() and makeString() as variadic templates, replacing
        the argument count-based overloads.

        tryMakeString() now constructs a stack-based tuple of necessary StringTypeAdapter
        objects and utilizes the StringAdapterTuple struct template to operate on that
        tuple, recursively calling the necessary operations on each element in the tuple.
        This effectively mimics the process of previous tryMakeString() implementation,
        but makes it scalable to a tuple of elements that are to be concatenated.

        StringAppend class template now stores two StringTypeAdapter objects for the
        two passed-in string objects, packed in a tuple, calling
        StringAdapterTuple<>::createString() directly when concatenating the two objects
        into one String.

        * wtf/text/StringConcatenate.h:
        (WTF::StringTypeAdapter<char>::length):
        (WTF::StringTypeAdapter<char>::is8Bit):
        (WTF::StringAdapterTuple::sumWithOverflow):
        (WTF::StringAdapterTuple::is8Bit):
        (WTF::StringAdapterTuple::writeTo):
        (WTF::StringAdapterTuple::createString):
        (WTF::tryMakeString):
        (WTF::makeString):
        (WTF::sumWithOverflow): Deleted.
        * wtf/text/StringOperators.h:
        (WTF::StringAppend::StringAppend):
        (WTF::StringAppend::operator String):
        (WTF::StringAppend::is8Bit):
        (WTF::StringAppend::writeTo):
        (WTF::StringAppend::length):
        (WTF::StringAppend::string1):
        (WTF::StringAppend::string2):

2015-08-03  Anders Carlsson  <andersca@apple.com>

        Make it possible to use String::utf8() in the debugger
        https://bugs.webkit.org/show_bug.cgi?id=147566

        Reviewed by Tim Horton.

        Add a new utf8() overload that doesn't take any parameters and just calls utf8(LenientConversion), since lldb doesn't support evaluating
        function calls with default parameters at the moment.

        * wtf/text/WTFString.cpp:
        (WTF::String::utf8):
        * wtf/text/WTFString.h:

2015-08-02  Benjamin Poulain  <bpoulain@apple.com>

        Investigate HashTable::HashTable(const HashTable&) and HashTable::operator=(const HashTable&) performance for hash-based static analyses
        https://bugs.webkit.org/show_bug.cgi?id=118455

        Reviewed by Filip Pizlo.

        Previously, when copying a HashTable, we would start from scratch
        with an empty table and insert elements one by one, growing-rehashing
        the table as needed.

        With this patch, we have 2 improvements to remove most of the cost.

        First, we compute a good size from the start. This removes all the
        reallocations and rehashs.
        This is where the biggest gain comes from.

        The second part is a simpler version of add() when we know that
        we cannot find a bucket with the same key and there cannot
        be any deleted bucket.
        This removes most branches from the hot loop, cutting another 25%
        of the time.

        * wtf/HashTable.h:
        (WTF::KeyTraits>::addUniqueForInitialization):
        (WTF::KeyTraits>::HashTable):

2015-08-01  Myles C. Maxfield  <mmaxfield@apple.com>

        HashTraits<AtomicString> can use SimpleClassHashTraits
        https://bugs.webkit.org/show_bug.cgi?id=147528

        Reviewed by Andreas Kling.

        No point in duplicating the code inside SimpleClassHashTraits.

        * wtf/text/AtomicStringHash.h:
        (WTF::HashTraits<WTF::AtomicString>::constructDeletedValue): Deleted.
        (WTF::HashTraits<WTF::AtomicString>::isDeletedValue): Deleted.

2015-08-01  Alex Christensen  <achristensen@webkit.org>

        Fix compile errors with VS2015
        https://bugs.webkit.org/show_bug.cgi?id=147526

        Reviewed by Myles Maxfield.

        * wtf/StringExtras.h:
        (snprintf):
        (wtf_vsnprintf):
        VS2015 has an implementation of snprintf.

2015-07-31  Alex Christensen  <achristensen@webkit.org>

        Prepare for VS2015
        https://bugs.webkit.org/show_bug.cgi?id=146579

        Reviewed by Jon Honeycutt.

        * wtf/StdLibExtras.h:
        (std::exchange):
        Added preprocessor macros around functions implemented in VS2015's standard library.

2015-07-30  Chris Dumez  <cdumez@apple.com>

        Mark more classes as fast allocated
        https://bugs.webkit.org/show_bug.cgi?id=147440

        Reviewed by Sam Weinig.

        Mark more classes as fast allocated for performance. We heap-allocate
        objects of those types throughout the code base.

        * wtf/Bag.h:
        * wtf/SegmentedVector.h:
        * wtf/SentinelLinkedList.h:

2015-07-29  Basile Clement  <basile_clement@apple.com>

        Remove native call inlining
        https://bugs.webkit.org/show_bug.cgi?id=147417

        Rubber-stamped by Filip Pizlo.

        * wtf/Platform.h:

2015-07-28  Yusuke Suzuki  <utatane.tea@gmail.com>

        [ES6] Add ENABLE_ES6_MODULES compile time flag with the default value "false"
        https://bugs.webkit.org/show_bug.cgi?id=147350

        Reviewed by Sam Weinig.

        * wtf/FeatureDefines.h:

2015-07-28  Filip Pizlo  <fpizlo@apple.com>

        Unreviewed, fix Windows build.

        * wtf/MetaAllocatorHandle.h:
        (WTF::MetaAllocatorHandle::key):

2015-07-27  Filip Pizlo  <fpizlo@apple.com>

        Add logging when executable code gets deallocated
        https://bugs.webkit.org/show_bug.cgi?id=147355

        Reviewed by Mark Lam.

        * wtf/MetaAllocator.cpp:
        (WTF::MetaAllocatorHandle::dump): It's useful to be able to dump these.
        * wtf/MetaAllocatorHandle.h:

2015-07-28  Benjamin Poulain  <bpoulain@apple.com>

        Speed up StringBuilder::appendQuotedJSONString()
        https://bugs.webkit.org/show_bug.cgi?id=147352

        Reviewed by Andreas Kling.

        * wtf/text/StringBuilder.cpp:
        (WTF::appendQuotedJSONStringInternal):
        The cases '"' and '\\' are not that uncommon, and they can easily
        be handled in the original branch testing for them.

        This is about 2.5% better on the JSON.stringify test.

2015-07-27  Alex Christensen  <achristensen@webkit.org>

        Progress towards building AppleWin with CMake
        https://bugs.webkit.org/show_bug.cgi?id=147325

        Reviewed by Martin Robinson.

        * wtf/PlatformWin.cmake:
        Link with CoreFoundation.lib.

2015-07-25  Carlos Alberto Lopez Perez  <clopez@igalia.com>

        REGRESSION (bmalloc): WebKit performance tests don't report memory stats.
        https://bugs.webkit.org/show_bug.cgi?id=141247

        Reviewed by Geoffrey Garen.

        Meanwhile a better way of getting memory stats with bmalloc is not found
        (see bug 136592), we can report as memory stats the resident set size
        information that the operating system provides to us.

        This at least should be good enough to get back the memory stats on the
        performance tests and being able to track down memory usage regressions
        at https://perf.webkit.org

        * wtf/FastMalloc.cpp:
        (WTF::fastMallocStatistics): Report maxrss data as committedVMBytes.

2015-07-24  Csaba Osztrogonác  <ossy@webkit.org>

        Remove the unused GCC workaround - std::is_trivially_destructible
        https://bugs.webkit.org/show_bug.cgi?id=147226

        Reviewed by Darin Adler.

        * wtf/StdLibExtras.h:

2015-07-23  Alex Christensen  <achristensen@webkit.org>

        Remove compile and runtime flags for promises.
        https://bugs.webkit.org/show_bug.cgi?id=147244

        Reviewed by Yusuke Suzuki.

        * wtf/FeatureDefines.h:

2015-07-22  Sukolsak Sakshuwong  <sukolsak@gmail.com>

        Add ENABLE_WEBASSEMBLY feature flag for WebAssembly
        https://bugs.webkit.org/show_bug.cgi?id=147212

        Reviewed by Filip Pizlo.

        * wtf/FeatureDefines.h:

2015-07-22  Filip Pizlo  <fpizlo@apple.com>

        Introduce release assert for using threads before threading is initialized
        https://bugs.webkit.org/show_bug.cgi?id=147200

        Reviewed by Michael Saboff.
        
        This will help bugs where you use createThread() before calling initializeThreading().

        * wtf/ThreadIdentifierDataPthreads.cpp:
        (WTF::ThreadIdentifierData::initialize):

2015-07-21  Daniel Bates  <dabates@apple.com>

        WTFCrash() in WebKit::WebProcess::networkConnection()
        https://bugs.webkit.org/show_bug.cgi?id=147112
        <rdar://problem/18477459>

        Reviewed by Gavin Barraclough.

        Add explicit boolean conversion function and remove overload of operator! to support
        checking whether an activity token is valid more directly than using the overloaded operator!.

        * wtf/RefCounter.h:
        (WTF::RefCounter::Token::operator bool): Added.
        (WTF::RefCounter::Token::operator!): Deleted.

2015-07-20  Mark Lam  <mark.lam@apple.com>

        Rollout r187020 and r187021: breaks JSC API tests on debug builds.
        https://bugs.webkit.org/show_bug.cgi?id=147110

        * wtf/WTFThreadData.cpp:
        (WTF::WTFThreadData::WTFThreadData):
        * wtf/WTFThreadData.h:
        (WTF::WTFThreadData::stack):

2015-07-20  Alex Christensen  <achristensen@webkit.org>

        Resurrect CMake build on Windows.
        https://bugs.webkit.org/show_bug.cgi?id=147083

        Reviewed by Gyuyoung Kim.

        * wtf/PlatformWin.cmake:

2015-07-20  Per Arne Vollan  <peavo@outlook.com>

        JavaScriptCore performance is very bad on Windows
        https://bugs.webkit.org/show_bug.cgi?id=146448

        Reviewed by Mark Lam.

        Updating the stack bounds is time consuming.
        Only update the stack bounds when a new fiber is running.

        * wtf/WTFThreadData.cpp:
        (WTF::WTFThreadData::WTFThreadData):
        * wtf/WTFThreadData.h:
        (WTF::WTFThreadData::stack):

2015-07-20  Julien Brianceau  <julien.brianceau@gmail.com>

        Use isnan from std namespace in Stopwatch.h.
        https://bugs.webkit.org/show_bug.cgi?id=146911

        Reviewed by Žan Doberšek.

        * wtf/Stopwatch.h:
        (WTF::Stopwatch::isActive):
        (WTF::Stopwatch::start):
        (WTF::Stopwatch::stop):
        (WTF::Stopwatch::elapsedTime):

2015-07-16  Benjamin Poulain  <bpoulain@apple.com>

        [Content extensions] Combine suffixes when generating NFAs
        https://bugs.webkit.org/show_bug.cgi?id=146961

        Reviewed by Alex Christensen.

        * wtf/Vector.h:
        (WTF::minCapacity>::Vector):
        (WTF::=):
        Copying a vector with a different inline capacity was broken due to
        the addition of MinimumCapacity.

        This feature was needed by this patch so I fixed WTF.

2015-07-15  Anders Carlsson  <andersca@apple.com>

        Make JavaScriptCore SPI headers used by WebCore SPI headers self-contained
        https://bugs.webkit.org/show_bug.cgi?id=146978

        Reviewed by Dan Bernstein.

        * wtf/ExportMacros.h:

2015-07-14  Anders Carlsson  <andersca@apple.com>

        Assertions.h should include ExportMacros.h
        https://bugs.webkit.org/show_bug.cgi?id=146948

        Reviewed by Tim Horton.

        * wtf/Assertions.h:

2015-07-11  Joseph Pecoraro  <pecoraro@apple.com>

        Unreviewed build fix, restrict APP_LINKS to just iOS.

        * wtf/Platform.h:

2015-07-09  Tim Horton  <timothy_horton@apple.com>

        Use CoreAnimation fences instead of synchronous IPC to synchronize resize
        https://bugs.webkit.org/show_bug.cgi?id=146294
        <rdar://problem/21090193>

        Reviewed by Anders Carlsson.

        * wtf/Platform.h:
        Add HAVE(COREANIMATION_FENCES)

2015-07-04  Chris Dumez  <cdumez@apple.com>

        Drop RefPtr::clear() method
        https://bugs.webkit.org/show_bug.cgi?id=146556

        Reviewed by Brady Eidson.

        Drop RefPtr::clear() method in favor of "= nullptr;" pattern.
        Also made the "= nullptr;" pattern as efficient as clear()
        by providing a operator=(nullptr_t) overload. Local micro-
        benchmarking showed that "= nullptr;" used to be ~1.7% slower
        than clear().

2015-07-03  Dan Bernstein  <mitz@apple.com>

        [Xcode] Update some build settings as recommended by Xcode 7
        https://bugs.webkit.org/show_bug.cgi?id=146597

        Reviewed by Sam Weinig.

        * Configurations/Base.xcconfig: Enabled CLANG_WARN_UNREACHABLE_CODE and
        GCC_NO_COMMON_BLOCKS. Removed GCC_MODEL_TUNING.

        * WTF.xcodeproj/project.pbxproj: Updated LastUpgradeCheck.

2015-07-01  Alex Christensen  <achristensen@webkit.org>

        Re-enable WebGL on WinCairo
        https://bugs.webkit.org/show_bug.cgi?id=146537

        Reviewed by Csaba Osztrogonác.

        * wtf/FeatureDefines.h:
        Enable WebGL on WinCairo again.

2015-07-01  Alex Christensen  <achristensen@webkit.org>

        Ignore Visual Studio warning in SegmentedVector
        https://bugs.webkit.org/show_bug.cgi?id=146514

        Reviewed by Andreas Kling.

        * wtf/SegmentedVector.h:
        (WTF::SegmentedVector::deleteAllSegments):
        Use pragmas to ignore the 0 element array warning.

2015-07-01  Dean Jackson  <dino@apple.com>

        Disable the experimental WebGL2 implementation
        https://bugs.webkit.org/show_bug.cgi?id=146526
        <rdar://problem/21641235>

        Reviewed by Myles Maxfield.

        Add (and disable) an ENABLE_WEBGL2 flag.

        * wtf/FeatureDefines.h:

2015-06-30  Alex Christensen  <achristensen@webkit.org>

        [Win] Unreviewed build fix after r186169.

        * wtf/FeatureDefines.h:
        Temporarily disable WebGL on WinCairo. It was already temporarily disabled on AppleWin.

2015-06-30  Andy VanWagoner  <thetalecrafter@gmail.com>

        Implement ECMAScript Internationalization API
        https://bugs.webkit.org/show_bug.cgi?id=90906

        Reviewed by Benjamin Poulain.

        * wtf/FeatureDefines.h: add ENABLE_INTL flag

2015-06-30  Keith Miller  <keith_miller@apple.com>

        Errors in read() are not handled in WTF::cryptographicallyRandomValuesFromOS.
        https://bugs.webkit.org/show_bug.cgi?id=146473

        Reviewed by Filip Pizlo.

        We were not checking if errors occurred in WTF::cryptographicallyRandomValuesFromOS.
        We now buffer the data until enough bits of entropy exist to fill the buffer
        rather than crash. Additionally, added two crash functions so we can distinguish
        between the two reasons why we crashed in traces.

        * wtf/OSRandomSource.cpp:
        (WTF::crashUnableToOpenFD):
        (WTF::crashUnableToReadFromFD):
        (WTF::cryptographicallyRandomValuesFromOS):

2015-06-29  Dean Jackson  <dino@apple.com>

        Temporarily disable PICTURE_SIZES
        https://bugs.webkit.org/show_bug.cgi?id=146435
        <rdar://problem/21087013>

        Reviewed by Tim Horton.

        Temporarily disable PICTURE_SIZES because it causes problems with out
        of date <picture> polyfills.

        * wtf/FeatureDefines.h:

2015-06-26  Antti Koivisto  <antti@apple.com>

        Network process hangs fetching disk cache entries
        https://bugs.webkit.org/show_bug.cgi?id=146348
        <rdar://problem/21528072>

        Reviewed by Anders Carlsson.

        RunLoop::dispatch may deadlock if invoked with std::function that captures an object that calls RunLoop::dispatch in destructor.

        * wtf/RunLoop.cpp:
        (WTF::RunLoop::performWork):

            Don't reuse std::function variable in loop. We may end up destroying previously held std::function in assignment
            while holding the runloop mutex. With this change std::function is always destroyed with mutex unlocked.

2015-06-24  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r185906.
        https://bugs.webkit.org/show_bug.cgi?id=146276

        MSVC doesn't yet provide a const-qualified std::array<T,
        N>::size(), failing to compile the static_assert (Requested by
        zdobersek on #webkit).

        Reverted changeset:

        "Improve the source code generated by make_names.pl"
        https://bugs.webkit.org/show_bug.cgi?id=146208
        http://trac.webkit.org/changeset/185906

2015-06-24  Zan Dobersek  <zdobersek@igalia.com>

        Improve the source code generated by make_names.pl
        https://bugs.webkit.org/show_bug.cgi?id=146208

        Reviewed by Darin Adler.

        * wtf/text/StringImpl.h:
        (WTF::StringImpl::assertHashIsCorrect): Make this method const-qualified.

2015-06-22  Darin Adler  <darin@apple.com>

        Make Array.join work directly on substrings without reifying them
        https://bugs.webkit.org/show_bug.cgi?id=146191

        Reviewed by Andreas Kling.

        * wtf/Vector.h: Added an overload of uncheckedAppend like the one we added
        a while back, a non-template function that forwards through to the function
        template. This lets us call uncheckedAppend on an argument list and have it
        properly convert it to the Vector's element type.

        * wtf/text/StringView.h:
        (WTF::StringView::getCharactersWithUpconvert): Changed to not use memcpy;
        saw some indication the hand-written loop was faster when profiling. Also
        use m_length directly when we know we are dealing with an 8-bit string,
        since the masking that the index function does is not needed in that case.
        (WTF::StringView::UpconvertedCharacters::UpconvertedCharacters): Ditto.
        (WTF::StringView::toString): Ditto.
        (WTF::StringView::toFloat): Ditto.
        (WTF::StringView::toInt): Ditto.
        (WTF::StringView::toStringWithoutCopying): Ditto.
        (WTF::StringView::find): Ditto.

2015-06-22  YunQiang Su  <wzssyqa@gmail.com>

        [WTF] Platform.h: use _ABI64 instead of _MIPS_SIM_ABI64 to determine MIPS N64
        https://bugs.webkit.org/show_bug.cgi?id=145113

        Reviewed by Csaba Osztrogonác.

        * wtf/Platform.h:

2015-06-22  Anders Carlsson  <andersca@apple.com>

        Fix build.

        * wtf/threads/BinarySemaphore.cpp:

2015-06-22  Anders Carlsson  <andersca@apple.com>

        Get rid of the Windows specific BinarySemaphore implementation
        https://bugs.webkit.org/show_bug.cgi?id=146216

        Reviewed by Andreas Kling.

        The fact that the Windows implementation uses a HEVENT internally was only useful
        to the Windows port of WebKit2; we can get rid of it now.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * wtf/threads/BinarySemaphore.h:
        (WTF::BinarySemaphore::event): Deleted.
        * wtf/threads/win/BinarySemaphoreWin.cpp: Removed.
        (WTF::BinarySemaphore::BinarySemaphore): Deleted.
        (WTF::BinarySemaphore::~BinarySemaphore): Deleted.
        (WTF::BinarySemaphore::signal): Deleted.
        (WTF::BinarySemaphore::wait): Deleted.

2015-06-21  Gavin Barraclough  <barraclough@apple.com>

        Page load performance regression due to bugs.webkit.org/show_bug.cgi?id=145542
        https://bugs.webkit.org/show_bug.cgi?id=146198

        Unreviewed rollout.

        * wtf/glib/GUniquePtr.h:

2015-06-20  Michael Catanzaro  <mcatanzaro@igalia.com>

        [EFL][GTK] Define GLIB_VERSION_MIN_REQUIRED and require glib 2.36 for GTK
        https://bugs.webkit.org/show_bug.cgi?id=146181

        Reviewed by Martin Robinson.

        Define GLIB_VERSION_MIN_REQUIRED to avoid deprecation warnings.

        * wtf/Platform.h:

2015-06-19  Michael Catanzaro  <mcatanzaro@igalia.com>

        [SOUP] Define SOUP_VERSION_MIN_REQUIRED
        https://bugs.webkit.org/show_bug.cgi?id=146165

        Reviewed by Martin Robinson.

        Define SOUP_VERSION_MIN_REQUIRED to avoid deprecation warnings.

        * wtf/Platform.h:

2015-06-19  Mark Lam  <mark.lam@apple.com>

        Gardening: build fixes for GTK and EFL for CheckedArithmetic change.

        Not reviewed.

        * wtf/CheckedArithmetic.h:
        (WTF::Checked::operator<):
        (WTF::Checked::operator<=):
        (WTF::Checked::operator>):
        (WTF::Checked::operator>=):

2015-06-19  Mark Lam  <mark.lam@apple.com>

        CheckedArithmetic's operator bool() and operator==() is broken.
        https://bugs.webkit.org/show_bug.cgi?id=146129

        Reviewed by Geoffrey Garen and Oliver Hunt.

        The existing operator UnspecifiedBoolType*() in CheckedArithmetic is erroneously
        allowing the Checked value to be implicitly casted into pointer types.  This is
        because it is doing a reinterpret_cast<UnspecifiedBoolType*>(1) whereas the idiom
        relies on the address of a member e.g. &Checked::m_value.  As a result,
        ImageBufferData::putData() was getting an implicit cast of a Checked value to
        (void*)1 and doing incorrect pointer comparisons on it.

        Also, 2 of CheckedArithmetic's operator==() will crash if used on an overflowed
        value, while a 3rd one does not.  The 3rd one should be consistent and also crash
        if used on an overflowed Checked value.

        In this fix, we replace operator UnspecifiedBoolType*() with an explicit operator
        bool().  We also add the missing operators <, <=, >, and >=.  That takes care of
        the comparisons in ImageBufferData::putData().

        * wtf/CheckedArithmetic.h:
        (WTF::CrashOnOverflow::overflowed):
        (WTF::CrashOnOverflow::crash):
        (WTF::RecordOverflow::crash):

        (WTF::Checked::operator!):
        (WTF::Checked::operator bool):
        (WTF::Checked::unsafeGet):
        - Don't call CRASH() directly.  Delegate to the handler.

        (WTF::Checked::operator==):
        - Should call the handler's crash() to be consistent with the other 2 versions of
          operator== which will crash in unsafeGet() if used on an overflowed Checked
          value.

        (WTF::Checked::operator<):
        (WTF::Checked::operator<=):
        (WTF::Checked::operator>):
        (WTF::Checked::operator>=):
        - Add missing operators.

        (WTF::Checked::operator UnspecifiedBoolType*): Deleted.

2015-06-19  Csaba Osztrogonác  <ossy@webkit.org>

        [WK2] Fix unused-private-field warning in WebProcess/Plugins/PluginView.<h|cpp>
        https://bugs.webkit.org/show_bug.cgi?id=145252

        Reviewed by Tim Horton.

        * wtf/FeatureDefines.h: Moved the definition of ENABLE_PRIMARY_SNAPSHOTTED_PLUGIN_HEURISTIC
        here from Source/WebKit2/WebProcess/WebPage/WebPage.h

2015-06-17  Andreas Kling  <akling@apple.com>

        SegmentedVector should waste less memory.
        <https://webkit.org/b/146069>

        Reviewed by Anders Carlsson.

        We were wasting sizeof(Vector) on every segment in SegmentVector.
        The segments were using inline capacity, and would never go beyond it,
        so all the size/capacity/out-of-line-buffer metadata was useless.

        Change the internal representation to Vector<T[SegmentSize]> instead.
        This saves 16 bytes per segment, so lower SegmentSize -> bigger savings!

        * wtf/SegmentedVector.h:
        (WTF::SegmentedVectorIterator::operator*):
        (WTF::SegmentedVectorIterator::operator->):
        (WTF::SegmentedVectorIterator::operator++):
        (WTF::SegmentedVectorIterator::operator==):
        (WTF::SegmentedVectorIterator::operator!=):
        (WTF::SegmentedVectorIterator::SegmentedVectorIterator):
        (WTF::SegmentedVector::at):
        (WTF::SegmentedVector::append):
        (WTF::SegmentedVector::removeLast):
        (WTF::SegmentedVector::grow):
        (WTF::SegmentedVector::begin):
        (WTF::SegmentedVector::end):
        (WTF::SegmentedVector::deleteAllSegments):
        (WTF::SegmentedVector::ensureSegmentsFor):
        (WTF::SegmentedVector::ensureSegment):
        (WTF::SegmentedVector::allocateSegment):
        (WTF::SegmentedVectorIterator::operator=): Deleted.
        (WTF::SegmentedVector::SegmentedVector): Deleted.

2015-06-16  Andreas Kling  <akling@apple.com>

        Remove unused template parameter InlineCapacity from SegmentedVector.
        <https://webkit.org/b/146044>

        Reviewed by Anders Carlsson.

        * wtf/SegmentedVector.h:
        (WTF::SegmentedVectorIterator::operator=):
        (WTF::SegmentedVectorIterator::SegmentedVectorIterator):
        (WTF::SegmentedVector::at):

2015-06-16  Mark Lam  <mark.lam@apple.com>

        Use NakedPtr<Exception>& to return exception results.
        https://bugs.webkit.org/show_bug.cgi?id=145870

        Reviewed by Anders Carlsson and Filip Pizlo.

        Introducing the NakedPtr class.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/NakedPtr.h: Added.
        (WTF::NakedPtr::NakedPtr):
        (WTF::NakedPtr::get):
        (WTF::NakedPtr::clear):
        (WTF::NakedPtr::operator*):
        (WTF::NakedPtr::operator->):
        (WTF::NakedPtr::operator T*):
        (WTF::NakedPtr::operator!):
        (WTF::NakedPtr::operator bool):
        (WTF::=):
        (WTF::NakedPtr<T>::swap):
        (WTF::swap):

2015-06-12  Zan Dobersek  <zdobersek@igalia.com>

        [GLib] Move files under Source/WTF/wtf/gobject to Source/WTF/wtf/glib
        https://bugs.webkit.org/show_bug.cgi?id=145799

        Reviewed by Carlos Garcia Campos.

        Move the GLib-specific files to the Source/WTF/wtf/glib/ directory.
        'gobject' wasn't the most appropriate name for the directory since
        GObject is a submodule of GLib, but a lot of the code there didn't
        have much to do with GObject specifically.

        Build rules for the moved files are also updated.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * wtf/Platform.h:
        * wtf/PlatformEfl.cmake:
        * wtf/PlatformGTK.cmake:
        * wtf/RunLoop.h:
        * wtf/WorkQueue.h:
        * wtf/glib/GLibUtilities.cpp: Renamed from Source/WTF/wtf/gobject/GlibUtilities.cpp.
        (getCurrentExecutablePath):
        * wtf/glib/GLibUtilities.h: Renamed from Source/WTF/wtf/gobject/GlibUtilities.h.
        * wtf/glib/GMainLoopSource.cpp: Renamed from Source/WTF/wtf/gobject/GMainLoopSource.cpp.
        (WTF::GMainLoopSource::create):
        (WTF::GMainLoopSource::GMainLoopSource):
        (WTF::GMainLoopSource::~GMainLoopSource):
        (WTF::GMainLoopSource::isScheduled):
        (WTF::GMainLoopSource::isActive):
        (WTF::GMainLoopSource::cancel):
        (WTF::GMainLoopSource::scheduleIdleSource):
        (WTF::GMainLoopSource::schedule):
        (WTF::GMainLoopSource::scheduleTimeoutSource):
        (WTF::GMainLoopSource::scheduleAfterDelay):
        (WTF::createMicrosecondsTimeoutSource):
        (WTF::GMainLoopSource::scheduleAndDeleteOnDestroy):
        (WTF::GMainLoopSource::scheduleAfterDelayAndDeleteOnDestroy):
        (WTF::GMainLoopSource::prepareVoidCallback):
        (WTF::GMainLoopSource::finishVoidCallback):
        (WTF::GMainLoopSource::voidCallback):
        (WTF::GMainLoopSource::prepareBoolCallback):
        (WTF::GMainLoopSource::finishBoolCallback):
        (WTF::GMainLoopSource::boolCallback):
        (WTF::GMainLoopSource::socketCallback):
        (WTF::GMainLoopSource::voidSourceCallback):
        (WTF::GMainLoopSource::boolSourceCallback):
        (WTF::GMainLoopSource::socketSourceCallback):
        (WTF::GMainLoopSource::Context::destroySource):
        * wtf/glib/GMainLoopSource.h: Renamed from Source/WTF/wtf/gobject/GMainLoopSource.h.
        (WTF::GMainLoopSource::Context::operator=):
        * wtf/glib/GMutexLocker.h: Renamed from Source/WTF/wtf/gobject/GMutexLocker.h.
        (WTF::MutexWrapper<GMutex>::lock):
        (WTF::MutexWrapper<GMutex>::unlock):
        (WTF::MutexWrapper<GRecMutex>::lock):
        (WTF::MutexWrapper<GRecMutex>::unlock):
        (WTF::GMutexLocker::GMutexLocker):
        (WTF::GMutexLocker::~GMutexLocker):
        (WTF::GMutexLocker::lock):
        (WTF::GMutexLocker::unlock):
        * wtf/glib/GRefPtr.cpp: Renamed from Source/WTF/wtf/gobject/GRefPtr.cpp.
        (WTF::refGPtr):
        (WTF::derefGPtr):
        * wtf/glib/GRefPtr.h: Renamed from Source/WTF/wtf/gobject/GRefPtr.h.
        (WTF::GRefPtr::GRefPtr):
        (WTF::GRefPtr::~GRefPtr):
        (WTF::GRefPtr::clear):
        (WTF::GRefPtr::outPtr):
        (WTF::GRefPtr::isHashTableDeletedValue):
        (WTF::GRefPtr::get):
        (WTF::GRefPtr::operator*):
        (WTF::GRefPtr::operator->):
        (WTF::GRefPtr::operator!):
        (WTF::GRefPtr::operator UnspecifiedBoolType):
        (WTF::GRefPtr::hashTableDeletedValue):
        (WTF::=):
        (WTF::GRefPtr<T>::swap):
        (WTF::swap):
        (WTF::operator==):
        (WTF::operator!=):
        (WTF::static_pointer_cast):
        (WTF::const_pointer_cast):
        (WTF::adoptGRef):
        (WTF::refGPtr):
        (WTF::derefGPtr):
        * wtf/glib/GThreadSafeMainLoopSource.cpp: Renamed from Source/WTF/wtf/gobject/GThreadSafeMainLoopSource.cpp.
        (WTF::GThreadSafeMainLoopSource::GThreadSafeMainLoopSource):
        (WTF::GThreadSafeMainLoopSource::~GThreadSafeMainLoopSource):
        (WTF::GThreadSafeMainLoopSource::cancel):
        (WTF::GThreadSafeMainLoopSource::schedule):
        (WTF::GThreadSafeMainLoopSource::scheduleAfterDelay):
        (WTF::GThreadSafeMainLoopSource::prepareVoidCallback):
        (WTF::GThreadSafeMainLoopSource::finishVoidCallback):
        (WTF::GThreadSafeMainLoopSource::voidCallback):
        (WTF::GThreadSafeMainLoopSource::prepareBoolCallback):
        (WTF::GThreadSafeMainLoopSource::finishBoolCallback):
        (WTF::GThreadSafeMainLoopSource::boolCallback):
        * wtf/glib/GThreadSafeMainLoopSource.h: Renamed from Source/WTF/wtf/gobject/GThreadSafeMainLoopSource.h.
        * wtf/glib/GTypedefs.h: Renamed from Source/WTF/wtf/gobject/GTypedefs.h.
        * wtf/glib/GUniquePtr.h: Renamed from Source/WTF/wtf/gobject/GUniquePtr.h.
        (WTF::GPtrDeleter::operator()):
        (WTF::GUniqueOutPtr::GUniqueOutPtr):
        (WTF::GUniqueOutPtr::~GUniqueOutPtr):
        (WTF::GUniqueOutPtr::outPtr):
        (WTF::GUniqueOutPtr::release):
        (WTF::GUniqueOutPtr::operator*):
        (WTF::GUniqueOutPtr::operator->):
        (WTF::GUniqueOutPtr::get):
        (WTF::GUniqueOutPtr::operator!):
        (WTF::GUniqueOutPtr::operator UnspecifiedBoolType):
        (WTF::GUniqueOutPtr::reset):
        * wtf/glib/MainThreadGLib.cpp:
        * wtf/gobject/GMainLoopSource.cpp:
        (WTF::GMainLoopSource::create): Deleted.
        (WTF::GMainLoopSource::GMainLoopSource): Deleted.
        (WTF::GMainLoopSource::~GMainLoopSource): Deleted.
        (WTF::GMainLoopSource::isScheduled): Deleted.
        (WTF::GMainLoopSource::isActive): Deleted.
        (WTF::GMainLoopSource::cancel): Deleted.
        (WTF::GMainLoopSource::scheduleIdleSource): Deleted.
        (WTF::GMainLoopSource::schedule): Deleted.
        (WTF::GMainLoopSource::scheduleTimeoutSource): Deleted.
        (WTF::GMainLoopSource::scheduleAfterDelay): Deleted.
        (WTF::createMicrosecondsTimeoutSource): Deleted.
        (WTF::GMainLoopSource::scheduleAndDeleteOnDestroy): Deleted.
        (WTF::GMainLoopSource::scheduleAfterDelayAndDeleteOnDestroy): Deleted.
        (WTF::GMainLoopSource::prepareVoidCallback): Deleted.
        (WTF::GMainLoopSource::finishVoidCallback): Deleted.
        (WTF::GMainLoopSource::voidCallback): Deleted.
        (WTF::GMainLoopSource::prepareBoolCallback): Deleted.
        (WTF::GMainLoopSource::finishBoolCallback): Deleted.
        (WTF::GMainLoopSource::boolCallback): Deleted.
        (WTF::GMainLoopSource::socketCallback): Deleted.
        (WTF::GMainLoopSource::voidSourceCallback): Deleted.
        (WTF::GMainLoopSource::boolSourceCallback): Deleted.
        (WTF::GMainLoopSource::socketSourceCallback): Deleted.
        (WTF::GMainLoopSource::Context::destroySource): Deleted.
        * wtf/gobject/GMainLoopSource.h:
        (WTF::GMainLoopSource::Context::operator=): Deleted.
        * wtf/gobject/GMutexLocker.h:
        (WTF::MutexWrapper<GMutex>::lock): Deleted.
        (WTF::MutexWrapper<GMutex>::unlock): Deleted.
        (WTF::MutexWrapper<GRecMutex>::lock): Deleted.
        (WTF::MutexWrapper<GRecMutex>::unlock): Deleted.
        (WTF::GMutexLocker::GMutexLocker): Deleted.
        (WTF::GMutexLocker::~GMutexLocker): Deleted.
        (WTF::GMutexLocker::lock): Deleted.
        (WTF::GMutexLocker::unlock): Deleted.
        * wtf/gobject/GRefPtr.cpp:
        (WTF::refGPtr): Deleted.
        (WTF::derefGPtr): Deleted.
        * wtf/gobject/GRefPtr.h:
        (WTF::GRefPtr::GRefPtr): Deleted.
        (WTF::GRefPtr::~GRefPtr): Deleted.
        (WTF::GRefPtr::clear): Deleted.
        (WTF::GRefPtr::outPtr): Deleted.
        (WTF::GRefPtr::isHashTableDeletedValue): Deleted.
        (WTF::GRefPtr::get): Deleted.
        (WTF::GRefPtr::operator*): Deleted.
        (WTF::GRefPtr::operator->): Deleted.
        (WTF::GRefPtr::operator!): Deleted.
        (WTF::GRefPtr::operator UnspecifiedBoolType): Deleted.
        (WTF::GRefPtr::hashTableDeletedValue): Deleted.
        (WTF::=): Deleted.
        (WTF::GRefPtr<T>::swap): Deleted.
        (WTF::swap): Deleted.
        (WTF::operator==): Deleted.
        (WTF::operator!=): Deleted.
        (WTF::static_pointer_cast): Deleted.
        (WTF::const_pointer_cast): Deleted.
        (WTF::adoptGRef): Deleted.
        (WTF::refGPtr): Deleted.
        (WTF::derefGPtr): Deleted.
        * wtf/gobject/GThreadSafeMainLoopSource.cpp:
        (WTF::GThreadSafeMainLoopSource::GThreadSafeMainLoopSource): Deleted.
        (WTF::GThreadSafeMainLoopSource::~GThreadSafeMainLoopSource): Deleted.
        (WTF::GThreadSafeMainLoopSource::cancel): Deleted.
        (WTF::GThreadSafeMainLoopSource::schedule): Deleted.
        (WTF::GThreadSafeMainLoopSource::scheduleAfterDelay): Deleted.
        (WTF::GThreadSafeMainLoopSource::prepareVoidCallback): Deleted.
        (WTF::GThreadSafeMainLoopSource::finishVoidCallback): Deleted.
        (WTF::GThreadSafeMainLoopSource::voidCallback): Deleted.
        (WTF::GThreadSafeMainLoopSource::prepareBoolCallback): Deleted.
        (WTF::GThreadSafeMainLoopSource::finishBoolCallback): Deleted.
        (WTF::GThreadSafeMainLoopSource::boolCallback): Deleted.
        * wtf/gobject/GUniquePtr.h:
        (WTF::GPtrDeleter::operator()): Deleted.
        (WTF::GUniqueOutPtr::GUniqueOutPtr): Deleted.
        (WTF::GUniqueOutPtr::~GUniqueOutPtr): Deleted.
        (WTF::GUniqueOutPtr::outPtr): Deleted.
        (WTF::GUniqueOutPtr::release): Deleted.
        (WTF::GUniqueOutPtr::operator*): Deleted.
        (WTF::GUniqueOutPtr::operator->): Deleted.
        (WTF::GUniqueOutPtr::get): Deleted.
        (WTF::GUniqueOutPtr::operator!): Deleted.
        (WTF::GUniqueOutPtr::operator UnspecifiedBoolType): Deleted.
        (WTF::GUniqueOutPtr::reset): Deleted.
        * wtf/gobject/GlibUtilities.cpp:
        (getCurrentExecutablePath): Deleted.

2015-06-10  Basile Clement  <basile_clement@apple.com>

        Unreviewed, fix an typo in unused template code.

        * wtf/TinyPtrSet.h:
        (WTF::TinyPtrSet::iterator::operator*): s/at(index)/at(m_index)/

2015-06-09  Csaba Osztrogonác  <ossy@webkit.org>

        [cmake] Fix the style issues in cmake project files
        https://bugs.webkit.org/show_bug.cgi?id=145755

        Reviewed by Darin Adler.

        * wtf/CMakeLists.txt:

2015-06-08  Alexey Proskuryakov  <ap@apple.com>

        Build fix.

        * wtf/TinyPtrSet.h: (WTF::TinyPtrSet::isEmpty): s/poointer/pointer/

2015-06-07  Filip Pizlo  <fpizlo@apple.com>

        The tiny set magic in StructureSet should be available in WTF
        https://bugs.webkit.org/show_bug.cgi?id=145722

        Reviewed by Geoffrey Garen.
        
        As the management of structure sets evolved in JSC, the StructureSet data structure grew
        increasingly smart. It's got some smart stuff for managing small sets of pointers. I
        wanted to take the generic logic out of JSC and put it into a reusable templatized class
        in WTF.
        
        * WTF.vcxproj/WTF.vcxproj:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/TinyPtrSet.h: Added.
        (WTF::TinyPtrSet::TinyPtrSet):
        (WTF::TinyPtrSet::operator=):
        (WTF::TinyPtrSet::~TinyPtrSet):
        (WTF::TinyPtrSet::clear):
        (WTF::TinyPtrSet::onlyEntry):
        (WTF::TinyPtrSet::isEmpty):
        (WTF::TinyPtrSet::add):
        (WTF::TinyPtrSet::remove):
        (WTF::TinyPtrSet::contains):
        (WTF::TinyPtrSet::merge):
        (WTF::TinyPtrSet::forEach):
        (WTF::TinyPtrSet::genericFilter):
        (WTF::TinyPtrSet::filter):
        (WTF::TinyPtrSet::exclude):
        (WTF::TinyPtrSet::isSubsetOf):
        (WTF::TinyPtrSet::isSupersetOf):
        (WTF::TinyPtrSet::overlaps):
        (WTF::TinyPtrSet::size):
        (WTF::TinyPtrSet::at):
        (WTF::TinyPtrSet::operator[]):
        (WTF::TinyPtrSet::last):
        (WTF::TinyPtrSet::iterator::iterator):
        (WTF::TinyPtrSet::iterator::operator*):
        (WTF::TinyPtrSet::iterator::operator++):
        (WTF::TinyPtrSet::iterator::operator==):
        (WTF::TinyPtrSet::iterator::operator!=):
        (WTF::TinyPtrSet::begin):
        (WTF::TinyPtrSet::end):
        (WTF::TinyPtrSet::operator==):
        (WTF::TinyPtrSet::addOutOfLine):
        (WTF::TinyPtrSet::containsOutOfLine):
        (WTF::TinyPtrSet::copyFrom):
        (WTF::TinyPtrSet::copyFromOutOfLine):
        (WTF::TinyPtrSet::OutOfLineList::create):
        (WTF::TinyPtrSet::OutOfLineList::destroy):
        (WTF::TinyPtrSet::OutOfLineList::list):
        (WTF::TinyPtrSet::OutOfLineList::OutOfLineList):
        (WTF::TinyPtrSet::deleteListIfNecessary):
        (WTF::TinyPtrSet::isThin):
        (WTF::TinyPtrSet::pointer):
        (WTF::TinyPtrSet::singleEntry):
        (WTF::TinyPtrSet::list):
        (WTF::TinyPtrSet::set):
        (WTF::TinyPtrSet::setEmpty):
        (WTF::TinyPtrSet::getReservedFlag):
        (WTF::TinyPtrSet::setReservedFlag):

2015-06-05  Chris Dumez  <cdumez@apple.com>

        [WK2][iOS] Limit the number of vnodes used by the WebContent processes
        https://bugs.webkit.org/show_bug.cgi?id=145672
        <rdar://problem/21126637>

        Reviewed by Antti Koivisto.

        * wtf/RefCounter.h:
        (WTF::RefCounter::value):

        Expose the actual refcount instead of a boolean value.

2015-06-05  Alex Christensen  <achristensen@webkit.org>

        [Web Timing] Use new SPI to enable data collection.
        https://bugs.webkit.org/show_bug.cgi?id=145650
        rdar://problem/21203358

        Reviewed by Chris Dumez.

        * wtf/Platform.h:
        Added HAVE_TIMINGDATAOPTIONS for platform and version dependent feature.

2015-06-05  Xabier Rodriguez Calvar  <calvaris@igalia.com> and Youenn Fablet <youenn.fablet@crf.canon.fr>

        [Streams API] ReadableStream should store callbacks as a Deque
        https://bugs.webkit.org/show_bug.cgi?id=145641

        Reviewed by Darin Adler.

        * wtf/Deque.h:
        (WTF::Deque::append): Adding not templated append method, forwarding to templated append method.

2015-06-02  Xabier Rodriguez Calvar  <calvaris@igalia.com> and Youenn Fablet <youenn.fablet@crf.canon.fr>

        [Streams API] Delegate ReadableStreamReader reference counting to ReadableStream
        https://bugs.webkit.org/show_bug.cgi?id=144907

        Reviewed by Darin Adler.

        * wtf/Vector.h:
        (WTF::Vector::append): Adding not templated append method, forwarding to ValueType templated append method.

2015-06-02  Yusuke Suzuki  <utatane.tea@gmail.com>

        Heap-use-after-free read of size 4 in JavaScriptCore: WTF::StringImpl::isSymbol() (StringImpl.h:496)
        https://bugs.webkit.org/show_bug.cgi?id=145532

        Reviewed by Geoffrey Garen.

        Return `RefPtr<AtomicStringImpl>` instead of `AtomicStringImpl*`.

        * wtf/text/AtomicStringImpl.cpp:
        (WTF::AtomicStringImpl::lookUpSlowCase):
        (WTF::AtomicStringImpl::lookUpInternal):
        * wtf/text/AtomicStringImpl.h:
        (WTF::AtomicStringImpl::lookUp):

2015-06-01  Anders Carlsson  <andersca@apple.com>

        Use xpc_connection_set_oneshot_instance where possible
        https://bugs.webkit.org/show_bug.cgi?id=145535
        rdar://problem/21109994

        Reviewed by Sam Weinig.

        Add SPI declaration.

        * wtf/spi/darwin/XPCSPI.h:

2015-05-29  Anders Carlsson  <andersca@apple.com>

        Missing #import of Platform.h in several WTF headers
        https://bugs.webkit.org/show_bug.cgi?id=145475
        rdar://problem/21161818

        Reviewed by Darin Adler.

        Add Platform.h #includes.

        * wtf/Assertions.h:
        * wtf/RetainPtr.h:

2015-05-29  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r184949.
        https://bugs.webkit.org/show_bug.cgi?id=145458

        Ends up generating worse code for HashTable move constructors
        (Requested by zdobersek on #webkit).

        Reverted changeset:

        "Clean up HashTable constructors"
        https://bugs.webkit.org/show_bug.cgi?id=145369
        http://trac.webkit.org/changeset/184949

2015-05-28  Gyuyoung Kim  <gyuyoung.kim@webkit.org>

        Purge PassRefPtr in StringConcatenate.h
        https://bugs.webkit.org/show_bug.cgi?id=145376

        Reviewed by Darin Adler.

        Replace PassRefPtr with RefPtr. Additionally use nullptr instead of 0.

        * wtf/text/StringConcatenate.h:
        (WTF::tryMakeString):
        (WTF::makeString):

2015-05-28  Zan Dobersek  <zdobersek@igalia.com>

        Clean up HashTable constructors
        https://bugs.webkit.org/show_bug.cgi?id=145369

        Reviewed by Andreas Kling.

        Use nullptr to initialize pointer member variables in the HashTable
        default constructor. Copy and move constructors can use constructor
        delegation instead of replicating all member initializations. Move
        constructor should simply call HashTable::swap() instead of replicating
        all the swap operations.

        * wtf/HashTable.h:
        (WTF::KeyTraits>::HashTable):

2015-05-27  Alexey Proskuryakov  <ap@apple.com>

        [Mac] Fix clang static analyzer build
        https://bugs.webkit.org/show_bug.cgi?id=145426
        rdar://problem/20947408

        Reviewed by Dan Bernstein.

        * wtf/spi/darwin/XPCSPI.h: Correct declarations of xpc_retain and xpc_release.

2015-05-27  Dean Jackson  <dino@apple.com>

        img.currentSrc problem in strict mode with old picturefill
        https://bugs.webkit.org/show_bug.cgi?id=144095
        <rdar://problem/21087013>

        Reviewed by Simon Fraser.

        Add a PICTURE_SIZES flag.

        * wtf/FeatureDefines.h:

2015-05-26  Andreas Kling  <akling@apple.com>

        StringView should have find(StringView, start).
        <https://webkit.org/b/145351>

        Reviewed by Darin Adler.

        Move the class agnostic guts of StringImpl's find() implementation from StringImpl
        to StringCommon.h and templatize the code into a findCommon() helper.

        StringImpl::find() and StringView::find() now both call findCommon().

        * wtf/text/StringCommon.h:
        (WTF::findInner):
        (WTF::find):
        (WTF::findCommon):
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::find):
        (WTF::findInner): Deleted.
        * wtf/text/StringImpl.h:
        (WTF::find): Deleted.
        * wtf/text/StringView.cpp:
        (WTF::StringView::find):
        * wtf/text/StringView.h:


2015-05-26  Dan Bernstein  <mitz@apple.com>

        <rdar://problem/21104551> Update build settings

        Reviewed by Anders Carlsson.

        * Configurations/DebugRelease.xcconfig:

2015-05-23  Dan Bernstein  <mitz@apple.com>

        Remove unused definitions of WEBKIT_VERSION_MIN_REQUIRED
        https://bugs.webkit.org/show_bug.cgi?id=145345

        Reviewed by Sam Weinig.

        * Configurations/Base.xcconfig: Also changed to use $(inherited).

2015-05-23  Yusuke Suzuki  <utatane.tea@gmail.com>

        Introduce UniquedStringImpl and SymbolImpl to separate symbolic strings from AtomicStringImpl
        https://bugs.webkit.org/show_bug.cgi?id=144848

        Reviewed by Darin Adler.

        he current AtomicStringImpl accidentally means the symbol OR atomic StringImpl.
        t's not correct to its name and it's error prone.

        In this patch, we'll introduce/changes classes into WTF.

        1. UniquedStringImpl
        It's derived class from StringImpl. And it represents symbol || atomic StringImpl.

        2. SymbolImpl
        It's derived class from UniquedStringImpl. Only symbol strings can become this.
        It ensures the given StringImpl is symbol in compile time.

        3. AtomicStringImpl
        It's derived class from UniquedStringImpl. Only atomic (non-normal && non-symbol) strings can become this.
        It ensures the given StringImpl is atomic in compile time.

        And, in this time, I just accept UniqueStringImpl in AtomicString. As the result,
        1. Now AtomicStringImpl issue is fixed. Its SymbolImpl is separated and UniquedStringImpl is introduced.
        2. But AtomicString still have both symbol and atomic strings.
        This should be solved in the separated patch.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/PrintStream.cpp:
        * wtf/PrintStream.h:
        (WTF::printInternal):
        * wtf/text/AtomicString.h:
        (WTF::AtomicString::AtomicString):
        * wtf/text/AtomicStringImpl.h:
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::~StringImpl):
        (WTF::StringImpl::createSymbol):
        (WTF::StringImpl::createSymbolEmpty):
        * wtf/text/StringImpl.h:
        * wtf/text/SymbolImpl.h: Copied from Source/JavaScriptCore/runtime/PrivateName.h.
        * wtf/text/SymbolRegistry.cpp:
        (WTF::SymbolRegistry::symbolForKey):
        (WTF::SymbolRegistry::keyForSymbol):
        (WTF::SymbolRegistry::remove):
        * wtf/text/SymbolRegistry.h:
        * wtf/text/UniquedStringImpl.h: Copied from Source/JavaScriptCore/runtime/PrivateName.h.

2015-05-20  Zan Dobersek  <zdobersek@igalia.com>

        [GTK] Move MainThreadGtk, RunLoopGtk, WorkQueueGtk under Source/WTF/wtf/glib/
        https://bugs.webkit.org/show_bug.cgi?id=145117

        Reviewed by Csaba Osztrogonác.

        Move the MainThreadGtk, RunLoopGtk and WorkQueueGtk implementation files from
        Source/WTF/wtf/gtk/ to Source/WTF/wtf/glib/. These implementations are not
        GTK-specific and only depend on GLib, so they are renamed as well.

        There are other such implementations under Source/WTF/wtf/gobject/ (GObject
        is just a subset of GLib) that will be moved under the new directory in
        future patches.

        * wtf/PlatformGTK.cmake:
        * wtf/glib/MainThreadGLib.cpp: Renamed from Source/WTF/wtf/gtk/MainThreadGtk.cpp.
        (WTF::initializeMainThreadPlatform):
        (WTF::scheduleDispatchFunctionsOnMainThread):
        * wtf/glib/RunLoopGLib.cpp: Renamed from Source/WTF/wtf/gtk/RunLoopGtk.cpp.
        (WTF::RunLoop::RunLoop):
        (WTF::RunLoop::~RunLoop):
        (WTF::RunLoop::run):
        (WTF::RunLoop::stop):
        (WTF::RunLoop::wakeUp):
        (WTF::RunLoop::TimerBase::TimerBase):
        (WTF::RunLoop::TimerBase::~TimerBase):
        (WTF::RunLoop::TimerBase::start):
        (WTF::RunLoop::TimerBase::stop):
        (WTF::RunLoop::TimerBase::isActive):
        * wtf/glib/WorkQueueGLib.cpp: Renamed from Source/WTF/wtf/gtk/WorkQueueGtk.cpp.
        (WTF::WorkQueue::platformInitialize):
        (WTF::WorkQueue::platformInvalidate):
        (WTF::WorkQueue::registerSocketEventHandler):
        (WTF::WorkQueue::unregisterSocketEventHandler):
        (WTF::WorkQueue::dispatch):
        (WTF::WorkQueue::dispatchAfter):

2015-05-19  Andreas Kling  <akling@apple.com>

        Give StringView a utf8() API.
        <https://webkit.org/b/145201>

        Reviewed by Anders Carlsson

        Added an LChar version of StringImpl::utf8ForCharacters() and use that to give
        StringView a utf8() API just like String has.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::utf8ForCharacters):
        * wtf/text/StringImpl.h:
        * wtf/text/StringView.cpp:
        (WTF::StringView::utf8):
        * wtf/text/StringView.h:

2015-05-19  Yusuke Suzuki  <utatane.tea@gmail.com>

        Move AtomicStringImpl table related operations from AtomicString to AtomicStringImpl
        https://bugs.webkit.org/show_bug.cgi?id=145109

        Reviewed by Darin Adler.

        Now AtomicStringImpl table operations are located in AtomicString.
        But they should be under AtomicStringImpl.
        This patch simply moves these operations to AtomicStringImpl.

        And this patch renames static AtomicString::find to static AtomicStringImpl::lookUp
        because it conflicts with AtomicStringImpl's member function name.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.vcxproj/copy-files.cmd:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/PlatformMac.cmake:
        * wtf/PlatformWin.cmake:
        * wtf/text/AtomicString.cpp:
        (WTF::AtomicString::lower):
        (WTF::AtomicString::convertToASCIILowercase):
        (WTF::AtomicString::fromUTF8Internal):
        (WTF::AtomicStringTableLocker::AtomicStringTableLocker): Deleted.
        (WTF::stringTable): Deleted.
        (WTF::addToStringTable): Deleted.
        (WTF::CStringTranslator::hash): Deleted.
        (WTF::CStringTranslator::equal): Deleted.
        (WTF::CStringTranslator::translate): Deleted.
        (WTF::AtomicString::add): Deleted.
        (WTF::UCharBufferTranslator::hash): Deleted.
        (WTF::UCharBufferTranslator::equal): Deleted.
        (WTF::UCharBufferTranslator::translate): Deleted.
        (WTF::HashAndCharactersTranslator::hash): Deleted.
        (WTF::HashAndCharactersTranslator::equal): Deleted.
        (WTF::HashAndCharactersTranslator::translate): Deleted.
        (WTF::HashAndUTF8CharactersTranslator::hash): Deleted.
        (WTF::HashAndUTF8CharactersTranslator::equal): Deleted.
        (WTF::HashAndUTF8CharactersTranslator::translate): Deleted.
        (WTF::SubstringTranslator::translate): Deleted.
        (WTF::SubstringTranslator8::hash): Deleted.
        (WTF::SubstringTranslator8::equal): Deleted.
        (WTF::SubstringTranslator16::hash): Deleted.
        (WTF::SubstringTranslator16::equal): Deleted.
        (WTF::LCharBufferTranslator::hash): Deleted.
        (WTF::LCharBufferTranslator::equal): Deleted.
        (WTF::LCharBufferTranslator::translate): Deleted.
        (WTF::CharBufferFromLiteralDataTranslator::hash): Deleted.
        (WTF::CharBufferFromLiteralDataTranslator::equal): Deleted.
        (WTF::CharBufferFromLiteralDataTranslator::translate): Deleted.
        (WTF::AtomicString::addFromLiteralData): Deleted.
        (WTF::AtomicString::addSlowCase): Deleted.
        (WTF::AtomicString::remove): Deleted.
        (WTF::AtomicString::findSlowCase): Deleted.
        (WTF::AtomicString::findInternal): Deleted.
        (WTF::AtomicString::isInAtomicStringTable): Deleted.
        * wtf/text/AtomicString.h:
        (WTF::AtomicString::AtomicString):
        (WTF::AtomicString::fromUTF8):
        (WTF::AtomicString::find): Deleted.
        (WTF::AtomicString::add): Deleted.
        (WTF::AtomicString::addWithStringTableProvider): Deleted.
        * wtf/text/AtomicStringImpl.cpp: Copied from Source/WTF/wtf/text/AtomicString.cpp.
        (WTF::AtomicStringTableLocker::AtomicStringTableLocker):
        (WTF::stringTable):
        (WTF::addToStringTable):
        (WTF::CStringTranslator::hash):
        (WTF::CStringTranslator::equal):
        (WTF::CStringTranslator::translate):
        (WTF::AtomicStringImpl::add):
        (WTF::UCharBufferTranslator::hash):
        (WTF::UCharBufferTranslator::equal):
        (WTF::UCharBufferTranslator::translate):
        (WTF::HashAndCharactersTranslator::hash):
        (WTF::HashAndCharactersTranslator::equal):
        (WTF::HashAndCharactersTranslator::translate):
        (WTF::HashAndUTF8CharactersTranslator::hash):
        (WTF::HashAndUTF8CharactersTranslator::equal):
        (WTF::HashAndUTF8CharactersTranslator::translate):
        (WTF::SubstringTranslator::translate):
        (WTF::SubstringTranslator8::hash):
        (WTF::SubstringTranslator8::equal):
        (WTF::SubstringTranslator16::hash):
        (WTF::SubstringTranslator16::equal):
        (WTF::LCharBufferTranslator::hash):
        (WTF::LCharBufferTranslator::equal):
        (WTF::LCharBufferTranslator::translate):
        (WTF::CharBufferFromLiteralDataTranslator::hash):
        (WTF::CharBufferFromLiteralDataTranslator::equal):
        (WTF::CharBufferFromLiteralDataTranslator::translate):
        (WTF::AtomicStringImpl::addLiteral):
        (WTF::AtomicStringImpl::addSlowCase):
        (WTF::AtomicStringImpl::remove):
        (WTF::AtomicStringImpl::lookUpSlowCase):
        (WTF::AtomicStringImpl::addUTF8):
        (WTF::AtomicStringImpl::lookUpInternal):
        (WTF::AtomicStringImpl::isInAtomicStringTable):
        * wtf/text/AtomicStringImpl.h:
        (WTF::AtomicStringImpl::lookUp):
        (WTF::AtomicStringImpl::add):
        (WTF::AtomicStringImpl::addWithStringTableProvider):
        (WTF::AtomicStringImpl::AtomicStringImpl): Deleted.
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::~StringImpl):
        * wtf/text/StringImpl.h:
        * wtf/text/WTFString.h:
        (WTF::String::String):
        * wtf/text/cf/AtomicStringCF.cpp:
        (WTF::AtomicString::add): Deleted.
        * wtf/text/cf/AtomicStringImplCF.cpp: Renamed from Source/WTF/wtf/text/cf/AtomicStringCF.cpp.
        (WTF::AtomicStringImpl::add):

2015-05-19  Ting-Wei Lan  <lantw44@gmail.com>

        [SOUP] Use st_birthtime to get creation time of files on systems support it
        https://bugs.webkit.org/show_bug.cgi?id=144989

        Reviewed by Carlos Garcia Campos.

        Define HAVE(STAT_BIRTHTIME) as 1 on operating systems supporting
        getting creation time of files using st_birthtime in stat.

        * wtf/Platform.h:

2015-05-19  Chris Dumez  <cdumez@apple.com>

        Mark static variables as const when possible
        https://bugs.webkit.org/show_bug.cgi?id=145161

        Reviewed by Andreas Kling.

        * wtf/dtoa.cpp:
        (WTF::pow5mult):

2015-05-19  Gyuyoung Kim  <gyuyoung.kim@webkit.org>

        [EFL] Remove unnecessary PLATFORM(EFL) macro in EFL specific files
        https://bugs.webkit.org/show_bug.cgi?id=145160

        Reviewed by Csaba Osztrogonác.

        * wtf/efl/EflTypedefs.h: Remove PLATFORM(EFL).
        * wtf/efl/UniquePtrEfl.h: ditto.

2015-05-18  Michael Catanzaro  <mcatanzaro@igalia.com>

        [CMake] Ignore warnings in system headers
        https://bugs.webkit.org/show_bug.cgi?id=144747

        Reviewed by Darin Adler.

        Separate include directories into WebKit project includes and system includes. Suppress all
        warnings from headers in system include directories using the SYSTEM argument to
        the include_directories command.

        * wtf/CMakeLists.txt:
        * wtf/PlatformEfl.cmake:
        * wtf/PlatformGTK.cmake:

2015-05-18  Myles C. Maxfield  <mmaxfield@apple.com>

        Addressing post-review comments on r184353
        https://bugs.webkit.org/show_bug.cgi?id=145146

        Reviewed by Benjamin Poulain.

        Create an overload for equalIgnoringASCIICase() for AtomicString and string literals.

        * wtf/text/AtomicString.h:
        (WTF::equalIgnoringASCIICase):

2015-05-18  Skachkov Alexandr  <gskachkov@gmail.com>

        [ES6] Arrow function syntax. Feature flag for arrow function
        https://bugs.webkit.org/show_bug.cgi?id=145108

        Reviewed by Ryosuke Niwa.

        Added feature flag ENABLE_ES6_ARROWFUNCTION_SYNTAX for arrow function

        * wtf/FeatureDefines.h:

2015-05-17  Benjamin Poulain  <benjamin@webkit.org>

        Do not use fastMallocGoodSize anywhere
        https://bugs.webkit.org/show_bug.cgi?id=145103

        Reviewed by Michael Saboff.

        It is silly we see fastMallocGoodSize in profiles, it does absolutely nothing.

        This patch keeps fastMallocGoodSize() around for older code linking
        with newer WebKit, but remove any use of it inside WebKit.

        * wtf/FastMalloc.cpp:
        (WTF::fastMallocGoodSize):
        * wtf/FastMalloc.h:
        * wtf/Vector.h:
        (WTF::VectorBufferBase::allocateBuffer):
        (WTF::VectorBufferBase::tryAllocateBuffer):
        (WTF::VectorBufferBase::reallocateBuffer):

2015-05-15  Dan Bernstein  <mitz@apple.com>

        Build fix for some versions of clang.

        * wtf/SaturatedArithmetic.h:
        (signedAddOverflows):
        (signedSubtractOverflows):

2015-05-14  Dan Bernstein  <mitz@apple.com>

        Reverted r177753, now that <rdar://problem/19347133> is fixed.

        Rubber-stamped by Benjamin Poulain.

        * wtf/SaturatedArithmetic.h:
        (signedAddOverflows):
        (signedSubtractOverflows):

2015-05-14  Myles C. Maxfield  <mmaxfield@apple.com>

        Add String literal overloads to equalIgnoringASCIICase()
        https://bugs.webkit.org/show_bug.cgi?id=145008

        Reviewed by Benjamin Poulain.

        Create an overload for equalIgnoringASCIICase for string literals.

        * wtf/text/StringImpl.h:
        (WTF::equalIgnoringASCIICase): Use a non-templated helper function.
        * wtf/text/StringImpl.cpp:
        (WTF::equalIgnoringASCIICase): Implement it.
        * wtf/text/StringView.h:
        (WTF::equalIgnoringASCIICase): Use a non-templated helper function.
        * wtf/text/StringView.cpp:
        (WTF::equalIgnoringASCIICase): Implement it.
        * wtf/text/WTFString.h:
        (WTF::equalIgnoringASCIICase): Delegate to StringImpl's implementation.

2015-05-14  Žan Doberšek  <zdobersek@igalia.com>

        [GTK] RunLoop constructor should properly retrieve or establish the thread-default GMainContext
        https://bugs.webkit.org/show_bug.cgi?id=144732

        Reviewed by Carlos Garcia Campos.

        RunLoop constructor in the GTK implementation should use the
        existing thread-default context, create a new one if not on
        the main thread, or use the global-default one if on the main
        thread.

        In RunLoop::run(), the GMainContext should then be pushed as
        the thread-default before calling g_main_loop_run(), and popped
        off when the main loop stops.

        * wtf/gtk/RunLoopGtk.cpp:
        (WTF::RunLoop::RunLoop):
        (WTF::RunLoop::run):

2015-05-13  Oliver Hunt  <oliver@apple.com>
       Ensure that all the smart pointer types in WTF clear their pointer before deref
       https://bugs.webkit.org/show_bug.cgi?id=143789

       Reviewed by Ryosuke Niwa.

       In order to prevent use after free bugs caused by destructors
       that end up trying to access the smart pointer itself, we should
       make sure we always clear the m_ptr field before calling deref.

       Essentially the UaF path is:
       struct Foo : RefCounted<Foo> {
         Wibble* m_wibble;
         void doSomething();
         ~Foo() { m_wibble->doSomethingLikeCleanup(); }
       };

       struct Wibble {
         void doSomethingLikeCleanup()
         {
           if (m_foo) {
               /* if this branch is not here we get a null deref */
               m_foo->doSomething();
           }
         }
         void replaceFoo(Foo* foo) { m_foo = foo; }
         RefPtr<Foo> m_foo;
       };

       Wibble* someWibble = /* a Wibble with m_foo->m_refCount == 1 */;
                            /* and m_foo points to someWibble       */;

       someWibble->replaceFoo(someOtherFoo);
       + someWibble->m_foo->m_ptr->deref();
         + someWibble->m_foo->m_ptr->~Foo()
           + someWibble->m_foo->m_ptr->m_wibble->doSomethingLikeCleanup()
             + someWibble->m_foo->m_ptr->m_wibble /* someWibble */ ->m_foo->m_ptr /*logically dead*/ ->doSomething()

       By clearing m_ptr first we either force a null pointer deref or
       we force our code down a path that does not use the dead smart
       pointer.

       * wtf/PassRefPtr.h:
       (WTF::PassRefPtr::~PassRefPtr):
       * wtf/Ref.h:
       (WTF::Ref::~Ref):
       (WTF::Ref::operator=):
       * wtf/RefPtr.h:
       (WTF::RefPtr::~RefPtr):
       * wtf/RetainPtr.h:
       (WTF::RetainPtr::~RetainPtr):
       (WTF::RetainPtr<T>::clear):

2015-05-12  Michael Saboff  <msaboff@apple.com>

        If JSC cannot get executable memory, it shouldn't call madvise
        https://bugs.webkit.org/show_bug.cgi?id=144931

        Reviewed by Mark Lam.

        Made calling madvise conditional on really getting mmapped memory.

        * wtf/OSAllocatorPosix.cpp:
        (WTF::OSAllocator::reserveUncommitted):

2015-05-11  Brent Fulgham  <bfulgham@apple.com>

        [Win] Move Windows build target to Windows 7 (or newer)
        https://bugs.webkit.org/show_bug.cgi?id=144890
        <rdar://problem/20707307>

        Reviewed by Anders Carlsson.

        Update linked SDK and minimal Windows level to be compatible with
        Windows 7 or newer.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTFGenerated.vcxproj:
        * config.h:

2015-05-11  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] WorkQueue objects are not released
        https://bugs.webkit.org/show_bug.cgi?id=144824

        Reviewed by Žan Doberšek.

        Do not keep a reference of the WorkQueue for the entire life of
        its worker thread, since every task scheduled on the WorkQueue
        already takes a reference. Instead, take a reference of the main
        loop to make sure that when the worker thread starts, the main
        loop hasn't been released to avoid runtime warnings (see
        webkit.org/b/140998). Also removed the g_main_context_pop_thread_default()
        from the thread body, since the thread-specific context queue will
        be freed anyway when the thread exits.
        If the WorkQueue is released early, before the thread has started,
        schedule a main loop quit in the context, to make sure it will
        be the first thing run by the main loop and the thread will exit.

        * wtf/WorkQueue.h: Remove unused event loop mutex.
        * wtf/gtk/WorkQueueGtk.cpp:
        (WTF::WorkQueue::platformInitialize):
        (WTF::WorkQueue::platformInvalidate):

2015-05-09  Yoav Weiss  <yoav@yoav.ws>

        Remove the PICTURE_SIZES build flag
        https://bugs.webkit.org/show_bug.cgi?id=144679

        Reviewed by Benjamin Poulain.

        Removed the PICTURE_SIZES build time flag.

        * wtf/FeatureDefines.h:

2015-05-08  Myles C. Maxfield  <mmaxfield@apple.com>

        Remove convenience constructors for TextRun
        https://bugs.webkit.org/show_bug.cgi?id=144752

        Reviewed by Anders Carlsson.

        No reason why StringView shouldn't have a StringImpl* constructor.

        Test: StringView8Bit in TestWebKitAPI

        * wtf/text/StringView.h: Add the constructor.

2015-05-08  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r183996.
        https://bugs.webkit.org/show_bug.cgi?id=144806

        ASan detected use-after free (Requested by ap on #webkit).

        Reverted changeset:

        "Remove convenience constructors for TextRun"
        https://bugs.webkit.org/show_bug.cgi?id=144752
        http://trac.webkit.org/changeset/183996

2015-05-08  Myles C. Maxfield  <mmaxfield@apple.com>

        Remove convenience constructors for TextRun
        https://bugs.webkit.org/show_bug.cgi?id=144752

        Reviewed by Anders Carlsson.

        No reason why StringView shouldn't have a StringImpl* constructor.

        Test: StringView8Bit in TestWebKitAPI

        * wtf/text/StringView.h: Add the constructor.

2015-05-08  Andreas Kling  <akling@apple.com>

        Optimize serialization of quoted JSON strings.
        <https://webkit.org/b/144754>

        Reviewed by Darin Adler.

        Add a StringBuilder API for appending a quoted JSON string. This is used by
        JSON.stringify() to implement efficient appending of strings while escaping
        quotes, control characters and \uNNNN-style characters.

        The main benefit comes from only doing a single buffer expansion up front,
        instead of doing it every time we append something. The fudge factor is pretty
        large, since the maximum number of output characters per input character is 6.

        The first landing of this patch had two bugs in it:

        - Made \uNNNN escapes uppercase hexadecimal instead of lowercase.
        - Didn't preallocate enough space for 8-bit input strings.

        Both were caught by existing tests on our bots, and both were due to last-minute
        changes before landing. :/

        * wtf/text/StringBuilder.cpp:
        (WTF::appendQuotedJSONStringInternal):
        (WTF::StringBuilder::appendQuotedJSONString):
        * wtf/text/StringBuilder.h:

2015-05-07  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r183961.
        https://bugs.webkit.org/show_bug.cgi?id=144784

        Broke js/dom/JSON-stringify.html (Requested by kling on
        #webkit).

        Reverted changeset:

        "Optimize serialization of quoted JSON strings."
        https://bugs.webkit.org/show_bug.cgi?id=144754
        http://trac.webkit.org/changeset/183961

2015-05-07  Andreas Kling  <akling@apple.com>

        Optimize serialization of quoted JSON strings.
        <https://webkit.org/b/144754>

        Reviewed by Darin Adler.

        Add a StringBuilder API for appending a quoted JSON string. This is used by
        JSON.stringify() to implement efficient appending of strings while escaping
        quotes, control characters and \uNNNN-style characters.

        The main benefit comes from only doing a single buffer expansion up front,
        instead of doing it every time we append something. The fudge factor is pretty
        large for 16-bit strings, since the maximum number of output characters per
        input character is 6.

        * wtf/text/StringBuilder.cpp:
        (WTF::appendQuotedJSONStringInternal):
        (WTF::StringBuilder::appendQuotedJSONString):
        * wtf/text/StringBuilder.h:

2015-05-07  Martin Robinson  <mrobinson@igalia.com>

        [GTK] All spell checking layout tests fail
        https://bugs.webkit.org/show_bug.cgi?id=144648

        Reviewed by Carlos Garcia Campos.

        * wtf/Platform.h: Activate UNIFIED_TEXT_CHECKING for GTK+.

2015-05-07  Dan Bernstein  <mitz@apple.com>

        <rdar://problem/19317140> [Xcode] Remove usage of AspenFamily.xcconfig in Source/
        https://bugs.webkit.org/show_bug.cgi?id=144727

        Reviewed by Darin Adler.

        * Configurations/Base.xcconfig: Don’t include AspenFamily.xcconfig, and define
        INSTALL_PATH_PREFIX and LD_DYLIB_INSTALL_NAME for the iOS 8.x Simulator.

2015-05-07  Žan Doberšek  <zdobersek@igalia.com>

        [GTK] Clean up RunLoop implementation
        https://bugs.webkit.org/show_bug.cgi?id=144729

        Reviewed by Carlos Garcia Campos.

        Clean up the RunLoop implementation for the GTK port,
        removing unnecessary methods and using simpler variable names.

        Nested GMainLoops in RunLoop::run() are now created for the
        RunLoop's GMainContext, and not for the default context (enforced
        through the null argument to g_main_loop_new()).

        * wtf/RunLoop.h:
        * wtf/gtk/RunLoopGtk.cpp:
        (WTF::RunLoop::RunLoop):
        (WTF::RunLoop::~RunLoop):
        (WTF::RunLoop::run):
        (WTF::RunLoop::stop):
        (WTF::RunLoop::wakeUp):
        (WTF::RunLoop::TimerBase::start):
        (WTF::RunLoop::innermostLoop): Deleted.
        (WTF::RunLoop::pushNestedMainLoop): Deleted.
        (WTF::RunLoop::popNestedMainLoop): Deleted.

2015-05-05  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Async operations running in the WorkQueue thread should schedule their sources to the WorkQueue main lopp
        https://bugs.webkit.org/show_bug.cgi?id=144541

        Reviewed by Žan Doberšek.

        They are currently sent to the main thread run loop, because we
        are not setting the WorkQueue main context as the default one in
        the worker thread.

        * wtf/gtk/WorkQueueGtk.cpp:
        (WTF::WorkQueue::platformInitialize): Call
        g_main_context_push_thread_default() to set the WorkQueue main
        context as the default of the thread before running the main loop,
        and g_main_context_pop_thread_default() when the main loop quits.

2015-05-04  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r183661.
        https://bugs.webkit.org/show_bug.cgi?id=144594

        Caused ~3.5MB regression on membuster(!) (Requested by kling_
        on #webkit).

        Reverted changeset:

        "Decrease minimum Vector size."
        https://bugs.webkit.org/show_bug.cgi?id=144453
        http://trac.webkit.org/changeset/183661

2015-05-04  Zan Dobersek  <zdobersek@igalia.com>

        [WTF] Remove Functional.h inclusions
        https://bugs.webkit.org/show_bug.cgi?id=144400

        Reviewed by Darin Adler.

        Remove most of the Functional.h header inclusions. The header is preserved
        since it's still used by older versions of Safari, and for the callOnMainThread()
        stub in DeprecatedSymbolsUsedBySafari.mm.

        * wtf/MainThread.cpp:
        * wtf/RunLoop.h:
        * wtf/WorkQueue.cpp:
        * wtf/WorkQueue.h:
        * wtf/efl/DispatchQueueEfl.h:
        * wtf/efl/DispatchQueueWorkItemEfl.h:

2015-05-02  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r183722.
        https://bugs.webkit.org/show_bug.cgi?id=144534

        Made all the tests assert (Requested by ap on #webkit).

        Reverted changeset:

        "Generated static StringImpls should have static flag set."
        https://bugs.webkit.org/show_bug.cgi?id=144516
        http://trac.webkit.org/changeset/183722

2015-05-02  Andreas Kling  <akling@apple.com>

        Generated static StringImpls should have static flag set.
        <https://webkit.org/b/144516>

        Reviewed by Darin Adler.

        Discovered this while tracking down a string ref leak. Turns out that the strings
        generated by StaticString.pm were not getting the static flag set on them.

        The only practical difference from this AFAICT is that now the garbage collector
        will correctly see that these strings have no extra memory cost to worry about.

        * wtf/text/StringImpl.h:

2015-05-01  Martin Robinson  <mrobinson@igalia.com>

        USE(...) macro should expect unprefixed variables
        https://bugs.webkit.org/show_bug.cgi?id=144454

        Reviewed by Daniel Bates.

        * wtf/Assertions.cpp: Replace all occurrences WTF_USE with USE.
        * wtf/Platform.h: Replace all occurrences WTF_USE with USE. Modify the USE
        macro to look for unprefixed variables.
        * wtf/WTFThreadData.h: Replace all occurrences WTF_USE with USE.

2015-05-01  Joseph Pecoraro  <pecoraro@apple.com>

        Enable ENABLE_ES6_TEMPLATE_LITERAL_SYNTAX by default on all ports (Windows was missed)
        https://bugs.webkit.org/show_bug.cgi?id=144495

        Reviewed by Csaba Osztrogonác.

        * wtf/FeatureDefines.h:
        This covers all ports that haven't defined the flag otherwise.

2015-04-30  Alex Christensen  <achristensen@webkit.org>

        Decrease minimum Vector size.
        https://bugs.webkit.org/show_bug.cgi?id=144453

        Reviewed by Andreas Kling.

        * wtf/Vector.h:
        Make the default min size 4 to save memory on small Vectors.

2015-04-30  Yusuke Suzuki  <utatane.tea@gmail.com>

        Use the default hash value for Symbolized StringImpl
        https://bugs.webkit.org/show_bug.cgi?id=144347

        Reviewed by Darin Adler.

        Use a default hash value calculation for symbolized StringImpl.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::createSymbol):
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::StringImpl):
        (WTF::StringImpl::symbolAwareHash):
        (WTF::StringImpl::existingSymbolAwareHash):
        (WTF::StringImpl::hashForSymbol):
        * wtf/text/StringStatics.cpp:
        (WTF::StringImpl::nextHashForSymbol):
        (WTF::StringImpl::hashAndFlagsForSymbol): Deleted.

2015-04-29  Alexey Proskuryakov  <ap@apple.com>

        LazyNeverDestroyed is not thread safe in debug builds, causing assertions
        https://bugs.webkit.org/show_bug.cgi?id=144378

        Reviewed by Darin Adler.

        * wtf/NeverDestroyed.h:

2015-04-28  Geoffrey Garen  <ggaren@apple.com>

        It shouldn't take 1846 lines of code and 5 FIXMEs to sort an array.
        https://bugs.webkit.org/show_bug.cgi?id=144013

        Reviewed by Mark Lam.

        Remove this custom tree implementation because it is unused. (It was
        previously used to achieve a stable array sort in certain cases.)

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/AVLTree.h: Removed.
        * wtf/CMakeLists.txt:

2015-04-29  Myles C. Maxfield  <mmaxfield@apple.com>

        [OS X] Use CTFontCreateForCSS instead of doing font search ourselves
        https://bugs.webkit.org/show_bug.cgi?id=132159

        Reviewed by Darin Adler.

        * wtf/Platform.h:

        Opt-in using ENABLE(PLATFORM_FONT_LOOKUP)

2015-04-29  Yusuke Suzuki  <utatane.tea@gmail.com>

        REGRESSION (r183373): ASSERT failed in wtf/SHA1.h
        https://bugs.webkit.org/show_bug.cgi?id=144257

        Reviewed by Darin Adler.

        * wtf/SHA1.h:
        (WTF::SHA1::addBytes):

2015-04-29  Martin Robinson  <mrobinson@igalia.com>

        [CMake] [GTK] Organize and clean up unused CMake variables
        https://bugs.webkit.org/show_bug.cgi?id=144364

        Reviewed by Gyuyoung Kim.

        * wtf/PlatformGTK.cmake: Add variables specific to this project.

2015-04-28  Michael Catanzaro  <mcatanzaro@igalia.com>

        Fully replace ENABLE_LLINT_C_LOOP with ENABLE_JIT
        https://bugs.webkit.org/show_bug.cgi?id=144304

        Reviewed by Geoffrey Garen.

        No longer check ENABLE_LLINT_C_LOOP to determine the value of ENABLE_JIT.

        * wtf/Platform.h:

2015-04-28  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r183514.
        https://bugs.webkit.org/show_bug.cgi?id=144359

        It broke cloop test bots (Requested by mcatanzaro on #webkit).

        Reverted changeset:

        "Fully replace ENABLE_LLINT_C_LOOP with ENABLE_JIT"
        https://bugs.webkit.org/show_bug.cgi?id=144304
        http://trac.webkit.org/changeset/183514

2015-04-28  Michael Catanzaro  <mcatanzaro@igalia.com>

        Fully replace ENABLE_LLINT_C_LOOP with ENABLE_JIT
        https://bugs.webkit.org/show_bug.cgi?id=144304

        Reviewed by Geoffrey Garen.

        No longer check ENABLE_LLINT_C_LOOP to determine the value of ENABLE_JIT.

        * wtf/Platform.h:

2015-04-28  Alex Christensen  <achristensen@webkit.org>

        Properly reset deleted count when clearing HashTables.
        https://bugs.webkit.org/show_bug.cgi?id=144343

        Reviewed by Andreas Kling.

        * wtf/HashTable.h:
        (WTF::KeyTraits>::clear):
        Reset m_deletedCount, which appears to have been forgotten.

2015-04-28  Alex Christensen  <achristensen@webkit.org>

        [Content Extensions] Use less memory for CombinedURLFilters.
        https://bugs.webkit.org/show_bug.cgi?id=144290

        Reviewed by Andreas Kling.

        * wtf/Forward.h:
        * wtf/Vector.h:
        Added a minCapacity template parameter to allow changing the minimum size of an 
        allocated buffer. The default minCapacity is kept at 16 unless otherwise specified 
        to have no change on existing code, but this could be changed later. A smaller 
        default minCapacity would use less memory with small Vectors but spend more time 
        copying when expanding to large Vectors.

2015-04-27  Brent Fulgham  <bfulgham@apple.com>

        [Win] Deactivate WebGL until Windows tests work properly
        https://bugs.webkit.org/show_bug.cgi?id=144291
        <rdar://problem/20707307>

        Reviewed by Zalan Bujtas.

        * wtf/FeatureDefines.h: Force WebGL off for Windows builds.

2015-04-27  Michael Catanzaro  <mcatanzaro@igalia.com>

        Rename WTF_USE_3D_GRAPHICS to ENABLE_GRAPHICS_CONTEXT_3D
        https://bugs.webkit.org/show_bug.cgi?id=144193

        Reviewed by Darin Adler.

        * wtf/FeatureDefines.h:
        * wtf/Platform.h:

2015-04-22  Martin Robinson  <mrobinson@igalia.com>

        [CMake] Autogenerate cmakeconfig.h.cmake
        https://bugs.webkit.org/show_bug.cgi?id=143997

        Reviewed by Csaba Osztrogonác.

        * wtf/Platform.h: Move a GTK-specific setting from cmakeconfig.h to here.

2015-04-25  Martin Robinson  <mrobinson@igalia.com>

        Rename ENABLE_3D_RENDERING to ENABLE_3D_TRANSFORMS
        https://bugs.webkit.org/show_bug.cgi?id=144182

        Reviewed by Simon Fraser.

        * wtf/FeatureDefines.h: Replace all instances of 3D_RENDERING with 3D_TRANSFORMS.

2015-04-24  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r183288.
        https://bugs.webkit.org/show_bug.cgi?id=144189

        Made js/sort-with-side-effecting-comparisons.html time out in
        debug builds (Requested by ap on #webkit).

        Reverted changeset:

        "It shouldn't take 1846 lines of code and 5 FIXMEs to sort an
        array."
        https://bugs.webkit.org/show_bug.cgi?id=144013
        http://trac.webkit.org/changeset/183288

2015-04-21  Geoffrey Garen  <ggaren@apple.com>

        It shouldn't take 1846 lines of code and 5 FIXMEs to sort an array.
        https://bugs.webkit.org/show_bug.cgi?id=144013

        Reviewed by Mark Lam.

        Remove this custom tree implementation because it is unused. (It was
        previously used to achieve a stable array sort in certain cases.)

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/AVLTree.h: Removed.
        * wtf/CMakeLists.txt:

2015-04-24  Darin Adler  <darin@apple.com>

        Convert OwnPtr and PassOwnPtr uses to std::unique_ptr
        https://bugs.webkit.org/show_bug.cgi?id=128007

        Reviewed by Anders Carlsson.

        * WTF.vcxproj/WTF.vcxproj: Removed OwnPtr source files.
        * WTF.vcxproj/WTF.vcxproj.filters: Ditto.
        * WTF.xcodeproj/project.pbxproj: Ditto.
        * wtf/CMakeLists.txt: Ditto.

        * wtf/Forward.h: Removed OwnPtr and PassOwnPtr.
        * wtf/HashTraits.h: Ditto.

        * wtf/OwnPtr.h: Removed.
        * wtf/OwnPtrCommon.h: Removed.
        * wtf/PassOwnPtr.h: Removed.

        * wtf/SizeLimits.cpp: Removed OwnPtr.
        * wtf/VectorTraits.h: Removed OwnPtr specialization.

2015-04-23  Jer Noble  <jer.noble@apple.com>

        Disable HAVE_AVKIT on AppleTV
        https://bugs.webkit.org/show_bug.cgi?id=144142

        Reviewed by Dan Bernstein.

        * wtf/Platform.h:

2015-04-23  Alexey Proskuryakov  <ap@apple.com>

        [iOS] WebKit services should inherit environment variables for home
        https://bugs.webkit.org/show_bug.cgi?id=144078
        rdar://problem/20571678

        Reviewed by Dan Bernstein.

        * wtf/spi/darwin/XPCSPI.h: Added xpc_copy_bootstrap and xpc_dictionary_apply.

2015-04-23  Alexey Proskuryakov  <ap@apple.com>

        Undo the WTF part of the previous build fix, we don't use private headers in WTF.

        * WTF.xcodeproj/project.pbxproj:

2015-04-23  Alexey Proskuryakov  <ap@apple.com>

        Build fix.

        * WTF.xcodeproj/project.pbxproj: Make RAMSize.h a private header, now that it's used
        from outside WTF.

2015-04-23  Andreas Kling  <akling@apple.com>

        There should only be one way to get the system memory size.
        <https://webkit.org/b/144081>

        Reviewed by Antti Koivisto.

        Merge all the logic from other RAM size fetcher helpers into WTF's.

        Darwin ports now use host_info() instead of sysctl(), since that was the more common way
        of doing this.

        Also bumped the fallback answer from 128 MB to 512 MB to bring it closer to today's hardware.

        Finally, the number is rounded up to the next multiple of 128 MB, to avoid misunderstandings
        on some systems where the number returned by the kernel is slightly lower than the marketing
        number. Removed the "fudging" that was used in some places, since this fixes that cleanly.

        * wtf/RAMSize.cpp:
        (WTF::computeRAMSize):

2015-04-22  Darin Adler  <darin@apple.com>

        Eliminate remaining uses of OwnPtr and PassOwnPtr in WebCore outside the editing and platform directories
        https://bugs.webkit.org/show_bug.cgi?id=143949

        Reviewed by Andreas Kling.

        * wtf/MathExtras.h:
        (wtf_ceil): Deleted. This was a workaround for a bug that was introduced in Leopard and
        fixed in Snow Leopard <rdar://problem/6286405>, so we don't need the workaround any more.

2015-04-22  Alexey Proskuryakov  <ap@apple.com>

        [Mac] In nightlies and local builds, WebKit services can get terminated under memory pressure
        https://bugs.webkit.org/show_bug.cgi?id=144052
        rdar://problem/19754404

        Build fix. Landing a forward declaration that should have been part of the original patch.

        * wtf/spi/darwin/XPCSPI.h:

2015-04-21  Chris Dumez  <cdumez@apple.com>

        Make Vector(const Vector<T, otherCapacity, otherOverflowBehaviour>&) constructor explicit
        https://bugs.webkit.org/show_bug.cgi?id=143970

        Reviewed by Darin Adler.

        Make Vector(const Vector<T, otherCapacity, otherOverflowBehaviour>&)
        constructor explicit as it copies the vector and it is easy to call it
        by mistake.

        * wtf/RefCountedArray.h:
        (WTF::RefCountedArray::RefCountedArray):
        * wtf/Vector.h:

2015-04-21  Darin Adler  <darin@apple.com>

        Remove some stray uses of OwnPtr and PassOwnPtr in WTF (outside of the template definitions and traits)
        https://bugs.webkit.org/show_bug.cgi?id=143944

        Reviewed by Andreas Kling.

        * wtf/FilePrintStream.h: Removed unneeded include.
        * wtf/HashTable.h: Fixed class template name in comment.
        * wtf/HashTraits.h: Removed unneeded forward declaration.
        * wtf/ListHashSet.h: Removed unneeded includes.
        * wtf/ThreadingWin.cpp: Removed unneeded includes.
        (WTF::wtfThreadEntryPoint): Changed code to use unique_ptr.
        (WTF::createThreadInternal): Changed code to use make_unique and release.
        * wtf/efl/RunLoopEfl.cpp: Removed unneeded includes.

2015-04-19  Darin Adler  <darin@apple.com>

        Update RefPtr documentation and deprecation
        https://bugs.webkit.org/show_bug.cgi?id=143936

        Reviewed by Andreas Kling.

        * WTF.vcxproj/WTF.vcxproj: Removed PassRef.h
        * WTF.vcxproj/WTF.vcxproj.filters: Ditto.
        * WTF.xcodeproj/project.pbxproj: Ditto.
        * wtf/CMakeLists.txt: Ditto.

2015-04-17  Alexey Proskuryakov  <ap@apple.com>

        Use ASan poisoning to taint moved-out-of Refs
        https://bugs.webkit.org/show_bug.cgi?id=143894
        rdar://problem/19443723

        Reviewed by Darin Adler.

        * wtf/Ref.h: (WTF::Ref::~Ref):

2015-04-17  Alexey Proskuryakov  <ap@apple.com>

        Remove unused BoundsCheckedPointer
        https://bugs.webkit.org/show_bug.cgi?id=143896

        Reviewed by Geoffrey Garen.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/BoundsCheckedPointer.h: Removed.
        * wtf/CMakeLists.txt:

2015-04-16  Yusuke Suzuki  <utatane.tea@gmail.com>

        [ES6] Implement Symbol.for and Symbol.keyFor
        https://bugs.webkit.org/show_bug.cgi?id=143404

        Reviewed by Geoffrey Garen.

        When we register symbolized StringImpl* into SymbolRegistry, symbolized StringImpl* is aware of that.
        And when destructing it, it removes its reference from SymbolRegistry as if atomic StringImpl do so with AtomicStringTable.
        While AtomicStringTable (in WebCore case) exists in thread local storage,
        SymbolRegistry exists per VM and StringImpl* has a reference to the registered SymbolRegistry.

        Since StringImpl has isSymbol etc. members, it's class is aware of Symbol use cases.
        So introduce SymbolRegistry in WTF layers as if AtomicStringTable.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/text/AtomicString.cpp:
        (WTF::AtomicString::addSlowCase):
        (WTF::AtomicString::findSlowCase):
        (WTF::AtomicString::findInternal):
        (WTF::AtomicString::find): Deleted.
        * wtf/text/AtomicString.h:
        (WTF::AtomicString::find):
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::~StringImpl):
        (WTF::StringImpl::createSymbol):
        (WTF::StringImpl::createSymbolEmpty):
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::StringImpl):
        (WTF::StringImpl::extractFoldedStringInSymbol):
        (WTF::StringImpl::symbolRegistry):
        (WTF::StringImpl::createSymbolEmpty): Deleted.
        * wtf/text/SymbolRegistry.cpp: Copied from Source/JavaScriptCore/runtime/SymbolConstructor.h.
        (WTF::SymbolRegistry::~SymbolRegistry):
        (WTF::SymbolRegistry::symbolForKey):
        (WTF::SymbolRegistry::keyForSymbol):
        (WTF::SymbolRegistry::remove):
        * wtf/text/SymbolRegistry.h: Added.
        (WTF::SymbolRegistryKey::hash):
        (WTF::SymbolRegistryKey::impl):
        (WTF::SymbolRegistryKey::isHashTableDeletedValue):
        (WTF::SymbolRegistryKey::hashTableDeletedValue):
        (WTF::DefaultHash<SymbolRegistryKey>::Hash::hash):
        (WTF::DefaultHash<SymbolRegistryKey>::Hash::equal):
        (WTF::HashTraits<SymbolRegistryKey>::isEmptyValue):
        (WTF::SymbolRegistryKey::SymbolRegistryKey):

2015-04-16  Antti Koivisto  <antti@apple.com>

        Use CommonCrypto for SHA1 and MD5
        https://bugs.webkit.org/show_bug.cgi?id=143826

        Reviewed by Anders Carlsson.

        CommonCrypto SHA1 implementation is ~4x faster than the naive WTF one. Use it when available.

        These are covered by existing API tests.

        * wtf/MD5.cpp:
        (WTF::MD5::MD5):
        (WTF::MD5::addBytes):
        (WTF::MD5::checksum):
        * wtf/MD5.h:
        * wtf/SHA1.cpp:
        (WTF::SHA1::SHA1):
        (WTF::SHA1::addBytes):
        (WTF::SHA1::computeHash):

            Remove the side effect where computeHash resets the state. No one relies on it.

        (WTF::SHA1::hexDigest):
        (WTF::SHA1::computeHexDigest):
        * wtf/SHA1.h:

2015-04-16  Csaba Osztrogonác  <ossy@webkit.org>

        Remove the unnecessary WTF_CHANGES define
        https://bugs.webkit.org/show_bug.cgi?id=143825

        Reviewed by Andreas Kling.

        * config.h:

2015-04-15  Руслан Ижбулатов  <lrn1986@gmail.com>

        Harmonize binary semaphore ifdefs

        They should be either OS(WINDOWS) (in which case we'd need
        BinarySemaphoreWin.cpp, which is not shipped by WebKitGTK)
        or PLATFORM(WIN) (in which case Mutex/ThreadCondition-based
        implementation is used).

        This fixes errors like:
          CXX      Source/WTF/wtf/threads/libWTF_la-BinarySemaphore.lo
        ../webkitgtk-2.4.8/Source/WTF/wtf/threads/BinarySemaphore.cpp: In constructor 'WTF::BinarySemaphore::BinarySemaphore()':
        ../webkitgtk-2.4.8/Source/WTF/wtf/threads/BinarySemaphore.cpp:34:7: error: class 'WTF::BinarySemaphore' does not have any field named 'm_isSet'
             : m_isSet(false)
               ^
        ../webkitgtk-2.4.8/Source/WTF/wtf/threads/BinarySemaphore.cpp: In member function 'void WTF::BinarySemaphore::signal()':
        ../webkitgtk-2.4.8/Source/WTF/wtf/threads/BinarySemaphore.cpp:44:24: error: 'm_mutex' was not declared in this scope
             MutexLocker locker(m_mutex);
                                ^
        ../webkitgtk-2.4.8/Source/WTF/wtf/threads/BinarySemaphore.cpp:46:5: error: 'm_isSet' was not declared in this scope
             m_isSet = true;
             ^
        ../webkitgtk-2.4.8/Source/WTF/wtf/threads/BinarySemaphore.cpp:47:5: error: 'm_condition' was not declared in this scope
             m_condition.signal();
             ^
        ../webkitgtk-2.4.8/Source/WTF/wtf/threads/BinarySemaphore.cpp: In member function 'bool WTF::BinarySemaphore::wait(double)':
        ../webkitgtk-2.4.8/Source/WTF/wtf/threads/BinarySemaphore.cpp:52:24: error: 'm_mutex' was not declared in this scope
             MutexLocker locker(m_mutex);
                                ^
        ../webkitgtk-2.4.8/Source/WTF/wtf/threads/BinarySemaphore.cpp:55:13: error: 'm_isSet' was not declared in this scope
             while (!m_isSet) {
                     ^
        ../webkitgtk-2.4.8/Source/WTF/wtf/threads/BinarySemaphore.cpp:56:21: error: 'm_condition' was not declared in this scope
                 timedOut = !m_condition.timedWait(m_mutex, absoluteTime);
                             ^
        ../webkitgtk-2.4.8/Source/WTF/wtf/threads/BinarySemaphore.cpp:62:5: error: 'm_isSet' was not declared in this scope
             m_isSet = false;
             ^
        GNUmakefile:52762: recipe for target 'Source/WTF/wtf/threads/libWTF_la-BinarySemaphore.lo' failed

        [W32] Inconsistent ifdefs in BinarySemaphore.h and BinarySemaphore.cpp
        https://bugs.webkit.org/show_bug.cgi?id=143756

        Reviewed by Darin Adler.

        * wtf/threads/BinarySemaphore.h:

2015-04-12  Michael Catanzaro  <mcatanzaro@igalia.com>

        Fix -Wparentheses warning with GCC 5 in SaturatedArithmetic.h
        https://bugs.webkit.org/show_bug.cgi?id=143457

        Reviewed by Benjamin Poulain.

        Tested by WTF.SaturatedArithmeticAddition and WTF.SaturatedArithmeticSubtraction.

        * wtf/SaturatedArithmetic.h:
        (signedAddOverflows): Use && instead of & to avoid triggering -Wparentheses in newer
        versions of GCC and Clang, and to improve the clarity of the function.
        (signedSubtractOverflows): Changed correspondingly, although there was no warning here.

2015-04-08  Sam Weinig  <sam@webkit.org>

        Allow LaunchServices to handle URLs on link navigations
        <rdar://problem/19446826>
        https://bugs.webkit.org/show_bug.cgi?id=143544

        Reviewed by Anders Carlsson.

        * wtf/Platform.h:
        Add HAVE macro for this functionality.

2015-04-09  Andy Estes  <aestes@apple.com>

        [Cocoa] Add a HAVE(AVKIT) and use it
        https://bugs.webkit.org/show_bug.cgi?id=143593

        Reviewed by David Kilzer.

        * wtf/Platform.h: Defined HAVE(AVKIT) to be true on all Cocoa platforms except Watch OS.

2015-04-09  Andy Estes  <aestes@apple.com>

        [Content Filtering] Add a HAVE(PARENTAL_CONTROLS) and use it
        https://bugs.webkit.org/show_bug.cgi?id=143559

        Reviewed by David Kilzer.

        Added PLATFORM(WATCHOS). Used PLATFORM() since Watch OS is just a variant of OS(IOS).
        Defined HAVE(PARENTAL_CONTROLS) to be true on all Cocoa platforms except Watch OS.

        * wtf/Platform.h:

2015-04-08  Alex Christensen  <achristensen@webkit.org> and Patrick Gansterer  <paroga@webkit.org>

        Add CMake build system for WinCairo port.
        https://bugs.webkit.org/show_bug.cgi?id=115944

        Reviewed by Chris Dumez.

        * wtf/FeatureDefines.h:
        * wtf/PlatformWin.cmake:

2015-04-05  Antti Koivisto  <antti@apple.com>

        Bloom filter should support longer hashes
        https://bugs.webkit.org/show_bug.cgi?id=143419

        Reviewed by Dan Bernstein.

        It currently supports 'unsigned' hash only which is inconvenient and doesn't have enough independent bits for larger filters.

        Support arbitrarily sized hashes of type std::array<uint8_t, hashSize> (like SHA1::Digest and MD5::Digest).

        * wtf/BloomFilter.h:
        (WTF::BloomFilter<keyBits>::keysFromHash):
        (WTF::BloomFilter<keyBits>::mayContain):
        (WTF::BloomFilter<keyBits>::add):

2015-04-03  Antti Koivisto  <antti@apple.com>

        Add non-counting Bloom filter implementation
        https://bugs.webkit.org/show_bug.cgi?id=143366

        Reviewed by Sam Weinig.

        Add a traditional single-bit-per-bucket Bloom filter in addition to the existing counting implementation.

        - rename BloomFilter -> CountingBloomFilter.
        - add a new basic BloomFilter type.
        - update some terminology to match http://en.wikipedia.org/wiki/Bloom_filter and modernize the code a bit.
        - add API tests.

        * wtf/BloomFilter.h:
        (WTF::BloomFilter::BloomFilter):
        (WTF::BloomFilter::add):

            Also support merging.

        (WTF::BloomFilter::mayContain):
        (WTF::BloomFilter::arrayIndex):
        (WTF::BloomFilter::bitMask):
        (WTF::BloomFilter<keyBits>::mayContain):
        (WTF::BloomFilter<keyBits>::add):
        (WTF::BloomFilter<keyBits>::isBitSet):
        (WTF::BloomFilter<keyBits>::setBit):
        (WTF::BloomFilter<keyBits>::clear):
        (WTF::CountingBloomFilter::CountingBloomFilter):
        (WTF::CountingBloomFilter::mayContain):
        (WTF::CountingBloomFilter::firstBucket):
        (WTF::CountingBloomFilter::secondBucket):
        (WTF::CountingBloomFilter<keyBits>::add):
        (WTF::CountingBloomFilter<keyBits>::remove):
        (WTF::CountingBloomFilter<keyBits>::clear):
        (WTF::CountingBloomFilter<keyBits>::likelyEmpty):
        (WTF::CountingBloomFilter<keyBits>::isClear):
        (WTF::BloomFilter::maximumCount): Deleted.
        (WTF::BloomFilter::firstSlot): Deleted.
        (WTF::BloomFilter::secondSlot): Deleted.
        (WTF::BloomFilter<keyBits>::remove): Deleted.
        (WTF::BloomFilter<keyBits>::likelyEmpty): Deleted.
        (WTF::BloomFilter<keyBits>::isClear): Deleted.

015-04-01  Antti Koivisto  <antti@apple.com>

        Value assignment operator of Optional should be stricter
        https://bugs.webkit.org/show_bug.cgi?id=143303

        Reviewed by Andreas Kling.

        struct Foo { mutable Optional<std::chrono::seconds> s; };
        Foo foo, foo2;
        foo = foo2;

        doesn't build because it tries to use wrong operator=.

        * wtf/Optional.h:

            Add enable_if test similar to std::experimental::optional.

2015-04-01  Alex Christensen  <achristensen@webkit.org>

        Progress towards CMake on Windows and Mac.
        https://bugs.webkit.org/show_bug.cgi?id=143293

        Reviewed by Filip Pizlo.

        * wtf/CMakeLists.txt:
        Don't use bmalloc on Windows yet.
        * wtf/FeatureDefines.h:
        Temporarily disabled WebGL on Windows CMake builds.
        * wtf/PlatformMac.cmake:
        Tell open source builders where to find unicode headers.

2015-03-31  Alexey Proskuryakov  <ap@apple.com>

        Fix the build after <http://trac.webkit.org/changeset/182205>.

        * wtf/text/StringImpl.h: (WTF::StringImpl::extractFoldedStringInSymbol):
        A function cannot be both exported and inline.

2015-03-31  Yusuke Suzuki  <utatane.tea@gmail.com>

        Clean up Identifier factories to clarify the meaning of StringImpl*
        https://bugs.webkit.org/show_bug.cgi?id=143146

        Reviewed by Filip Pizlo.

        Introduce StringKind into `StringImpl`. There's 3 kinds
        1. StringNormal (non-atomic, non-symbol)
        2. StringAtomic (atomic, non-symbol)
        3. StringSymbol (non-atomic, symbol)
        They are mutually exclusive.

        * wtf/text/AtomicString.cpp:
        (WTF::AtomicString::addSlowCase):
        (WTF::AtomicString::findSlowCase):
        When registering a string into AtomicStringTable,
        it should not be a symbol string
        because symbol and atomic types are mutually exclusive.
        When a symbol string comes, we extract an owner string
        from a symbol string by using `StringImpl::extractFoldedStringInSymbol()`.
        It always succeeds because a symbol (non empty) string
        is always BufferSubstring and has an owner string.
        Empty symbol string doesn't have an owner string.
        This case is filtered by `!string.length()` guard.
        * wtf/text/AtomicString.h:
        (WTF::AtomicString::add):
        (WTF::AtomicString::addWithStringTableProvider):
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::~StringImpl):
        (WTF::StringImpl::createSymbol):
        (WTF::StringImpl::createUnique): Deleted.
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::StringImpl):
        (WTF::StringImpl::createSymbolEmpty):
        (WTF::StringImpl::flagIsAtomic):
        (WTF::StringImpl::flagIsSymbol):
        (WTF::StringImpl::maskStringKind):
        (WTF::StringImpl::stringKind):
        (WTF::StringImpl::isSymbol):
        (WTF::StringImpl::isAtomic):
        (WTF::StringImpl::setIsAtomic):
        (WTF::StringImpl::extractFoldedStringInSymbol):
        (WTF::StringImpl::createUniqueEmpty): Deleted.
        (WTF::StringImpl::flagIsUnique): Deleted.
        (WTF::StringImpl::isUnique): Deleted.
        * wtf/text/StringStatics.cpp:
        (WTF::StringImpl::hashAndFlagsForSymbol):
        (WTF::StringImpl::hashAndFlagsForUnique): Deleted.

2015-03-30  Gyuyoung Kim  <gyuyoung.kim@samsung.com>

        [CMake][EFL] Remove redundant library link and include path
        https://bugs.webkit.org/show_bug.cgi?id=143221

        Reviewed by Csaba Osztrogonác.

        * wtf/PlatformEfl.cmake: Remove unnecessary library link and include path.

2015-03-27  Myles C. Maxfield  <mmaxfield@apple.com>

        Support building WTF on Windows without Cygwin
        https://bugs.webkit.org/show_bug.cgi?id=143084

        Reviewed by Brent Fulgham.

        Windows doesn't have "touch".

        * WTF.vcxproj/WTFGenerated.make:

2015-03-26  Alex Christensen  <achristensen@webkit.org>

        Progress towards CMake on Mac.
        https://bugs.webkit.org/show_bug.cgi?id=143112

        Reviewed by Chris Dumez.

        * wtf/PlatformMac.cmake:

2015-03-25  Filip Pizlo  <fpizlo@apple.com>

        Unreviewed, we have edited this file in 2015.

        * wtf/Platform.h:

2015-03-25  Filip Pizlo  <fpizlo@apple.com>

        Heap variables shouldn't end up in the stack frame
        https://bugs.webkit.org/show_bug.cgi?id=141174

        Reviewed by Geoffrey Garen.

        * wtf/FastBitVector.h:
        (WTF::FastBitVector::resize): Small change: don't resize if you don't have to resize.

2015-03-25  Filip Pizlo  <fpizlo@apple.com>

        Change Atomic methods from using the_wrong_naming_conventions to using theRightNamingConventions. Also make seq_cst the default.

        Rubber stamped by Geoffrey Garen.

        * wtf/Atomics.h:
        (WTF::Atomic::load):
        (WTF::Atomic::store):
        (WTF::Atomic::compareExchangeWeak):
        (WTF::Atomic::compareExchangeStrong):
        (WTF::Atomic::compare_exchange_weak): Deleted.
        (WTF::Atomic::compare_exchange_strong): Deleted.
        * wtf/ByteSpinLock.h:
        (WTF::ByteSpinLock::lock):
        * wtf/SpinLock.h:
        (WTF::SpinLockBase::lock):

2015-03-24  Beth Dakin  <bdakin@apple.com>

        Add events related to force click gesture
        https://bugs.webkit.org/show_bug.cgi?id=142836
        -and corresponding-
        rdar://problem/20210239

        Reviewed by Dean Jackson.

        New enable flag for the events.
        * wtf/FeatureDefines.h:

2015-03-23  Filip Pizlo  <fpizlo@apple.com>

        JSC should have a low-cost asynchronous disassembler
        https://bugs.webkit.org/show_bug.cgi?id=142997

        Reviewed by Mark Lam.

        * wtf/StringPrintStream.h:

2015-03-22  Benjamin Poulain  <benjamin@webkit.org>

        CSS Selectors: fix attribute case-insensitive matching of Contain and List
        https://bugs.webkit.org/show_bug.cgi?id=142932

        Reviewed by Darin Adler.

        Add some utility functions to the string classes to find substrings
        using ASCII case-insensitive comparisons.

        * wtf/text/AtomicString.h:
        (WTF::AtomicString::contains):
        Add the light version that only lock one register.

        (WTF::AtomicString::containsIgnoringASCIICase):
        (WTF::AtomicString::findIgnoringASCIICase):

        * wtf/text/StringCommon.h:
        (WTF::findIgnoringASCIICase):
        This is the common implementation used by StringView and StringImpl.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::findIgnoringASCIICase):
        * wtf/text/StringImpl.h:
        * wtf/text/StringView.cpp:
        (WTF::StringView::containsIgnoringASCIICase):
        (WTF::StringView::findIgnoringASCIICase):
        * wtf/text/StringView.h:
        * wtf/text/WTFString.h:
        (WTF::String::findIgnoringASCIICase):
        (WTF::String::contains):
        (WTF::String::containsIgnoringASCIICase):

2015-03-19  Andreas Kling  <akling@apple.com>

        DFGAllocator should use bmalloc's aligned allocator.
        <https://webkit.org/b/142871>

        Reviewed by Geoffrey Garen.

        Remove PageAllocationAligned since it has no more clients.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/PageAllocationAligned.cpp: Removed.
        * wtf/PageAllocationAligned.h: Removed.

2015-03-18  Dhi Aurrahman  <diorahman@rockybars.com>

        Fix StringView misplaced implementations after r181525 and r181558
        https://bugs.webkit.org/show_bug.cgi?id=142772

        Reviewed by Darin Adler.

        Fix misplaced implementations in StringView::startsWithIgnoringASCIICase and 
        StringView::endsWith. 

        Add some tests in [1] to cover the StringView::startsWith, 
        StringView::startsWithIgnoringASCIICase, StringView::endsWith and 
        StringView::endsWithIgnoringASCIICase implementations.

        [1] Tools/TestWebKitAPI/Tests/WTF/StringView.cpp.

        * wtf/text/StringView.cpp:
        (WTF::StringView::startsWithIgnoringASCIICase):
        (WTF::StringView::endsWith):
        (WTF::StringView::endsWithIgnoringASCIICase):

2015-03-17  Michael Saboff  <msaboff@apple.com>

        Windows X86-64 should use the fixed executable allocator
        https://bugs.webkit.org/show_bug.cgi?id=142749

        Reviewed by Filip Pizlo.

        Set ENABLE_EXECUTABLE_ALLOCATOR_FIXED for Windows.
        Needed to export MetaAllocator::currentStatistics() for use in JavaScriptCore.

        * wtf/MetaAllocator.h:
        * wtf/Platform.h:

2015-03-16  Ryosuke Niwa  <rniwa@webkit.org>

        Enable ES6 classes by default
        https://bugs.webkit.org/show_bug.cgi?id=142774

        Reviewed by Gavin Barraclough.

        * wtf/FeatureDefines.h:

2015-03-16  Csaba Osztrogonác  <ossy@webkit.org>

        [ARM] Enable generating idiv instructions if it is supported
        https://bugs.webkit.org/show_bug.cgi?id=142725

        Reviewed by Michael Saboff.

        * wtf/Platform.h: Set HAVE_ARM_IDIV_INSTRUCTIONS based on GCC macro too.

2015-03-16  Benjamin Poulain  <benjamin@webkit.org>

        Fix StringView after r181525
        Unreviewed.

        Fix 2 silly mistakes I made in r181525.

        * wtf/text/StringView.cpp:
        (WTF::StringView::startsWith):
        (WTF::StringView::startsWithIgnoringASCIICase):
        (WTF::StringView::endsWith):
        (WTF::StringView::endsWithIgnoringASCIICase):
        The implementation was inside the #ifdef.

        * wtf/text/StringView.h:
        The symbols were not exported.

2015-03-16  Max Stepin  <maxstepin@gmail.com>

        Add APNG support
        https://bugs.webkit.org/show_bug.cgi?id=17022

        Reviewed by Carlos Garcia Campos.

        * wtf/FeatureDefines.h:

2015-03-15  Benjamin Poulain  <benjamin@webkit.org>

        CSS: fix the case-insensitive matching of the attribute selectors Begin, End and Hyphen
        https://bugs.webkit.org/show_bug.cgi?id=142715

        Reviewed by Brent Fulgham.

        Add the necessary infrastructure to test startsWith() and endsWith() with
        ASCII case-insentive comparisons.

        * wtf/text/AtomicString.h:
        (WTF::AtomicString::startsWith):
        (WTF::AtomicString::startsWithIgnoringASCIICase):
        (WTF::AtomicString::endsWith):
        (WTF::AtomicString::endsWithIgnoringASCIICase):

        * wtf/text/StringCommon.h:
        (WTF::loadUnaligned):
        (WTF::equal):
        I moved the low level equal() code from StringImpl to StringCommon
        since it is used by both StringImpl and StringView.

        (WTF::equalCommon):
        (WTF::equalIgnoringASCIICaseCommon):
        Ideally we should drop the "Common" part of the name but StringView
        wants this inline for some reason. I prefered keeping the current behavior
        since I don't know how StringView's matching performance was evaluated.

        (WTF::startsWith):
        (WTF::startsWithIgnoringASCIICase):
        (WTF::endsWith):
        (WTF::endsWithIgnoringASCIICase):
        Make all that code shared between StringView and Stringimpl.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::startsWith):
        (WTF::StringImpl::startsWithIgnoringASCIICase):
        (WTF::StringImpl::endsWith):
        (WTF::StringImpl::endsWithIgnoringASCIICase):
        (WTF::equal):
        (WTF::stringImplContentEqual): Deleted.
        * wtf/text/StringImpl.h:
        (WTF::loadUnaligned): Deleted.
        (WTF::equal): Deleted.

        * wtf/text/StringView.cpp:
        (WTF::StringView::startsWith):
        (WTF::StringView::startsWithIgnoringASCIICase):
        (WTF::StringView::endsWith):
        (WTF::StringView::endsWithIgnoringASCIICase):
        * wtf/text/StringView.h:
        Since those are new, we can safely make them out-of-line and
        evaluate the inlining impact as needed.

        * wtf/text/WTFString.h:
        (WTF::String::startsWithIgnoringASCIICase):
        (WTF::String::endsWith):
        (WTF::String::endsWithIgnoringASCIICase):

2015-03-15  Benjamin Poulain  <bpoulain@apple.com>

        Change the exact attribute matching to be ASCII case-insensitive
        https://bugs.webkit.org/show_bug.cgi?id=142609

        Reviewed by Darin Adler.

        Add support for ASCII case insensitive comparisons to all the string
        classes.

        The new file StringCommon.h has the common algorithm to avoid repeating
        the same code with different types.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * wtf/ASCIICType.h:
        (WTF::toASCIILower):
        * wtf/CMakeLists.txt:
        * wtf/text/AtomicString.h:
        (WTF::equalIgnoringASCIICase):
        * wtf/text/StringCommon.h: Added.
        (WTF::equalIgnoringASCIICase):
        (WTF::equalIgnoringASCIICaseCommon):
        * wtf/text/StringImpl.cpp:
        (WTF::equalIgnoringASCIICase):
        (WTF::equalIgnoringASCIICaseNonNull):
        (WTF::StringImpl::utf8Impl):
        (WTF::StringImpl::defaultWritingDirection): Deleted.
        (WTF::StringImpl::adopt): Deleted.
        (WTF::StringImpl::sizeInBytes): Deleted.
        (WTF::putUTF8Triple): Deleted.
        (WTF::StringImpl::utf8): Deleted.
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::isSubString): Deleted.
        (WTF::find): Deleted.

2015-03-14  Michael Saboff  <msaboff@apple.com>

        Disable Yarr JIT for ARMv7k
        https://bugs.webkit.org/show_bug.cgi?id=142645

        Rubber stamped by Geoffrey Garen.

        Changed the setting of ENABLE_YARR_JIT to be predicated on ENABLED_JIT.

        * wtf/Platform.h:

2015-03-14  Michael Saboff  <msaboff@apple.com>

        ES6: Add binary and octal literal support
        https://bugs.webkit.org/show_bug.cgi?id=142681

        Reviewed by Ryosuke Niwa.

        * wtf/ASCIICType.h:
        (WTF::isASCIIBinaryDigit): New support function.
        (WTF::isASCIIOctalDigit): Updated to use logical and (&&) instead of binary and (&).

2015-03-13  Mark Lam  <mark.lam@apple.com>

        Replace TCSpinLock with a new WTF::SpinLock based on WTF::Atomic.
        <https://webkit.org/b/142674>

        Reviewed by Filip Pizlo.

        We no longer use TCMalloc in our code, and we now have C++11.  This replaces the
        TCMalloc_SpinLock with a new WTF::SpinLock based on WTF::Atomic (which is a
        wrapper around std::atomic).

        Note that there is a StaticSpinLock and a SpinLock:

        1. StaticSpinLock is an alias for SpinLockBase, and its initialization relies on
           static / global std:atomic being automatically initialized to 0 at compile time.
           Hence, StaticSpinLock should only be used for statics / globals (including
           static members of classes / structs).

        2. SpinLock is derived from SpinLockBase, and adds a default constructor to
           initialize its internal atomic value to 0.  Because SpinLock has a constructor,
           it cannot be used for statics / globals.  Objects that want to embed a spin
           lock as an instance field should use SpinLock so that it is initialized properly.
           std::atomic will not automatically initialize instance fields to 0.  Hence,
           StaticSpinLock will not work correctly as instance fields of a class / struct.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/MetaAllocator.cpp:
        (WTF::MetaAllocator::~MetaAllocator):
        (WTF::MetaAllocator::MetaAllocator):
        * wtf/MetaAllocator.h:
        * wtf/SpinLock.h: Added.
        (WTF::SpinLockBase::lock):
        (WTF::SpinLockBase::unlock):
        (WTF::SpinLockBase::isLocked):
        (WTF::SpinLockBase::slowLock):
        (WTF::SpinLock::SpinLock):
        * wtf/TCSpinLock.h: Removed.
        * wtf/text/AtomicString.cpp:

2015-03-13  Mark Lam  <mark.lam@apple.com>

        Introduce WTF::Atomic to wrap std::atomic for a friendlier CAS.
        <https://webkit.org/b/142661>

        Reviewed by Filip Pizlo.

        The CAS functions provided by std::atomic takes a reference to the expected
        value and modifies it if the CAS fails.  However, in a lot of our CAS usage,
        we don't want the expected value to change.  The solution to this is to
        provide a WTF::Atomic struct that wraps std::atomic, and provide CAS
        methods that won't alter the expected value if the CAS fails.

        The method names in WTF::Atomic are chosen to be identical to those
        in std::atomic so that WTF::Atomic can be a simple drop in replacement
        for std::atomic.

        Also changed ByteSpinLock to use WTF::Atomic instead of std::atomic.

        * wtf/Atomics.h:
        (WTF::Atomic::load):
        (WTF::Atomic::store):
        (WTF::Atomic::compare_exchange_weak):
        (WTF::Atomic::compare_exchange_strong):
        * wtf/ByteSpinLock.h:
        (WTF::ByteSpinLock::ByteSpinLock):
        (WTF::ByteSpinLock::lock):

2015-03-12  Filip Pizlo  <fpizlo@apple.com>

        Bytecode liveness analysis should have more lambdas and fewer sets
        https://bugs.webkit.org/show_bug.cgi?id=142647

        Reviewed by Mark Lam.
        
        Add a method for iterating each set bit in a FastBitVector. Uses a functor as a callback since
        this allows for a more efficient algorithm.

        * wtf/FastBitVector.h:
        (WTF::FastBitVector::forEachSetBit):

2015-03-12  Michael Saboff  <msaboff@apple.com>

        Disable Yarr JIT for ARMv7k
        https://bugs.webkit.org/show_bug.cgi?id=142645

        Reviewed by Oliver Hunt.

        Make the setting of ENABLE_YARR_JIT match ENABLE_JIT for ARMv7k.

        * wtf/Platform.h:

2015-03-12  Mark Lam  <mark.lam@apple.com>

        Change WTF::ByteSpinLock to use std::atomic.
        <https://webkit.org/b/142644>

        Reviewed by Filip Pizlo.

        * wtf/ByteSpinLock.h:
        (WTF::ByteSpinLock::ByteSpinLock):
        (WTF::ByteSpinLock::lock):
        (WTF::ByteSpinLock::unlock):
        (WTF::ByteSpinLock::isHeld):

2015-03-12  Csaba Osztrogonác  <ossy@webkit.org>

        [ARM][Linux] GC sometimes stuck in an infinite loop if parallel GC is enabled
        https://bugs.webkit.org/show_bug.cgi?id=141290

        Reviewed by Carlos Garcia Campos.

        * wtf/Platform.h: Enable parallel GC after r181319.

2015-03-11  Myles C. Maxfield  <mmaxfield@apple.com>

        Use out-of-band messaging for RenderBox::firstLineBaseline() and RenderBox::inlineBlockBaseline()
        https://bugs.webkit.org/show_bug.cgi?id=142569

        Reviewed by David Hyatt.

        Provide a callback to Optional::valueOrCompute() which is evaluated only if necessary.

        * wtf/Optional.h:
        (WTF::Optional::valueOrCompute):

2015-03-10  Brent Fulgham  <bfulgham@apple.com>

        [Win] 17 different JSC tests started to fail in DST
        https://bugs.webkit.org/show_bug.cgi?id=142531

        Reviewed by Chris Dumez.

        The stock 'GetTimeZoneInformation' call does not always match the actual Daylight
        Savings calendar. This results in a period of time when these tests fail.

        If available, we should take advantage of the new 'GetTimeZoneInformationForYear',
        which accesses a dynamic calendar of DST dates, which is presumbably updated by
        Microsoft from year-to-year.

        * wtf/DateMath.cpp:
        (WTF::timeZoneInformationForYearFunction): New function to conditionally access
        some Vista (and newer) functionality.
        (WTF::calculateUTCOffset): Call new function (if available) to calculate proper UTC
        time offset.

2015-03-10  Alex Christensen  <achristensen@webkit.org>

        Use unsigned for HashSet size.
        https://bugs.webkit.org/show_bug.cgi?id=142518

        Reviewed by Benjamin Poulain.

        * wtf/HashCountedSet.h:
        (WTF::Traits>::size):
        (WTF::Traits>::capacity):
        * wtf/HashMap.h:
        (WTF::X>::size):
        (WTF::X>::capacity):
        * wtf/HashSet.h:
        (WTF::V>::size):
        (WTF::V>::capacity):
        * wtf/HashTable.h:
        (WTF::HashTable::Stats::recordCollisionAtCount):
        (WTF::HashTable::Stats::dumpStats):
        (WTF::HashTable::size):
        (WTF::HashTable::capacity):
        (WTF::KeyTraits>::deallocateTable):
        (WTF::KeyTraits>::checkTableConsistencyExceptSize):
        * wtf/HashTraits.h:
        * wtf/ListHashSet.h:
        (WTF::U>::size):
        (WTF::U>::capacity):

2015-03-10  Said Abou-Hallawa  <sabouhallawa@apple.com>

        Remove PassRefPtr from svg/properties classes.
        https://bugs.webkit.org/show_bug.cgi?id=142063.

        Reviewed by Darin Adler.

        * wtf/Ref.h:
        (WTF::static_reference_cast): Add a stat_cast function to Ref<>.

2015-03-10  Mark Lam  <mark.lam@apple.com>

        [Win] JSC Build Warnings Need to be Resolved.
        <https://webkit.org/b/142366>

        Reviewed by Brent Fulgham.

        * wtf/Compiler.h:
        - MSVC also does not have the CONSIDERS_UNREACHABLE_CODE quirk.

2015-03-10  Geoffrey Garen  <ggaren@apple.com>

        bmalloc: tryFastMalloc shouldn't crash
        https://bugs.webkit.org/show_bug.cgi?id=142443

        Reviewed by Sam Weinig.

        Rolling back in r181307 with a check for whether bmalloc is enabled, to
        avoid crashes when running with ASan and GuardMalloc.

        * wtf/FastMalloc.cpp:
        (WTF::fastMalloc):
        (WTF::fastRealloc):
        (WTF::fastAlignedMalloc):
        (WTF::tryFastMalloc):
        (WTF::tryFastRealloc): Deleted.
        * wtf/FastMalloc.h:

2015-03-10  Michael Catanzaro  <mcatanzaro@igalia.com>

        GCC: CRASH() should be annotated with NORETURN
        https://bugs.webkit.org/show_bug.cgi?id=142524

        Reviewed by Anders Carlsson.

        Add COMPILER(GCC) to #ifdefs that already exist for Clang.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h:

2015-03-09  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r181307.
        https://bugs.webkit.org/show_bug.cgi?id=142525

        Broke ASan tests (Requested by ap on #webkit).

        Reverted changeset:

        "bmalloc: tryFastMalloc shouldn't crash"
        https://bugs.webkit.org/show_bug.cgi?id=142443
        http://trac.webkit.org/changeset/181307

2015-03-09  Geoffrey Garen  <ggaren@apple.com>

        bmalloc: tryFastMalloc shouldn't crash
        https://bugs.webkit.org/show_bug.cgi?id=142443

        Reviewed by Darin Adler.

        * wtf/FastMalloc.cpp:
        (WTF::fastMalloc):
        (WTF::fastRealloc):
        (WTF::fastAlignedMalloc): Don't check for null. bmalloc automatically
        crashes on allocation failure, and we'd rather not pay for an extra check.

        (WTF::tryFastMalloc): Added an opt-out API to return null rather than
        crashing, since some clients need this.

        (WTF::tryFastRealloc): Deleted. Unused.

        * wtf/FastMalloc.h:

2015-03-09  Mark Lam  <mark.lam@apple.com>

        8-bit version of weakCompareAndSwap() can cause an infinite loop.
        https://webkit.org/b/142513>

        Reviewed by Filip Pizlo.

        Presently, Bitmap::concurrentTestAndSet() uses the 8-bit version of
        weakCompareAndSwap() (which compares and swaps an uint8_t value).
        Bitmap::concurrentTestAndSet() has a loop that checks if a bit in the
        byte of interest has been set.  If not, it will call the 8-bit CAS
        function to set the bit.

        Under the covers, for ARM, the 8-bit CAS function actually works with a
        32-bit CAS.  The 8-bit CAS will first fetch the 32-bit value in memory
        that should contain the 8-bit value, and check if it contains the
        expected byte.  If the value in memory doesn't have the expected byte,
        it will return early to its caller.  The expectation is that the caller
        will reload the byte from memory and call the 8-bit CAS again.

        Unfortunately, this code path that returns early does not have a
        compiler fence.  Without a compiler fence, the C++ compiler can
        optimize away the reloading of the expected byte value, leaving it
        unchanged.  As a result, we'll have a infinite loop here that checks a
        value that will never change, and the loop will not terminate until the
        value changes.

        The fix is to eliminate the early return check in the 8-bit CAS, and
        have it always call down to the 32-bit CAS.  The 32-bit CAS has a
        compiler fence which will prevent this issue.

        * wtf/Atomics.h:
        (WTF::weakCompareAndSwap):

2015-03-09  Martin Robinson  <mrobinson@igalia.com>

        [EFL] Move DispatchQueue to WTF
        https://bugs.webkit.org/show_bug.cgi?id=142493

        Reviewed by Csaba Osztrogonác.

        * wtf/PlatformEfl.cmake: Add DispatchQueue to the source list.
        * wtf/efl/DispatchQueueEfl.cpp: Renamed from Source/WebKit2/Platform/efl/DispatchQueueEfl.cpp.
        * wtf/efl/DispatchQueueEfl.h: Renamed from Source/WebKit2/Platform/efl/DispatchQueueEfl.h.
        * wtf/efl/DispatchQueueWorkItemEfl.h: Renamed from Source/WebKit2/Platform/efl/DispatchQueueWorkItemEfl.h.

2015-03-08  Brent Fulgham  <bfulgham@apple.com>

        [Win] WTF::WorkQueue does not balance ref/deref properly
        https://bugs.webkit.org/show_bug.cgi?id=142471

        Reviewed by Antti Koivisto.

        Make sure we deref the count when we execute a function in the
        WorkQueue.

        * wtf/win/WorkQueueWin.cpp:
        (WTF::WorkQueue::performWorkOnRegisteredWorkThread):

2015-03-07  Brent Fulgham  <bfulgham@apple.com>

        [Win] Revive WTF::WorkQueue on Windows
        https://bugs.webkit.org/show_bug.cgi?id=142432

        Reviewed by Darin Adler.

        Revive the Windows implementation of WTF::WorkQueue.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * wtf/WorkQueue.h:
        * wtf/win/WorkItemWin.cpp: Added.
        * wtf/win/WorkItemWin.h: Added.
        * wtf/win/WorkQueueWin.cpp: Added.

2015-03-06  Geoffrey Garen  <ggaren@apple.com>

        Fix crashes seen on the the Windows buildbots after my last patch.

        Unreviewed.

        * wtf/FastMalloc.cpp:
        (WTF::fastAlignedMalloc): Let's pass these arguments in the right order.

2015-03-06  Myles C. Maxfield  <mmaxfield@apple.com>

        Crash in -[WebCascadeList objectAtIndex:] + 195
        https://bugs.webkit.org/show_bug.cgi?id=141274

        Reviewed by David Kilzer.

        * wtf/WeakPtr.h:
        (WTF::WeakPtrFactory::createWeakPtr): WebCascadeList uses a const FontCascade,
        and it calls createWeakPtr() on it. Therefore, createWeakPtr has to be marked
        const.
        (WTF::WeakPtrFactory::operator=): Removed because it was broken and had no
        callers

2015-03-06  Simon Fraser  <simon.fraser@apple.com>

        Allow tree dumping functions to be used in release builds by switching a flag
        https://bugs.webkit.org/show_bug.cgi?id=142379

        Reviewed by Zalan Bujtas.

        There are various tree dumping functions that are useful for debugging, and sometimes
        you want to be able to use them in release builds. Currently they are surrounded by
        #ifndef NDEBUG. Change this to #if ENABLE(TREE_DEBUGGING), which is defined to 0 or 1
        in wtf/Platform.h

        * wtf/Platform.h:

2015-03-05  Chris Dumez  <cdumez@apple.com>

        Regression(r173761): ASSERTION FAILED: !is8Bit() in StringImpl::characters16()
        https://bugs.webkit.org/show_bug.cgi?id=142350

        Reviewed by Michael Saboff and Benjamin Poulain.

        Fix ASSERTION FAILED: !is8Bit() in StringImpl::characters16() from
        WTF::equalInner() after r173761. The code was incorrectly assuming that
        if stringImpl is 16-bit, then matchString is 16-bit too, which is not
        correct.

        Also rename WTFString::startsWith() / endsWith() taking an offset to
        hasInfixStartingAt() / hasInfixEndingAt() for clarity. It seems odd
        to call it startsWith even though it won't technically *start* with
        the pattern if the input offset is greater than zero.

        Also drop the caseSensitive argument as it is never used (always true
        at call sites.

        * wtf/text/StringImpl.cpp:
        (WTF::equalInner):
        (WTF::StringImpl::hasInfixStartingAt):
        (WTF::StringImpl::hasInfixEndingAt):
        (WTF::StringImpl::startsWith): Deleted.
        (WTF::StringImpl::endsWith): Deleted.
        * wtf/text/StringImpl.h:
        * wtf/text/WTFString.h:
        (WTF::String::hasInfixStartingAt):
        (WTF::String::hasInfixEndingAt):
        (WTF::String::startsWith): Deleted.
        (WTF::String::endsWith): Deleted.

2015-03-05  Chris Dumez  <cdumez@apple.com>

        NetworkCache efficacy logging is using too much CPU
        https://bugs.webkit.org/show_bug.cgi?id=142186
        <rdar://problem/19632080>

        Reviewed by Antti Koivisto.

        * wtf/HashMap.h:
        (WTF::copyToVector):
        Add copyToVector() utility function for HashMap that uses an std::pair<key, value>
        as element type.

        * wtf/text/WTFString.h:
        (WTF::StringCapture::StringCapture):
        (WTF::StringCapture::operator=):
        Add default constructor and assignment operator to StringCapture so that
        it can be used in a Vector.

2015-03-05  Antti Koivisto  <antti@apple.com>

        Support WorkQueue QOS classes on Mavericks
        https://bugs.webkit.org/show_bug.cgi?id=142328

        Reviewed by Anders Carlsson.

        "The priority of a dispatch queue is inherited from its target queue.  In order to
        change the priority of a queue created with dispatch_queue_create(), use the
        dispatch_get_global_queue() function to obtain a target queue of the desired prior-
        ity."

        * wtf/cocoa/WorkQueueCocoa.cpp:
        (WTF::targetQueueForQOSClass):
        (WTF::WorkQueue::platformInitialize):

2015-03-03  Anders Carlsson  <andersca@apple.com>

        Remove unused compression code
        https://bugs.webkit.org/show_bug.cgi?id=142237

        Reviewed by Geoffrey Garen.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Compression.cpp: Removed.
        * wtf/Compression.h: Removed.

2015-03-02  Gyuyoung Kim  <gyuyoung.kim@samsung.com>

        [WK2] Remove unnecessary create() factory functions.
        https://bugs.webkit.org/show_bug.cgi?id=142161

        Reviewed by Chris Dumez.

        We can replace some create() factory functions with std::make_unique(). Because
        it just returns new instance. Even some of those functions have used std::unique_ptr<>
        instead of std::make_unique<>. Fixed all.

        * wtf/efl/WorkQueueEfl.cpp:
        (WorkQueue::dispatch):

2015-03-02  Filip Pizlo  <fpizlo@apple.com>

        DFG compile time measurements should really report milliseconds
        https://bugs.webkit.org/show_bug.cgi?id=142209

        Reviewed by Benjamin Poulain.
        
        This bug was introduced because currentTimeMS() calls were converted to
        monotonicallyIncreasingTime() calls. Perhaps this bug would be less likely if there was a
        monotonicallyIncreasingTimeMS() function available, so this patch adds it.

        * wtf/CurrentTime.h:
        (WTF::monotonicallyIncreasingTimeMS):

2015-02-27  Darin Adler  <darin@apple.com>

        Remove unused PossiblyNull
        https://bugs.webkit.org/show_bug.cgi?id=142124

        Reviewed by Andreas Kling.

        * WTF.vcxproj/WTF.vcxproj: Removed the file.
        * WTF.vcxproj/WTF.vcxproj.filters: Ditto.
        * WTF.xcodeproj/project.pbxproj: Ditto.
        * wtf/CMakeLists.txt: Ditto.
        * wtf/PossiblyNull.h: Removed.

        * wtf/FastMalloc.h: Moved everything to the left.
        Moved member functions out of the TryMallocReturnValue class definition.
        (WTF::TryMallocReturnValue::operator PossiblyNull<T>): Deleted.
        (WTF::TryMallocReturnValue::getValue): Marked inline, changed to work
        only with pointer types, not arbitrary non-pointer types.

2015-02-26  Brent Fulgham  <bfulgham@apple.com>

        [Win] Make build logs more legible by reducing noise
        https://bugs.webkit.org/show_bug.cgi?id=142034

        Reviewed by Alexey Proskuryakov.

        Modify batch files, makefiles, and DOS commands to remove
        uninteresting/unhelpful output.

        * WTF.vcxproj/WTFGenerated.make:
        * WTF.vcxproj/WTFPreBuild.cmd:
        * WTF.vcxproj/copy-files.cmd:

2015-02-26  Landry Breuil  <landry@openbsd.org>

        Revert bug 19975, now that gcc 4.7 is required.
        https://bugs.webkit.org/show_bug.cgi?id=129927

        Reviewed by Andreas Kling.

        isfinite() and signbit() are provided by gcc's cmath header.

        * wtf/MathExtras.h:

2015-02-26  Csaba Osztrogonác  <ossy@webkit.org>

        UNREACHABLE_FOR_PLATFORM() should be release assert
        https://bugs.webkit.org/show_bug.cgi?id=141904

        Reviewed by Darin Adler.

        * wtf/Assertions.h:
        (UNREACHABLE_FOR_PLATFORM):

2015-02-25  Filip Pizlo  <fpizlo@apple.com>

        Enable concurrent JIT on GTK
        https://bugs.webkit.org/show_bug.cgi?id=142007

        Reviewed by Benjamin Poulain.

        Seems weird that GTK keeps it off. No good reason for that as far as I can tell.

        * wtf/Platform.h:

2015-02-23  Brent Fulgham  <bfulgham@apple.com>

        WTF::WeakPtr should rename 'forgot' to 'clear' and support nullptr assignment
        https://bugs.webkit.org/show_bug.cgi?id=141935

        Reviewed by Myles C. Maxfield.

        * wtf/WeakPtr.h:
        (WTF::WeakPtr::operator=): Added 'nullptr_t' overload.
        (WTF::WeakPtr::clear): Renamed from 'forget'
        (WTF::WeakPtr::forget): Deleted.

2015-02-23  Brent Fulgham  <bfulgham@apple.com>

        WTF::WeakPtr should have a 'forget' method
        https://bugs.webkit.org/show_bug.cgi?id=141923

        Reviewed by Myles C. Maxfield.

        * wtf/WeakPtr.h:
        (WTF::WeakPtr::forget): Added.

2015-02-20  Geoffrey Garen  <ggaren@apple.com>

        Remove TCMalloc
        https://bugs.webkit.org/show_bug.cgi?id=141844

        Reviewed by Andreas Kling.

        It's unused.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/FastMalloc.cpp:
        (WTF::EntropySource<4>::value): Deleted.
        (WTF::EntropySource<8>::value): Deleted.
        (WTF::internalEntropyValue): Deleted.
        (WTF::freedObjectStartPoison): Deleted.
        (WTF::freedObjectEndPoison): Deleted.
        (WTF::ClassIndex): Deleted.
        (WTF::HardenedSLL::create): Deleted.
        (WTF::HardenedSLL::null): Deleted.
        (WTF::HardenedSLL::setValue): Deleted.
        (WTF::HardenedSLL::value): Deleted.
        (WTF::HardenedSLL::operator!): Deleted.
        (WTF::HardenedSLL::operator UnspecifiedBoolType): Deleted.
        (WTF::HardenedSLL::operator!=): Deleted.
        (WTF::HardenedSLL::operator==): Deleted.
        (WTF::LgFloor): Deleted.
        (WTF::SLL_Next): Deleted.
        (WTF::SLL_SetNext): Deleted.
        (WTF::SLL_Push): Deleted.
        (WTF::SLL_Pop): Deleted.
        (WTF::SLL_PopRange): Deleted.
        (WTF::SLL_PushRange): Deleted.
        (WTF::SizeClass): Deleted.
        (WTF::ByteSizeForClass): Deleted.
        (WTF::NumMoveSize): Deleted.
        (WTF::InitSizeClasses): Deleted.
        (WTF::MetaDataAlloc): Deleted.
        (WTF::PageHeapAllocator::Init): Deleted.
        (WTF::PageHeapAllocator::New): Deleted.
        (WTF::PageHeapAllocator::Delete): Deleted.
        (WTF::PageHeapAllocator::inuse): Deleted.
        (WTF::pages): Deleted.
        (WTF::AllocationSize): Deleted.
        (WTF::spanInitializerCookie): Deleted.
        (WTF::Span::next): Deleted.
        (WTF::Span::remoteNext): Deleted.
        (WTF::Span::prev): Deleted.
        (WTF::Span::setNext): Deleted.
        (WTF::Span::setPrev): Deleted.
        (WTF::Span::initCookie): Deleted.
        (WTF::Span::clearCookie): Deleted.
        (WTF::Span::isValid): Deleted.
        (WTF::Event): Deleted.
        (WTF::NewSpan): Deleted.
        (WTF::DeleteSpan): Deleted.
        (WTF::DLL_Init): Deleted.
        (WTF::DLL_Remove): Deleted.
        (WTF::DLL_IsEmpty): Deleted.
        (WTF::DLL_Length): Deleted.
        (WTF::DLL_Print): Deleted.
        (WTF::DLL_Prepend): Deleted.
        (WTF::TCMalloc_Central_FreeList::length): Deleted.
        (WTF::TCMalloc_Central_FreeList::tc_length): Deleted.
        (WTF::TCMalloc_Central_FreeList::enumerateFreeObjects): Deleted.
        (WTF::TCMalloc_Central_FreeList::entropy): Deleted.
        (WTF::FastMallocZone::goodSize): Deleted.
        (WTF::FastMallocZone::check): Deleted.
        (WTF::FastMallocZone::print): Deleted.
        (WTF::FastMallocZone::log): Deleted.
        (WTF::FastMallocZone::forceLock): Deleted.
        (WTF::FastMallocZone::forceUnlock): Deleted.
        (WTF::FastMallocZone::statistics): Deleted.
        (WTF::FastMallocZone::zoneValloc): Deleted.
        (WTF::FastMallocZone::zoneDestroy): Deleted.
        (WTF::MallocHook::record): Deleted.
        (WTF::MallocHook::recordAllocation): Deleted.
        (WTF::MallocHook::recordDeallocation): Deleted.
        (WTF::MallocHook::init): Deleted.
        (WTF::MallocHook::InvokeNewHook): Deleted.
        (WTF::MallocHook::InvokeDeleteHook): Deleted.
        (WTF::KernelSupportsTLS): Deleted.
        (WTF::CheckIfKernelSupportsTLS): Deleted.
        (WTF::TCMalloc_PageHeap::GetDescriptor): Deleted.
        (WTF::TCMalloc_PageHeap::GetDescriptorEnsureSafe): Deleted.
        (WTF::TCMalloc_PageHeap::SystemBytes): Deleted.
        (WTF::TCMalloc_PageHeap::FreeBytes): Deleted.
        (WTF::TCMalloc_PageHeap::GetSizeClassIfCached): Deleted.
        (WTF::TCMalloc_PageHeap::CacheSizeClass): Deleted.
        (WTF::TCMalloc_PageHeap::RecordSpan): Deleted.
        (WTF::TCMalloc_PageHeap::init): Deleted.
        (WTF::TCMalloc_PageHeap::initializeScavenger): Deleted.
        (WTF::TCMalloc_PageHeap::isScavengerSuspended): Deleted.
        (WTF::TCMalloc_PageHeap::scheduleScavenger): Deleted.
        (WTF::TCMalloc_PageHeap::rescheduleScavenger): Deleted.
        (WTF::TCMalloc_PageHeap::suspendScavenger): Deleted.
        (WTF::TCMalloc_PageHeap::scavengerTimerFired): Deleted.
        (WTF::TCMalloc_PageHeap::runScavengerThread): Deleted.
        (WTF::TCMalloc_PageHeap::signalScavenger): Deleted.
        (WTF::TCMalloc_PageHeap::scavenge): Deleted.
        (WTF::TCMalloc_PageHeap::shouldScavenge): Deleted.
        (WTF::TCMalloc_PageHeap::New): Deleted.
        (WTF::TCMalloc_PageHeap::AllocLarge): Deleted.
        (WTF::TCMalloc_PageHeap::Split): Deleted.
        (WTF::TCMalloc_PageHeap::Carve): Deleted.
        (WTF::mergeDecommittedStates): Deleted.
        (WTF::TCMalloc_PageHeap::Delete): Deleted.
        (WTF::TCMalloc_PageHeap::IncrementalScavenge): Deleted.
        (WTF::TCMalloc_PageHeap::RegisterSizeClass): Deleted.
        (WTF::TCMalloc_PageHeap::ReturnedBytes): Deleted.
        (WTF::PagesToMB): Deleted.
        (WTF::TCMalloc_PageHeap::Dump): Deleted.
        (WTF::TCMalloc_PageHeap::GrowHeap): Deleted.
        (WTF::TCMalloc_PageHeap::Check): Deleted.
        (WTF::TCMalloc_PageHeap::CheckList): Deleted.
        (WTF::TCMalloc_PageHeap::ReleaseFreeList): Deleted.
        (WTF::TCMalloc_PageHeap::ReleaseFreePages): Deleted.
        (WTF::TCMalloc_ThreadCache_FreeList::Init): Deleted.
        (WTF::TCMalloc_ThreadCache_FreeList::length): Deleted.
        (WTF::TCMalloc_ThreadCache_FreeList::empty): Deleted.
        (WTF::TCMalloc_ThreadCache_FreeList::lowwatermark): Deleted.
        (WTF::TCMalloc_ThreadCache_FreeList::clear_lowwatermark): Deleted.
        (WTF::TCMalloc_ThreadCache_FreeList::Push): Deleted.
        (WTF::TCMalloc_ThreadCache_FreeList::PushRange): Deleted.
        (WTF::TCMalloc_ThreadCache_FreeList::PopRange): Deleted.
        (WTF::TCMalloc_ThreadCache_FreeList::Pop): Deleted.
        (WTF::TCMalloc_ThreadCache_FreeList::Validate): Deleted.
        (WTF::TCMalloc_ThreadCache_FreeList::enumerateFreeObjects): Deleted.
        (WTF::TCMalloc_ThreadCache::freelist_length): Deleted.
        (WTF::TCMalloc_ThreadCache::Size): Deleted.
        (WTF::TCMalloc_ThreadCache::enumerateFreeObjects): Deleted.
        (WTF::getPageHeap): Deleted.
        (WTF::fastMallocGoodSize): Deleted.
        (WTF::TCMalloc_PageHeap::periodicScavenge): Deleted.
        (WTF::TCMalloc_PageHeap::scavengerThread): Deleted.
        (WTF::setThreadHeap): Deleted.
        (WTF::TCMalloc_Central_FreeList::Init): Deleted.
        (WTF::TCMalloc_Central_FreeList::ReleaseListToSpans): Deleted.
        (WTF::TCMalloc_Central_FreeList::ReleaseToSpans): Deleted.
        (WTF::TCMalloc_Central_FreeList::EvictRandomSizeClass): Deleted.
        (WTF::TCMalloc_Central_FreeList::MakeCacheSpace): Deleted.
        (WTF::TCMalloc_Central_FreeList::ShrinkCache): Deleted.
        (WTF::TCMalloc_Central_FreeList::InsertRange): Deleted.
        (WTF::TCMalloc_Central_FreeList::RemoveRange): Deleted.
        (WTF::TCMalloc_Central_FreeList::FetchFromSpansSafe): Deleted.
        (WTF::TCMalloc_Central_FreeList::FetchFromSpans): Deleted.
        (WTF::TCMalloc_Central_FreeList::Populate): Deleted.
        (WTF::TCMalloc_ThreadCache::SampleAllocation): Deleted.
        (WTF::TCMalloc_ThreadCache::Init): Deleted.
        (WTF::TCMalloc_ThreadCache::Cleanup): Deleted.
        (WTF::TCMalloc_ThreadCache::Allocate): Deleted.
        (WTF::TCMalloc_ThreadCache::Deallocate): Deleted.
        (WTF::TCMalloc_ThreadCache::FetchFromCentralCache): Deleted.
        (WTF::TCMalloc_ThreadCache::ReleaseToCentralCache): Deleted.
        (WTF::TCMalloc_ThreadCache::Scavenge): Deleted.
        (WTF::TCMalloc_ThreadCache::PickNextSample): Deleted.
        (WTF::TCMalloc_ThreadCache::InitModule): Deleted.
        (WTF::TCMalloc_ThreadCache::NewHeap): Deleted.
        (WTF::TCMalloc_ThreadCache::GetThreadHeap): Deleted.
        (WTF::TCMalloc_ThreadCache::GetCache): Deleted.
        (WTF::TCMalloc_ThreadCache::GetCacheIfPresent): Deleted.
        (WTF::TCMalloc_ThreadCache::InitTSD): Deleted.
        (WTF::TCMalloc_ThreadCache::CreateCacheIfNecessary): Deleted.
        * wtf/TCPackedCache.h: Removed.
        * wtf/TCPageMap.h: Removed.
        * wtf/TCSystemAlloc.cpp: Removed.
        * wtf/TCSystemAlloc.h: Removed.

2015-02-20  Alexey Proskuryakov  <ap@apple.com>

        Remove svn:keywords property.

        As far as I can tell, the property had no effect on any of these files, but also,
        when it has effect it's likely harmful.

        * wtf/DecimalNumber.cpp: Removed property svn:keywords.
        * wtf/spi/darwin/XPCSPI.h: Removed property svn:keywords.

2015-02-20  Csaba Osztrogonác  <ossy@webkit.org>

        EFL URTBF

        * wtf/PlatformEfl.cmake:

2015-02-20  Simon Fraser  <simon.fraser@apple.com>

        RunLoop::dispatch() should drop the mutex before calling wakeUp().
        https://bugs.webkit.org/show_bug.cgi?id=141820

        Reviewed by Alexey Proskuryakov.
        
        RunLoop::wakeUp() calls into CoreFoundation which could take time,
        so scope the mutex just to protect m_functionQueue.

        * wtf/RunLoop.cpp:
        (WTF::RunLoop::dispatch):

2015-02-20  Gyuyoung Kim  <gyuyoung.kim@samsung.com>

        Unreviewed, EFL build fix since r180410.

        * wtf/PlatformEfl.cmake: Add WEBKIT2/Platform/efl path in order to include DispatchQueueEfl.h.

2015-02-20  Antti Koivisto  <antti@apple.com>

        Move WorkQueue from WK2 to WTF
        https://bugs.webkit.org/show_bug.cgi?id=141797

        Reviewed by Anders Carlsson.

        It may be useful in WebCore.

        Windows implementation is still missing.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/PlatformGTK.cmake:
        * wtf/WorkQueue.cpp: Copied from Source/WebKit2/Platform/WorkQueue.cpp.
        * wtf/WorkQueue.h: Copied from Source/WebKit2/Platform/WorkQueue.h.
        * wtf/cocoa: Added.
        * wtf/cocoa/WorkQueueCocoa.cpp: Copied from Source/WebKit2/Platform/mac/WorkQueueMac.cpp.
        * wtf/efl/WorkQueueEfl.cpp: Copied from Source/WebKit2/Platform/efl/WorkQueueEfl.cpp.
        * wtf/gtk/WorkQueueGtk.cpp: Copied from Source/WebKit2/Platform/gtk/WorkQueueGtk.cpp.

2015-02-13  Gyuyoung Kim  <gyuyoung.kim@samsung.com>

        [EFL] Enable bmalloc for EFL port 
        https://bugs.webkit.org/show_bug.cgi?id=141459

        Reviewed by Csaba Osztrogonác.

        * wtf/CMakeLists.txt: Remove TCSystemAlloc.cpp/h.
        * wtf/FastMalloc.cpp: Enable BMALLOC for EFL port.

2015-02-13  Anders Carlsson  <andersca@apple.com>

        Add a move constructor and move assignment operator to Deque
        https://bugs.webkit.org/show_bug.cgi?id=141571

        Reviewed by Andreas Kling.

        * wtf/Deque.h:
        (WTF::inlineCapacity>::Deque):
        (WTF::=): Deleted.

2015-02-13  Anders Carlsson  <andersca@apple.com>

        Add an initializer list constructor to Deque
        https://bugs.webkit.org/show_bug.cgi?id=141565

        Reviewed by Andreas Kling.

        * wtf/Deque.h:
        (WTF::inlineCapacity>::Deque):

2015-02-13  Anders Carlsson  <andersca@apple.com>

        Re-indent Deque.h

        Rubber-stamped by Antti Koivisto.

        * wtf/Deque.h:

2015-02-11  Brent Fulgham  <bfulgham@apple.com>

        [Win] [64-bit] Work around MSVC2013 Runtime Bug
        https://bugs.webkit.org/show_bug.cgi?id=141498
        <rdar://problem/19803642>

        Reviewed by Anders Carlsson.

        Disable FMA3 instruction use in the MSVC math library to
        work around a VS2013 runtime crash. We can remove this
        workaround when we switch to VS2015.

        * WTF.vcxproj/WTF.vcxproj: Add new files.
        * WTF.vcxproj/WTF.vcxproj.filters: Ditto.
        * wtf/win/WTFDLL.cpp: Added.

2015-02-11  Gyuyoung Kim  <gyuyoung.kim@samsung.com>

        [EFL][GTK] Use bmalloc instead of tcmalloc
        https://bugs.webkit.org/show_bug.cgi?id=140162

        Reviewed by Carlos Garcia Campos.

        * wtf/CMakeLists.txt:
        * wtf/FastMalloc.cpp:
            Enable bmalloc on GTK ports, but EFL port will enable it when bmalloc supports
            memory statistics.

2015-02-10  Darin Adler  <darin@apple.com>

        Add the crash-on-failure behavior to bmalloc-based fastMalloc
        https://bugs.webkit.org/show_bug.cgi?id=141434

        Reviewed by Alexey Proskuryakov.

        * wtf/FastMalloc.cpp: Removed unneeded includes.
        (WTF::fastMalloc): Added null check and CRASH.
        (WTF::fastCalloc): Added overflow checking, null check, and CRASH.
        (WTF::fastRealloc): Added null check and CRASH.
        (WTF::fastMallocSize): Added FIXME comment.
        (WTF::fastMallocGoodSize): Added FIXME comment.
        (WTF::fastAlignedMalloc): Added null check and CRASH.
        (WTF::tryFastMalloc): Changed to call bmalloc directly instead of
        calling fastMalloc, since fastMalloc will now crash on failure.
        (WTF::tryFastRealloc): Changed to call bmalloc directly instead of
        calling fastRealloc, since fastRealloc will now crash on failure.
        (WTF::tryFastCalloc): Added overflow checking.
        (WTF::fastMallocStatistics): Added FIXME comment.

2015-02-10  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] GMutexLocker build issue
        https://bugs.webkit.org/show_bug.cgi?id=141381

        Reviewed by Žan Doberšek.

        Remove using WTF::GMutexLocker from the header, since newer glib
        versions have a GMutexLocker in the public API.

        * wtf/gobject/GMutexLocker.h:

2015-02-09  Alexey Proskuryakov  <ap@apple.com>

        REGRESSION: tryFastCalloc is no longer "try"
        https://bugs.webkit.org/show_bug.cgi?id=141406

        Reviewed by Darin Adler.

        This causes crashes on some WebKit regression test bots.

        * wtf/FastMalloc.cpp: (WTF::tryFastCalloc): Fix what looks like a copy/paste mistake.

2015-02-07  Csaba Osztrogonác  <ossy@webkit.org>

        [ARM] GC sometimes stuck in an infinite loop if parallel GC is enabled
        https://bugs.webkit.org/show_bug.cgi?id=141290

        Reviewed by Anders Carlsson.

        * wtf/Platform.h:

2015-02-07  Chris Dumez  <cdumez@apple.com>

        Add Vector::removeFirstMatching() / removeAllMatching() methods taking lambda functions
        https://bugs.webkit.org/show_bug.cgi?id=141321

        Reviewed by Darin Adler.

        Add Vector::removeFirstMatching() / removeAllMatching() methods taking
        lambda functions to match the element(s) to remove. This simplifies the
        code a bit. Vector::removeAllMatching() is also more efficient than the
        manual removal alternative.

        * wtf/Vector.h:

2015-02-06  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r179743.
        https://bugs.webkit.org/show_bug.cgi?id=141335

        caused missing symbols in non-WebKit clients of WTF::Vector
        (Requested by kling on #webkit).

        Reverted changeset:

        "Remove WTF::fastMallocGoodSize()."
        https://bugs.webkit.org/show_bug.cgi?id=141020
        http://trac.webkit.org/changeset/179743

2015-02-06  Andreas Kling  <akling@apple.com>

        Remove WTF::fastMallocGoodSize().
        <https://webkit.org/b/141020>

        Reviewed by Anders Carlsson.

        bmalloc's good-size API just returns exactly whatever you pass it,
        so it's of no utility to us anymore.

        This gets rid of a bunch of pointless out-of-line calls in Vector
        construction and growth.

        * wtf/Compression.cpp:
        (WTF::GenericCompressedData::create):
        * wtf/FastMalloc.cpp:
        (WTF::fastMallocGoodSize): Deleted.
        * wtf/FastMalloc.h:
        * wtf/Vector.h:
        (WTF::VectorBufferBase::allocateBuffer):
        (WTF::VectorBufferBase::tryAllocateBuffer):
        (WTF::VectorBufferBase::reallocateBuffer):

2015-02-05  Youenn Fablet  <youenn.fablet@crf.canon.fr> and Xabier Rodriguez Calvar <calvaris@igalia.com>

        [Streams API] Implement a barebone ReadableStream interface
        https://bugs.webkit.org/show_bug.cgi?id=141045

        Reviewed by Benjamin Poulain.

        * wtf/FeatureDefines.h:

2015-02-04  Alexey Proskuryakov  <ap@apple.com>

        Optimized equal() functions in StringImpl.h are not ASan compatible
        https://bugs.webkit.org/show_bug.cgi?id=141258

        Reviewed by Daniel Bates.

        * wtf/text/StringImpl.h: (WTF::equal): Add custom implementations for ASan.

2015-02-04  Chris Dumez  <cdumez@apple.com>

        Add removeFirst(value) / removeAll(value) methods to WTF::Vector
        https://bugs.webkit.org/show_bug.cgi?id=141192

        Reviewed by Benjamin Poulain.

        Add removeFirst(value) / removeAll(value) convenience methods to
        WTF::Vector to reduce complexity a bit at call sites.

        I am planning to add overloads for these taking a lambda function for
        matching in a follow-up patch as well. I have seen quite a few
        Vector::remove(index) call sites that would benefit from it.

        * wtf/Vector.h:
        (WTF::OverflowHandler>::removeFirst):
        (WTF::OverflowHandler>::removeAll):

2015-02-02  Dhi Aurrahman  <diorahman@rockybars.com>

        Optimize matchesLangPseudoClass() of :lang()
        https://bugs.webkit.org/show_bug.cgi?id=140873

        Reviewed by Darin Adler.

        Add some basic equality comparison operators.

        * wtf/text/StringView.h:
        (WTF::operator==):
        (WTF::operator!=):
        (WTF::equal):
        (WTF::equalIgnoringASCIICase):

2015-02-02  Geoffrey Garen  <ggaren@apple.com>

        Use FastMalloc (bmalloc) instead of BlockAllocator for GC pages
        https://bugs.webkit.org/show_bug.cgi?id=140900

        Reviewed by Mark Hahnenberg.

        Re-landing just the HandleBlock piece of this patch.

        * wtf/FastMalloc.cpp:
        (WTF::fastAlignedMalloc):
        (WTF::fastAlignedFree):
        (WTF::TCMalloc_ThreadCache::CreateCacheIfNecessary):
        * wtf/FastMalloc.h:

2015-02-02  Daniel Bates  <dabates@apple.com>

        [iOS] ASSERTION FAILED: m_scriptExecutionContext->isContextThread() in ContextDestructionObserver::observeContext
        https://bugs.webkit.org/show_bug.cgi?id=141057
        <rdar://problem/19068790>

        Reviewed by Alexey Proskuryakov.

        * wtf/MainThread.h:
        * wtf/mac/MainThreadMac.mm:
        (WTF::callOnWebThreadOrDispatchAsyncOnMainThread): Added.

2015-01-31  Sam Weinig  <sam@webkit.org>

        Remove even more Mountain Lion support
        https://bugs.webkit.org/show_bug.cgi?id=141124

        Reviewed by Alexey Proskuryakov.

        * Configurations/Base.xcconfig:
        * Configurations/DebugRelease.xcconfig:
        * wtf/Assertions.cpp:
        * wtf/FeatureDefines.h:
        * wtf/Platform.h:

2015-01-31  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r179426.
        https://bugs.webkit.org/show_bug.cgi?id=141119

        "caused a memory use regression" (Requested by Guest45 on
        #webkit).

        Reverted changeset:

        "Use FastMalloc (bmalloc) instead of BlockAllocator for GC
        pages"
        https://bugs.webkit.org/show_bug.cgi?id=140900
        http://trac.webkit.org/changeset/179426

2015-01-31  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r179408.
        https://bugs.webkit.org/show_bug.cgi?id=141117

        This didn't fully fix the issue (Requested by anttik on
        #webkit).

        Reverted changeset:

        "OSObjectPtr does not work with dispatch_data_t on Maverics"
        https://bugs.webkit.org/show_bug.cgi?id=141081
        http://trac.webkit.org/changeset/179408

2015-01-30  Yusuke Suzuki  <utatane.tea@gmail.com>

        Implement ES6 Symbol
        https://bugs.webkit.org/show_bug.cgi?id=140435

        Reviewed by Geoffrey Garen.

        Introduce new unique string mechanizm into StringImpl.
        It is used for implementing Symbol which holds a [[Description]] value.

        * wtf/text/AtomicString.h:
        (WTF::AtomicString::add):
        (WTF::AtomicString::addWithStringTableProvider):

        Previously, we checked `isAtomic()` or `!length()`. This guard can filter out EmptyUnique.
        But now, we introduced new unique StringImpl. Since it has an actual string value, we need to check `isUnique()`.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::~StringImpl):
        (WTF::StringImpl::createUnique):

        In createUnique, we leverage Substring mechanizm to produce a new unique
        string from an existing string.

        * wtf/text/StringImpl.h:
        (WTF::StringImpl::StringImpl):
        (WTF::StringImpl::createUniqueEmpty):
        (WTF::StringImpl::flagIsUnique):
        (WTF::StringImpl::isUnique):
        (WTF::StringImpl::setIsAtomic):
        (WTF::StringImpl::createEmptyUnique): Deleted.
        (WTF::StringImpl::isEmptyUnique): Deleted.

        Instead of EmptyUnique, we introduced new flag to StringImpl, `isUnique`.
        While EmptyUnique cannot hold any string values except for empty string,
        the unique StringImpl can hold any String values.
        We fold the Symbol's descriptiveString value here.

        * wtf/text/StringStatics.cpp:
        (WTF::StringImpl::hashAndFlagsForUnique):
        (WTF::StringImpl::hashAndFlagsForEmptyUnique): Deleted.

2015-01-30  Geoffrey Garen  <ggaren@apple.com>

        Use FastMalloc (bmalloc) instead of BlockAllocator for GC pages
        https://bugs.webkit.org/show_bug.cgi?id=140900

        Reviewed by Mark Hahnenberg.

        Re-landing just the HandleBlock piece of this patch.

        * wtf/FastMalloc.cpp:
        (WTF::fastAlignedMalloc):
        (WTF::fastAlignedFree):
        (WTF::TCMalloc_ThreadCache::CreateCacheIfNecessary):
        * wtf/FastMalloc.h:

2015-01-30  Namhoon Kim  <yanhkim@gmail.com>

        Call vsnprintf instead of _vsnprintf in vprintf_stderr_common
        https://bugs.webkit.org/show_bug.cgi?id=141078

        In windows _vsnprintf api does not place null character
        automatically. Simply replace it with vsnprintf. Which is
        polyfill to call wtf_vsnprintf in windows.

        Reviewed by Brent Fulgham.

        * wtf/Assertions.cpp:

2015-01-30  Brian J. Burg  <burg@cs.washington.edu>

        Web Inspector: ASSERT in InspectorTimelineAgent::internalStop
        https://bugs.webkit.org/show_bug.cgi?id=141039

        Reviewed by Timothy Hatcher.

        Add messages to Stopwatch assertions, and clean up constructor.

        * wtf/Stopwatch.h:
        (WTF::Stopwatch::Stopwatch):
        (WTF::Stopwatch::start):
        (WTF::Stopwatch::stop):

2015-01-30  Chris Dumez  <cdumez@apple.com>

        Add match_constness<Reference, T> helper struct
        https://bugs.webkit.org/show_bug.cgi?id=140905

        Reviewed by Benjamin Poulain.

        Add match_constness<Reference, T> helper struct to simplify downcast<>()
        a bit. The purpose of this helper is to update T's constness to match
        Reference's.

        * wtf/TypeCasts.h:
        (WTF::downcast):

2015-01-30  Chris Dumez  <cdumez@apple.com>

        Add assertion in RefPtr's operator*() to make sure we don't dereference nullptr
        https://bugs.webkit.org/show_bug.cgi?id=141092

        Reviewed by Anders Carlsson.

        Add assertion in RefPtr's operator*() to make sure we don't dereference
        nullptr.

        * wtf/RefPtr.h:
        (WTF::RefPtr::operator*):

2015-01-30  Geoffrey Garen  <ggaren@apple.com>

        GC marking threads should clear malloc caches
        https://bugs.webkit.org/show_bug.cgi?id=141097

        Reviewed by Andreas Kling.

        Split the scavenging API into per-thread vs global, so that you can
        request to scavenge your own thread without scavenging the whole heap.

        * wtf/FastMalloc.cpp:
        (WTF::releaseFastMallocFreeMemoryForThisThread):
        (WTF::TCMalloc_ThreadCache::CreateCacheIfNecessary):
        * wtf/FastMalloc.h:

2015-01-30  Antti Koivisto  <antti@apple.com>

        OSObjectPtr does not work with dispatch_data_t on Maverics
        https://bugs.webkit.org/show_bug.cgi?id=141081

        Reviewed by Pratik Solanki.
        
        Trying to use OSObjectPtr<dispatch_data_t> throws 
        
        -[OS_dispatch_data _xref_dispose]: unrecognized selector sent to instance 0

        * wtf/OSObjectPtr.h:
        (WTF::retainOSObject<dispatch_data_t>):
        (WTF::releaseOSObject<dispatch_data_t>):
        
            Add specialization for dispatch_data_t on Maverics.

2015-01-29  Santosh Mahto  <santoshbit2007@gmail.com>

        Refactor String::format to handle unreached va_end.
        https://bugs.webkit.org/show_bug.cgi?id=140938

        Reviewed by Alexey Proskuryakov.

        Now va_end is called for all platform after getting length
        of formatted string and again va_start/va_end is called to write
        formatted string in buffer. This way it ensure va_end is always
        reached for each va_start.

        * wtf/text/WTFString.cpp:

2015-01-29  Csaba Osztrogonác  <ossy@webkit.org>

        Move HAVE_DTRACE definition back to Platform.h
        https://bugs.webkit.org/show_bug.cgi?id=141033

        Reviewed by Dan Bernstein.

        * wtf/Platform.h:

2015-01-28  Namhoon Kim  <namkim@ea.com>

        Windows return -1 when calling vsnprintf with arguments that exceed target buffer size
        https://bugs.webkit.org/show_bug.cgi?id=140917

        Reviewed by Brent Fulgham.

        Fix return value of vsnprintf when windows API return -1 to denote
        requested buffer exceeded. Replace return value by calling vscprintf.

        * wtf/StringExtras.h:
        (snprintf): Fix return value by calling vscprintf when buffer exceeded.
        (wtf_vsnprintf): Ditto.

2015-01-28  Geoffrey Garen  <ggaren@apple.com>

        Removed fastMallocForbid / fastMallocAllow
        https://bugs.webkit.org/show_bug.cgi?id=141012

        Reviewed by Mark Hahnenberg.

        Removed the forbid / allow API because it is no longer used.

        * wtf/FastMalloc.cpp:
        (WTF::tryFastMalloc):
        (WTF::fastMalloc):
        (WTF::tryFastCalloc):
        (WTF::fastCalloc):
        (WTF::fastFree):
        (WTF::tryFastRealloc):
        (WTF::fastRealloc):
        (WTF::TCMalloc_ThreadCache::CreateCacheIfNecessary):
        (WTF::isForbidden): Deleted.
        (WTF::fastMallocForbid): Deleted.
        (WTF::fastMallocAllow): Deleted.
        (WTF::initializeIsForbiddenKey): Deleted.
        * wtf/FastMalloc.h:

2015-01-28  Dana Burkart  <dburkart@apple.com>

        Move ASan flag settings from DebugRelease.xcconfig to Base.xcconfig
        https://bugs.webkit.org/show_bug.cgi?id=136765

        Reviewed by Alexey Proskuryakov.

        * Configurations/Base.xcconfig:
        * Configurations/DebugRelease.xcconfig:

2015-01-28  Darin Adler  <darin@apple.com>

        Fix small leak in Collator
        https://bugs.webkit.org/show_bug.cgi?id=140990

        Reviewed by Andreas Kling.

        * wtf/unicode/icu/CollatorICU.cpp:
        (WTF::Collator::Collator): Use fastStrDup instead of strdup.
        (WTF::Collator::~Collator): Use fastFree on the collator locale that we
        are abandoning. The old code instead just called free on a null pointer.

2015-01-27  Geoffrey Garen  <ggaren@apple.com>

        Removed WTF_MALLOC_VALIDATION
        https://bugs.webkit.org/show_bug.cgi?id=140958

        Reviewed by Anders Carlsson.

        I don't think anyone has been using this, and the #ifdefs were driving
        me crazy.

        We have other options for validation -- like MallocGuardEdges,
        MallocCheckHeapEach, MallocScribble, and GuardMalloc.

        * wtf/FastMalloc.cpp:
        (WTF::tryFastMalloc):
        (WTF::fastMalloc):
        (WTF::tryFastCalloc):
        (WTF::fastCalloc):
        (WTF::fastFree):
        (WTF::tryFastRealloc):
        (WTF::fastRealloc):
        (WTF::fastMallocSize):
        (WTF::TCMalloc_ThreadCache::CreateCacheIfNecessary):
        (WTF::Internal::fastMallocMatchFailed): Deleted.
        * wtf/FastMalloc.h:
        (WTF::Internal::fastMallocValidationHeader): Deleted.
        (WTF::Internal::fastMallocValidationSuffix): Deleted.
        (WTF::Internal::fastMallocMatchValidationType): Deleted.
        (WTF::Internal::setFastMallocMatchValidationType): Deleted.
        (WTF::fastMallocMatchValidateMalloc): Deleted.
        (WTF::fastMallocMatchValidateFree): Deleted.
        (WTF::fastMallocValidate): Deleted.

2015-01-27  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r179192.
        https://bugs.webkit.org/show_bug.cgi?id=140953

        Caused numerous layout test failures (Requested by mattbaker_
        on #webkit).

        Reverted changeset:

        "Use FastMalloc (bmalloc) instead of BlockAllocator for GC
        pages"
        https://bugs.webkit.org/show_bug.cgi?id=140900
        http://trac.webkit.org/changeset/179192

2015-01-26  Geoffrey Garen  <ggaren@apple.com>

        Use FastMalloc (bmalloc) instead of BlockAllocator for GC pages
        https://bugs.webkit.org/show_bug.cgi?id=140900

        Reviewed by Mark Hahnenberg.

        New interface for aligned allocation: fastAlignedMalloc / fastAlignedFree.
        We require a special function call on free because Windows.

        * wtf/FastMalloc.cpp:
        (WTF::fastAlignedMalloc):
        (WTF::fastAlignedFree): Do it.

        (WTF::do_memalign): Un-ifdef this, since we use it now.

        * wtf/FastMalloc.h: Make our new function names visible like the rest
        of fastMalloc.

2015-01-26  Brent Fulgham  <bfulgham@apple.com>

        [Win] ASSERTION FAILED !m_ptr under AccessibilityController::winAddNotificationListener
        https://bugs.webkit.org/show_bug.cgi?id=87426
        <rdar://problem/11527899>

        Reviewed by Darin Adler.

        Revise internal containers to use std::addressof in preference to
        to using the '&' operator.

        * wtf/Deque.h:
        (WTF::inlineCapacity>::append):
        (WTF::inlineCapacity>::prepend):
        (WTF::inlineCapacity>::removeFirst):
        (WTF::inlineCapacity>::removeLast):
        (WTF::inlineCapacity>::remove):
        (WTF::inlineCapacity>::after):
        (WTF::inlineCapacity>::before):
        * wtf/GetPtr.h:
        * wtf/HashTable.h:
        (WTF::HashTableBucketInitializer<false>::initialize):
        * wtf/HashTraits.h:
        (WTF::SimpleClassHashTraits::constructDeletedValue):
        (WTF::CustomHashTraits::constructDeletedValue):
        * wtf/ListHashSet.h:
        (WTF::ListHashSetConstIterator::get):
        * wtf/Vector.h:
        (WTF::Vector::swap):
        (WTF::OverflowHandler>::append):
        (WTF::OverflowHandler>::tryAppend):
        (WTF::OverflowHandler>::insert):

2015-01-24  Chris Dumez  <cdumez@apple.com>

        Provide implementation for WTF::DefaultHash<bool>
        https://bugs.webkit.org/show_bug.cgi?id=140848

        Reviewed by Anders Carlsson.

        Provide implementation for WTF::DefaultHash<bool> so that we can use
        HashMap<std::pair<XXX, bool>> in the code base. Right now, we need to
        use some integer type to work around the issue.

        * wtf/HashFunctions.h:

2015-01-23  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Add missing null check in some derefGPtr implementations
        https://bugs.webkit.org/show_bug.cgi?id=140822

        Reviewed by Sergio Villar Senin.

        It's missing in GHashTable and GVariant implementations.

        * wtf/gobject/GRefPtr.cpp:
        (WTF::derefGPtr):

2015-01-23  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Add initial database process support
        https://bugs.webkit.org/show_bug.cgi?id=139491

        Reviewed by Sergio Villar Senin.

        Add support for using GRefPtr with GVariantBuilder.

        * wtf/gobject/GRefPtr.cpp:
        (WTF::refGPtr):
        (WTF::derefGPtr):
        * wtf/gobject/GRefPtr.h:
        * wtf/gobject/GTypedefs.h:

2015-01-22  Ryosuke Niwa  <rniwa@webkit.org>

        Add a build flag for ES6 class syntax
        https://bugs.webkit.org/show_bug.cgi?id=140760

        Reviewed by Michael Saboff.

        * wtf/FeatureDefines.h:

2015-01-21  Csaba Osztrogonác  <ossy@webkit.org>

        Remove ENABLE(INSPECTOR) ifdef guards
        https://bugs.webkit.org/show_bug.cgi?id=140668

        Reviewed by Darin Adler.

        * wtf/FeatureDefines.h:

2015-01-20  YunQiang Su  <wzssyqa@gmail.com>

        Fix failed to build for Linux/MIPS64EL
        https://bugs.webkit.org/show_bug.cgi?id=124370

        Reviewed by Darin Adler.

        Add MIPS64EL support.

        * wtf/Platform.h:
        * wtf/dtoa/utils.h:

2015-01-19  Alexey Proskuryakov  <ap@apple.com>

        Make ASan do bounds checks for WTF::Vector
        https://bugs.webkit.org/show_bug.cgi?id=140631
        rdar://problem/19437718

        Reviewed by Darin Adler.

        * wtf/SizeLimits.cpp: Disable Vector object size checks for ASan enabled builds.

        * wtf/Vector.h:
        (WTF::VectorBuffer::endOfBuffer):
        (WTF::Vector::Vector):
        (WTF::Vector::~Vector):
        (WTF::Vector::swap):
        (WTF::OverflowHandler>::Vector):
        (WTF::=):
        (WTF::OverflowHandler>::fill):
        (WTF::OverflowHandler>::resize):
        (WTF::OverflowHandler>::shrink):
        (WTF::OverflowHandler>::grow):
        (WTF::OverflowHandler>::asanSetInitialBufferSizeTo):
        (WTF::OverflowHandler>::asanSetBufferSizeToFullCapacity):
        (WTF::OverflowHandler>::asanBufferSizeWillChangeTo):
        (WTF::OverflowHandler>::reserveCapacity):
        (WTF::OverflowHandler>::tryReserveCapacity):
        (WTF::OverflowHandler>::shrinkCapacity):
        (WTF::OverflowHandler>::append):
        (WTF::OverflowHandler>::tryAppend):
        (WTF::OverflowHandler>::appendSlowCase):
        (WTF::OverflowHandler>::uncheckedAppend):
        (WTF::OverflowHandler>::insert):
        (WTF::OverflowHandler>::remove):
        (WTF::OverflowHandler>::releaseBuffer):

        * wtf/Compiler.h: Changed ASAN_ENABLED macro fallback value from false to 0,
        MSVC was not happy with false.

2015-01-20  Csaba Osztrogonác  <ossy@webkit.org>

        Remove non-Windows cruft from WebKit/win/Plugins
        https://bugs.webkit.org/show_bug.cgi?id=140675

        Reviewed by Anders Carlsson.

        * wtf/FeatureDefines.h:

2015-01-16  Myles C. Maxfield  <mmaxfield@apple.com>

        WeakPtr functions crash when created with default constructor
        https://bugs.webkit.org/show_bug.cgi?id=140479

        Reviewed by Andreas Kling.

        This patch rearranges how WeakPtr works, and has the following ideas behind it:

        1. WeakPtr should use Ref internally. This solves the crash by always having a
        valid WeakReference.
        2. Clients should not be able to construct WeakReferences directly. Instead,
        only WeakPtrFactory (and WeakPtr's default constructor) should be able to
        construct them. They are considered an implementation detail of WeakPtr.
        3. Except for the default constructor, clients should not be able to construct
        WeakPtrs directly. Instead, the WeakPtrFactory must construct them. This
        guarantees that the WeakPtrs all reference the same WeakReference.
        4. Clients can construct a WeakPtr using its default constructor, and then
        use the assignment operator to make it non-null. (Or they could use
        WeakPtrFactory to make it non-null at creation-time.)
        5. No one was using WeakReference::bindTo(), and it doesn't seem useful, so I
        removed it.

        Tests: WTF_WeakPtr API tests

        * wtf/Ref.h:
        (WTF::Ref::Ref): Added extra ASSERT()s, and explicitly deleted copy
        constructors with a comment.
        (WTF::Ref::operator=): Added extra ASSERT()s, and explicitly deleted copy
        assignment operators with a comment.
        * wtf/WeakPtr.h:
        (WTF::WeakReference::clear): Used nullptr.
        (WTF::WeakReference::create): Moved to private:
        (WTF::WeakPtr::WeakPtr): For the default constructor, initialized the Ref with
        a new WeakReference. For the other constructor, moved it to private:. Also added
        copy constructors and copy assignment operators (since Ref doesn't have them but
        RefPtr does). These constructors/operators are relied upon in various places
        throughout WebCore.
        (WTF::WeakPtr::operator bool): Made non-explicit.
        (WTF::WeakReference::createUnbound): Deleted.
        (WTF::WeakReference::bindTo): Deleted.
        (WTF::WeakReference::WeakReference): Deleted.
        (WTF::WeakPtrFactory::WeakPtrFactory): Deleted.

2015-01-16  Yusuke Suzuki  <utatane.tea@gmail.com>

        std::all_of requires complete C++ iterators in GCC 4.8
        https://bugs.webkit.org/show_bug.cgi?id=140530

        Reviewed by Darin Adler.

        In the WebKit2/UIProcess/WebProcessLifetimeObserver.cpp, std::all_of
        is used for HashIterators. However, std::all_of requires the complete
        C++ iterator interface including iterator_category typedef member and
        it raises compile error in GCC 4.8 (and libstdc++) environment.

        This patch inherits std::iterator with appropriate type parameters.
        It automatically defines required typedefs including iterator_category.

        * wtf/HashIterators.h:

2015-01-15  Csaba Osztrogonác  <ossy@webkit.org>

        Remove ENABLE(SQL_DATABASE) guards
        https://bugs.webkit.org/show_bug.cgi?id=140434

        Reviewed by Darin Adler.

        * wtf/FeatureDefines.h:

2015-01-14  Csaba Osztrogonác  <ossy@webkit.org>

        Unreviewed fix after r163330.

        * wtf/Platform.h: Use C style comment.

2015-01-14  Marc Juul  <juul@sudomesh.org>

        C++ style comment was preventing compile if CPU(ARM_NEON)
        https://bugs.webkit.org/show_bug.cgi?id=133827

        Reviewed by Csaba Osztrogonác.

        * wtf/Platform.h:

2015-01-13  Chris Dumez  <cdumez@apple.com>

        Make WTF::Optional work with msvc 2013
        https://bugs.webkit.org/show_bug.cgi?id=140401

        Reviewed by Anders Carlsson.

        Update the WTF::Optional implementation to use std::aligned_memory and
        placement new instead of an unrestricted union because msvc 2013 still
        doesn't support unrestricted unions.

        This change is a pre-requirement to fix Bug 140347 as this change uses
        WTF::Optional with types that have non-trivial copy constructors.

        This change is covered by the existing Optional WTF test.

        * wtf/Optional.h:

2015-01-11  Sam Weinig  <sam@webkit.org>

        Remove support for SharedWorkers
        https://bugs.webkit.org/show_bug.cgi?id=140344

        Reviewed by Anders Carlsson.

        * wtf/FeatureDefines.h:

2015-01-12  Darin Adler  <darin@apple.com>

        Modernize and streamline HTMLTokenizer
        https://bugs.webkit.org/show_bug.cgi?id=140166

        Reviewed by Sam Weinig.

        * wtf/Forward.h: Removed PassRef, added OrdinalNumber and TextPosition.

2015-01-09  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r178154, r178163, and r178164.
        https://bugs.webkit.org/show_bug.cgi?id=140292

        Still multiple assertion failures on tests (Requested by ap on
        #webkit).

        Reverted changesets:

        "Modernize and streamline HTMLTokenizer"
        https://bugs.webkit.org/show_bug.cgi?id=140166
        http://trac.webkit.org/changeset/178154

        "Unreviewed speculative buildfix after r178154."
        http://trac.webkit.org/changeset/178163

        "One more unreviewed speculative buildfix after r178154."
        http://trac.webkit.org/changeset/178164

2015-01-08  Darin Adler  <darin@apple.com>

        Modernize and streamline HTMLTokenizer
        https://bugs.webkit.org/show_bug.cgi?id=140166

        Reviewed by Sam Weinig.

        * wtf/Forward.h: Removed PassRef, added OrdinalNumber and TextPosition.

2015-01-08  Benjamin Poulain  <benjamin@webkit.org>

        [WK2] Start a prototype for declarative site specific extensions
        https://bugs.webkit.org/show_bug.cgi?id=140160

        Reviewed by Andreas Kling.

        * wtf/FeatureDefines.h:

2015-01-07  Daniel Bates  <dabates@apple.com>

        [iOS] Make WebKit2 build with public iOS SDK and more build fixes for DRT
        https://bugs.webkit.org/show_bug.cgi?id=137371

        As pointed out by Tim Horton, use C-style comment instead of C++-style comment as
        wtf/Compiler.h is included in the sandbox profile and the sandbox profile compiler
        doesn't understand C++-style comments.

        * wtf/Compiler.h:

2015-01-07  Daniel Bates  <dabates@apple.com>

        [iOS] Make WebKit2 build with public iOS SDK and more build fixes for DRT
        https://bugs.webkit.org/show_bug.cgi?id=137371

        Reviewed by David Kilzer.

        Move EXTERN_C_BEGIN and EXTERN_C_END macros from file WebKit2/config.h to here and
        rename them to WTF_EXTERN_C_BEGIN and WTF_EXTERN_C_END, respectively, so that we
        can make use of these macros in SPI wrapper headers (e.g. UIKitSPI.h).

        I'll look to transition existing code to WTF_EXTERN_C_BEGIN/WTF_EXTERN_C_END and
        remove EXTERN_C in a subsequent commit(s).

        * wtf/Compiler.h:

2015-01-07  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r178068.
        https://bugs.webkit.org/show_bug.cgi?id=140235

        Breaks the iOS build (Requested by enrica on #webkit).

        Reverted changeset:

        "[iOS] Make WebKit2 build with public iOS SDK and more build
        fixes for DRT"
        https://bugs.webkit.org/show_bug.cgi?id=137371
        http://trac.webkit.org/changeset/178068

2015-01-07  Daniel Bates  <dabates@apple.com>

        [iOS] Make WebKit2 build with public iOS SDK and more build fixes for DRT
        https://bugs.webkit.org/show_bug.cgi?id=137371

        Reviewed by David Kilzer.

        Move EXTERN_C_BEGIN and EXTERN_C_END macros from file WebKit2/config.h to here and
        rename them to WTF_EXTERN_C_BEGIN and WTF_EXTERN_C_END, respectively, so that we
        can make use of these macros in SPI wrapper headers (e.g. UIKitSPI.h).

        I'll look to transition existing code to WTF_EXTERN_C_BEGIN/WTF_EXTERN_C_END and
        remove EXTERN_C in a subsequent commit(s).

        * wtf/Compiler.h:

2015-01-07  Brian J. Burg  <burg@cs.washington.edu>

        Web Inspector: purge PassRefPtr from Inspector code and use Ref for typed and untyped protocol objects
        https://bugs.webkit.org/show_bug.cgi?id=140053

        Reviewed by Andreas Kling.

        * wtf/Stopwatch.h:
        (WTF::Stopwatch::create): Return a Ref.

2015-01-07  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r178039.
        https://bugs.webkit.org/show_bug.cgi?id=140187

        Breaks ObjC Inspector Protocol (Requested by JoePeck on
        #webkit).

        Reverted changeset:

        "Web Inspector: purge PassRefPtr from Inspector code and use
        Ref for typed and untyped protocol objects"
        https://bugs.webkit.org/show_bug.cgi?id=140053
        http://trac.webkit.org/changeset/178039

2015-01-06  Brian J. Burg  <burg@cs.washington.edu>

        Web Inspector: purge PassRefPtr from Inspector code and use Ref for typed and untyped protocol objects
        https://bugs.webkit.org/show_bug.cgi?id=140053

        Reviewed by Andreas Kling.

        * wtf/Stopwatch.h:
        (WTF::Stopwatch::create): Return a Ref.

2015-01-06  Alexey Proskuryakov  <ap@apple.com>

        ADDRESS_SANITIZER macro is overloaded
        https://bugs.webkit.org/show_bug.cgi?id=140130

        Reviewed by Anders Carlsson.

        * wtf/Compiler.h: Added an ASAN_ENABLED macro. The abbreviation should become well
        known - we already use it in tools.

        * wtf/Assertions.h:
        * wtf/RefCounted.h:
        * wtf/SizeLimits.cpp:
        Change the conditional to ENABLE(SECURITY_ASSERTIONS). These checks will be used
        in debug builds, and also when one explicitly passes -DENABLE_SECURITY_ASSERTIONS.

2015-01-05  Andreas Kling  <akling@apple.com>

        Purge PassRefPtr from Page.
        <https://webkit.org/b/140089>

        Reviewed by Anders Carlsson.

        Make SchedulePair::create() return Ref since it never fails.

        * wtf/SchedulePair.h:
        (WTF::SchedulePair::create):

2015-01-01  Darin Adler  <darin@apple.com>

        Rework code that hides characters in password fields to streamline a little
        https://bugs.webkit.org/show_bug.cgi?id=140035

        Reviewed by Sam Weinig.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::fill): Deleted.
        * wtf/text/StringImpl.h: Deleted StringImpl::fill.
        * wtf/text/WTFString.h:
        (WTF::String::fill): Deleted.

2014-12-26  Dan Bernstein  <mitz@apple.com>

        Build fix.

        Removed use of __builtin_s{add,sub}_overflow introduced in r177729 that was causing a compiler used at Apple to crash because of <rdar://problem/19347133>.

        * wtf/SaturatedArithmetic.h:
        (signedAddOverflows):
        (signedSubtractOverflows):

2014-12-26  Dan Bernstein  <mitz@apple.com>

        <rdar://problem/19348208> REGRESSION (r177027): iOS builds use the wrong toolchain
        https://bugs.webkit.org/show_bug.cgi?id=139950

        Reviewed by David Kilzer.

        * Configurations/Base.xcconfig: Only define TOOLCHAINS when building for OS X, doing so
        in a manner that works with Xcode 5.1.1.

2014-12-25  Dan Bernstein  <mitz@apple.com>

        Try to fix the Windows build after r177733.

        * wtf/Ref.h:

2014-12-25  Alexey Proskuryakov  <ap@apple.com>

        Simplify saturated integer add/sub
        https://bugs.webkit.org/show_bug.cgi?id=139854

        Address Darin's post-commit feedback to fix API tests.

        * wtf/SaturatedArithmetic.h: (saturatedSubtraction):

2014-12-24  Benjamin Poulain  <benjamin@webkit.org>

        Simplify saturated integer add/sub
        https://bugs.webkit.org/show_bug.cgi?id=139854

        Reviewed by Darin Adler.

        * wtf/Compiler.h:
        Make a wrapper for __has_builtin for compilers that do not support it.

        * wtf/SaturatedArithmetic.h:
        (saturatedAddition):
        (saturatedSubtraction):
        Use the builtins when possible instead of reinventing the wheel.
        On ARMv7, use the saturated math instructions.

2014-12-23  Anders Carlsson  <andersca@apple.com>

        Move dynamic_objc_cast to RetainPtr.h
        https://bugs.webkit.org/show_bug.cgi?id=139915

        Reviewed by Sam Weinig.

        * wtf/RetainPtr.h:
        (WTF::dynamic_objc_cast):

2014-12-23  Anders Carlsson  <andersca@apple.com>

        Re-indent RefPtr.h and RetainPtr.h.

        Rubber-stamped by Sam Weinig.

        * wtf/RefPtr.h:
        * wtf/RetainPtr.h:

2014-12-20  Eric Carlson  <eric.carlson@apple.com>

        [iOS] add optimized fullscreen API
        https://bugs.webkit.org/show_bug.cgi?id=139833
        <rdar://problem/18844486>

        Reviewed by Simon Fraser.

        * wtf/Platform.h: Define ENABLE_VIDEO_PRESENTATION_MODE.

2014-12-18  Gyuyoung Kim  <gyuyoung.kim@samsung.com>

        Fix build break on EFL and GTK since r177523
        https://bugs.webkit.org/show_bug.cgi?id=139805

        Reviewed by Csaba Osztrogonác.

        * wtf/Ref.h: Include <wtf/StdLibExtras.h> to use std::exchange().

2014-12-18  Gavin Barraclough  <barraclough@apple.com>

        Add strong typing to RefCounter interface, return value as a bool.
        https://bugs.webkit.org/show_bug.cgi?id=139776

        Unreviewed style fixes.

        * wtf/RefCounter.h:
        (WTF::=):

2014-12-18  Brent Fulgham  <bfulgham@apple.com>

        [Win] Build correction after r177541.

        * wtf/RefCounter.h:
        (WTF::RefCounter::Token<T>::Token): Revise constructor inlines to correct
        syntax error.

2014-12-18  Gavin Barraclough  <barraclough@apple.com>

        Add strong typing to RefCounter interface, return value as a bool.
        https://bugs.webkit.org/show_bug.cgi?id=139776

        Reviewed by Geoff Garen.

        Currently all token vended by a RefCounter have the same type - Ref<RefCounter::Count>.
        This means there is no compile time type checking to prevent mistakes. Update the count()
        method to token<>(), templated on type used to identify the token being returned.
        Calls to token<T>() will return a result of type RefCounter::Token<T>.

        There are a few problems with the fact the counter will return you an exact count of the
        number of outstanding tokens:
          - It is desirable to only fire the callback on zero-edge changes; it is more consistent
            to do so if the value is only readable as a boolean.
          - It is desirable to provide the value as an argument to the callback, however to make
            this useful for integer values it is also necessary to indicate the direction of change
            (0->1 is often interesting where 2->1 is not).
          - There is a mismatch between the precision of returning a count, and the inherent
            imprecision of a token based mechanism, where it may be difficult to guarantee
            absolutely no unnecessary refcount churn, and thus unintentional counter values.

        * wtf/RefCounter.cpp:
        (WTF::RefCounter::Count::ref):
        (WTF::RefCounter::Count::deref):
            - only call the callback on zero-edge changes; provide the value.
        (WTF::RefCounter::RefCounter):
            - callback now takes a bool argument.
        * wtf/RefCounter.h:
        (WTF::RefCounter::Token::Token):
            - New opaque type to reference the RefCounter::Count.
        (WTF::RefCounter::Token::operator!):
            - ! operator checks for null / anasigned Tokens.
        (WTF::RefCounter::RefCounter):
            - callback now takes a bool argument.
        (WTF::RefCounter::token):
            - renamed from count(), templated on type of token returned.
        (WTF::RefCounter::value):
            - now returns a bool.
        (WTF::RefCounter::Token<T>::Token):
        (WTF::=):
            - Tokens can be copied & assigned.
        (WTF::RefCounter::count): Deleted.
            - renamed to token<>().

2014-12-18  Anders Carlsson  <andersca@apple.com>

        Simplify smart pointer classes by using std::exchange
        https://bugs.webkit.org/show_bug.cgi?id=139790

        Reviewed by Andreas Kling.

        * wtf/MallocPtr.h:
        * wtf/OSObjectPtr.h:
        * wtf/OwnPtr.h:
        (WTF::OwnPtr<T>::clear):
        (WTF::OwnPtr<T>::release):
        (WTF::OwnPtr<T>::leakPtr):
        (WTF::=):
        * wtf/PassOwnPtr.h:
        (WTF::PassOwnPtr<T>::leakPtr):
        * wtf/PassRefPtr.h:
        (WTF::PassRefPtr<T>::leakRef):
        * wtf/Ref.h:
        * wtf/RefPtr.h:
        (WTF::RefPtr<T>::clear):
        (WTF::RefPtr<T>::leakRef):
        * wtf/RetainPtr.h:
        (WTF::RetainPtr<T>::leakRef):

2014-12-18  Anders Carlsson  <andersca@apple.com>

        Clean up MachSendRight and add a copySendRight member function
        https://bugs.webkit.org/show_bug.cgi?id=139788

        Reviewed by Tim Horton.

        * wtf/StdLibExtras.h:
        (std::exchange):
        Add an implementation of std::exchange.

2014-12-17  Chris Dumez  <cdumez@apple.com>

        [iOS] Make it possible to toggle FeatureCounter support at runtime
        https://bugs.webkit.org/show_bug.cgi?id=139688
        <rdar://problem/19266254>

        Reviewed by Andreas Kling.

        Remove FeatureCounter API from WTF and move it to WebCore/platform
        instead so that it can log conditionally based on a WebCore setting.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:

2014-12-17  Brent Fulgham  <bfulgham@apple.com>

        [Win] Correct DebugSuffix builds under MSBuild
        https://bugs.webkit.org/show_bug.cgi?id=139733
        <rdar://problem/19276880>

        Reviewed by Simon Fraser.

        * WTF.vcxproj/WTF.proj: Make sure to use the '_debug' suffix
        when building the DebugSuffix target.

2014-12-17  Anders Carlsson  <andersca@apple.com>

        Make Ref::copyRef const and ref-qualified
        https://bugs.webkit.org/show_bug.cgi?id=139730

        Reviewed by Andreas Kling.

        * wtf/Ref.h:

2014-12-16  Daniel Bates  <dabates@apple.com>

        [iOS] WTF fails to build with public SDK due to missing header CPAggregateDictionary.h
        https://bugs.webkit.org/show_bug.cgi?id=139695

        Reviewed by Chris Dumez.

        Add USE(APPLE_INTERNAL_SDK)-guard around iOS-specific feature counter implementation
        as we are only interested in counting features in builds of iOS WebKit that were built
        with the Apple Internal SDK.

        * wtf/FeatureCounter.cpp:
        * wtf/ios/FeatureCounter.mm:

2014-12-16  Geoffrey Garen  <ggaren@apple.com>

        Enable FastMalloc in debug builds
        https://bugs.webkit.org/show_bug.cgi?id=139692

        Reviewed by Alexey Proskuryakov.

        This will give debug builds greater fidelity to the real thing.

        FastMalloc now transparently supports all the malloc debugging APIs I
        know of by disabling itself at runtime -- and it should be easy to add
        support for any APIs I missed -- so there's no need to turn it off in
        debug builds.

        * wtf/FastMalloc.cpp:

2014-12-16  Anders Carlsson  <andersca@apple.com>

        RefPtr::copyRef should be const
        https://bugs.webkit.org/show_bug.cgi?id=139689

        Reviewed by Andreas Kling.

        copyRef() doesn't modify the original object so it should be const.
        Also, add a && qualified overload and mark it deleted so that calls to copyRef() where
        the object is an rvalue will fail to compile.

        * wtf/RefPtr.h:

2014-12-15  Chris Dumez  <cdumez@apple.com>

        [iOS] Add feature counting support
        https://bugs.webkit.org/show_bug.cgi?id=139652
        <rdar://problem/19255690>

        Reviewed by Gavin Barraclough.

        Add a FeatureCounter API for to log / count when a feature
        is used. For now, this is only implementated on iOS.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/FeatureCounter.cpp: Added.
        (WTF::incrementFeatureCounterKey):
        (WTF::setFeatureCounterKey):
        * wtf/FeatureCounter.h: Added.
        * wtf/ios/FeatureCounter.mm: Added.
        (WTF::incrementFeatureCounterKey):
        (WTF::setFeatureCounterKey):

2014-12-12  Anders Carlsson  <andersca@apple.com>

        Get rid of the DONT_FINALIZE_ON_MAIN_THREAD #define
        https://bugs.webkit.org/show_bug.cgi?id=139613

        Reviewed by Sam Weinig.

        * wtf/Platform.h:
        Remove the #define.

2014-12-15  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r177284.
        https://bugs.webkit.org/show_bug.cgi?id=139658

        "Breaks API tests and LayoutTests on Yosemite Debug"
        (Requested by msaboff on #webkit).

        Reverted changeset:

        "Make sure range based iteration of Vector<> still receives
        bounds checking"
        https://bugs.webkit.org/show_bug.cgi?id=138821
        http://trac.webkit.org/changeset/177284

2014-12-15  Andreas Kling  <akling@apple.com>

        Purge PassRefPtr from FocusEvent code.
        <https://webkit.org/b/139647>

        Reviewed by Anders Carlsson.

        Add a RefPtr::copyRef() to use when passing a RefPtr to a RefPtr&& without
        transferring the ownership.

        * wtf/RefPtr.h:

2014-12-15  Oliver Hunt  <oliver@apple.com>

        Make sure range based iteration of Vector<> still receives bounds checking
        https://bugs.webkit.org/show_bug.cgi?id=138821

        Reviewed by Mark Lam.

        Add a new IndexedIterator struct to WTF that wraps a
        Vector type and index to provide pointer like semantics
        while still performing runtime bounds checking, even in
        release builds. We store a simple index into the vector
        which means that this iterator allows vector resizing
        during iteration. If the vector is resized such that the
        iterator is out of bounds, then any attempt to dereference
        the iterator will crash safely.

        For the purpose of retaining semantically equivalent
        behaviour, the iterator can be moved to m_index == size()
        as that is the standard "end" terminator for these types.
        Attempting to dereference at that point will still crash
        rather than perform an unsafe memory operation.

        By necessity there are many overrides for operator + and - as
        we otherwise hit many different type promotion ambiguities when
        performing arithmetic with iterators. These ambiguities are also
        different for 32- vs. 64-bit, so duplicating the functions
        and then forwarding to the core implementations that performed
        the bounds checking and mutation seemed like the right call.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/IndexedIterator.h: Added.
        (WTF::IndexedIterator::IndexedIterator):
        (WTF::IndexedIterator::operator->):
        (WTF::IndexedIterator::operator*):
        (WTF::IndexedIterator::get):
        (WTF::IndexedIterator::operator++):
        (WTF::IndexedIterator::operator--):
        (WTF::IndexedIterator::operator UnspecifiedBoolType):
        (WTF::IndexedIterator::operator-):
        (WTF::IndexedIterator::operator=):
        (WTF::IndexedIterator::operator==):
        (WTF::IndexedIterator::operator!=):
        (WTF::IndexedIterator::operator<):
        (WTF::IndexedIterator::operator<=):
        (WTF::IndexedIterator::operator>):
        (WTF::IndexedIterator::operator>=):
        (WTF::IndexedIterator::operator const_iterator):
        (WTF::IndexedIterator::unsafeGet):
        (WTF::getPtr):
        (WTF::operator-):
        (WTF::operator==):
        (WTF::operator!=):
        (WTF::operator<=):
        (WTF::operator>=):
        (WTF::operator<):
        (WTF::operator>):
        (WTF::IndexedIteratorSelector::makeIterator):
        (WTF::IndexedIteratorSelector::makeConstIterator):
        * wtf/RefCountedArray.h:
        (WTF::RefCountedArray::RefCountedArray):
        * wtf/Vector.h:
        (WTF::Vector::Vector):
        (WTF::Vector::begin):
        (WTF::Vector::end):
        (WTF::OverflowHandler>::Vector):
        (WTF::=):
        (WTF::OverflowHandler>::fill):
        (WTF::OverflowHandler>::expandCapacity):
        (WTF::OverflowHandler>::tryExpandCapacity):
        (WTF::OverflowHandler>::resize):
        (WTF::OverflowHandler>::shrink):
        (WTF::OverflowHandler>::grow):
        (WTF::OverflowHandler>::reserveCapacity):
        (WTF::OverflowHandler>::tryReserveCapacity):
        (WTF::OverflowHandler>::shrinkCapacity):
        (WTF::OverflowHandler>::append):
        (WTF::OverflowHandler>::tryAppend):
        (WTF::OverflowHandler>::appendSlowCase):
        (WTF::OverflowHandler>::uncheckedAppend):
        (WTF::OverflowHandler>::appendVector):
        (WTF::OverflowHandler>::insert):
        (WTF::OverflowHandler>::insertVector):
        (WTF::OverflowHandler>::remove):

2014-12-14  Andreas Kling  <akling@apple.com>

        Minor follow-up tweaks suggested by Darin on bug 139587.

        * wtf/text/WTFString.h:
        (WTF::String::String):

2014-12-14  Andreas Kling  <akling@apple.com>

        Replace PassRef with Ref/Ref&& across the board.
        <https://webkit.org/b/139587>

        Reviewed by Darin Adler.

        Kill the PassRef class and replace it by Ref/Ref&&.
        Usage is simple:

            - For locals and members, keep using Ref<T>.
            - For return types, use Ref<T>.
            - For (ownership-transferring) arguments, use Ref<T>&&.

        When passing to a Ref&&, use WTF::move() to mobilize the value
        at the call site, e.g:

            void myFunction(Ref<Foo>&&);

            Ref<Foo> myFoo(Foo::create());
            myFunction(WTF::move(myFoo));
            // 'myFoo' is invalid from this point forward.

        As you can see, it works a lot like PassRefPtr, but unlike PassRefPtr
        it won't surprise you by becoming null *unless* you WTF::move it.

        I've also added a Ref::copyRef() for instances where you want to
        return a Ref *without* transferring ownership, e.g code like:

            Ref<Foo> foo() { return m_foo; }

        ... now becomes ...

            Ref<Foo> foo() { return m_foo.copyRef(); }

        This makes it explicit that a refcount bump will occur.

        Finally, do note that unlike last year's PassRef, Ref&& does not
        require you to move it to avoid leaking; it will clean itself up.

        * wtf/PassRef.h:
        (WTF::adopted): Deleted.
        (WTF::PassRef<T>::PassRef): Deleted.
        (WTF::PassRef<T>::~PassRef): Deleted.
        (WTF::PassRef<T>::get): Deleted.
        (WTF::PassRef<T>::ptr): Deleted.
        (WTF::PassRef<T>::leakRef): Deleted.
        (WTF::adoptRef): Deleted.
        (WTF::createRefCounted): Deleted.
        * wtf/PassRefPtr.h:
        (WTF::PassRefPtr::PassRefPtr):
        * wtf/Ref.h:
        (WTF::adopted):
        (WTF::Ref::~Ref):
        (WTF::Ref::Ref):
        (WTF::Ref::operator=):
        (WTF::Ref::operator->):
        (WTF::Ref::ptr):
        (WTF::Ref::get):
        (WTF::Ref::operator T&):
        (WTF::Ref::operator const T&):
        (WTF::Ref<T>::replace):
        (WTF::adoptRef):
        * wtf/RefCounter.h:
        (WTF::RefCounter::count):
        * wtf/RefPtr.h:
        (WTF::RefPtr::releaseNonNull):
        (WTF::RefPtr<T>::RefPtr):
        (WTF::=):
        * wtf/text/AtomicString.cpp:
        (WTF::addToStringTable):
        (WTF::AtomicString::add):
        (WTF::AtomicString::addFromLiteralData):
        (WTF::AtomicString::addSlowCase):
        * wtf/text/AtomicString.h:
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::createFromLiteral):
        (WTF::StringImpl::createWithoutCopying):
        (WTF::StringImpl::createUninitializedInternal):
        (WTF::StringImpl::createUninitializedInternalNonEmpty):
        (WTF::StringImpl::createUninitialized):
        (WTF::StringImpl::reallocateInternal):
        (WTF::StringImpl::reallocate):
        (WTF::StringImpl::createInternal):
        (WTF::StringImpl::create):
        (WTF::StringImpl::create8BitIfPossible):
        (WTF::StringImpl::substring):
        (WTF::StringImpl::lower):
        (WTF::StringImpl::upper):
        (WTF::StringImpl::fill):
        (WTF::StringImpl::foldCase):
        (WTF::StringImpl::convertToASCIILowercase):
        (WTF::StringImpl::stripMatchedCharacters):
        (WTF::StringImpl::stripWhiteSpace):
        (WTF::StringImpl::removeCharacters):
        (WTF::StringImpl::simplifyMatchedCharactersToSpace):
        (WTF::StringImpl::simplifyWhiteSpace):
        (WTF::StringImpl::replace):
        (WTF::StringImpl::adopt):
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::create8BitIfPossible):
        (WTF::StringImpl::create):
        (WTF::StringImpl::createSubstringSharingImpl8):
        (WTF::StringImpl::createSubstringSharingImpl):
        (WTF::StringImpl::createFromLiteral):
        (WTF::StringImpl::createEmptyUnique):
        (WTF::StringImpl::adopt):
        (WTF::StringImpl::replace):
        (WTF::StringImpl::constructInternal<LChar>):
        (WTF::StringImpl::constructInternal<UChar>):
        (WTF::StringImpl::isolatedCopy):
        * wtf/text/WTFString.h:
        (WTF::String::String):

2014-12-10  Geoffrey Garen  <ggaren@apple.com>

        Please disable the webkitFirstVersionWithInitConstructorSupport check on Apple TV
        https://bugs.webkit.org/show_bug.cgi?id=139501

        Reviewed by Gavin Barraclough.

        Added a platform definition for APPLETV.

        (It's not an OS because it's not mutually exclusive with other OS definitions.)

        * wtf/Platform.h:

2014-12-10  Martin Robinson  <mrobinson@igalia.com>

        [GTK] Add support for text-decoration-skip
        https://bugs.webkit.org/show_bug.cgi?id=131540

        Reviewed by Gustavo Noronha Silva.

        * wtf/Platform.h: Enable text decoration skip by default.

2014-12-09  David Kilzer  <ddkilzer@apple.com>

        Switch from using PLATFORM_NAME to SDK selectors in ANGLE, bmalloc, gtest, JavaScriptCore, WTF
        <http://webkit.org/b/139212>

        Reviewed by Joseph Pecoraro.

        * Configurations/Base.xcconfig:
        - Only set GCC_ENABLE_OBJC_GC, GCC_MODEL_TUNING and TOOLCHAINS
          on OS X.
        * Configurations/DebugRelease.xcconfig:
        - Only set MACOSX_DEPLOYMENT_TARGET and SDKROOT on OS X.

2014-12-09  Dean Jackson  <dino@apple.com>

        [Apple] Use Accelerate framework to speed-up FEGaussianBlur
        https://bugs.webkit.org/show_bug.cgi?id=139310

        Unreviewed followup, after comments by Andreas Kling.

        It was pointed out that we already have a USE(ACCELERATE), so
        we don't need a HAVE(ACCELERATE) :)

        * wtf/Platform.h:

2014-12-09  Alberto Garcia  <berto@igalia.com>

        Undefined Symbol build error "_objc_registerThreadWithCollector" when building WebKit GTK Mac OS X on Snow Leopard
        https://bugs.webkit.org/show_bug.cgi?id=58737

        Reviewed by Darin Adler.

        Replace OS(MAC_OS_X) with PLATFORM(MAC) to prevent using
        osx-specific code in WebKitGTK+ builds.

        * wtf/ThreadingPthreads.cpp:
        (WTF::initializeCurrentThreadInternal):

2014-12-08  Dean Jackson  <dino@apple.com>

        [Apple] Use Accelerate framework to speed-up FEGaussianBlur
        https://bugs.webkit.org/show_bug.cgi?id=139310
        <rdar://problem/18434594>

        Reviewed by Simon Fraser.

        Add a HAVE_ACCELERATE flag, true on Apple platforms.

        * wtf/Platform.h:

2014-12-08  Myles C. Maxfield  <mmaxfield@apple.com>

        Fix iOS build after r176971.

        I had previously modified the WTF forwarding header instead of modifying the real source.

        * wtf/unicode/CharacterNames.h:

2014-12-08  Anders Carlsson  <andersca@apple.com>

        Change WTF::currentCPUTime to return std::chrono::microseconds and get rid of currentCPUTimeMS
        https://bugs.webkit.org/show_bug.cgi?id=139410

        Reviewed by Andreas Kling.

        * wtf/CurrentTime.cpp:
        (WTF::currentCPUTime):
        (WTF::currentCPUTimeMS): Deleted.
        * wtf/CurrentTime.h:

2014-12-08  Chris Dumez  <cdumez@apple.com>

        Revert r176293 & r176275

        Unreviewed, revert r176293 & r176275 changing the Vector API to use unsigned type
        instead of size_t. There is some disagreement regarding the long-term direction
        of the API and we shouldn’t leave the API partly transitioned to unsigned type
        while making a decision.

        * wtf/Forward.h:
        * wtf/Vector.h:
        (WTF::VectorTypeOperations::compare):
        (WTF::VectorBufferBase::allocateBuffer):
        (WTF::VectorBufferBase::tryAllocateBuffer):
        (WTF::VectorBufferBase::shouldReallocateBuffer):
        (WTF::VectorBufferBase::reallocateBuffer):
        (WTF::VectorBufferBase::capacity):
        (WTF::VectorBufferBase::VectorBufferBase):
        (WTF::VectorBuffer::VectorBuffer):
        (WTF::VectorBuffer::allocateBuffer):
        (WTF::VectorBuffer::tryAllocateBuffer):
        (WTF::VectorBuffer::shouldReallocateBuffer):
        (WTF::VectorBuffer::reallocateBuffer):
        (WTF::VectorBuffer::swap):
        (WTF::VectorBuffer::swapInlineBuffer):
        (WTF::VectorBuffer::swapInlineBuffers):
        (WTF::Vector::Vector):
        (WTF::Vector::capacity):
        (WTF::Vector::at):
        (WTF::Vector::operator[]):
        (WTF::OverflowHandler>::find):
        (WTF::OverflowHandler>::reverseFind):
        (WTF::OverflowHandler>::fill):
        (WTF::OverflowHandler>::expandCapacity):
        (WTF::OverflowHandler>::tryExpandCapacity):
        (WTF::OverflowHandler>::resize):
        (WTF::OverflowHandler>::resizeToFit):
        (WTF::OverflowHandler>::shrink):
        (WTF::OverflowHandler>::grow):
        (WTF::OverflowHandler>::reserveCapacity):
        (WTF::OverflowHandler>::tryReserveCapacity):
        (WTF::OverflowHandler>::reserveInitialCapacity):
        (WTF::OverflowHandler>::shrinkCapacity):
        (WTF::OverflowHandler>::append):
        (WTF::OverflowHandler>::tryAppend):
        (WTF::OverflowHandler>::insert):
        (WTF::OverflowHandler>::insertVector):
        (WTF::OverflowHandler>::remove):
        (WTF::OverflowHandler>::reverse):
        (WTF::OverflowHandler>::checkConsistency):
        * wtf/text/AtomicString.h:
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::adopt):
        (WTF::equalIgnoringNullity):
        * wtf/text/StringView.h:
        (WTF::append):
        * wtf/text/WTFString.h:

2014-12-07  Andreas Kling  <akling@apple.com>

        Use more PassRef in AtomicString.
        <https://webkit.org/b/139319>

        Reviewed by Antti Koivisto.

        Make a pass over AtomicString and convert functions that return PassRefPtr
        into returning RefPtr (where it may be null) and PassRef otherwise.
        This allows the compiler to skip null checks in many places.

        * wtf/text/AtomicString.cpp:
        (WTF::addToStringTable):
        (WTF::AtomicString::add):
        (WTF::AtomicString::addFromLiteralData):
        (WTF::AtomicString::addSlowCase):
        * wtf/text/AtomicString.h:
        (WTF::AtomicString::add):
        (WTF::AtomicString::addWithStringTableProvider):
        * wtf/text/cf/AtomicStringCF.cpp:
        (WTF::AtomicString::add):

2014-12-05  Roger Fong  <roger_fong@apple.com>

        [Win] proj files copying over too many resources..
        https://bugs.webkit.org/show_bug.cgi?id=139315.
        <rdar://problem/19148278>

        Reviewed by Brent Fulgham.

        * WTF.vcxproj/WTF.proj: Only copy WTF.dll.

2014-12-05  Andreas Kling  <akling@apple.com>

        PassRef should deref on destruction if pointee was not moved.
        <https://webkit.org/b/139309>

        Reviewed by Antti Koivisto.

        Let PassRef become nullptr internally after having WTF::move()'d the pointee.
        This means that PassRef is now essentially a PassRefPtr that can only be
        constructed with a non-null pointee.

        This should make it possible for all ::create()-style construction helpers to
        return PassRef, removing a branch in each case.

        * wtf/PassRef.h:
        (WTF::PassRef<T>::PassRef):
        (WTF::PassRef<T>::~PassRef):
        (WTF::PassRef<T>::get):
        (WTF::PassRef<T>::ptr):
        (WTF::PassRef<T>::leakRef):
        (WTF::PassRef<T>::dropRef): Deleted.

2014-12-05  Jer Noble  <jer.noble@apple.com>

        [WTF] MediaTime should support round-tripping from and to doubles.
        https://bugs.webkit.org/show_bug.cgi?id=139248

        Reviewed by Eric Carlson.

        MediaTimes should be able to return precisely the same double value as was used
        when the MediaTime was created, so long as that MediaTime was not modified in a
        non-destructive way. This will allow API which accepts floating-point values to
        return the exact same value when asked, but still be able to store that value
        as a MediaTime.

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::createWithFloat): Added; store the floating-point value in a union.
        (WTF::MediaTime::createWithDouble): Ditto.
        (WTF::MediaTime::toFloat): If the value is a double, just return it.
        (WTF::MediaTime::toDouble): Ditto.
        (WTF::MediaTime::operator+): Special case when one or both sides are doubles.
        (WTF::MediaTime::operator-): Ditto.
        (WTF::MediaTime::operator*): Ditto.
        (WTF::MediaTime::compare): Ditto.
        (WTF::abs): Ditto.
        (WTF::MediaTime::setTimeScale): Convert the MediaTime from a double.

2014-12-05  peavo@outlook.com  <peavo@outlook.com>

        [WinCairo] WTF project is missing a GStreamer source file.
        https://bugs.webkit.org/show_bug.cgi?id=139296

        Reviewed by Philippe Normand.

        The WTF project file is missing a GStreamer source file,
        causing a link error when compiling with GStreamer enabled.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:

2014-12-04  David Kilzer  <ddkilzer@apple.com>

        REGRESSION (r176683): RefCounter.h is installed outside SDKROOT

        * WTF.xcodeproj/project.pbxproj: Don't mark RefCounter.h as a
        private header.  WTF headers use a special build phase script to
        be installed.

2014-12-04  Anders Carlsson  <andersca@apple.com>

        Make API::String copy the underlying strings if needed, for thread safety
        https://bugs.webkit.org/show_bug.cgi?id=139261

        Reviewed by Sam Weinig.

        * wtf/RefPtr.h:
        (WTF::RefPtr<T>::leakRef):
        Add a leakRef() to RefPtr so we don't have to go through PassRefPtr.

        * wtf/text/WTFString.cpp:
        (WTF::String::isSafeToSendToAnotherThread):
        Check if the string is empty before checking whether it's in an atomic string table.
        It's safe to send empty strings to other threads even if they're in the atomic string table
        since they will never be deallocated.

2014-12-04  Csaba Osztrogonác  <ossy@webkit.org>

        Fix cast-align warning in StringImpl.h
        https://bugs.webkit.org/show_bug.cgi?id=139222

        Reviewed by Anders Carlsson.

        * wtf/text/StringImpl.h:
        (WTF::StringImpl::tailPointer):

2014-12-02  Mark Lam  <mark.lam@apple.com>

        Rolling out r176592, r176603, r176616, and r176705 until build and perf issues are resolved.
        https://bugs.webkit.org/show_bug.cgi?id=138821

        Not reviewed.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/IndexedIterator.h: Removed.
        * wtf/RefCountedArray.h:
        (WTF::RefCountedArray::RefCountedArray):
        * wtf/Vector.h:
        (WTF::Vector::Vector):
        (WTF::Vector::begin):
        (WTF::Vector::end):
        (WTF::OverflowHandler>::Vector):
        (WTF::=):
        (WTF::OverflowHandler>::fill):
        (WTF::OverflowHandler>::expandCapacity):
        (WTF::OverflowHandler>::tryExpandCapacity):
        (WTF::OverflowHandler>::resize):
        (WTF::OverflowHandler>::shrink):
        (WTF::OverflowHandler>::grow):
        (WTF::OverflowHandler>::reserveCapacity):
        (WTF::OverflowHandler>::tryReserveCapacity):
        (WTF::OverflowHandler>::shrinkCapacity):
        (WTF::OverflowHandler>::append):
        (WTF::OverflowHandler>::tryAppend):
        (WTF::OverflowHandler>::appendSlowCase):
        (WTF::OverflowHandler>::uncheckedAppend):
        (WTF::OverflowHandler>::appendVector):
        (WTF::OverflowHandler>::insert):
        (WTF::OverflowHandler>::insertVector):
        (WTF::OverflowHandler>::remove):

2014-12-02  Oliver Hunt  <oliver@apple.com>

        Fix IOS builds.

        * wtf/IndexedIterator.h:

2014-12-02  Gavin Barraclough  <barraclough@apple.com>

        Generalize PageActivityAssertionToken
        https://bugs.webkit.org/show_bug.cgi?id=139106

        Reviewed by Sam Weinig.

        PageActivityAssertionToken is a RAII mechanism implementing a counter, used by PageThrottler
        to count user visible activity in progress on the page (currently page load and media playback).
        Use of an RAII type is prevents a number of possible errors, including double counting a single
        media element, or failing to decrement the count after a media element has been deallocated.

        The current implementation has a number of drawbacks that have been addressed by this refactoring:
         - specific to single use in PageThrottler class - not reusable.
         - incomplete encapsulation - the counter and WeakPtrFactory that comprise the current implementation
           are not encapsulated (are in the client type, PageThrottler).
         - tokens are not shared - PageActivityAssertionToken instances are managed by std::unique, every
           increment requires an object allocation.
         - redundancy - the current implementation uses a WeakPtr to safely reference the PageThrottler, this
           is internally implemented using a reference counted type, resulting in two counters being
           incremented (one in the PageActivityAssertionToken, one in the PageThrottler).

        In the reimplementation:
         - a callback is provided via a lambda function, which allows for easy reuse without a lot of
           boilerplate code.
         - the counter, callback and ownership of the otherwise weakly-owned token is encapsulated within the
           RefCounter type.
         - a single count within RefCounter::Count stores the counter value, and also manage the lifetime
           of this object.
         - standard RefPtrs are used to manage references to the RefCounter::Count.

        * WTF.xcodeproj/project.pbxproj:
            - added RefCounter.cpp/.h
        * wtf/RefCounter.cpp: Added.
        (WTF::RefCounter::Count::ref):
            - increment the counter.
        (WTF::RefCounter::Count::deref):
            - decrement the counter, and delete as necessary.
        (WTF::RefCounter::RefCounter):
            - create a RefCounter::Count.
        (WTF::RefCounter::~RefCounter):
            - eagerly delete the Counter if it has no references, otherwise let it be deleted on last deref.
        * wtf/RefCounter.h: Added.
        (WTF::RefCounter::Count::Count):
            - initialize count to 0.
        (WTF::RefCounter::RefCounter):
            - takes a lambda to be called when the value changes.
        (WTF::RefCounter::count):
            - reference the counter (and in doing so increment the count).
        (WTF::RefCounter::value):
            - access the current value of the counter.

2014-12-01  Andreas Kling  <akling@apple.com>

        Optimize constructing JSC::Identifier from AtomicString.
        <https://webkit.org/b/139157>

        Reviewed by Michael Saboff.

        Make AtomicString::isInAtomicStringTable() public so it can be used
        in some Identifier assertions.

        * wtf/text/AtomicString.h:

2014-12-01  Oliver Hunt  <oliver@apple.com>

        Fix non-mac builds.

        * wtf/IndexedIterator.h:

2014-12-01  Oliver Hunt  <oliver@apple.com>

        Fix 32-bit build.

        * wtf/IndexedIterator.h:

2014-11-17  Oliver Hunt  <oliver@apple.com>

        Make sure range based iteration of Vector<> still receives bounds checking
        https://bugs.webkit.org/show_bug.cgi?id=138821

        Reviewed by Mark Lam.

        Add a new IndexedIterator struct to WTF that wraps a
        Vector type and index to provide pointer like semantics
        while still performing runtime bounds checking, even in
        release builds. We store a simple index into the vector
        which means that this iterator allows vector resizing
        during iteration. If the vector is resized such that the
        iterator is out of bounds, then any attempt to dereference
        the iterator will crash safely. Any other errors, including
        overflows, and over extending the iterator will likewise
        crash.

        For the purpose of retaining semantically equivalent
        behaviour, the iterator can be moved to m_index == size()
        as that is the standard "end" terminator for these types.
        Attempting to dereference at that point will still crash
        rather than perform an unsafe memory operation.

        In order to maintain the validity of all the bounds checking,
        we perform full integer range checking prior to any mutation
        of the iterator location. If we detect an arithmetic overflow
        we will crash rather than attempting to carry on.

        By necessity there are many overrides for operator + and - as
        we otherwise hit many different type promotion ambiguities when
        performing arithmetic with iterators. These ambiguities are also
        different for 32- vs. 64-bit, so duplicating the functions
        and then forwarding to the core implementations that performed
        the bounds checking and mutation seemed like the right call.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/IndexedIterator.h: Added.
        (WTF::IndexedIterator::IndexedIterator):
        (WTF::IndexedIterator::operator->):
        (WTF::IndexedIterator::operator*):
        (WTF::IndexedIterator::get):
        (WTF::IndexedIterator::operator++):
        (WTF::IndexedIterator::operator--):
        (WTF::IndexedIterator::operator UnspecifiedBoolType):
        (WTF::IndexedIterator::operator+=):
        (WTF::IndexedIterator::operator-=):
        (WTF::IndexedIterator::operator+):
        (WTF::IndexedIterator::operator-):
        (WTF::IndexedIterator::operator=):
        (WTF::IndexedIterator::operator==):
        (WTF::IndexedIterator::operator!=):
        (WTF::IndexedIterator::operator<):
        (WTF::IndexedIterator::operator<=):
        (WTF::IndexedIterator::operator>):
        (WTF::IndexedIterator::operator>=):
        (WTF::IndexedIterator::operator const_iterator):
        (WTF::IndexedIterator::isSafeToCompare):
        (WTF::IndexedIterator::unsafeGet):
        (WTF::getPtr):
        (WTF::operator-):
        (WTF::operator==):
        (WTF::operator!=):
        (WTF::operator<=):
        (WTF::operator>=):
        (WTF::operator<):
        (WTF::operator>):
        (WTF::IndexedIteratorSelector::makeIterator):
        (WTF::IndexedIteratorSelector::makeConstIterator):
        * wtf/RefCountedArray.h:
        (WTF::RefCountedArray::RefCountedArray):
        * wtf/Vector.h:
        (WTF::Vector::Vector):
        (WTF::Vector::begin):
        (WTF::Vector::end):
        (WTF::OverflowHandler>::Vector):
        (WTF::=):
        (WTF::OverflowHandler>::fill):
        (WTF::OverflowHandler>::expandCapacity):
        (WTF::OverflowHandler>::tryExpandCapacity):
        (WTF::OverflowHandler>::resize):
        (WTF::OverflowHandler>::shrink):
        (WTF::OverflowHandler>::grow):
        (WTF::OverflowHandler>::reserveCapacity):
        (WTF::OverflowHandler>::tryReserveCapacity):
        (WTF::OverflowHandler>::shrinkCapacity):
        (WTF::OverflowHandler>::append):
        (WTF::OverflowHandler>::tryAppend):
        (WTF::OverflowHandler>::appendSlowCase):
        (WTF::OverflowHandler>::uncheckedAppend):
        (WTF::OverflowHandler>::appendVector):
        (WTF::OverflowHandler>::insert):
        (WTF::OverflowHandler>::insertVector):
        (WTF::OverflowHandler>::remove):

2014-11-30  Ryuan Choi  <ryuan.choi@navercorp.com>

        [EFL] Drop support for the EFL 1.7
        https://bugs.webkit.org/show_bug.cgi?id=139114

        Reviewed by Gyuyoung Kim.

        * wtf/efl/EflTypedefs.h: Removed old definitions which EFL 1.7 used.

2014-11-21  Anders Carlsson  <andersca@apple.com>

        Remove the Timer parameters from timer callbacks
        https://bugs.webkit.org/show_bug.cgi?id=138974

        Reviewed by Antti Koivisto.

        * wtf/RunLoopTimer.h:
        (WTF::RunLoopTimer::RunLoopTimer):
        (WTF::RunLoopTimer::fired):

2014-11-18  Chris Dumez  <cdumez@apple.com>

        Have Vector::capacity() return an unsigned instead of a size_t
        https://bugs.webkit.org/show_bug.cgi?id=138842

        Reviewed by Andreas Kling.

        Have Vector::capacity() return an unsigned instead of a size_t as
        capacity is stored as an unsigned internally.

        * wtf/Vector.h:
        (WTF::Vector::capacity):
        (WTF::OverflowHandler>::expandCapacity):
        (WTF::OverflowHandler>::tryExpandCapacity):

2014-11-18  Geoffrey Garen  <ggaren@apple.com>

        Removed the custom allocator for ListHashSet nodes
        https://bugs.webkit.org/show_bug.cgi?id=138841

        Reviewed by Andreas Kling.

        bmalloc is fast, so we don't need a custom allocator.

        The MallocBench test for linked list node allocation (list_allocate) is
        4.09X faster in bmalloc than TCMalloc. Also, I wrote a stress test to
        add/remove link elements, which modify a ListHashSet on insertion and
        removal, and it was 1% faster / in the noise with bmalloc enabled.

        * wtf/ListHashSet.h:
        (WTF::ListHashSetNode::ListHashSetNode):
        (WTF::ListHashSetTranslator::translate):
        (WTF::U>::ListHashSet):
        (WTF::=):
        (WTF::U>::swap):
        (WTF::U>::~ListHashSet):
        (WTF::U>::size):
        (WTF::U>::capacity):
        (WTF::U>::isEmpty):
        (WTF::U>::first):
        (WTF::U>::removeFirst):
        (WTF::U>::takeFirst):
        (WTF::U>::last):
        (WTF::U>::removeLast):
        (WTF::U>::takeLast):
        (WTF::U>::contains):
        (WTF::U>::remove):
        (WTF::U>::clear):
        (WTF::U>::unlink):
        (WTF::U>::unlinkAndDelete):
        (WTF::U>::appendNode):
        (WTF::U>::prependNode):
        (WTF::U>::insertNodeBefore):
        (WTF::U>::deleteAllNodes):
        (WTF::ListHashSetNodeAllocator::ListHashSetNodeAllocator): Deleted.
        (WTF::ListHashSetNodeAllocator::allocate): Deleted.
        (WTF::ListHashSetNodeAllocator::deallocate): Deleted.
        (WTF::ListHashSetNodeAllocator::pool): Deleted.
        (WTF::ListHashSetNodeAllocator::pastPool): Deleted.
        (WTF::ListHashSetNodeAllocator::inPool): Deleted.
        (WTF::ListHashSetNode::operator new): Deleted.
        (WTF::ListHashSetNode::destroy): Deleted.

2014-11-18  Chris Dumez  <cdumez@apple.com>

        Update the Vector API to deal with unsigned types instead of size_t
        https://bugs.webkit.org/show_bug.cgi?id=138824

        Reviewed by Andreas Kling.

        Update part of the Vector API to deal with unsigned types instead of
        size_t. The Vector class is already using unsigned type for its
        capacity and size data members. However, the Vector API was never
        updated accordingly.

        The rest of the Vector API will be ported in follow-up patches to
        make the change smaller and more easily reviewable.

        * wtf/Forward.h:
        * wtf/Vector.h:
        (WTF::VectorTypeOperations::compare):
        (WTF::VectorBufferBase::allocateBuffer):
        (WTF::VectorBufferBase::tryAllocateBuffer):
        (WTF::VectorBufferBase::shouldReallocateBuffer):
        (WTF::VectorBufferBase::reallocateBuffer):
        (WTF::VectorBufferBase::capacity):
        (WTF::VectorBufferBase::VectorBufferBase):
        (WTF::VectorBuffer::VectorBuffer):
        (WTF::VectorBuffer::allocateBuffer):
        (WTF::VectorBuffer::tryAllocateBuffer):
        (WTF::VectorBuffer::shouldReallocateBuffer):
        (WTF::VectorBuffer::reallocateBuffer):
        (WTF::VectorBuffer::swap):
        (WTF::VectorBuffer::swapInlineBuffer):
        (WTF::VectorBuffer::swapInlineBuffers):
        (WTF::Vector::Vector):
        (WTF::Vector::at):
        (WTF::Vector::operator[]):
        (WTF::OverflowHandler>::find):
        (WTF::OverflowHandler>::reverseFind):
        (WTF::OverflowHandler>::fill):
        (WTF::OverflowHandler>::expandCapacity):
        (WTF::OverflowHandler>::tryExpandCapacity):
        (WTF::OverflowHandler>::resize):
        (WTF::OverflowHandler>::resizeToFit):
        (WTF::OverflowHandler>::shrink):
        (WTF::OverflowHandler>::grow):
        (WTF::OverflowHandler>::reserveCapacity):
        (WTF::OverflowHandler>::tryReserveCapacity):
        (WTF::OverflowHandler>::reserveInitialCapacity):
        (WTF::OverflowHandler>::shrinkCapacity):
        (WTF::OverflowHandler>::append):
        (WTF::OverflowHandler>::tryAppend):
        (WTF::OverflowHandler>::insert):
        (WTF::OverflowHandler>::insertVector):
        (WTF::OverflowHandler>::remove):
        (WTF::OverflowHandler>::reverse):
        (WTF::OverflowHandler>::checkConsistency):
        * wtf/text/AtomicString.h:
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::adopt):
        (WTF::equalIgnoringNullity):
        * wtf/text/StringView.h:
        (WTF::append):
        * wtf/text/WTFString.h:

2014-11-18  peavo@outlook.com  <peavo@outlook.com>

        [WinCairo] Compile errors when GStreamer is enabled.
        https://bugs.webkit.org/show_bug.cgi?id=137000

        Reviewed by Philippe Normand.

        MSVC does not allow the keyword default on move constructors and move assignment operators.

        * wtf/gobject/GMainLoopSource.cpp:
        (WTF::GMainLoopSource::cancel):
        (WTF::GMainLoopSource::socketCallback):
        * wtf/gobject/GMainLoopSource.h:
        (WTF::GMainLoopSource::Context::operator=):

2014-11-17  Anders Carlsson  <andersca@apple.com>

        Fix WTF build with newer versions of clang.
        <rdar://problem/18978705>

        * wtf/HashTable.h:
        (WTF::removeIterator):
        * wtf/dtoa/utils.h:
        (WTF::double_conversion::BitCast):

2014-11-13  Myles C. Maxfield  <mmaxfield@apple.com>

        Allow constructing a base PassRef with a derived Ref
        https://bugs.webkit.org/show_bug.cgi?id=138701

        Reviewed by Andreas Kling

        * wtf/PassRef.h:
        (WTF::PassRef<T>::PassRef):

2014-11-12  Ryuan Choi  <ryuan.choi@navercorp.com>

        [EFL] Fix the build with EFL 1.12
        https://bugs.webkit.org/show_bug.cgi?id=138245

        Reviewed by Gyuyoung Kim.

        * wtf/efl/UniquePtrEfl.h:
        Removed Evas_GL.h from UniquePtrEfl.h, which is commonly included, because
        it should not be included with official GL headers.

2014-11-12  Mark Lam  <mark.lam@apple.com>

        Rename USE(MASM_PROBE) to ENABLE(MASM_PROBE).
        <https://webkit.org/b/138661>

        Reviewed by Michael Saboff.

        Also move the switch for enabling the use of MASM_PROBE from JavaScriptCore's
        config.h to WTF's Platform.h.  This ensures that the setting is consistently
        applied even when building WebCore parts as well.

        * wtf/Platform.h:

2014-11-09  Antti Koivisto  <antti@apple.com>

        Remove BloomFilter size limit
        https://bugs.webkit.org/show_bug.cgi?id=138549

        Reviewed by Andreas Kling.

        * wtf/BloomFilter.h: Remove the static_assert, the code works fine with somewhat larger sizes.

2014-11-09  Chris Dumez  <cdumez@apple.com>

        Add a more correct way to compare floating point numbers and use it
        https://bugs.webkit.org/show_bug.cgi?id=138527

        Reviewed by Darin Adler.

        To compare floating point numbers in the code base, we would often rely
        on the following check:
        std::abs(a - b) <= std::numeric_limits<T>::epsilon()

        However, this is not correct for arbitrary floating point values, and
        will fail for values that are not close to zero.

        This patch introduces a WTF::areEssentiallyEqual() templated function
        that can only be called with floating point types and relies on the
        following formula from [1][2] that defines u as being "essentially
        equal" to v if: | u - v | / |u| <= e and | u - v | / |v| <= e

        [1] Knuth, D. E. "Accuracy of Floating Point Arithmetic." The Art of
            Computer Programming. 3rd ed. Vol. 2. Boston: Addison-Wesley, 1998.
            229-45.
        [2] http://www.boost.org/doc/libs/1_34_0/libs/test/doc/components/test_tools/floating_point_comparison.html

        * wtf/MathExtras.h:
        (WTF::safeFPDivision):
        (WTF::areEssentiallyEqual):
        (WTF::withinEpsilon): Deleted.

2014-11-08  Darin Adler  <darin@apple.com>

        Replace FileThread class with a single function
        https://bugs.webkit.org/show_bug.cgi?id=138282

        Reviewed by Alexey Proskuryakov.

        * wtf/MessageQueue.h: Made queue work on any type and not require wrapping
        everything in a unique_ptr.

        * wtf/Threading.cpp:
        (WTF::threadEntryPoint): Changed to use a std::function instead of a function pointer.
        (WTF::createThread): Add a version that takes a std::function. Reimplemented the
        old version using lambdas. Removed the obsolete versions that were there just to support
        binary compatibility with very old versions of Safari.

        * wtf/Threading.h: Removed an incorrect license header that covers code that was long ago
        moved to a different file. Changed createThread to take a std::function instead of a function
        pointer and data pointer. Moved internal functions after public functions.

2014-11-05  Chris Dumez  <cdumez@apple.com>

        Assertion hit DOMTimer::updateTimerIntervalIfNecessary()
        https://bugs.webkit.org/show_bug.cgi?id=138440

        Reviewed by Geoffrey Garen.

        Move the withinEpsilon() function to WTF to avoid code duplication.

        * wtf/MathExtras.h:
        (WTF::withinEpsilon):

2014-11-05  Chris Dumez  <cdumez@apple.com>

        Allow constructing a PassRef from a Ref
        https://bugs.webkit.org/show_bug.cgi?id=138389

        Reviewed by Andreas Kling.

        Allow constructing a PassRef from a Ref, similarly to PassRefPtr that
        can be constructed from a RefPtr already. This avoids having to call
        Ref::get() and simplifies the code a bit.

        * wtf/PassRef.h:
        (WTF::PassRef<T>::PassRef):

2014-11-05  Dan Bernstein  <mitz@apple.com>

        Remove the unused deletion UI feature
        https://bugs.webkit.org/show_bug.cgi?id=138442

        Rubber-stamped by Alexey Proskuryakov.

        * wtf/FeatureDefines.h: Removed definition of ENABLE_DELETION_UI.

2014-11-03  Dean Jackson  <dino@apple.com>

        Add ENABLE_FILTERS_LEVEL_2 feature guard.
        https://bugs.webkit.org/show_bug.cgi?id=138362

        Reviewed by Tim Horton.

        Add a new feature define for Level 2 of CSS Filters.
        http://dev.w3.org/fxtf/filters-2/

        * wtf/FeatureDefines.h:

2014-11-05  Csaba Osztrogonác  <ossy@webkit.org>

        Enable ARMv7 disassembler for all platforms
        https://bugs.webkit.org/show_bug.cgi?id=138415

        Reviewed by Darin Adler.

        * wtf/Platform.h:

2014-11-04  Chris Dumez  <cdumez@apple.com>

        Add ptr() method to Ref class
        https://bugs.webkit.org/show_bug.cgi?id=138361

        Reviewed by Darin Adler.

        It is a very common pattern in our code base to get a pointer from a
        Ref object. Previously, we have to call Ref.get() and take its address
        which is not very nice. This patch adds a ptr() method to Ref class
        to simplify the code a bit.

        * wtf/PassRef.h:
        (WTF::PassRef<T>::ptr):
        * wtf/Ref.h:
        (WTF::Ref::ptr):
        (WTF::GetPtrHelper<Ref<T>>::getPtr):

2014-11-04  Dániel Bátyai  <dbatyai.u-szeged@partner.samsung.com>

        ATTR_USED incorrectly applying to Clang
        https://bugs.webkit.org/show_bug.cgi?id=138313

        Reviewed by Csaba Osztrogonác.

        ATTR_USED was only intended for GCC. Also limit it to ENABLE(FTL_NATIVE_CALL_INLINING)
        since that's the only thing it's needed for.

        * wtf/Platform.h:

2014-11-03  Chris Dumez  <cdumez@apple.com>

        Allow implicit conversion from Ref<T> to T&
        https://bugs.webkit.org/show_bug.cgi?id=138331

        Reviewed by Andreas Kling.

        Allow implicit conversion from Ref<T> to T& to reduce the amount of
        Ref<>::get() calls in the code and increase readability. Unlike for
        RefPtr, doing this for Ref should not be error prone.

        * wtf/Ref.h:
        (WTF::Ref::operator T&):
        (WTF::Ref::operator const T&):
        * wtf/RunLoop.cpp:
        (WTF::RunLoop::Holder::runLoop):

2014-10-31  Jeffrey Pfau  <jpfau@apple.com>

        Unreviewed, fix ASan build after r175382

        * wtf/SizeLimits.cpp:

2014-10-31  Geoffrey Garen  <ggaren@apple.com>

        Rolled in r175389.

        WebKit was failing to build 32bit on some Apple internal systems because
        those systems were configured to build bmalloc 64-bit-only. Those systems
        have been updated to build bmalloc as a universal binary, so everything
        should work fine now.

        The relevant setting is controlled by an environment variable on the
        build system, and not by the project file in the source tree, so there's
        no new code change here.

                Enable bmalloc in 32bit builds
                https://bugs.webkit.org/show_bug.cgi?id=138232

                Reviewed by Andreas Kling.

        * wtf/FastMalloc.cpp:

2014-10-31  Lucas Forschler  <lforschler@apple.com>

        Unreviewed rollout r175389.
        
2014-10-30  Dana Burkart  <dburkart@apple.com>

        <rdar://problem/18821260> Prepare for the mysterious future

        Reviewed by Lucas Forschler.

        * Configurations/Base.xcconfig:
        * Configurations/DebugRelease.xcconfig:

2014-10-30  Geoffrey Garen  <ggaren@apple.com>

        Enable bmalloc in 32bit builds
        https://bugs.webkit.org/show_bug.cgi?id=138232

        Reviewed by Andreas Kling.

        Seems to work fine.

        * wtf/FastMalloc.cpp:

2014-10-30  Jeffrey Pfau  <jpfau@apple.com>

        ASSERT(!m_deletionHasBegun) in RefCounted.h should be ASSERT_WITH_SECURITY_IMPLICATION
        https://bugs.webkit.org/show_bug.cgi?id=138141

        Reviewed by Alexey Proskuryakov.

        * wtf/RefCounted.h:
        (WTF::RefCountedBase::ref):
        (WTF::RefCountedBase::relaxAdoptionRequirement):
        (WTF::RefCountedBase::derefBase):
        (WTF::adopted):

2014-10-28  Milan Crha  <mcrha@redhat.com>

        Use constants from wtf/MathExtras.h
        https://bugs.webkit.org/show_bug.cgi?id=137967

        Reviewed by Darin Adler.

        * wtf/MathExtras.h:

2014-10-28  Tibor Meszaros  <tmeszaros.u-szeged@partner.samsung.com>

        [EFL] Remove unnecessary defines from OptionsEfl.cmake
        https://bugs.webkit.org/show_bug.cgi?id=138132

        Reviewed by Csaba Osztrogonác.

        * wtf/Platform.h:

2014-10-27  Chris Dumez  <cdumez@apple.com>

        Use separate HashMaps for common and uncommon headers in HTTPHeaderMap
        https://bugs.webkit.org/show_bug.cgi?id=138079

        Reviewed by Anders Carlsson.

        Add HashTraits for C++11 strong enum types. Using integer HashTraits for
        strong enums would be inconvenient as it would require casting between
        integer and strong enum types.

        * wtf/HashTraits.h:
        (WTF::StrongEnumHashTraits::emptyValue):
        (WTF::StrongEnumHashTraits::constructDeletedValue):
        (WTF::StrongEnumHashTraits::isDeletedValue):

2014-10-25  Brian J. Burg  <burg@cs.washington.edu>

        Web Inspector: timelines should not count time elapsed while paused in the debugger
        https://bugs.webkit.org/show_bug.cgi?id=136351

        Unreviewed, follow-up fix after r175203. The debugger agent should not assume
        that the inspector environment's stopwatch has already been started.

        * wtf/Stopwatch.h:
        (WTF::Stopwatch::isActive): Added. Allow peeking at the stopwatch state.

2014-10-18  Brian J. Burg  <burg@cs.washington.edu>

        Web Inspector: timelines should not count time elapsed while paused in the debugger
        https://bugs.webkit.org/show_bug.cgi?id=136351

        Reviewed by Timothy Hatcher.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Stopwatch.h: Added. This implements a refcounted monotonic stopwatch.
        (WTF::Stopwatch::create):
        (WTF::Stopwatch::Stopwatch):
        (WTF::Stopwatch::reset):
        (WTF::Stopwatch::start):
        (WTF::Stopwatch::stop):
        (WTF::Stopwatch::elapsedTime):

2014-10-23  Joseph Pecoraro  <pecoraro@apple.com>

        Web Inspector: Provide a way to have alternate inspector agents
        https://bugs.webkit.org/show_bug.cgi?id=137901

        Reviewed by Brian Burg.

        * wtf/FeatureDefines.h:

2014-10-23  Alberto Garcia  <berto@igalia.com>

        [GTK] Fix build on Hurd
        https://bugs.webkit.org/show_bug.cgi?id=138003

        Reviewed by Carlos Garcia Campos.

        * wtf/InlineASM.h:
        * wtf/Platform.h:

2014-10-22  Byungseon Shin  <sun.shin@lge.com>

        String(new Date(Mar 30 2014 01:00:00)) is wrong in CET
        https://bugs.webkit.org/show_bug.cgi?id=130967

        Reviewed by Mark Lam.

        By definition of calculateLocalTimeOffset, input time should be UTC time.
        But there are many cases when input time is based on local time.
        So, it gives erroneous results while calculating offset of DST boundary time.
        By adding a argument to distinguish UTC and local time, we can get the correct offset.

        * wtf/DateMath.cpp:
        (WTF::calculateLocalTimeOffset):
        (WTF::parseDateFromNullTerminatedCharacters):
        Compensate time offset depends on UTC time or local time.
        * wtf/DateMath.h:
        Add argument to differenciate UTC or local time.

2014-10-21  Dániel Bátyai  <dbatyai.u-szeged@partner.samsung.com>

        Fix FTL Native Inlining for EFL
        https://bugs.webkit.org/show_bug.cgi?id=137774

        Reviewed by Michael Saboff.

        Updated guard definition for Native Inlining, and added an attribute define for marking functions
        that should not be left out of the symbol table.

        * wtf/Platform.h:

2014-10-20  Chris Dumez  <cdumez@apple.com>

        Use is<>() / downcast<>() for Accessibility objects
        https://bugs.webkit.org/show_bug.cgi?id=137286

        Reviewed by Darin Adler.

        Remove the legacy TYPE_CASTS_BASE() macro now that it is no longer
        used.

        * wtf/Assertions.h:

2014-10-18  Dan Bernstein  <mitz@apple.com>

        WorkQueue dispatches functions but isn’t a FunctionDispatcher
        https://bugs.webkit.org/show_bug.cgi?id=137853

        Reviewed by Anders Carlsson.

        * wtf/FunctionDispatcher.h: Added header guards.

2014-10-17  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GLIB] Add API to GMainLoopSource to schedule sources after a delay in microseconds
        https://bugs.webkit.org/show_bug.cgi?id=137782

        Reviewed by Sergio Villar Senin.

        In some cases when we have a double with the time in seconds, the
        conversion to milliseconds ends up truncating the value to 0, and
        the source scheduled immediately.

        * wtf/gobject/GMainLoopSource.cpp:
        (WTF::createMicrosecondsTimeoutSource): Use a custom timeout
        source that handles the interval in microseconds instead of milliseconds.
        (WTF::GMainLoopSource::scheduleAfterDelay): Use MicrosecondsTimeoutSource.
        (WTF::GMainLoopSource::scheduleAfterDelayAndDeleteOnDestroy): Ditto.
        * wtf/gobject/GMainLoopSource.h:

2014-10-17  Dan Bernstein  <mitz@apple.com>

        Reverted incorrect build fix attempt.

        * wtf/Threading.cpp:

2014-10-17  Dan Bernstein  <mitz@apple.com>

        Tried to fix the Yosemite build.

        * wtf/Threading.cpp:

2014-10-16  Dan Bernstein  <mitz@apple.com>

        OSObjectPtr is missing leakRef()
        https://bugs.webkit.org/show_bug.cgi?id=137798

        Reviewed by Sam Weinig.

        * wtf/OSObjectPtr.h:

2014-10-14  Brent Fulgham  <bfulgham@apple.com>

        [Win] Unreviewed gardening. Ignore Visual Studio *.sdf files.

        * WTF.vcxproj: Modified property svn:ignore.

2014-10-13  Antti Koivisto  <antti@apple.com>

        Add StringCapture helper for thread-safe lambda capture
        https://bugs.webkit.org/show_bug.cgi?id=137664

        Reviewed by Anders Carlsson.

        There is currently no clean way to capture a String in a thread-safe manner. This will now work:

        StringCapture stringCapture(string);
        auto lambdaThatRunsInAnotherThread = [stringCapture] { String string = stringCapture.string(); ... }

        This type won't be necessary with C++14 initialized lambda capture: [string = string.isolatedCopy()].

        * wtf/text/WTFString.h:
        (WTF::StringCapture::StringCapture): Create isolated copy in copy-constructor.
        (WTF::StringCapture::string):

2014-10-11  KwangHyuk Kim  <hyuki.kim@samsung.com>

        [EFL] Enable WebP support.
        https://bugs.webkit.org/show_bug.cgi?id=136156

        Reviewed by Gyuyoung Kim.

        Enable WTF_USE_WEBP macro for WK2 Efl.

        * wtf/Platform.h:

2014-10-11  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GLIB] Split GMainLoopSource moving thread safe implementation to its own class GThreadSafeMainLoopSource
        https://bugs.webkit.org/show_bug.cgi?id=137485

        Reviewed by Sergio Villar Senin.

        We made GMainLoopSource thread safe, but in most of the cases we
        know the sources are used by a single thread, which has an impact
        in the performance (mutex, GCancellable, etc.). The new class
        GThreadSafeMainLoopSource inherits from GMainLoopSource overriding
        the new virtual methods and calling the parent for the common code.
        GMutexLocker now supports recursive mutexes, it's a template that
        can wrap a GMutex or a GRecMutex. GThreadSafeMainLoopSource uses a
        recursive mutex using the new GMutexLocker API.

        * wtf/PlatformEfl.cmake: Add new file to compilation.
        * wtf/PlatformGTK.cmake: Ditto.
        * wtf/gobject/GMainLoopSource.cpp:
        (WTF::GMainLoopSource::GMainLoopSource):
        (WTF::GMainLoopSource::~GMainLoopSource):
        (WTF::GMainLoopSource::cancel):
        (WTF::GMainLoopSource::schedule):
        (WTF::GMainLoopSource::scheduleAfterDelay):
        (WTF::GMainLoopSource::prepareVoidCallback):
        (WTF::GMainLoopSource::finishVoidCallback):
        (WTF::GMainLoopSource::voidCallback):
        (WTF::GMainLoopSource::prepareBoolCallback):
        (WTF::GMainLoopSource::finishBoolCallback):
        (WTF::GMainLoopSource::boolCallback):
        (WTF::GMainLoopSource::socketCallback):
        (WTF::GMainLoopSource::cancelWithoutLocking): Deleted.
        * wtf/gobject/GMainLoopSource.h:
        * wtf/gobject/GMutexLocker.h:
        (WTF::MutexWrapper<GMutex>::lock):
        (WTF::MutexWrapper<GMutex>::unlock):
        (WTF::MutexWrapper<GRecMutex>::lock):
        (WTF::MutexWrapper<GRecMutex>::unlock):
        (WTF::GMutexLocker::GMutexLocker):
        (WTF::GMutexLocker::lock):
        (WTF::GMutexLocker::unlock):
        * wtf/gobject/GThreadSafeMainLoopSource.cpp: Added.
        (WTF::GThreadSafeMainLoopSource::GThreadSafeMainLoopSource):
        (WTF::GThreadSafeMainLoopSource::~GThreadSafeMainLoopSource):
        (WTF::GThreadSafeMainLoopSource::cancel):
        (WTF::GThreadSafeMainLoopSource::schedule):
        (WTF::GThreadSafeMainLoopSource::scheduleAfterDelay):
        (WTF::GThreadSafeMainLoopSource::prepareVoidCallback):
        (WTF::GThreadSafeMainLoopSource::finishVoidCallback):
        (WTF::GThreadSafeMainLoopSource::voidCallback):
        (WTF::GThreadSafeMainLoopSource::prepareBoolCallback):
        (WTF::GThreadSafeMainLoopSource::finishBoolCallback):
        (WTF::GThreadSafeMainLoopSource::boolCallback):
        * wtf/gobject/GThreadSafeMainLoopSource.h: Added.

2014-10-09  Dean Jackson  <dino@apple.com>

        Remove ENABLE_CSS3_CONDITIONAL_RULES
        https://bugs.webkit.org/show_bug.cgi?id=137571

        Reviewed by Simon Fraser.

        * wtf/FeatureDefines.h:

2014-10-09  Akos Kiss  <akiss@inf.u-szeged.hu>

        Enable ARM64 disassembler for all platforms
        https://bugs.webkit.org/show_bug.cgi?id=137560

        Reviewed by Michael Saboff.

        Remove PLATFORM conditions from around WTF_USE_ARM64_DISASSEMBLER since
        the ARM64 disassembler has no platform dependencies anymore.

        * wtf/Platform.h:

2014-10-08  peavo@outlook.com  <peavo@outlook.com>

        [WinCairo] Enable JIT on 32-bit.
        https://bugs.webkit.org/show_bug.cgi?id=137521

        Reviewed by Mark Lam.

        Enable JIT on Windows 32-bit, but disable it at runtime if SSE2 is not present.

        * wtf/Platform.h:

2014-10-08  Brent Fulgham  <bfulgham@apple.com>

        [Win] Resolve warnings about missing __has_include macro under MSVC
        https://bugs.webkit.org/show_bug.cgi?id=137524

        Reviewed by Anders Carlsson.

        * wtf/Compiler.h: Provide a dummy implementation of __has_include that
        avoids the warning without changing compile behavior.

2014-10-07  Brent Fulgham  <bfulgham@apple.com>

        [Win] Resolve some MSVC static analyzer warnings
        https://bugs.webkit.org/show_bug.cgi?id=137504

        Reviewed by Dean Jackson.

        * wtf/GregorianDateTime.cpp:
        (WTF::GregorianDateTime::setToCurrentLocalTime): Properly handle
        possible timezone error case.
        * wtf/OSAllocatorWin.cpp:
        (WTF::OSAllocator::decommit): Silence a spurious warning about using
        MEM_DECOMMIT instead of MEM_RELEASE.
        * wtf/ThreadingWin.cpp: Silence a spurious warning about how the
        tryLock method is implemented.

2014-10-07  Christophe Dumez  <cdumez@apple.com>

        [WK2] Use is<>() / downcast<>() for DrawingAreaProxy subclasses
        https://bugs.webkit.org/show_bug.cgi?id=137477

        Reviewed by Andreas Kling.

        Rename wtf/cf/TypeCasts.h to wtf/cf/TypeCastsCF.h to avoid conflict
        with wtf/TypeCasts.h. They were using the same #ifndef guard and it
        was causing problems when both were included in the same context.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/cf/TypeCastsCF.h: Renamed from Source/WTF/wtf/cf/TypeCasts.h.
        (WTF::dynamic_cf_cast):
        (WTF::checked_cf_cast):

2014-10-07  Anders Carlsson  <andersca@apple.com>

        Try to fix the Mountain Lion build.

        * wtf/text/StringView.h:
        (WTF::StringView::underlyingStringIsValid):
        (WTF::StringView::setUnderlyingString):
        (WTF::StringView::invalidate):

2014-10-07  Anders Carlsson  <andersca@apple.com>

        Use "1", not "true".

        * wtf/text/StringView.h:

2014-10-07  Anders Carlsson  <andersca@apple.com>

        Temporarily disable the StringView lifetime checking.

        * wtf/text/StringView.h:

2014-10-07  Anders Carlsson  <andersca@apple.com>

        Another build fix attempt.

        * wtf/text/StringView.cpp:
        (WTF::StringView::UnderlyingString::UnderlyingString):

2014-10-07  Anders Carlsson  <andersca@apple.com>

        Try to fix the Windows build.

        * wtf/text/StringView.cpp:
        (WTF::StringView::UnderlyingString::UnderlyingString):

2014-10-06  Darin Adler  <darin@apple.com>

        Make StringView check the lifetime of the StringImpl it's created from
        https://bugs.webkit.org/show_bug.cgi?id=137202

        Reviewed by Anders Carlsson.

        * WTF.vcxproj/WTF.vcxproj: Added StringView.cpp.
        * WTF.vcxproj/WTF.vcxproj.filters: Added StringView.cpp.
        * WTF.xcodeproj/project.pbxproj: Added StringView.cpp.
        * wtf/CMakeLists.txt: Added StringView.cpp.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::~StringImpl): Call StringView::invalidate.

        * wtf/text/StringView.cpp: Added.
        (WTF::underlyingStrings): Returns map from StringImpl to the underlying
        string object used by StringView to track validity.
        (WTF::StringView::invalidate): Mark the underlying string object invalid,
        and remove it from the map, so any future StringImpl will get a new one,
        even if it has the same pointer.
        (WTF::StringView::underlyingStringIsValid): Return true only if the
        underlying string is still valid.
        (WTF::StringView::setUnderlyingString): Create and manage reference counts
        of underlying string objects as needed.

        * wtf/text/StringView.h: Moved function bodies out of the class definition,
        so we can now read a clean class definition to see the class design and what
        functions it offers.
        (WTF::StringView::StringView): Added a comment to the default constructor.
        Also added copy and move constructors so they can call setUnderlyingString
        and assert the underlying string is valid as needed, replacing the
        compiler-generated ones.
        (WTF::StringView::~StringView): Added a call to setUnderlyingString.
        (WTF::StringView::operator=): Added these assignment operators with the same
        job as the constructors above.
        (WTF::StringView::initialize): Added a comment.
        (WTF::StringView::characters8): Added an assertion that the underlying
        string is valid.
        (WTF::StringView::characters16): Ditto.
        (WTF::StringView::substring): Added code to propagate the underlying string
        from the original string to the substring.
        (WTF::StringView::invalidate): Inline empty version of this function for
        non-debug builds.
        (WTF::StringView::underlyingStringIsValid): Ditto.
        (WTF::StringView::setUnderlyingString): Ditto.

2014-10-06  Brent Fulgham  <bfulgham@apple.com>

        [Win] DateMath's calculateUTFOffset does not account for DST.
        https://bugs.webkit.org/show_bug.cgi?id=137458
        <rdar://problem/18559172>

        Reviewed by Geoffrey Garen.

        Check the return value of GetTimeZoneInformation and use the
        proper bias against UTC (depending on whether we are in daylight
        savings time, or standard time).

        Also, handle possible error cases in the FileTimeToSystemTime
        and SystemTimeToTzSpecificLocalTime, rather than using potentially
        uninitialized values.

        * wtf/DateMath.cpp:
        (WTF::calculateUTCOffset): Use proper daylight-savings-time state.
        (WTF::calculateDSTOffset): Avoid uninitialized data due to failing
        API calls.

2014-10-06  Christophe Dumez  <cdumez@apple.com>

        Add is<>() / downcast<>() support for RenderObject subclasses
        https://bugs.webkit.org/show_bug.cgi?id=137424

        Reviewed by Benjamin Poulain.

        Handle correctly calling TypeCastTraits<ExpectedType, ArgType>::isOfType(ArgType&)
        with ExpectedType being a base class of ArgType (or the same as ArgType). The
        previous template specialization was only meant to support the case where
        ExpectedType is the same as ArgType but even that wasn't working as the compiler
        would complain about ambiguous partial specializations. Since this is needed by
        RenderTraversal functions, this patch adds an extra isBaseType template parameter
        to TypeCastTraits to resolve the ambiguity and relies on std::is_base_of for the
        detection.

        * wtf/TypeCasts.h:

2014-10-06  Brent Fulgham  <bfulgham@apple.com>

        [Win] Project file gardening.

        * WTF.vcxproj/WTF.vcxproj.filters: Move HashMethod.h and
        FastBitVector.cpp to proper places in hierarchy.

2014-10-04  Brian J. Burg  <burg@cs.washington.edu>

        Unreviewed, rolling out r174319.

        Causes assertions in fast/profiler tests. Needs nontrivial
        investigation, will take offline.

        Reverted changeset:

        "Web Inspector: timelines should not count time elapsed while
        paused in the debugger"
        https://bugs.webkit.org/show_bug.cgi?id=136351
        http://trac.webkit.org/changeset/174319

2014-10-04  Brian J. Burg  <burg@cs.washington.edu>

        Web Inspector: timelines should not count time elapsed while paused in the debugger
        https://bugs.webkit.org/show_bug.cgi?id=136351

        Reviewed by Timothy Hatcher.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Stopwatch.h: Added. This implements a refcounted monotonic stopwatch.
        (WTF::Stopwatch::reset):
        (WTF::Stopwatch::start):
        (WTF::Stopwatch::stop):

2014-10-04  Filip Pizlo  <fpizlo@apple.com>

        FTL should sink PutLocals
        https://bugs.webkit.org/show_bug.cgi?id=137168

        Reviewed by Oliver Hunt.
        
        Make the set bits of a BitVector iterable.

        * wtf/BitVector.h:
        (WTF::BitVector::SetBitsIterable::SetBitsIterable):
        (WTF::BitVector::SetBitsIterable::iterator::iterator):
        (WTF::BitVector::SetBitsIterable::iterator::operator*):
        (WTF::BitVector::SetBitsIterable::iterator::operator++):
        (WTF::BitVector::SetBitsIterable::iterator::operator==):
        (WTF::BitVector::SetBitsIterable::iterator::operator!=):
        (WTF::BitVector::SetBitsIterable::begin):
        (WTF::BitVector::SetBitsIterable::end):
        (WTF::BitVector::setBits):

2014-10-03  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r174275.
        https://bugs.webkit.org/show_bug.cgi?id=137408

        Build failures on the internal bots. (Requested by dethbakin
        on #webkit).

        Reverted changeset:

        "FTL should sink PutLocals"
        https://bugs.webkit.org/show_bug.cgi?id=137168
        http://trac.webkit.org/changeset/174275

2014-10-03  Christophe Dumez  <cdumez@apple.com>

        Add TypeCasts.h to xcodeproject
        https://bugs.webkit.org/show_bug.cgi?id=137403

        Reviewed by Benjamin Poulain.

        Add TypeCasts.h to xcodeproject.

        * WTF.xcodeproj/project.pbxproj:

2014-09-28  Filip Pizlo  <fpizlo@apple.com>

        FTL should sink PutLocals
        https://bugs.webkit.org/show_bug.cgi?id=137168

        Reviewed by Oliver Hunt.
        
        Make the set bits of a BitVector iterable.

        * wtf/BitVector.h:
        (WTF::BitVector::SetBitsIterable::SetBitsIterable):
        (WTF::BitVector::SetBitsIterable::iterator::iterator):
        (WTF::BitVector::SetBitsIterable::iterator::operator*):
        (WTF::BitVector::SetBitsIterable::iterator::operator++):
        (WTF::BitVector::SetBitsIterable::iterator::operator==):
        (WTF::BitVector::SetBitsIterable::iterator::operator!=):
        (WTF::BitVector::SetBitsIterable::begin):
        (WTF::BitVector::SetBitsIterable::end):
        (WTF::BitVector::setBits):

2014-10-03  Myles C. Maxfield  <mmaxfield@apple.com>

        Support modern for loops over StringViews
        https://bugs.webkit.org/show_bug.cgi?id=137165

        Reviewed by Darin Adler.

        This patch adds two functions, codePoints() and codeUnits(), on StringView.
        These two functions return small objects which have begin() and end() functions,
        which means it can be used by the modern for loop style. This small class also
        has an inner iterator class which can be incremented, dereferenced, and
        compared.

        Using these new objects looks like this:
        for (UChar codeunit : stringView.codeUnits()) { } and
        for (UChar32 codepoint : stringView.codePoints()) { }.

        * wtf/text/StringView.h:
        (WTF::StringView::codepoints):
        (WTF::StringView::codeunits):
        (WTF::StringViewCodePointIterator::StringViewCodePointIterator):
        (WTF::StringViewCodePointIterator::Iterator::Iterator):
        (WTF::StringViewCodePointIterator::Iterator::operator*):
        (WTF::StringViewCodePointIterator::Iterator::operator!=):
        (WTF::StringViewCodeUnitIterator::StringViewCodeUnitIterator):
        (WTF::StringViewCodeUnitIterator::Iterator::Iterator):
        (WTF::StringViewCodeUnitIterator::Iterator::operator*):
        (WTF::StringViewCodeUnitIterator::Iterator::operator!=):

2014-09-28  Sam Weinig  <sam@webkit.org>

        Remove RefPtrHashMap
        https://bugs.webkit.org/show_bug.cgi?id=137200

        Reviewed by Darin Adler.

        HashMap now has all the features of the RefPtr specialization of HashMap
        (which lived in RefPtrHashMap.h) and is in fact more efficient when moving
        items into it. For instance:

        For HashMap<RefPtr<Foo>, Bar> map:

        RefPtr<Foo> foo = ...;
        map.add(WTF::move(foo), Bar());

        will now not cause a ref() / deref(), but will successfully move the item in
        without churn. The same is true if foo.release() was used.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        Remove references to RefPtrHashMap.h.

        * wtf/RefPtrHashMap.h: Removed.

        * wtf/HashMap.h:
        Remove #include of RefPtrHashMap.h and add inlineGet to match the interface
        exposed by the RefPtrHashMap specialization.

2014-10-02  Anders Carlsson  <andersca@apple.com>

        Add back debugging/testing code that I accidentally removed.

        * wtf/text/StringConcatenate.h:
        (WTF::StringTypeAdapter<String>::writeTo):

2014-10-02  Anders Carlsson  <andersca@apple.com>

        Simplify StringTypeAdapter templates
        https://bugs.webkit.org/show_bug.cgi?id=137356

        Reviewed by Andreas Kling.

        * wtf/text/StringConcatenate.h:
        Use StringView for copying characters. Use inheritance for char* vs const char* etc. Make all StringAdapter member functions const.

        * wtf/text/StringView.h:
        Move enough functions out of line so we can include WTFString.h after the StringView class definition.

2014-10-01  Christophe Dumez  <cdumez@apple.com>

        Have is<>(T*) function do a null check on the pointer argument
        https://bugs.webkit.org/show_bug.cgi?id=137333

        Reviewed by Gavin Barraclough.

        Have is<>(T*) function do a null check on the argument instead of a
        simple assertion. This makes sense for 2 reasons:
        1. It is more consistent with downcast<>(T*), which will succeed even
           if the argument is a nullptr.
        2. It simplifies the code a bit as it gets rid of a lot of explicit
           null checks.

        * wtf/TypeCasts.h:
        (WTF::is):

2014-10-02  Daniel Bates  <dabates@apple.com>

        Clean up: Move XPC forward declarations in JavaScriptCore to WTF SPI wrapper header
        https://bugs.webkit.org/show_bug.cgi?id=137277

        Reviewed by Alexey Proskuryakov.

        Towards centralizing the declarations of XPC functions used in JavaScriptCore
        and WebKit2, add a header that wraps these function declarations called XPCSPI.h
        and use it instead of including the corresponding XPC API/SPI headers/forward
        declaring XPC functions. This will also aid in the effort to make WebKit2 build
        for iOS with the public iOS SDK.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/spi/darwin/XPCSPI.h: Added.

2014-10-01  Christophe Dumez  <cdumez@apple.com>

        Unreviewed build fix after r174193.

        Adding a return statement as that function is returning a boolean.

        * wtf/TypeCasts.h:
        (WTF::TypeCastTraits::isOfType):

2014-10-01  Christophe Dumez  <cdumez@apple.com>

        Fail better when is<>() / downcast<>() is used for an unsupported type
        https://bugs.webkit.org/show_bug.cgi?id=137323

        Reviewed by Benjamin Poulain.

        We should fail better when is<>() / downcast<>() is used for an
        unsupported type (i.e. a type that doesn't have the needed
        TypeCastTraits template specialization). Previously, we would get an
        obscure linking error, which was sub-optimal.

        With this patch, you would now hit a static_assert() at build time if
        you tried to use is<>() / downcast<>() for a type that did not have the
        needed template specialization. There is also a helpful comment above
        the assertion letting the developer know how to add the needed template
        specialization.

        * wtf/TypeCasts.h:
        (WTF::TypeCastTraits::isOfType):

2014-10-01  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r174180, r174183, and r174186.
        https://bugs.webkit.org/show_bug.cgi?id=137320

        Broke the Mac MountainLion build. Will investigate offline.
        (Requested by dydz on #webkit).

        Reverted changesets:

        "Clean up: Move XPC forward declarations in JavaScriptCore to
        WTF SPI wrapper header"
        https://bugs.webkit.org/show_bug.cgi?id=137277
        http://trac.webkit.org/changeset/174180

        "Attempt to fix the build after
        <https://trac.webkit.org/changeset/174180>"
        https://bugs.webkit.org/show_bug.cgi?id=137277
        http://trac.webkit.org/changeset/174183

        "Another attempt to fix the Mac build after
        <https://trac.webkit.org/changeset/174180>"
        https://bugs.webkit.org/show_bug.cgi?id=137277
        http://trac.webkit.org/changeset/174186

2014-10-01  Daniel Bates  <dabates@apple.com>

        Another attempt to fix the Mac build after <https://trac.webkit.org/changeset/174180>
        (https://bugs.webkit.org/show_bug.cgi?id=137277)

        Include header AvailabilityMacros.h instead of Availability.h, which actually defines the
        macro __MAC_OS_X_VERSION_MIN_REQUIRED.

        * wtf/spi/darwin/XPCSPI.h:

2014-10-01  Daniel Bates  <dabates@apple.com>

        Attempt to fix the build after <https://trac.webkit.org/changeset/174180>
        (https://bugs.webkit.org/show_bug.cgi?id=137277)

        Include header <Availability.h> for the definition of __MAC_OS_X_VERSION_MIN_REQUIRED.
        Also, we want to define CONST_ON_OR_AFTER_MAC_OS_X_VERSION_1090 to be const when building
        on iOS.

        * wtf/spi/darwin/XPCSPI.h:

2014-10-01  Daniel Bates  <dabates@apple.com>

        Clean up: Move XPC forward declarations in JavaScriptCore to WTF SPI wrapper header
        https://bugs.webkit.org/show_bug.cgi?id=137277

        Reviewed by Alexey Proskuryakov.

        Towards centralizing the declarations of XPC functions used in JavaScriptCore
        and WebKit2, add a header that wraps these function declarations called XPCSPI.h
        and use it instead of including the corresponding XPC API/SPI headers/forward
        declaring XPC functions. This will also aid in the effort to make WebKit2 build
        for iOS with the public iOS SDK.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/spi/darwin/XPCSPI.h: Added.

2014-10-01  Brent Fulgham  <bfulgham@apple.com>

        [Win] 32-bit JavaScriptCore should limit itself to the C loop
        https://bugs.webkit.org/show_bug.cgi?id=137304
        <rdar://problem/18375370>

        Reviewed by Michael Saboff.

        * wtf/Platform.h: Force the C loop when building for 32-bit Windows.

2014-09-30  Christophe Dumez  <cdumez@apple.com>

        Generalize is<>() / downcast<>() support to all types
        https://bugs.webkit.org/show_bug.cgi?id=137243

        Reviewed by Benjamin Poulain.

        Generalize is<>() / downcast<>() support to all types, not just Nodes.

        * wtf/Assertions.h:
        * wtf/TypeCasts.h: Added.
        (WTF::is):
        (WTF::downcast):

2014-09-30  Anders Carlsson  <andersca@apple.com>

        Get the STRING_STATS codepath compiling again, and add calls to ref/deref
        https://bugs.webkit.org/show_bug.cgi?id=137259

        Reviewed by Andreas Kling.

        * wtf/text/StringImpl.cpp:
        (WTF::StringStats::removeString):
        (WTF::StringStats::printStats):
        (WTF::StringImpl::~StringImpl):
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::StringImpl):
        (WTF::StringImpl::isSubString):
        (WTF::StringImpl::ref):
        (WTF::StringImpl::deref):
        (WTF::StringStats::addUpconvertedString): Deleted.

2014-09-30  Daniel Bates  <dabates@apple.com>

        REGRESSION (r172532): JSBase.h declares NSMapTable functions that are SPI
        https://bugs.webkit.org/show_bug.cgi?id=137170
        <rdar://problem/18477384>

        Reviewed by Geoffrey Garen.

        Add SPI wrapper header, NSMapTableSPI.h.

        Additionally, define convenience macro EXTERN_C that can be used to specify the C linkage
        convention for a declaration. For example, the declaration "EXTERN_C const int x;" will
        expand to:

        extern const int x;

        and

        extern "C" const int x;

        when used in a C and C++ file, respectively.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/Compiler.h:
        * wtf/spi/cocoa/NSMapTableSPI.h: Added.

2014-09-29  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r174045.
        https://bugs.webkit.org/show_bug.cgi?id=137231

        Introduced a crash during page loading tests on Mac (Requested
        by rniwa on #webkit).

        Reverted changeset:

        "Replace OSObjectPtr with RetainPtr/adoptOS"
        https://bugs.webkit.org/show_bug.cgi?id=137158
        http://trac.webkit.org/changeset/174045

2014-09-26  Sam Weinig  <sam@webkit.org>

        Replace OSObjectPtr with RetainPtr/adoptOS
        https://bugs.webkit.org/show_bug.cgi?id=137158

        Reviewed by Dan Bernstein.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/OSObjectPtr.h: Removed.
        * wtf/RetainPtr.h:
        (WTF::adoptOS):
        Added. This adopt function is slightly different than both adoptCF and adoptNS,
        in that unlike adoptCF(), it can be passed an Objective-C type (since OS objects
        are sometimes Objective-C objects, but not always), and unlike adoptNS() it doesn't 
        require us to jump through hoops to appease GC (since OS objects are not Objective-C
        objects if GC is enabled).

2014-09-24  Filip Pizlo  <fpizlo@apple.com>

        FTL should sink object allocations
        https://bugs.webkit.org/show_bug.cgi?id=136330

        Reviewed by Oliver Hunt.
        
        Make it possible to reset a Bag.

        * wtf/Bag.h:
        (WTF::Bag::Bag):
        (WTF::Bag::~Bag):
        (WTF::Bag::clear):

2014-09-25  Roger Fong  <roger_fong@apple.com>

        [Windows] Unreviewed build fix. Ensure that python2.7 is used for Windows builds.

        * WTF.vcxproj/WTFGenerated.make:

2014-09-25  Csaba Osztrogonác  <ossy@webkit.org>

        Remove WinCE port from trunk
        https://bugs.webkit.org/show_bug.cgi?id=136951

        Reviewed by Alex Christensen.

        * config.h:
        * wtf/Assertions.cpp:
        * wtf/Assertions.h:
        * wtf/Atomics.h:
        (WTF::weakCompareAndSwap):
        * wtf/CurrentTime.cpp:
        (WTF::lowResUTCTime):
        * wtf/DataLog.cpp:
        * wtf/DateMath.cpp:
        (WTF::getLocalTime):
        (WTF::calculateDSTOffset):
        * wtf/FastMalloc.cpp:
        * wtf/FeatureDefines.h:
        * wtf/OSAllocator.h:
        (WTF::OSAllocator::decommitAndRelease):
        * wtf/Platform.h:
        * wtf/PlatformWin.cmake:
        * wtf/RAMSize.cpp:
        (WTF::computeRAMSize):
        * wtf/RandomNumberSeed.h:
        (WTF::initializeRandomNumberGenerator):
        * wtf/StackBounds.cpp:
        (WTF::StackBounds::initialize):
        * wtf/StackBounds.h:
        (WTF::StackBounds::isGrowingDownward):
        * wtf/StdLibExtras.h:
        (wtf_bsearch): Deleted.
        * wtf/StringExtras.h:
        (strnicmp): Deleted.
        (stricmp): Deleted.
        (strdup): Deleted.
        * wtf/ThreadSpecific.h:
        * wtf/ThreadingWin.cpp:
        (WTF::createThreadInternal):
        * wtf/WindowsExtras.h:
        (WTF::getRegistryValue):
        (WTF::getWindowPointer):
        (WTF::setWindowPointer):
        * wtf/dtoa/utils.h:
        * wtf/text/WTFString.cpp:
        (WTF::String::format):

2014-09-24  Geoffrey Garen  <ggaren@apple.com>

        Do the bmalloc.
        https://bugs.webkit.org/show_bug.cgi?id=132629

        Reviewed by Gavin Barraclough.

        64-bit only for now, just to try it out.

        * wtf/FastMalloc.cpp:

2014-09-23  Geoffrey Garen  <ggaren@apple.com>

        Rolled out r173346.

            bmalloc should honor the FastMalloc statistics API
            https://bugs.webkit.org/show_bug.cgi?id=136592

        This didn't really work. Because we allow ranges with and without
        physical pages to merge, and we allow double-committing and
        double-decommitting, we can't rely on commit actions to track memory
        footprint.

        * wtf/FastMalloc.cpp:
        (WTF::fastMallocStatistics):

2014-09-23  Joseph Pecoraro  <pecoraro@apple.com>

        Web Inspector: Should be able to attach a debugger to a JSContext before anything is executed
        https://bugs.webkit.org/show_bug.cgi?id=136893

        Reviewed by Timothy Hatcher.

        Currently automatic inspection only happens in processes that have a
        debugger attached. That condition may change in the future, but this
        function can stand on its own in WTF. It may be useful in the future
        to perhaps continue though ASSERTs if you have a debugger attached.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h:

2014-09-22  Sam Weinig  <sam@webkit.org>

        Eliminate redundant PtrHash specializations
        https://bugs.webkit.org/show_bug.cgi?id=136990

        Reviewed by Darin Adler.

        Now that we have IsSmartPtr, we can eliminate all the specializations
        of PtrHash that we had (for RefPtr, OwnPtr, RetainPtr, and std::unique_ptr)
        and instead just have one that uses GetPtrHelper.

        No changes of behavior intended.

        * wtf/GetPtr.h:
        Remove unnecessary const_cast that Darin noticed.

        * wtf/HashFunctions.h:
        (WTF::PtrHash::hash): Deleted.
        (WTF::PtrHash::equal): Deleted.
        (WTF::PtrHash<RefPtr<P>>::hash): Deleted.
        (WTF::PtrHash<RefPtr<P>>::equal): Deleted.
        Specialize PtrHash based on whether the type is a smart pointer, and use GetPtrHelper
        to implement the smart pointer specialized variant.

        * wtf/HashMap.h:
        Remove include of GetPtr.h that is now included by HashFunctions.h

        * wtf/OwnPtr.h:
        (WTF::PtrHash<OwnPtr<P>>::hash): Deleted.
        (WTF::PtrHash<OwnPtr<P>>::equal): Deleted.
        Remove unnecessary specialization of PtrHash.

        * wtf/RetainPtr.h:
        (WTF::PtrHash<RetainPtr<P>>::hash): Deleted.
        (WTF::PtrHash<RetainPtr<P>>::equal): Deleted.
        Specialize IsSmartPointer for RetainPtr and remove the then unnecessary specialization of PtrHash.
        (This is already tested in the API test WTF/cf/RetainPtrHashing).

2014-09-20  Sam Weinig  <sam@webkit.org>

        Make possible HashSet<std::unique_ptr<>>
        https://bugs.webkit.org/show_bug.cgi?id=136166

        Reviewed by Darin Adler.

        * wtf/GetPtr.h:
        (WTF::getPtr):
        (WTF::GetPtrHelper<std::unique_ptr<T>>::getPtr):
        Make specializing GetPtrHelper a bit cleaner (you don't have to put 
        IsSmartPtr<T>::value everywhere any more) and add specializations for
        std::unique_ptr.

        * wtf/HashFunctions.h:
        (WTF::PtrHash<std::unique_ptr<P>>):
        Add specialization for PtrHash for std::unique_ptr and set it as the DefaultHash
        for it as well.

        * wtf/HashMap.h:    
        * wtf/HashSet.h:
        Add overloads of find(), contains(), remove(), take() (and get() for HashMap) for "smart pointers" that
        take the raw pointer type as the parameter. These use SFINAE to make themselves only available
        when the IsSmartPtr<KeyType>::value is true. 

        * wtf/HashTraits.h:
        Override constructDeletedValue() and isDeletedValue() in the std::unique_ptr specialization
        since the default implementation depends on the type having a constructor that takes a HashTableDeletedValue
        and function named isHashTableDeletedValue().

        * wtf/OwnPtr.h:
        (WTF::OwnPtr::OwnPtr):
        (WTF::OwnPtr::isHashTableDeletedValue):
        (WTF::OwnPtr::hashTableDeletedValue):
        Add HashTableDeletedValue constructor/functions to allow the constructDeletedValue() and isDeletedValue()
        hash traits to work.

        (WTF::PtrHash<OwnPtr<P>>::hash):
        (WTF::PtrHash<OwnPtr<P>>::equal):
        Add specialization for PtrHash for OwnPtr and set it as the DefaultHash
        for it as well.

        * wtf/Ref.h:
        Update for the less verbose GetPtrHelper specialization.

2014-09-19  Chris Dumez  <cdumez@apple.com>

        Allow DOM methods to return references instead of pointers
        https://bugs.webkit.org/show_bug.cgi?id=136931

        Add support for having WTF::getPtr() transform reference arguments
        into raw pointers so that DOM methods can now return references when
        appropriate and so that the generated bindings code can handle this
        via WTF::getPtr().

        This patch had to alter the way getPtr() was overloaded for smart
        pointer types so that we don't call &p on smart pointers but p.get().
        This was needed because the new WTF::getPtr(T&) was being called for
        RefPtr<T> arguments instead of the getPtr(const RefPtr<T>&) overload.
        This was addressed using traits and template specialization to
        distinguish WTF smart pointers from other types.

        Reviewed by Sam Weinig.

        * wtf/GetPtr.h:
        (WTF::getPtr):
        * wtf/OwnPtr.h:
        (WTF::getPtr): Deleted.
        * wtf/PassOwnPtr.h:
        (WTF::getPtr): Deleted.
        * wtf/PassRefPtr.h:
        (WTF::getPtr): Deleted.
        * wtf/Ref.h:
        * wtf/RefPtr.h:
        (WTF::getPtr): Deleted.
        * wtf/gobject/GRefPtr.h:
        (WTF::getPtr): Deleted.

2014-09-19  Daniel Bates  <dabates@apple.com>

        Always assume internal SDK when building configuration Production
        https://bugs.webkit.org/show_bug.cgi?id=136925
        <rdar://problem/18362399>

        Reviewed by Dan Bernstein.

        * Configurations/Base.xcconfig:

2014-09-19  Diego Pino Garcia  <dpino@igalia.com>

        Simple ES6 feature:String prototype additions
        https://bugs.webkit.org/show_bug.cgi?id=131704

        Reviewed by Darin Adler.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::find):
        (WTF::equalInner): Added.
        (WTF::StringImpl::startsWith): Add implementation that supports
        'startOffset' parameter.
        (WTF::StringImpl::endsWith): Add implementation that supports
        'endOffset' parameter.
        * wtf/text/StringImpl.h:
        * wtf/text/WTFString.h:
        (WTF::String::contains): Modify current implementation to allow
        setting a startOffset, 0 by default.
        (WTF::String::startsWith):
        (WTF::String::endsWith):

2014-09-18  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Dot not allow to create delete-on-destroy GMainLoopSources
        https://bugs.webkit.org/show_bug.cgi?id=136923

        Reviewed by Gustavo Noronha Silva.

        We have several asserts to ensure that delete-on-destroy sources
        are not misused, like not scheduling socket sources on a
        delete-on-destroy GMainLoopSource or not allowing to cancel them
        before they have been dispatched. It's better to ensure all those
        things at compile time, using static methods to schedule sources
        creating a delete-on-destroy GMainLoopSource that is not returned
        to the user.

        * wtf/gobject/GMainLoopSource.cpp:
        (WTF::GMainLoopSource::create): Private static method to create a
        delete-on-destroy GMainLoopSource.
        (WTF::GMainLoopSource::cancelWithoutLocking): Return early in case
        of delete-on-destroy source, since they can't be cancelled.
        (WTF::GMainLoopSource::schedule): Remove assertion to ensure
        socket sources are not scheduled on a delete-on-destroy GMainLoopSource.
        (WTF::GMainLoopSource::scheduleAndDeleteOnDestroy):
        (WTF::GMainLoopSource::scheduleAfterDelayAndDeleteOnDestroy):
        (WTF::GMainLoopSource::createAndDeleteOnDestroy): Deleted.
        * wtf/gobject/GMainLoopSource.h:
        * wtf/gtk/MainThreadGtk.cpp:
        (WTF::scheduleDispatchFunctionsOnMainThread): Use GMainLoopSource::scheduleAndDeleteOnDestroy()
        * wtf/gtk/RunLoopGtk.cpp:
        (WTF::RunLoop::wakeUp): Ditto.

2014-09-18  Joseph Pecoraro  <pecoraro@apple.com>

        Unreviewed rollout r173731. Broke multiple builds.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h:

2014-09-18  Joseph Pecoraro  <pecoraro@apple.com>

        Web Inspector: Should be able to attach a debugger to a JSContext before anything is executed
        https://bugs.webkit.org/show_bug.cgi?id=136893

        Reviewed by Timothy Hatcher.

        Currently automatic inspection only happens in processes that have a
        debugger attached. That condition may change in the future, but this
        function can stand on its own in WTF. It may be useful in the future
        to perhaps continue though ASSERTs if you have a debugger attached.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h:

2014-09-18  Zan Dobersek  <zdobersek@igalia.com>

        GMainLoopSource is exposed to race conditions
        https://bugs.webkit.org/show_bug.cgi?id=135800

        Reviewed by Carlos Garcia Campos.

        GMainLoopSource objects can be dispatching tasks on one thread
        while having a new task scheduled on a different thread. This
        can for instance occur in WebKitVideoSink, where the timeout
        callback can be called on main thread while at the same time
        it is being rescheduled on a different thread (created through
        GStreamer).

        The initial solution is to use GMutex to prevent parallel data
        access from different threads. In the future I plan to look at
        the possibility of creating thread-specific GMainLoopSource
        objects that wouldn't require the use of GMutex.

        GSource, GCancellable and std::function<> objects are now packed
        into an internal Context structure. Using the C++11 move semantics
        it's simple to, at the time of dispatch, move the current context
        out of the GMainLoopSource object in case the dispatch causes a
        rescheduling on that same object.

        Also added in the Context struct is a new GCancellable. The pointer
        of that object is shared with the GMainLoopSource before the Context
        is moved out for the callback dispatch. This makes it safe to cancel
        or even delete the GMainLoopSource during the dispatch and prevents
        use-after-delete on GMainLoopSource once the dispatch is done in
        the GMainLoopSource::*Callback() methods.

        All the schedule*() methods and the cancelWithoutLocking() method
        callers now lock the GMutex to ensure no one else is accessing the
        data at that moment. Similar goes for the dispatch methods, but those
        do the dispatch and possible destruction duties with the mutex unlocked.
        The dispatch can cause rescheduling on the same GMainLoopSource object,
        which must not be done with a locked mutex.

        * wtf/gobject/GMainLoopSource.cpp:
        (WTF::GMainLoopSource::GMainLoopSource):
        (WTF::GMainLoopSource::~GMainLoopSource):
        (WTF::GMainLoopSource::cancel):
        (WTF::GMainLoopSource::cancelWithoutLocking):
        (WTF::GMainLoopSource::scheduleIdleSource):
        (WTF::GMainLoopSource::schedule):
        (WTF::GMainLoopSource::scheduleTimeoutSource):
        (WTF::GMainLoopSource::scheduleAfterDelay):
        (WTF::GMainLoopSource::voidCallback):
        (WTF::GMainLoopSource::boolCallback):
        (WTF::GMainLoopSource::socketCallback):
        (WTF::GMainLoopSource::socketSourceCallback):
        (WTF::GMainLoopSource::Context::destroySource):
        (WTF::GMainLoopSource::reset): Deleted.
        (WTF::GMainLoopSource::destroy): Deleted.
        * wtf/gobject/GMainLoopSource.h:

2014-09-17  Daniel Bates  <dabates@apple.com>

        Unreviewed, rolling out r173695.

        Broke building third-party Legacy WebKit apps; will
        investigate offline

        Reverted changeset:

        "[iOS] Make WebCore build with public iOS SDK"
        https://bugs.webkit.org/show_bug.cgi?id=136487
        http://trac.webkit.org/changeset/173695

2014-09-17  Benjamin Poulain  <bpoulain@apple.com>

        CSS value in whitespace-separated list attribute selector (~=) mishandles tab/newline/etc.
        https://bugs.webkit.org/show_bug.cgi?id=136807

        Reviewed by Antti Koivisto.

        * wtf/text/AtomicString.h:
        (WTF::AtomicString::find):

2014-09-17  Daniel Bates  <dabates@apple.com>

        [iOS] Make WebCore build with public iOS SDK
        https://bugs.webkit.org/show_bug.cgi?id=136487

        Reviewed by David Kilzer.

        Define convenience macro EXTERN_C that can be used to specify the C linkage convention
        for a declaration. For example, the declaration "EXTERN_C const int x;" will expand to:

        extern const int x;

        and

        extern "C" const int x;

        when used in a C and C++ file, respectively.

        * wtf/Compiler.h:

2014-09-16  Filip Pizlo  <fpizlo@apple.com>

        Unreviewed, disable native inlining because it causes build failures.

        * wtf/Platform.h:

2014-09-15  Jer Noble  <jer.noble@apple.com>

        [Mac] Support audioSourceProvider() in MediaPlayerPrivateAVFoundationObjC
        https://bugs.webkit.org/show_bug.cgi?id=135042

        Reviewed by Eric Carlson.

        * wtf/Platform.h: Add WTF_USE_MEDIATOOLBOX.

2014-09-15  peavo@outlook.com  <peavo@outlook.com>

        [WinCairo] Make it easier to enable/disable GStreamer.
        https://bugs.webkit.org/show_bug.cgi?id=135766

        Reviewed by Brent Fulgham.

        Make it possible to enable/disable GStreamer by editing the new user macro ENABLE_GSTREAMER_WINCAIRO.

        * WTF.vcxproj/WTFDebugWinCairo.props: Import GStreamer property file.
        * WTF.vcxproj/WTFReleaseWinCairo.props: Ditto.
        * wtf/Platform.h: Enable GStreamer if ENABLE(GSTREAMER_WINCAIRO) is true, otherwise use Media Foundation.

2014-09-10  Jon Honeycutt  <jhoneycutt@apple.com>

        Re-add the request autocomplete feature

        <https://bugs.webkit.org/show_bug.cgi?id=136730>

        This feature was rolled out in r148731 because it was only used by
        Chromium. As we consider supporting this feature, roll it back in, but
        leave it disabled.

        This rolls out r148731 (which removed the feature) with small changes
        needed to make the code build in ToT, to make the tests run, and to
        remove unused code.

        Reviewed by Andy Estes.

        * wtf/FeatureDefines.h:

2014-09-12  Tim Horton  <timothy_horton@apple.com>

        Swiping back from a Twitter image to Twitter flashes to the wrong position
        https://bugs.webkit.org/show_bug.cgi?id=136798
        <rdar://problem/18324338>

        Reviewed by Darin Adler and Sam Weinig.

        * wtf/RunLoop.h:
        (WTF::RunLoop::TimerBase::startRepeating):
        Add a std::chrono veresion of RunLoop::TimerBase::startRepeating.

2014-09-12  Geoffrey Garen  <ggaren@apple.com>

        Rolled out r173540.

        It broke the Membuster performance bot, and it's still slightly profligate
        with memory.

            Do the bmalloc.
            https://bugs.webkit.org/show_bug.cgi?id=132629

        * wtf/FastMalloc.cpp:

2014-09-11  Geoffrey Garen  <ggaren@apple.com>

        Do the bmalloc.
        https://bugs.webkit.org/show_bug.cgi?id=132629

        Reviewed by Michael Saboff.

        64-bit only for now, just to try it out.

        * wtf/FastMalloc.cpp:

2014-09-09  Benjamin Poulain  <bpoulain@apple.com>

        Disable the "unreachable-code" warning
        https://bugs.webkit.org/show_bug.cgi?id=136677

        Reviewed by Darin Adler.

        The warning causes various build errors depending on which Clang you are using.

        For example, with recent clangs, it breaks all the ARCHS dependent code like this:
            if (sizeof(uintptr_t) == 4)
                // Something for 32 bits.
            else
                // Somethign for 64 bits.

        * Configurations/Base.xcconfig:

2014-09-07  Filip Pizlo  <fpizlo@apple.com>

        DFG should have a reusable SSA builder
        https://bugs.webkit.org/show_bug.cgi?id=136331

        Reviewed by Oliver Hunt.
        
        Update the alloc() method to use variadic templates. This makes it more natural to use.

        * wtf/SegmentedVector.h:
        (WTF::SegmentedVector::alloc):

2014-09-08  Eva Balazsfalvi  <evab.u-szeged@partner.samsung.com>

        Remove FILTERS flag
        https://bugs.webkit.org/show_bug.cgi?id=136571

        Reviewed by Darin Adler.

        * wtf/FeatureDefines.h:

2014-09-08  Dan Bernstein  <mitz@apple.com>

        HAVE(VOUCHERS) is not available outside of WebKit2
        https://bugs.webkit.org/show_bug.cgi?id=136637

        Reviewed by Tim Horton.

        * wtf/Platform.h: Moved the definition of HAVE_VOUCHERS from WebKit2’s config.h here.

2014-09-08  Tim Horton  <timothy_horton@apple.com>

        Try to fix the build after r173383, part 2.

        * wtf/OSObjectPtr.h:

2014-09-08  Tim Horton  <timothy_horton@apple.com>

        Try to fix the build after r173383.

        * wtf/OSObjectPtr.h:

2014-09-07  Sam Weinig  <sam@webkit.org>

        Make OSObjectPtr a bit more like RefPtr
        https://bugs.webkit.org/show_bug.cgi?id=136613

        Reviewed by Darin Adler.

        Address some of Darin's feedback by:
        - Making the adopting constructor private and friending adoptOSObject().
        - Implementing the assignment operator using swap.
        - Adding a move assignment operator.

        * wtf/OSObjectPtr.h:
        (WTF::OSObjectPtr::operator=):
        (WTF::OSObjectPtr::swap):
        (WTF::OSObjectPtr::OSObjectPtr):

2014-09-08  Jessie Berlin  <jberlin@apple.com>

        More build fixes after r173374.

        * wtf/dtoa/strtod.cc:

2014-09-08  Jessie Berlin  <jberlin@apple.com>

        Build fix after r173374.

        * wtf/dtoa/strtod.cc:

2014-09-08  Jessie Berlin  <jberlin@apple.com>

        Speculative build fix after r173364.

        * wtf/dtoa/strtod.cc:

2014-09-07  Maciej Stachowiak  <mjs@apple.com>

        Introduce COMPILER_QUIRK(CONSIDERS_UNREACHABLE_CODE) and use it
        https://bugs.webkit.org/show_bug.cgi?id=136616

        Reviewed by Darin Adler.

        * wtf/Compiler.h: Define the quirk for all compilers but clang.

2014-09-06  Sam Weinig  <sam@webkit.org>

        XPCPtr should be converted into an all purpose smart pointer for os_objects
        https://bugs.webkit.org/show_bug.cgi?id=136602

        Reviewed by Darin Adler.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/OSObjectPtr.h: Copied from Source/WebKit2/Platform/IPC/mac/XPCPtr.h.
        (WTF::retainOSObject):
        (WTF::releaseOSObject):
        (WTF::OSObjectPtr::OSObjectPtr):
        (WTF::OSObjectPtr::~OSObjectPtr):
        (WTF::OSObjectPtr::operator=):
        (WTF::adoptOSObject):
        (IPC::XPCPtr::XPCPtr): Deleted.
        (IPC::XPCPtr::~XPCPtr): Deleted.
        (IPC::XPCPtr::operator=): Deleted.
        (IPC::adoptXPC): Deleted.
        Rename/move XPCPtr to OSObjectPtr and make it work with any os_object.

2014-09-06  Darin Adler  <darin@apple.com>

        Make updates suggested by new version of Xcode
        https://bugs.webkit.org/show_bug.cgi?id=136603

        Reviewed by Mark Rowe.

        * Configurations/Base.xcconfig: Added CLANG_WARN_UNREACHABLE_CODE,
        COMBINE_HIDPI_IMAGES, and ENABLE_STRICT_OBJC_MSGSEND as suggested by
        Xcode upgrade check.

        * WTF.xcodeproj/project.pbxproj: Updated LastUpgradeCheck.

2014-09-05  Geoffrey Garen  <ggaren@apple.com>

        bmalloc should honor the FastMalloc statistics API
        https://bugs.webkit.org/show_bug.cgi?id=136592

        Reviewed by Gavin Barraclough.

        * wtf/FastMalloc.cpp:
        (WTF::fastMallocStatistics):

2014-09-05  Geoffrey Garen  <ggaren@apple.com>

        bmalloc should honor the FastMalloc scavenging API
        https://bugs.webkit.org/show_bug.cgi?id=136588

        Reviewed by Andreas Kling.

        * wtf/FastMalloc.cpp:
        (WTF::releaseFastMallocFreeMemory):

2014-09-05  Geoffrey Garen  <ggaren@apple.com>

        Rolled out <http://trac.webkit.org/changeset/173313>.

        It seems to have broken the PLT bot.

                Do the bmalloc.
                https://bugs.webkit.org/show_bug.cgi?id=132629

                * wtf/FastMalloc.cpp:

2014-06-06  Jer Noble  <jer.noble@apple.com>

        Refactoring: make MediaTime the primary time type for audiovisual times.
        https://bugs.webkit.org/show_bug.cgi?id=133579

        Reviewed by Eric Carlson.

        Add a unary minus operator, and add unimplemented private casting operators, to make
        unintentional double->MediaTime and MediaTime->double casts hard errors.

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::operator-):
        * wtf/MediaTime.h:

2014-09-04  Geoffrey Garen  <ggaren@apple.com>

        Do the bmalloc.
        https://bugs.webkit.org/show_bug.cgi?id=132629

        Reviewed by Michael Saboff.

        64-bit only for now, just to try it out.

        * wtf/FastMalloc.cpp:

2014-09-05  Dániel Bátyai  <dbatyai.u-szeged@partner.samsung.com>

        Enable GenGC on ARM Traditional
        https://bugs.webkit.org/show_bug.cgi?id=136567

        Reviewed by Csaba Osztrogonác.

        * wtf/Platform.h:

2014-09-04  Filip Pizlo  <fpizlo@apple.com>

        Beef up the DFG's CFG analyses to include iterated dominance frontiers and more user-friendly BlockSets
        https://bugs.webkit.org/show_bug.cgi?id=136520

        Fix bug found in Geoff's review but not landed in previous commit.

        * wtf/BitVector.cpp:
        (WTF::BitVector::equalsSlowCaseFast): return true.

2014-09-03  Filip Pizlo  <fpizlo@apple.com>

        Beef up the DFG's CFG analyses to include iterated dominance frontiers and more user-friendly BlockSets
        https://bugs.webkit.org/show_bug.cgi?id=136520

        Reviewed by Geoffrey Garen.
        
        Give BitVector a way to quickly find the next set (or unset) bit. Make BitVector equality
        faster. Fix a minor closure goof in Spectrum.

        * wtf/BitVector.cpp:
        (WTF::BitVector::equalsSlowCase):
        (WTF::BitVector::equalsSlowCaseFast):
        (WTF::BitVector::equalsSlowCaseSimple):
        * wtf/BitVector.h:
        (WTF::BitVector::findBit):
        (WTF::BitVector::findBitFast):
        (WTF::BitVector::findBitSimple):
        (WTF::BitVector::findBitInWord):
        * wtf/Spectrum.h:
        (WTF::Spectrum::removeIf):

2014-09-04  Anders Carlsson  <andersca@apple.com>

        Make hash table classes final
        https://bugs.webkit.org/show_bug.cgi?id=136540

        Reviewed by Antti Koivisto.

        We don't want anybody inheriting from these classes, so make them final.

        * wtf/HashCountedSet.h:
        * wtf/HashMap.h:
        * wtf/HashSet.h:

2014-09-04  Eva Balazsfalvi  <evab.u-szeged@partner.samsung.com>

        Remove CSS_FILTERS flag
        https://bugs.webkit.org/show_bug.cgi?id=136529

        Reviewed by Dirk Schulze.

        * wtf/FeatureDefines.h:

2014-09-04  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r173201.
        https://bugs.webkit.org/show_bug.cgi?id=136538

        Improves the situation but also introduces additional crashes.
        (Requested by zdobersek on #webkit).

        Reverted changeset:

        "GMainLoopSource is exposed to race conditions"
        https://bugs.webkit.org/show_bug.cgi?id=135800
        http://trac.webkit.org/changeset/173201

2014-09-04  Pratik Solanki  <psolanki@apple.com>

        Remove iOS specific disk image cache
        https://bugs.webkit.org/show_bug.cgi?id=136517

        Reviewed by Antti Koivisto.

        Disk image cache code unnecessarily complicates SharedBuffer implementation. We can remove
        this now since we don't enable it in WebKit2 on iOS.

        * wtf/FeatureDefines.h:

2014-09-03  Dan Bernstein  <mitz@apple.com>

        Get rid of HIGH_DPI_CANVAS leftovers
        https://bugs.webkit.org/show_bug.cgi?id=136491

        Reviewed by Benjamin Poulain.

        * wtf/FeatureDefines.h: Removed definition of ENABLE_HIGH_DPI_CANVAS.

2014-09-03  Zan Dobersek  <zdobersek@igalia.com>

        GMainLoopSource is exposed to race conditions
        https://bugs.webkit.org/show_bug.cgi?id=135800

        Reviewed by Carlos Garcia Campos.

        GMainLoopSource objects can be dispatching tasks on one thread
        while having a new task scheduled on a different thread. This
        can for instance occur in WebKitVideoSink, where the timeout
        callback can be called on main thread while at the same time
        it is being rescheduled on a different thread (created through
        GStreamer).

        The initial solution is to use GMutex to prevent parallel data
        access from different threads. In the future I plan to add better
        assertions, some meaningful comments and look at the possibility
        of creating thread-specific GMainLoopSource objects that wouldn't
        require the use of GMutex.

        GSource, GCancellable and std::function<> objects are now packed
        into an internal Context structure. Using the C++11 move semantics
        it's simple to, at the time of dispatch, move the current context
        out of the GMainLoopSource object in case the dispatch causes a
        rescheduling on that same object.

        All the schedule*() methods and the cancelInternal() method callers
        now lock the GMutex to ensure no one else is accessing the data at
        that moment. Similar goes for the dispatch methods, but those do
        the dispatch and possible destruction duties with the mutex unlocked.
        The dispatch can cause rescheduling on the same GMainLoopSource object,
        which must not be done with a locked mutex.

        * wtf/gobject/GMainLoopSource.cpp:
        (WTF::GMainLoopSource::GMainLoopSource):
        (WTF::GMainLoopSource::~GMainLoopSource):
        (WTF::GMainLoopSource::cancel):
        (WTF::GMainLoopSource::cancelInternal):
        (WTF::GMainLoopSource::scheduleIdleSource):
        (WTF::GMainLoopSource::schedule):
        (WTF::GMainLoopSource::scheduleTimeoutSource):
        (WTF::GMainLoopSource::scheduleAfterDelay):
        (WTF::GMainLoopSource::voidCallback):
        (WTF::GMainLoopSource::boolCallback):
        (WTF::GMainLoopSource::socketCallback):
        (WTF::GMainLoopSource::destroy):
        (WTF::GMainLoopSource::reset): Deleted.
        * wtf/gobject/GMainLoopSource.h:

2014-09-02  Daniel Bates  <dabates@apple.com>

        [iOS] Support using Foundation networking code
        https://bugs.webkit.org/show_bug.cgi?id=136467

        Reviewed by Pratik Solanki.

        Disable USE(CFNETWORK) and use the Foundation networking code by default when building
        iOS WebKit without the Apple Internal SDK.

        * wtf/Platform.h:

2014-08-26  Maciej Stachowiak  <mjs@apple.com>

        Use RetainPtr::autorelease in some places where it seems appropriate
        https://bugs.webkit.org/show_bug.cgi?id=136280

        Reviewed by Darin Adler.

        * wtf/text/mac/StringImplMac.mm:
        (WTF::StringImpl::operator NSString *): Use autorelease() instead of
        CFBridgingRelease(leakRef())

2014-08-29  Joseph Pecoraro  <pecoraro@apple.com>

        JavaScriptCore: Use ASCIILiteral where possible
        https://bugs.webkit.org/show_bug.cgi?id=136179

        Reviewed by Michael Saboff.

        * wtf/text/WTFString.cpp:
        (asciiDebug):

2014-08-27  Filip Pizlo  <fpizlo@apple.com>

        DFG should compute immediate dominators using the O(n log n) form of Lengauer and Tarjan's "A Fast Algorithm for Finding Dominators in a Flowgraph"
        https://bugs.webkit.org/show_bug.cgi?id=93361

        Reviewed by Mark Hahnenberg.
        
        Make BitVector operations return the previous value of the bit you're changing. This is
        useful for the kinds of set operations that are commonplace in compiler graph searches.

        * wtf/BitVector.h:
        (WTF::BitVector::quickSet):
        (WTF::BitVector::quickClear):
        (WTF::BitVector::set):
        (WTF::BitVector::ensureSizeAndSet):
        (WTF::BitVector::clear):

2014-08-27  Filip Pizlo  <fpizlo@apple.com>

        FTL should be able to do polymorphic call inlining
        https://bugs.webkit.org/show_bug.cgi?id=135145

        Reviewed by Geoffrey Garen.
        
        Add some power that I need for call edge profiling.

        * wtf/OwnPtr.h:
        (WTF::OwnPtr<T>::createTransactionally):
        * wtf/Spectrum.h:
        (WTF::Spectrum::add):
        (WTF::Spectrum::addAll):
        (WTF::Spectrum::get):
        (WTF::Spectrum::size):
        (WTF::Spectrum::KeyAndCount::KeyAndCount):
        (WTF::Spectrum::clear):
        (WTF::Spectrum::removeIf):

2014-08-27  Nico Weber  <thakis@chromium.org>

        Delete a MSVS2010 workaround.
        https://bugs.webkit.org/show_bug.cgi?id=136321

        Reviewed by Benjamin Poulain.

        Ports https://codereview.chromium.org/512923004/ by the talented
        Nico Weber from Blink. No intended behavior change.

        * wtf/Vector.h:
        (WTF::=):

2014-08-27  Mark Rowe  <mrowe@apple.com>

        JavaScriptCore is missing debug info for WTF because libWTF.a is stripped.
        <https://webkit.org/b/136320> / <rdar://problem/18148776>

        Reviewed by Dan Bernstein.

        * Configurations/WTF.xcconfig: Set STRIP_INSTALLED_PRODUCT = NO for the target
        that produces libWTF.a so that the debug symbols will be linked into JavaScriptCore
        and end up in its dSYM file.

2014-08-26  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r172940.
        https://bugs.webkit.org/show_bug.cgi?id=136256

        Caused assertions on fast/storage/serialized-script-
        value.html, and possibly flakiness on more tests (Requested by
        ap on #webkit).

        Reverted changeset:

        "FTL should be able to do polymorphic call inlining"
        https://bugs.webkit.org/show_bug.cgi?id=135145
        http://trac.webkit.org/changeset/172940

2014-08-23  Filip Pizlo  <fpizlo@apple.com>

        FTL should be able to do polymorphic call inlining
        https://bugs.webkit.org/show_bug.cgi?id=135145

        Reviewed by Geoffrey Garen.
        
        Add some power that I need for call edge profiling.

        * wtf/OwnPtr.h:
        (WTF::OwnPtr<T>::createTransactionally):
        * wtf/Spectrum.h:
        (WTF::Spectrum::add):
        (WTF::Spectrum::addAll):
        (WTF::Spectrum::get):
        (WTF::Spectrum::size):
        (WTF::Spectrum::KeyAndCount::KeyAndCount):
        (WTF::Spectrum::clear):
        (WTF::Spectrum::removeIf):

2014-08-25  Tomas Popela  <tpopela@redhat.com>

        Add support for little-endian PowerPC64
        https://bugs.webkit.org/show_bug.cgi?id=135647

        Reviewed by Oliver Hunt.

        * wtf/Platform.h:
        * wtf/dtoa/utils.h:

2014-08-24  Zan Dobersek  <zdobersek@igalia.com>

        GenericHashTraits::peek() is producing copies of passed-in temporary values
        https://bugs.webkit.org/show_bug.cgi?id=131461

        Reviewed by Darin Adler.

        * wtf/HashTraits.h:
        (WTF::GenericHashTraits::peek): Make this method a template that passes through
        the passed-in value without copying, achieved by using universal references and
        std::forward<>().

2014-08-22  Daniel Bates  <dabates@apple.com>

        [iOS] Disable ENABLE_IOS_{GESTURE, TOUCH}_EVENTS, and temporarily disable ENABLE_TOUCH_EVENTS
        and ENABLE_XSLT when building with the iOS public SDK
        https://bugs.webkit.org/show_bug.cgi?id=135945

        Reviewed by Andy Estes.

        * wtf/FeatureDefines.h:

2014-08-22  Akos Kiss  <akiss@inf.u-szeged.hu>

        Enable fixed executable allocator for any ARM64 target.
        https://bugs.webkit.org/show_bug.cgi?id=136162

        Reviewed by Michael Saboff.

        The ARM64 macro assembler relies on near calls being implemented by BL
        instructions, which have only 128MB offset range from PC. The
        on-demand executable allocator cannot ensure that any two locations in
        memory allocated for the JIT-compiled code are within this range. 
        However, the fixed executable allocator has a fixed 16MB memory pool for
        ARM64.

        * wtf/Platform.h:
        Define ENABLE_EXECUTABLE_ALLOCATOR_FIXED if CPU(ARM64), and update
        attached comment.

2014-08-22  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r172844.
        https://bugs.webkit.org/show_bug.cgi?id=136164

        re-applying WEBCORE_EXPORTS patch (Requested by
        alexchristensen on #webkit).

        Reverted changeset:

        "Revert r172831, it broke the Windows build."
        http://trac.webkit.org/changeset/172844

2014-08-22  Jon Lee  <jonlee@apple.com>

        Fix iOS build due to r172832 and move RUBBER_BANDING out of FeatureDefines.h
        https://bugs.webkit.org/show_bug.cgi?id=136157

        Reviewed by Simon Fraser.

        * wtf/FeatureDefines.h: Remove ENABLE(RUBBER_BANDING) logic for Mac platform.

2014-08-21  Tim Horton  <timothy_horton@apple.com>

        Revert r172831, it broke the Windows build.

        * wtf/ExportMacros.h:

2014-08-21  Zalan Bujtas  <zalan@apple.com>

        Enable SATURATED_LAYOUT_ARITHMETIC.
        https://bugs.webkit.org/show_bug.cgi?id=136106

        Reviewed by Simon Fraser.

        SATURATED_LAYOUT_ARITHMETIC protects LayoutUnit against arithmetic overflow.
        (No measurable performance regression on Mac.)

        * wtf/FeatureDefines.h:

2014-08-21  Alex Christensen  <achristensen@webkit.org>

        More WEBCORE_EXPORT macros.
        https://bugs.webkit.org/show_bug.cgi?id=136129

        Reviewed by Tim Horton.

        * wtf/ExportMacros.h:
        Removed WTF_TESTING which isn't used.

2014-08-20  Akos Kiss  <akiss@inf.u-szeged.hu>

        Enable ARM64 disassembler on EFL
        https://bugs.webkit.org/show_bug.cgi?id=136089

        Reviewed by Filip Pizlo.

        * wtf/Platform.h:
        Enable WTF_USE_ARM64_DISASSEMBLER for EFL as well.

2014-08-19  Pratik Solanki  <psolanki@apple.com>

        Remove PurgeableBuffer since it is not very useful any more
        https://bugs.webkit.org/show_bug.cgi?id=135939

        Reviewed by Andreas Kling.

        * wtf/Platform.h: Remove ENABLE_PURGEABLE_MEMORY define.
        * wtf/VMTags.h: Remove VM tags used by WebCore for cached resource purgeable memory.

2014-08-19  Magnus Granberg  <zorry@gentoo.org>

        TEXTREL in libjavascriptcoregtk-1.0.so.0.11.0 on x86 (or i586)
        https://bugs.webkit.org/show_bug.cgi?id=70610

        Reviewed by Darin Adler.

        Add PLT if we're building with PIC.

        * wtf/InlineASM.h:

2014-08-19  Zalan Bujtas  <zalan@apple.com>

        Remove ENABLE(SUBPIXEL_LAYOUT).
        https://bugs.webkit.org/show_bug.cgi?id=136077

        Reviewed by Simon Fraser.

        Remove compile time flag SUBPIXEL_LAYOUT. All ports have it enabled for a while now.

        * wtf/FeatureDefines.h:

2014-08-18  Maciej Stachowiak  <mjs@apple.com>

        Use NSURLFileTypeMappings directly instead of depending on WebKitSystemInterface wrappers for it
        https://bugs.webkit.org/show_bug.cgi?id=136035

        Reviewed by Dan Bernstein.

        * wtf/Platform.h: Define USE(APPLE_INTERNAL_SDK) by default on platforms that have it.

2014-08-18  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r172736.
        https://bugs.webkit.org/show_bug.cgi?id=136060

        Caused 14% PLT regressions (Requested by rniwa on #webkit).

        Reverted changeset:

        "Remove PurgeableBuffer since it is not very useful any more"
        https://bugs.webkit.org/show_bug.cgi?id=135939
        http://trac.webkit.org/changeset/172736

2014-08-18  Pratik Solanki  <psolanki@apple.com>

        Remove PurgeableBuffer since it is not very useful any more
        https://bugs.webkit.org/show_bug.cgi?id=135939

        Reviewed by Geoffrey Garen.

        * wtf/Platform.h: Remove ENABLE_PURGEABLE_MEMORY define.
        * wtf/VMTags.h: Remove VM tags used by WebCore for cached resource purgeable memory.

2014-08-14  Benjamin Poulain  <benjamin@webkit.org>

        CSS JIT: compile the :empty pseudo class
        https://bugs.webkit.org/show_bug.cgi?id=135958

        Reviewed by Andreas Kling.

        * wtf/text/StringImpl.h:
        (WTF::StringImpl::lengthMemoryOffset):

2014-08-12  Myles C. Maxfield  <mmaxfield@apple.com>

        Elements whose contents start with an astral Unicode symbol disappear when CSS `::first-letter` is applied to them
        https://bugs.webkit.org/show_bug.cgi?id=135756

        Reviewed by Darin Adler.

        Add a method to StringView which passes through contains() to find().

        * wtf/text/StringView.h:
        (WTF::StringView::contains):

2014-08-12  Pratik Solanki  <psolanki@apple.com>

        Enable didReceiveDataArray callback on Mac
        https://bugs.webkit.org/show_bug.cgi?id=135554
        <rdar://problem/9170731>

        Reviewed by Andreas Kling.

        Enable WTF_USE_NETWORK_CFDATA_ARRAY_CALLBACK for all Cocoa platforms so that we use the same
        code path for Mac and iOS.

        * wtf/Platform.h:

2014-08-12  Alex Christensen  <achristensen@webkit.org>

        Generate header detection headers for CMake on Windows.
        https://bugs.webkit.org/show_bug.cgi?id=135807

        Reviewed by Brent Fulgham.

        * wtf/CMakeLists.txt:
        * wtf/PlatformWin.cmake:
        Generate and include a stub WTFHeaderDetection.h.

2014-08-11  Andy Estes  <aestes@apple.com>

        [iOS] Get rid of iOS.xcconfig
        https://bugs.webkit.org/show_bug.cgi?id=135809

        Reviewed by Joseph Pecoraro.

        All iOS.xcconfig did was include AspenFamily.xcconfig, so there's no need for the indirection.

        * Configurations/Base.xcconfig:
        * Configurations/iOS.xcconfig: Removed.
        * WTF.xcodeproj/project.pbxproj:

2014-08-12  Zan Dobersek  <zdobersek@igalia.com>

        Clean up GMutexLocker
        https://bugs.webkit.org/show_bug.cgi?id=135833

        Reviewed by Carlos Garcia Campos.

        Place the GMutexLocker into the WTF namespace. There's no need for this
        class to use FastMalloc since it's always allocated on the stack. The
        constructor and class now operate on a GMutex reference. There's little
        need for an additional inline specifier for methods defined in the header.
        The mutex() method is removed as it was not used. m_val is renamed to a
        more descriptive m_locked and is made a boolean.

        * wtf/gobject/GMutexLocker.h:
        (WTF::GMutexLocker::GMutexLocker):
        (WTF::GMutexLocker::~GMutexLocker):
        (WTF::GMutexLocker::lock):
        (WTF::GMutexLocker::unlock):
        (WebCore::GMutexLocker::GMutexLocker): Deleted.
        (WebCore::GMutexLocker::~GMutexLocker): Deleted.
        (WebCore::GMutexLocker::lock): Deleted.
        (WebCore::GMutexLocker::unlock): Deleted.
        (WebCore::GMutexLocker::mutex): Deleted.

2014-08-12  Zan Dobersek  <zdobersek@igalia.com>

        Make GRefPtr move-able
        https://bugs.webkit.org/show_bug.cgi?id=135801

        Reviewed by Carlos Garcia Campos.

        Add move constructor and move assignment operator for GRefPtr.

        * wtf/gobject/GRefPtr.h:
        (WTF::GRefPtr::GRefPtr):
        (WTF::=):

2014-08-10  Benjamin Poulain  <benjamin@webkit.org>

        Update HashTable's operator= after r172167 per review comments

        * wtf/HashTable.h:
        Update the type as suggested by Darin.

2014-08-07  Benjamin Poulain  <bpoulain@apple.com>

        Get rid of SCRIPTED_SPEECH
        https://bugs.webkit.org/show_bug.cgi?id=135729

        Reviewed by Brent Fulgham.

        * wtf/FeatureDefines.h:

2014-08-07  Benjamin Poulain  <bpoulain@apple.com>

        Get rid of INPUT_SPEECH
        https://bugs.webkit.org/show_bug.cgi?id=135672

        Reviewed by Andreas Kling.

        * wtf/FeatureDefines.h:

2014-08-06  Dean Jackson  <dino@apple.com>

        ENABLE_CSS_TRANSFORMS_ANIMATIONS_UNPREFIXED is not used anywhere. Remove it.
        https://bugs.webkit.org/show_bug.cgi?id=135675

        Reviewed by Sam Weinig.

        * wtf/FeatureDefines.h:

2014-08-06  Benjamin Poulain  <benjamin@webkit.org>

        HashTable based classes leak a lot
        https://bugs.webkit.org/show_bug.cgi?id=135638

        Reviewed by Darin Adler.

        * wtf/HashTable.h:
        The operator= taking a rvalue reference was never freeing the memory allocated
        for the table of the left hand side object.

        This patch fixes the leaks by doing an alloc+swap with a new object.
        The object temp gets the reference to m_table, and destroys it in the regular destructor
        when going out of scope.

        Kudos to Pratik Solanki for finding the leaks.

2014-08-06  Dániel Bátyai  <dbatyai.u-szeged@partner.samsung.com>

        [JSC] Build fix for FTL on EFL after ftlopt merge
        https://bugs.webkit.org/show_bug.cgi?id=135565

        Reviewed by Mark Lam.

        Added ENABLE(FTL_NATIVE_CALL_INLINING).

        * wtf/Platform.h:

2014-08-04  Alex Christensen  <achristensen@webkit.org>

        Progress towards CMake on Mac.
        https://bugs.webkit.org/show_bug.cgi?id=135528

        Reviewed by Gyuyoung Kim.

        * wtf/CMakeLists.txt:
        Include text directory.
        * wtf/PlatformMac.cmake: Added.

2014-07-31  Alex Christensen  <achristensen@webkit.org>

        Progress towards cmake on Windows.
        https://bugs.webkit.org/show_bug.cgi?id=135484

        Reviewed by Martin Robinson.

        * wtf/CMakeLists.txt:
        Added WTF_LIBRARY_TYPE because Windows needs WTF to be a shared library.

2014-07-30  Andreas Kling  <akling@apple.com>

        PropertyName's internal string is always atomic.
        <https://webkit.org/b/135451>

        Remove AtomicString::findStringWithHash() since nobody uses it anymore.

        Reviewed by Benjamin Poulain.

        * wtf/text/AtomicString.cpp:
        (WTF::findString): Deleted.
        (WTF::AtomicString::findStringWithHash): Deleted.
        * wtf/text/AtomicString.h:

2014-07-30  Andy Estes  <aestes@apple.com>

        USE(CONTENT_FILTERING) should be ENABLE(CONTENT_FILTERING)
        https://bugs.webkit.org/show_bug.cgi?id=135439

        Reviewed by Tim Horton.

        We now support two different platform content filters, and will soon support a mock content filter (as part of
        webkit.org/b/128858). This makes content filtering a feature of WebKit, not just an adoption of a third-party
        library. ENABLE() is the correct macro to use for such a feature.

        * wtf/Platform.h:

2014-07-29  Brent Fulgham  <bfulgham@apple.com>

        [Win] Modify version numbering scheme to support 5-tuple versions
        https://bugs.webkit.org/show_bug.cgi?id=135400
        <rdar://problem/17849033>

        Reviewed by David Kilzer.

        * WTF.vcxproj/WTFPostBuild.cmd: Use new version-stamp.pl script
        to version WTF.dll.
        * WTF.vcxproj/WTFPreBuild.cmd: Make sure we have created the
        appropriate version resource during builds.

2014-07-29  Daniel Bates  <dabates@apple.com>

        Use WTF::move() instead of std::move() to help ensure move semantics
        https://bugs.webkit.org/show_bug.cgi?id=135351

        Reviewed by Alexey Proskuryakov.

        * wtf/HashTable.h:
        (WTF::KeyTraits>::HashTable):

2014-07-28  Brian J. Burg  <burg@cs.washington.edu>

        Should not export symbols for base64Encode inline adapter methods
        https://bugs.webkit.org/show_bug.cgi?id=135355

        Unreviewed build fix.

        Fixes the build break introduced by r171682, where a base64Encode
        inline adapter method was used in another header, thus creating
        multiple definitions of it (and problems with with weak symbols).

        * wtf/text/Base64.h: Remove WTF_EXPORT_PRIVATE for inlined methods.

2014-07-27  Filip Pizlo  <fpizlo@apple.com>

        Merge r170090, r170092, r170129, r170141, r170161, r170215, r170275, r170375, r170376, r170382, r170383, r170399, r170436, r170489, r170490, r170556 from ftlopt.

        * wtf/text/WTFString.h:

2014-07-26  Filip Pizlo  <fpizlo@apple.com>

        Unreviewed, roll out r171641-r171644. It broke some tests; will investigate and
        reland later.

        * wtf/text/WTFString.h:

2014-07-25  Filip Pizlo  <fpizlo@apple.com>

        Attempt to fix Windows.

        * wtf/text/WTFString.h:

2014-07-25  Gavin Barraclough  <baraclough@apple.com>

        Yosemite version number is 101000
        https://bugs.webkit.org/show_bug.cgi?id=135301

        Reviewed by Sam Weinig.

        * wtf/FeatureDefines.h:
        * wtf/Platform.h:

2014-07-23  Brent Fulgham  <bfulgham@apple.com>

        [Win] Use NO_RETURN_DUE_TO_CRASH on Windows.
        https://bugs.webkit.org/show_bug.cgi?id=13519

        Reviewed by Mark Lam.

        * wtf/Assertions.h: Add MSVC to list of compilers supporting this macro.
        * wtf/FastMalloc.cpp: Correct function declaration for NO_RETURN_DUE_TO_CRASH.

2014-07-22  Filip Pizlo  <fpizlo@apple.com>

        Merge r169148, r169185, r169188, r169578, r169582, r169584, r169588, r169753 from ftlopt.

    2014-06-04  Filip Pizlo  <fpizlo@apple.com>
    
            [ftlopt] AI should be able track structure sets larger than 1
            https://bugs.webkit.org/show_bug.cgi?id=128073
    
            Reviewed by Oliver Hunt.
    
            * wtf/Bag.h:
            (WTF::Bag::Node::Node):
            (WTF::Bag::add):
    
2014-07-22  Filip Pizlo  <fpizlo@apple.com>

        Merge r168635, r168780, r169005, r169014, and r169143 from ftlopt.

    2014-05-20  Filip Pizlo  <fpizlo@apple.com>
    
            [ftlopt] DFG bytecode parser should turn GetById with nothing but a Getter stub as stuff+handleCall, and handleCall should be allowed to inline if it wants to
            https://bugs.webkit.org/show_bug.cgi?id=133105
    
            Reviewed by Michael Saboff.
    
            * wtf/Bag.h:
            (WTF::Bag::iterator::operator!=):
    
2014-07-19  Zan Dobersek  <zdobersek@igalia.com>

        [WTF] Add the move constructor, move assignment operator for HashTable
        https://bugs.webkit.org/show_bug.cgi?id=130772

        Reviewed by Darin Adler.

        HashTable has both copy constructor and copy assignment operator, meaning that the move constructor
        and move assignment operator are implicitly deleted. This patch defines both to avoid unnecessary
        copies when moves can be performed.

        * wtf/HashTable.h:
        (WTF::KeyTraits>::HashTable):

2014-07-15  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r171107.
        https://bugs.webkit.org/show_bug.cgi?id=134959

        This was not the problem! (Requested by kling on #webkit).

        Reverted changeset:

        "Revert: Run the FastMalloc scavenger thread on iOS as well."
        https://bugs.webkit.org/show_bug.cgi?id=134927
        http://trac.webkit.org/changeset/171107

2014-07-15  Andreas Kling  <akling@apple.com>

        Revert: Run the FastMalloc scavenger thread on iOS as well.
        <https://webkit.org/b/134927>
        <rdar://problem/17485079>

        This appears to be the cause of some elusive crashes, and since I don't
        have a way to reproduce them, let's just go back to not running the
        scavenger thread on iOS.

        Reviewed by Antti Koivisto.

        * wtf/FastMalloc.cpp:

2014-07-13  Filip Pizlo  <fpizlo@apple.com>

        HashMap should have removeIf()
        https://bugs.webkit.org/show_bug.cgi?id=134870

        Reviewed by Sam Weinig.
        
        Expose a new HashMap method, called removeIf(), which allows you to do an efficient
        pass over the map and remove a bunch of things at once. This is used by DFG GCSE as
        part of https://bugs.webkit.org/show_bug.cgi?id=134677.

        * wtf/HashMap.h:
        (WTF::X>::removeIf):
        * wtf/HashTable.h:
        (WTF::KeyTraits>::removeIf):

2014-07-11  peavo@outlook.com  <peavo@outlook.com>

        [Win] Enable DFG JIT.
        https://bugs.webkit.org/show_bug.cgi?id=123615

        Reviewed by Mark Lam.

        * wtf/Platform.h:

2014-07-11  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r170995.
        https://bugs.webkit.org/show_bug.cgi?id=134831

        Causing odd crashes in debug builds (Requested by zdobersek on
        #webkit).

        Reverted changeset:

        "[WTF] Add the move constructor, move assignment operator for
        HashTable"
        https://bugs.webkit.org/show_bug.cgi?id=130772
        http://trac.webkit.org/changeset/170995

2014-07-09  Zan Dobersek  <zdobersek@igalia.com>

        [WTF] Add the move constructor, move assignment operator for HashTable
        https://bugs.webkit.org/show_bug.cgi?id=130772

        Reviewed by Darin Adler.

        HashTable has both copy constructor and copy assignment operator, meaning that the move constructor
        and move assignment operator are implicitly deleted. This patch defines both to avoid unnecessary
        copies when moves can be performed.

        * wtf/HashTable.h:
        (WTF::KeyTraits>::HashTable):

2014-07-10  Alex Christensen  <achristensen@webkit.org>

        Enable same features on all Windows ports.
        https://bugs.webkit.org/show_bug.cgi?id=134715

        Reviewed by Brent Fulgham.

        * wtf/Platform.h:
        Use REQUEST_ANIMATION_FRAME_TIMER on WinCairo.

2014-07-09  Brent Fulgham  <bfulgham@apple.com>

        [Win] Unreviewed build fix after r170930.

        * WTF.vcxproj/copy-files.cmd: Include cf files in
        post-build copy operation.

2014-07-09  Brent Fulgham  <bfulgham@apple.com>

        [Win] Remove uses of 'bash' in build system
        https://bugs.webkit.org/show_bug.cgi?id=134782
        <rdar://problem/17615533>

        Reviewed by Dean Jackson.

        Remove uses of 'bash' by replacing Windows-specific bash scripts
        with Perl equivalents.

        * WTF.vcxproj/WTFGenerated.make:
        * WTF.vcxproj/WTFGenerated.vcxproj:
        * WTF.vcxproj/WTFGenerated.vcxproj.filters:
        * WTF.vcxproj/WTFPreBuild.cmd:
        * WTF.vcxproj/build-generated-files.pl: Copied from Source/WTF/WTF.vcxproj/build-generated-files.sh.
        * WTF.vcxproj/build-generated-files.sh: Removed.

2014-07-09  Brent Fulgham  <bfulgham@apple.com>

        [Win] Remove use of 'grep' in build steps
        https://bugs.webkit.org/show_bug.cgi?id=134770
        <rdar://problem/17608783>

        Reviewed by Tim Horton.

        Replace uses of the grep command in Windows builds with the equivalent
        Perl program.

        * WTF.vcxproj/WTFPreBuild.cmd:

2014-07-07  Zan Dobersek  <zdobersek@igalia.com>

        Enable ARMv7 disassembler for the GTK port
        https://bugs.webkit.org/show_bug.cgi?id=134676

        Reviewed by Benjamin Poulain.

        * wtf/Platform.h: Enable the ARMv7 disassembler for the GTK port when
        targeting the ARMv7 architecture.

2014-07-06  Yoav Weiss  <yoav@yoav.ws>

        Turn on img@sizes compile flag
        https://bugs.webkit.org/show_bug.cgi?id=134634

        Reviewed by Benjamin Poulain.

        * wtf/FeatureDefines.h: Added compile flag definition.

2014-07-03  Gyuyoung Kim  <gyuyoung.kim@samsung.com>

        Unreivewed, fix build break on EFL and GTK since r170767.

        * wtf/CMakeLists.txt: Exclude Decoder.h and Encoder.h because those files were removed.

2014-07-03  Daniel Bates  <dabates@apple.com>

        Add WTF::move()
        https://bugs.webkit.org/show_bug.cgi?id=134500

        Reviewed by Darin Adler.

        Substitution of WTF::move() for std::move() rubber-stamped by Anders Carlsson.

        Implement WTF::move(), a replacement for std::move(). WTF::move() is less error
        prone than std::move() as it compile asserts that its argument is a non-const
        lvalue reference before ultimately casting it to a rvalue reference (via std::move).

        * wtf/Deque.h: Substitute WTF::move() for std::move().
        * wtf/HashMap.h: Ditto.
        * wtf/HashSet.h: Ditto.
        * wtf/HashTable.h: Ditto.
        * wtf/IteratorAdaptors.h: Ditto.
        * wtf/IteratorRange.h: Ditto.
        * wtf/ListHashSet.h: Ditto.
        * wtf/MainThread.cpp: Ditto.
        [...]
        * wtf/StdLibExtras.h:
        (WTF::move): Added.
        [...]

2014-07-03  Anders Carlsson  <andersca@apple.com>

        Get rid of Encoder.h and Decoder.h from WTF
        https://bugs.webkit.org/show_bug.cgi?id=134600

        Reviewed by Darin Adler.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/Decoder.h: Removed.
        * wtf/Encoder.h: Removed.

2014-07-03  Ryuan Choi  <ryuan.choi@samsung.com>

        Broken build with build-webkit --no-video
        https://bugs.webkit.org/show_bug.cgi?id=134587

        Reviewed by Darin Adler.

        MEDIA_CONTROLS_SCRIPT requires VIDEO enabled.

        * wtf/FeatureDefines.h: Added error message for dependency failure.

2014-07-02  Enrica Casucci  <enrica@apple.com>

        iOS build fix after http://trac.webkit.org/changeset/170697.
        
        Unreviewed.

        * wtf/Deque.h:

2014-07-02  Dan Bernstein  <mitz@apple.com>

        Remove some code only needed for versions of Safari that are no longer supported
        https://bugs.webkit.org/show_bug.cgi?id=134537

        Reviewed by Anders Carlsson.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h:

2014-07-01  Alex Christensen  <achristensen@webkit.org>

        Reduce dynamic memory allocation in css jit.
        https://bugs.webkit.org/show_bug.cgi?id=134416

        Reviewed by Benjamin Poulain.

        * wtf/Deque.h:
        Added inlineCapacity optional template parameter.

2014-06-30  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r170605.
        https://bugs.webkit.org/show_bug.cgi?id=134484

        The changes cause crashes on ARM64 (Requested by benjaminp on
        #webkit).

        Reverted changeset:

        "Reduce dynamic memory allocation in css jit."
        https://bugs.webkit.org/show_bug.cgi?id=134416
        http://trac.webkit.org/changeset/170605

2014-06-30  Daniel Bates  <dabates@apple.com>

        Make TransformIterator::TransformIterator() take rvalue references
        https://bugs.webkit.org/show_bug.cgi?id=134468

        Reviewed by Darin Adler.

        It's unnecessary to support TransformIterator::TransformIterator() taking const lvalue references
        as we only call it with rvalues. As a side benefit, we can use move semantics to initialize the
        members of TransformIterator.

        * wtf/IteratorAdaptors.h:
        (WTF::TransformIterator::TransformIterator): Make constructor take arguments as rvalue references.
        (WTF::makeTransformIterator): Substitute std::move() for std::forward().

2014-06-30  Alex Christensen  <achristensen@webkit.org>

        Reduce dynamic memory allocation in css jit.
        https://bugs.webkit.org/show_bug.cgi?id=134416

        Reviewed by Benjamin Poulain.

        * wtf/Deque.h:
        Added inlineCapacity optional template parameter.

2014-06-30  Anders Carlsson  <andersca@apple.com>

        Add code for encoding legacy session history entries
        https://bugs.webkit.org/show_bug.cgi?id=134452

        Reviewed by Andreas Kling.

        * wtf/MallocPtr.h:
        (WTF::MallocPtr::malloc):
        (WTF::MallocPtr::realloc):

2014-06-27  Andreas Kling  <akling@apple.com>

        [ARMv7] Skip one particularly expensive fastFree() alignment check.
        <https://webkit.org/b/134402>

        The size class alignment check in fastFree() was crazy expensive on ARMv7
        due to its use of modulo. Disabling it shaves 470ms off of PLT main thread
        time in the web process.

        Note that this was very hard to identify in profiles due to TCO.

        Reviewed by Gavin Barraclough.

        * wtf/FastMalloc.cpp:
        (WTF::TCMalloc_ThreadCache::CreateCacheIfNecessary):

2014-06-26  Andreas Kling  <akling@apple.com>

        Bump FastMalloc thread cache max size to 1MB on iOS.
        <https://webkit.org/b/134365>

        The previous limit (512kB) comes from the old days of very-low-memory
        devices, and we can now afford to spend another 512kB here.
        Note that we already have a mechanism to purge FastMalloc caches on
        system memory pressure.

        Looks like a ~400ms progression on PLT.

        Reviewed by Geoff Garen.

        * wtf/FastMalloc.cpp:

2014-06-26  Laszlo Gombos  <l.gombos@samsung.com>

        Define TARGET_OS_IPHONE to 0 for non-darwin ports
        https://bugs.webkit.org/show_bug.cgi?id=134347

        Reviewed by Darin Adler.

        A follow-up to r169880 to make it easier to reason about
        the code. The purpose of this change to allow
        "#if TARGET_OS_IPHONE" in public header files.

        * wtf/Platform.h:

2014-06-26  Chris Fleizach  <cfleizach@apple.com>

        Add an undo group for each dictated utterance in WebKit
        https://bugs.webkit.org/show_bug.cgi?id=134086

        Applied review comments from Sam Weinig.

        Move the associated USE #define into Platform.h.

        * wtf/Platform.h:

2014-06-25  Geoffrey Garen  <ggaren@apple.com>

        Unreviewed, rolling out r166876.

        Caused some ECMA test262 failures

        Reverted changeset:

        "Date object needs to check for ES5 15.9.1.14 TimeClip limit."
        https://bugs.webkit.org/show_bug.cgi?id=131248
        http://trac.webkit.org/changeset/166876

2014-06-25  peavo@outlook.com  <peavo@outlook.com>

        [Win64] ASM LLINT is not enabled.
        https://bugs.webkit.org/show_bug.cgi?id=130638

        Reviewed by Mark Lam.

        * wtf/Platform.h: Enable LLINT and JIT for Win64.

2014-06-25  Laszlo Gombos  <l.gombos@samsung.com>

        Remove build guard for progress element
        https://bugs.webkit.org/show_bug.cgi?id=134292

        Reviewed by Benjamin Poulain.

        The build flag is no longer needed as it is always on.

        * wtf/FeatureDefines.h:

2014-06-24  Andreas Kling  <akling@apple.com>

        Run the FastMalloc scavenger thread on iOS as well.
        <https://webkit.org/b/134287>
        <rdar://problem/17446198>

        Reviewed by Gavin Barraclough.

        * wtf/FastMalloc.cpp:

2014-06-24  Anders Carlsson  <andersca@apple.com>

        Add PageState to HistoryItem conversion code
        https://bugs.webkit.org/show_bug.cgi?id=134259

        Reviewed by Andreas Kling.

        * wtf/Optional.h:
        (WTF::Optional::valueOr):

2014-06-24  László Langó  <llango.u-szeged@partner.samsung.com>

        [JavaScriptCore] Enable concurrent JIT on EFL.
        https://bugs.webkit.org/show_bug.cgi?id=134242

        Reviewed by Csaba Osztrogonác.

        * wtf/Platform.h:

2014-06-23  Ryuan Choi  <ryuan.choi@samsung.com>

        [EFL] Replace RefPtr<Evas_Object> with UniquePtrEfl
        https://bugs.webkit.org/show_bug.cgi?id=134236

        Reviewed by Gyuyoung Kim.

        Although there are ref/unref for Evas_Object, it's bit odd so we should call evas_object_del to destroy it.
        So, this patch replaced RefPtr<Evas_Object> with UniquePtrEfl for the simplicity.

        * wtf/PlatformEfl.cmake: Removed RefPtrEfl.cpp from source list.
        * wtf/efl/RefPtrEfl.cpp: Removed.
        * wtf/efl/RefPtrEfl.h: Removed.

2014-06-21  Brady Eidson  <beidson@apple.com>

        Gamepad API - Deprecate the existing implementation
        https://bugs.webkit.org/show_bug.cgi?id=134108

        Reviewed by Timothy Hatcher.

        -Add new "GAMEPAD_DEPRECATED" build flag, moving the existing implementation to use it
        -Move some implementation files into a "deprecated" subdirectory.

        * wtf/FeatureDefines.h:

2014-06-21  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r170244.
        https://bugs.webkit.org/show_bug.cgi?id=134157

        GTK/EFL bindings generator works differently, making this
        patch not work there.  Will fix entire patch after a rollout.
        (Requested by bradee-oh on #webkit).

        Reverted changeset:

        "Gamepad API - Deprecate the existing implementation"
        https://bugs.webkit.org/show_bug.cgi?id=134108
        http://trac.webkit.org/changeset/170244

2014-06-21  Brady Eidson  <beidson@apple.com>

        Gamepad API - Deprecate the existing implementation
        https://bugs.webkit.org/show_bug.cgi?id=134108

        Reviewed by Timothy Hatcher.

        -Add new "GAMEPAD_DEPRECATED" build flag, moving the existing implementation to use it
        -Add the "Deprecated" suffix to some implementation files

        * wtf/FeatureDefines.h:

2014-06-21  Eva Balazsfalvi  <evab.u-szeged@partner.samsung.com>

        Removing PAGE_VISIBILITY_API compile guard.
        https://bugs.webkit.org/show_bug.cgi?id=133844

        Reviewed by Gavin Barraclough.

        * wtf/FeatureDefines.h:

2014-06-20  Anders Carlsson  <andersca@apple.com>

        Add encoding and decoding support for WTF::Optional
        https://bugs.webkit.org/show_bug.cgi?id=134125

        Reviewed by Andreas Kling.

        * wtf/Optional.h:
        (WTF::Optional::operator=):

2014-06-20  Anders Carlsson  <andersca@apple.com>

        Add copy/move constructors and assignment operators to WTF::Optional
        https://bugs.webkit.org/show_bug.cgi?id=134119

        Reviewed by Andreas Kling.

        * wtf/Optional.h:
        (WTF::Optional::Optional):
        (WTF::Optional::operator=):

2014-06-19  Anders Carlsson  <andersca@apple.com>

        Add WTF::Optional class
        https://bugs.webkit.org/show_bug.cgi?id=134083

        Reviewed by Andreas Kling.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/Optional.h: Added.
        (WTF::Optional::Optional):
        (WTF::Optional::~Optional):
        (WTF::Optional::operator bool):
        (WTF::Optional::value):

2014-06-19  Dániel Bátyai  <dbatyai.u-szeged@partner.samsung.com>

        Remove ENABLE(LLINT) and ENABLE(LLINT_C_LOOP) guards
        https://bugs.webkit.org/show_bug.cgi?id=130389

        Reviewed by Mark Lam.

        Removed ENABLE(LLINT) since we always build with it, and changed ENABLE(LLINT_C_LOOP)
        into !ENABLE(JIT) since they are mutually exclusive.

        * wtf/OSAllocatorPosix.cpp:
        (WTF::OSAllocator::reserveAndCommit):
        * wtf/Platform.h:

2014-06-18  Anders Carlsson  <andersca@apple.com>

        Add CF type cast function templates and use them in KeyedDecoder in WebKit2
        https://bugs.webkit.org/show_bug.cgi?id=134033

        Reviewed by Sam Weinig.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/cf/TypeCasts.h: Added.
        (WTF::dynamic_cf_cast):
        Returns null if the given CFTypeRef object doesn't have the right type.

        (WTF::checked_cf_cast):
        ASSERTs (with security implication) if the given CFTypeRef object is null or doesn't have the right type.

2014-06-17  Tamas Gergely  <tgergely.u-szeged@partner.samsung.com>

        Misused PLATFORM(MIDDLE_ENDIAN) and PLATFORM(BIG_ENDIAN).
        https://bugs.webkit.org/show_bug.cgi?id=128301

        Reviewed by Daniel Bates.

        Endianness is a CPU attribute, not a PLATFORM. PLATFORM() macro is replaced to CPU().

        * wtf/text/ASCIIFastPath.h:
        (WTF::copyLCharsFromUCharSource):

2014-06-17  Andreas Kling  <akling@apple.com>

        Web process main thread priority is lower than some network process threads.
        <https://webkit.org/b/133987>
        <rdar://problem/17330300>

        Bring all of our threads to the appropriate priority level by opting in to the
        threading QoS APIs. By marking them "user initiated", they still yield to UI
        interaction, but take priority over background tasks.

        Reviewed by Maciej Stachowiak.

        * wtf/Platform.h:
        * wtf/Threading.cpp:
        (WTF::setCurrentThreadIsUserInitiated):
        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::createThreadInternal):

2014-06-17  Alex Christensen  <achristensen@webkit.org>

        Enable css jit for armv7 on iOS.
        https://bugs.webkit.org/show_bug.cgi?id=133961
        <rdar://problem/17310631>

        Reviewed by Andreas Kling.

        * wtf/Platform.h:
        Enable css jit for ARM thumb on iOS.

2014-06-17  Dan Bernstein  <mitz@apple.com>

        String::isolatedCopy doesn’t return an isolated copy when used on an rvalue reference
        https://bugs.webkit.org/show_bug.cgi?id=133968

        Reviewed by Anders Carlsson.

        Made the rvalue reference overload of isolatedCopy() non-const, so that std::move(*this) is
        an rvalue reference that can be moved, rather than copied, into the returned String.

        * wtf/text/WTFString.cpp:
        (WTF::String::isolatedCopy):
        * wtf/text/WTFString.h:

2014-06-15  Dan Bernstein  <mitz@apple.com>

        iOS build fix after r169995.

        * wtf/RetainPtr.h:

2014-06-15  Anders Carlsson  <andersca@apple.com>

        Add an autorelease() member function to RetainPtr
        https://bugs.webkit.org/show_bug.cgi?id=133929

        Reviewed by Dan Bernstein.

        * wtf/RetainPtr.h:

2014-06-13  Alex Christensen  <achristensen@webkit.org>

        Unreviewed disabling css jit on armv7.  It's not quite ready yet.

        * wtf/Platform.h:
        Disable css jit on armv7.

2014-06-13  Alex Christensen  <achristensen@webkit.org>

        Enable css jit for armv7 on iOS.
        https://bugs.webkit.org/show_bug.cgi?id=133890
        <rdar://problem/17310631>

        Reviewed by Andreas Kling.

        * wtf/Platform.h:
        Enable css jit for ARM thumb on iOS.

2014-06-13  Mark Hahnenberg  <mhahnenberg@apple.com>

        OSR exit should barrier the Executables for all InlineCallFrames, not just those on the stack at the time of exit
        https://bugs.webkit.org/show_bug.cgi?id=133880

        Reviewed by Filip Pizlo.

        * wtf/Bag.h:
        (WTF::Bag::iterator::operator!=): Add != to the Bag iterator so we can use it in range-based iteration.

2014-06-12  Gavin Barraclough  <barraclough@apple.com>

        Add support for thread/WorkQueue QoS
        https://bugs.webkit.org/show_bug.cgi?id=130688

        Reviewed by Anders Carlson & Simon Fraser.

        Add the ability to mark threads as UserInteractive.

        * wtf/Threading.cpp:
        (WTF::setCurrentThreadIsUserInteractive):
            - added method to set QoS of current thread to UserInteractive.
        * wtf/Threading.h:
            - added declaration.

2014-06-12  Alexey Proskuryakov  <ap@apple.com>

        Fix Mac after r169880.

        This revision added a C++ comment to Platform.h, which breaks sandbox profile
        preprocessing.

        Also, I do not believe that this comment was entirely accurate - we've always used
        this technique with GCC, so there has to be more to it. So, I just removed the comment.

        * wtf/Platform.h:

2014-06-11  Csaba Osztrogonác  <ossy@webkit.org>

        [EFL][GTK] Ultimate fix not to have build failures
        in the future because of "#if TARGET_OS_IPHONE" guards.

        Unreviewed buildfix.

        * wtf/Platform.h: Define TARGET_OS_IPHONE to 0 on EFL and GTK.

2014-06-11  Ryosuke Niwa  <rniwa@webkit.org>

        Turning on DUMP_PROPERTYMAP_STATS causes a build failure
        https://bugs.webkit.org/show_bug.cgi?id=133673

        Reviewed by Andreas Kling.

        Added DEFINE_GLOBAL_FOR_LOGGING to allow running a destructor in logging code
        that needs to be enabled in release builds (e.g. for JavaScriptCore).

        * wtf/StdLibExtras.h:

2014-06-09  Benjamin Poulain  <bpoulain@apple.com>

        Improve CSSPrimitiveValue::customCSSText for ARMv7
        https://bugs.webkit.org/show_bug.cgi?id=133597

        Reviewed by Andreas Kling.

        * wtf/RefPtr.h:
        (WTF::RefPtr<T>::RefPtr):
        * wtf/text/WTFString.h:
        (WTF::String::String):

2014-06-05  Yoav Weiss  <yoav@yoav.ws>

        Align srcset parser with recent spec changes
        https://bugs.webkit.org/show_bug.cgi?id=133504

        Reviewed by Darin Adler.

        I've added toInt and toFloat methods to StringView, and exposed
        charactersToInt so that they can be used by
        HTMLSrcsetParser.cpp.

        * wtf/text/WTFString.h:
        * wtf/text/StringView.h:
        (WTF::StringView::toInt):
        (WTF::StringView::toFloat):

2014-06-04  Alex Christensen  <achristensen@webkit.org>

        Enable WebGL on Windows.
        https://bugs.webkit.org/show_bug.cgi?id=133503

        Reviewed by Brent Fulgham.

        * wtf/FeatureDefines.h:
        Enable WebGL for AppleWin and WinCairo ports.

2014-06-01  Jer Noble  <jer.noble@apple.com>

        [MSE] Appends of overlapping sample data do not clear existing samples properly.
        https://bugs.webkit.org/show_bug.cgi?id=133435

        Reviewed by Darin Adler.

        Add a dump method to MediaTime, so that MediaTimes can be easily converted to strings (for logging purposes).

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::dump):
        * wtf/MediaTime.h:

2014-05-31  Anders Carlsson  <andersca@apple.com>

        Add a LazyNeverDestroyed class template and use it
        https://bugs.webkit.org/show_bug.cgi?id=133425

        Reviewed by Darin Adler.

        LazyNeverDestroyed is similar to NeverDestroyed, except it's lazily constructed
        by calling construct(). This makes it useful for using inside std::call_once functions.
        
        * wtf/Forward.h:
        * wtf/NeverDestroyed.h:
        (WTF::LazyNeverDestroyed::construct):
        (WTF::LazyNeverDestroyed::operator T&):
        (WTF::LazyNeverDestroyed::get):
        (WTF::LazyNeverDestroyed::asPtr):
        (WTF::LazyNeverDestroyed::MaybeRelax::MaybeRelax):
        * wtf/mac/DeprecatedSymbolsUsedBySafari.mm:
        (WTF::atomicallyInitializedStaticMutex):
        * wtf/unicode/icu/CollatorICU.cpp:
        (WTF::cachedCollatorMutex):

2014-05-29  Alex Christensen  <achristensen@webkit.org>

        Enable css jit by default on arm64.
        https://bugs.webkit.org/show_bug.cgi?id=133246
        <rdar://problem/17073407>

        Reviewed by Benjamin Poulain.

        * wtf/Platform.h:
        Added arm64 to list of supported architectures.

2014-05-28  Filip Pizlo  <fpizlo@apple.com>

        DFG::DCEPhase inserts into an insertion set in reverse, causing hilarious basic block corruption if you kill a lot of NewArrays
        https://bugs.webkit.org/show_bug.cgi?id=133368

        Reviewed by Mark Lam.

        * wtf/Insertion.h:
        (WTF::executeInsertions): This algorithm is only correct if insertions are added in the right order. Assert that the order is right.

2014-05-27  Jon Lee  <jonlee@apple.com>

        Update ENABLE(MEDIA_SOURCE) on Mac
        https://bugs.webkit.org/show_bug.cgi?id=133141

        Reviewed by Darin Adler.

        * wtf/FeatureDefines.h: #ifdef unneeded for Mac since it's covered in the .xcconfigs.

2014-05-27  Tibor Meszaros  <tmeszaros.u-szeged@partner.samsung.com>

        Remove BLOB guards
        https://bugs.webkit.org/show_bug.cgi?id=132863

        Reviewed by Csaba Osztrogonác.

        * wtf/FeatureDefines.h:

2014-05-27  Gwang Yoon Hwang  <yoon@igalia.com>

        [GLIB] RunLoop::dispatch always executes the function on the main thread instead of the target thread.
        https://bugs.webkit.org/show_bug.cgi?id=133291

        Reviewed by Carlos Garcia Campos.

        GMainLoopSource::schedule[AfterDelay] must be used with the appropriate
        GMainContext. Because current implementations in RunLoopGtk passes nullptr
        instead of its runLoopContext when using GMainLoopSource, all of dispatched
        functions are executed on the main thread regardless of which runloops is used.

        This patch fixes the issue by passing the m_runLoopContext instead the default
        parameter to the GMainLoopSource::schedule[AfterDelay].

        * wtf/gtk/RunLoopGtk.cpp:
        (WTF::RunLoop::wakeUp):
        (WTF::RunLoop::TimerBase::start):

2014-05-26  Darin Adler  <darin@apple.com>

        Class name matching should use ASCII case-insensitive matching, not Unicode case folding
        https://bugs.webkit.org/show_bug.cgi?id=133292

        Reviewed by Anders Carlsson.

        * wtf/text/AtomicString.cpp:
        (WTF::AtomicString::addSlowCase): Change to take references instead of pointers since these
        arguments can never be null.
        (WTF::AtomicString::lower): Rearranged slightly to use PassRef in a more efficient but
        slightly uglier way.
        (WTF::AtomicString::convertToASCIILowercase): Added.
        * wtf/text/AtomicString.h: Updated for above changes.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::convertToASCIILowercase): Added.
        * wtf/text/StringImpl.h: Updated for above.

        * wtf/text/WTFString.cpp:
        (WTF::String::convertToASCIILowercase): Added.
        * wtf/text/WTFString.h: Updated for above.

2014-05-22  Zan Dobersek  <zdobersek@igalia.com>

        Add the partial specialization for VectorTraits<std::unique_ptr<P>>
        https://bugs.webkit.org/show_bug.cgi?id=133083

        Reviewed by Andreas Kling.

        * wtf/VectorTraits.h: Like for RefPtr<P>, OwnPtr<P> and Ref<P>, the partial
        specialization for VectorTraits<std::unique_ptr<P>> should exist and should
        inherit from SimpleClassVector.

2014-05-20  Geoffrey Garen  <ggaren@apple.com>

        Rolled out <http://trac.webkit.org/changeset/166184>
        https://bugs.webkit.org/show_bug.cgi?id=133144

        Reviewed by Gavin Barraclough.

        It caused a performance regression.

        * wtf/FastMalloc.cpp:
        (WTF::TCMalloc_PageHeap::runScavengerThread):
        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::createThreadInternal):
        (WTF::setCurrentThreadQOSUtility): Deleted.
        * wtf/ThreadingWin.cpp:
        (WTF::setCurrentThreadQOSUtility): Deleted.

2014-05-20  Jer Noble  <jer.noble@apple.com>

        [Mac] AVAssets are never destroyed; lack of an autorelease pool when calling callOnMainThread.
        https://bugs.webkit.org/show_bug.cgi?id=133130

        Reviewed by Geoff Garen.

        Wrap the function to be called in an autorelease pool, so that autoreleased objects are cleaned
        up immediately after the end of the function.

        * wtf/mac/MainThreadMac.mm:
        (WTF::timerFired):

2014-05-18  Rik Cabanier  <cabanier@adobe.com>

        support for navigator.hardwareConcurrency
        https://bugs.webkit.org/show_bug.cgi?id=132588

        Reviewed by Filip Pizlo.

        * wtf/FeatureDefines.h:

2014-05-14  Tibor Meszaros  <tmeszaros.u-szeged@partner.samsung.com>

        Remove CSS_STICKY_POSITION guards
        https://bugs.webkit.org/show_bug.cgi?id=132676

        Reviewed by Simon Fraser.

        * wtf/FeatureDefines.h:

2014-05-13  Simon Fraser  <simon.fraser@apple.com>

        [iOS WK2] background-attachment:fixed behaves very poorly
        https://bugs.webkit.org/show_bug.cgi?id=132881
        <rdar://problem/16789526>

        Reviewed by Beth Dakin.
        
        Remove ENABLE_FAST_MOBILE_SCROLLING. Ports can use the fixedBackgroundsPaintRelativeToDocument
        setting now.

        * wtf/FeatureDefines.h:

2014-05-08  Alexey Proskuryakov  <ap@apple.com>

        Automatically zip document bundles used via File API
        https://bugs.webkit.org/show_bug.cgi?id=132713
        <rdar://problem/13397892>

        Reviewed by Anders Carlsson.

        * wtf/FeatureDefines.h: Added ENABLE_FILE_REPLACEMENT for Mac.

2014-05-07  Filip Pizlo  <fpizlo@apple.com>

        UNREACHABLE_FOR_PLATFORM() is meant to be a release crash.

        Rubber stamped by Mark Hahnenberg..

        * wtf/Assertions.h:
        (UNREACHABLE_FOR_PLATFORM):

2014-05-06  Alberto Garcia  <berto@igalia.com>

        There is no HW_AVAILCPU on FreeBSD, NetBSD, and OpenBSD
        https://bugs.webkit.org/show_bug.cgi?id=132542

        Reviewed by Michael Saboff.

        Use sysconf() to get the number of processor cores.

        * wtf/NumberOfCores.cpp:
        (WTF::numberOfProcessorCores):

2014-05-04  Darin Adler  <darin@apple.com>

        RetainPtr: Use adoptCF function instead of AdoptCF constructor argument
        https://bugs.webkit.org/show_bug.cgi?id=80222

        Reviewed by Alexey Proskuryakov.

        All the clients are gone, so we can now remove AdoptCF and AdoptNS.

        * wtf/RetainPtr.h: Removed the public constructors that let you specify AdoptCF
        and AdoptNS. Instead, made the adoptCF and adoptNS functions be friends and use
        a private constructor that takes an Adopt argument.
        (WTF::adoptCF): Moved the Objective-C class check in here.
        (WTF::adoptNS): Moved the code to deal with the CFRetain for garbage collection
        in here; it used to be spread across the constructor and adoptNSReference.

2014-05-04  Andreas Kling  <akling@apple.com>

        Optimize JSRopeString for resolving directly to AtomicString.
        <https://webkit.org/b/132548>

        Add AtomicString::find([LU]Char*, unsigned length) helpers for finding
        an existing AtomicString without a StringImpl on hand.

        Reviewed by Filip Pizlo.

        * wtf/text/AtomicString.h:
        * wtf/text/AtomicString.cpp:
        (WTF::AtomicString::find):

2014-05-01  Brent Fulgham  <bfulgham@apple.com>

        Fix handling of attributes prior to compiling shader
        https://bugs.webkit.org/show_bug.cgi?id=132430

        Reviewed by Dean Jackson.

        WebGL programs that called bindAttribLocations prior to compiling shader sources
        would perform the bind using the non-hashed symbol name, but would later create
        the attributes as hashed names. Consequently, the program would refer to
        attributes that were never actually part of any shader, resulting in some amazing
        display artifacts.

        This patch adds a dictionary of hashed symbol names so that we can tell the WebGL
        program the proper name that will be used when the shader is eventually compiled,
        allowing the WebGL program to link against the proper symbol after compiling and
        linking completes.

        * wtf/HexNumber.h:
        (WTF::appendUnsigned64AsHex): Add uint64_t-compatible hex->string converter.

2014-04-30  Geoffrey Garen  <ggaren@apple.com>

        Link against bmalloc in production builds
        https://bugs.webkit.org/show_bug.cgi?id=132413

        Reviewed by Sam Weinig.

        Production builders have been configured to handle this, so let's build
        it.

        * Configurations/WTF.xcconfig:

2014-05-01  Ryuan Choi  <ryuan.choi@samsung.com>

        [EFL] There are many warnings with software backend
        https://bugs.webkit.org/show_bug.cgi?id=132422

        Reviewed by Gyuyoung Kim.

        * wtf/efl/EflTypedefs.h: Added Ecore_X_Window typedef

2014-04-30  Simon Fraser  <simon.fraser@apple.com>

        Remove ENABLE_PLUGIN_PROXY_FOR_VIDEO
        https://bugs.webkit.org/show_bug.cgi?id=132396

        Reviewed by Eric Carlson.

        Remove ENABLE_PLUGIN_PROXY_FOR_VIDEO and related code.

        * wtf/FeatureDefines.h:

2014-04-30  Víctor Manuel Jáquez Leal  <vjaquez@igalia.com>

        [GTK][GStreamer] Remove unnecessary GLIB_CHECK_VERSION #ifdefs
        https://bugs.webkit.org/show_bug.cgi?id=132390

        Reviewed by Philippe Normand.

        Since EFL port use GLib 2.38 and GTK+, 2.33.2, I assume it is OK
        remove, in GTK+ and GST, the existing glib version guards.

        This code was rollback from r149879 because Qt MIPS used it. But since
        Qt is gone, it is safe to remove now.

        * wtf/gobject/GRefPtr.cpp:
        (WTF::refGPtr): Deleted.
        (WTF::derefGPtr): Deleted.

2014-04-29  Alex Christensen  <achristensen@webkit.org>

        [WinCairo] Switch video from GStreamer to Media Foundation.
        https://bugs.webkit.org/show_bug.cgi?id=132358

        Reviewed by Brent Fulgham.

        * WTF.vcxproj/WTF.vcxproj:
        Removed dependencies on GStreamer.
        * wtf/Platform.h:
        Use Media Foundation instead of GStreamer and GLib.

2014-04-29  Filip Pizlo  <fpizlo@apple.com>

        Unreviewed, fix cloop build.

        * wtf/Platform.h:

2014-04-29  Michael Saboff  <msaboff@apple.com>

        For DARWIN platforms, use system temporary directory for DataLog output
        https://bugs.webkit.org/show_bug.cgi?id=132346

        Reviewed by Geoffrey Garen.

        Added code to call confstr() to access the process's temporary directory to use that
        location instead of /tmp/.  Put the code behind #ifdef DATA_LOG_TO_DARWIN_TEMP_DIR.

        * wtf/DataLog.cpp:
        (WTF::initializeLogFileOnce):

2014-04-25  Filip Pizlo  <fpizlo@apple.com>

        Figure out how many cores are available for realsies.

        Rubber stamped by Andreas Kling.
        
        HW_AVAILCPU is more canonical than HW_NCPU. For example if you use hacks to tell Darwin
        to make it seem like there are fewer CPUs, HW_AVAILCPU will change but HW_NCPU won't.
        HW_NCPU doesn't reflect how much actual paralellism you'll get; it's merely reporting
        facts about the machine you're running on. HW_AVAILCPU is almost always what WebKit
        wants since it uses this information to decide how many threads to launch for various
        things.

        * wtf/NumberOfCores.cpp:
        (WTF::numberOfProcessorCores):

2014-04-22  Brent Fulgham  <bfulgham@apple.com>

        [Win] Support Python 2.7 in Cygwin
        https://bugs.webkit.org/show_bug.cgi?id=132023

        Reviewed by Michael Saboff.

        * WTF.vcxproj/WTFGenerated.make: Use proper path to Python.

2014-04-21  Eric Carlson  <eric.carlson@apple.com>

        [Mac] implement WebKitDataCue
        https://bugs.webkit.org/show_bug.cgi?id=131799

        Reviewed by Dean Jackson.

        * wtf/FeatureDefines.h: Define ENABLE_DATACUE_VALUE.

2014-04-21  Darin Adler  <darin@apple.com>

        Add HashSet::takeAny
        https://bugs.webkit.org/show_bug.cgi?id=131928

        Reviewed by Benjamin Poulain.

        * wtf/HashSet.h: Added an overload of take that takes an iterator,
        and used it to implement both the existing take and new takeAny functions.

2014-04-20  Andreas Kling  <akling@apple.com>

        Speed up jsStringWithCache() through WeakGCMap inlining.
        <https://webkit.org/b/131923>

        Add HashMap::fastAdd(), which is the same as add() except we'll tell
        the compiler to aggressively inline it.

        Reviewed by Darin Adler.

        * wtf/HashMap.h:
        * wtf/HashTable.h:

2014-04-19  Filip Pizlo  <fpizlo@apple.com>

        Make it easier to check if an integer sum would overflow
        https://bugs.webkit.org/show_bug.cgi?id=131900

        Reviewed by Darin Adler.

        * wtf/CheckedArithmetic.h:
        (WTF::checkedSum):
        (WTF::sumOverflows):

2014-04-18  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r167527.
        https://bugs.webkit.org/show_bug.cgi?id=131883

        Broke 32-bit build (Requested by ap on #webkit).

        Reverted changeset:

        "[Mac] implement WebKitDataCue"
        https://bugs.webkit.org/show_bug.cgi?id=131799
        http://trac.webkit.org/changeset/167527

2014-04-18  Eric Carlson  <eric.carlson@apple.com>

        [Mac] implement WebKitDataCue
        https://bugs.webkit.org/show_bug.cgi?id=131799

        Reviewed by Dean Jackson.

        * wtf/FeatureDefines.h: Define ENABLE_DATACUE_VALUE.

2014-04-18  Martin Robinson  <mrobinson@igalia.com>

        Remove DynamicAnnotations.h?
        https://bugs.webkit.org/show_bug.cgi?id=131754

        Reviewed by Simon Fraser.

        This file, which helped support tools like Valgrind was unused.

        * WTF.vcxproj/WTF.vcxproj: Remove references to the files.
        * WTF.vcxproj/WTF.vcxproj.filters: Remove references to the files.
        * WTF.xcodeproj/project.pbxproj: Remove references to the files.
        * wtf/CMakeLists.txt: Remove references to the files.
        * wtf/DynamicAnnotations.cpp: Removed.
        * wtf/DynamicAnnotations.h: Removed.
        * wtf/ThreadSafeRefCounted.h: Remove references to the files.
        * wtf/text/StringStatics.cpp: Remove references to the files.

2014-04-18  Philippe Normand  <pnormand@igalia.com>

        Remove NETWORK_INFO support
        https://bugs.webkit.org/show_bug.cgi?id=131841

        Reviewed by Gyuyoung Kim.

        * wtf/FeatureDefines.h:

2014-04-17  Filip Pizlo  <fpizlo@apple.com>

        Don't include CompilationThread.h from StringImpl.h
        https://bugs.webkit.org/show_bug.cgi?id=131817

        Reviewed by Simon Fraser.

        * wtf/CompilationThread.h:
        * wtf/StdLibExtras.h:
        * wtf/text/StringImpl.h:

2014-04-17  Darin Adler  <darin@apple.com>

        Use HashMap<unique_ptr> and Vector<unique_ptr> instead of deprecatedDeleteAllValues
        https://bugs.webkit.org/show_bug.cgi?id=73757

        Reviewed by Brent Fulgham.

        * wtf/Vector.h:
        (WTF::deprecatedDeleteAllValues): Deleted.

2014-04-17  Darin Adler  <darin@apple.com>

        Add separate flag for IndexedDatabase in workers since the current implementation is not threadsafe
        https://bugs.webkit.org/show_bug.cgi?id=131785
        rdar://problem/16003108

        Reviewed by Brady Eidson.

        * wtf/FeatureDefines.h: Added INDEXED_DATABASE_IN_WORKERS.

2014-04-16  Simon Fraser  <simon.fraser@apple.com>

        Don't include CryptographicallyRandomNumber.h in StringImpl.h
        https://bugs.webkit.org/show_bug.cgi?id=131772

        Reviewed by Sam Weinig.

        * wtf/text/StringImpl.h:

2014-04-16  Gavin Barraclough  <barraclough@apple.com>

        Update to pthread QoS SPI
        https://bugs.webkit.org/show_bug.cgi?id=131753

        Rubber stamped by Benjamin Poulain

        * wtf/ThreadingPthreads.cpp:
        (WTF::setCurrentThreadQOSUtility):

2014-04-14  Geoffrey Garen  <ggaren@apple.com>

        WTF should have an optional mbmalloc target so we can benchmark FastMalloc
        https://bugs.webkit.org/show_bug.cgi?id=131662

        Reviewed by Darin Adler.

        * WTF.xcodeproj/project.pbxproj: Added the target.
        * wtf/mbmalloc.cpp: Added. Implements the libmbmalloc.dylib API required
        by MallocBench.

2014-04-16  Darin Adler  <darin@apple.com>

        Make Vector::takeLast work with move-only types (and optimize for types where move is faster)
        https://bugs.webkit.org/show_bug.cgi?id=131735

        Reviewed by Alexey Proskuryakov.

        * wtf/Vector.h:
        (WTF::Vector::takeLast): Added a missing std::move. All the other take functions have it.

2014-04-14  Mark Lam  <mark.lam@apple.com>

        monotonicallyIncreasingTime() should only initialize its static timebaseInfo once.
        <https://webkit.org/b/131630>

        Reviewed by Filip Pizlo.

        The current initialization of the static field is not thread safe.

        * wtf/CurrentTime.cpp:
        (WTF::monotonicallyIncreasingTime):

2014-04-14  Benjamin Poulain  <benjamin@webkit.org>

        [JSC] Improve the call site of string comparison in some hot path
        https://bugs.webkit.org/show_bug.cgi?id=131605

        Reviewed by Darin Adler.

        * wtf/text/StringImpl.cpp:
        (WTF::stringImplContentEqual):
        Inline that function to reduce the call overhead for JSC.
        This is only inlined twice, it is not catastrophic for our binary.

2014-04-13  Andy Estes  <aestes@apple.com>

        Relax adoption requirements of RefCounted objects that are NeverDestroyed
        https://bugs.webkit.org/show_bug.cgi?id=131593

        Reviewed by Dan Bernstein.

        RefCounted objects that are created by NeverDestroyed<> won't have a
        RefPtr adopting them, so call relaxAdoptionRequirements().

        * wtf/NeverDestroyed.h:
        (WTF::NeverDestroyed::NeverDestroyed):
        (WTF::NeverDestroyed::MaybeRelax::MaybeRelax):

2014-04-10  Brent Fulgham  <bfulgham@apple.com>

        [Win] Clean up some 64-bit warnings from Visual Studio analyzer
        https://bugs.webkit.org/show_bug.cgi?id=131514

        Reviewed by Tim Horton.

        * WTF.vcxproj/WTF.vcxproj: Use correct platform settings for
        64-bit build.
        * config.h: Ditto.
        * wtf/CurrentTime.cpp:
        (WTF::highResUpTime): Resolve warning about deprecated API.
        * wtf/StackBounds.cpp:
        (WTF::StackBounds::initialize): Silence warning about
        an uninitialized variable.

2014-04-09  Geoffrey Garen  <ggaren@apple.com>

        Rolled back in r166972.

        This time, we conditionally exclude linking against bmalloc in Production
        builds. Production builds will not be able to link against bmalloc
        until the Production build system has been updated to build bmalloc.

            WTF should link against bmalloc
            https://bugs.webkit.org/show_bug.cgi?id=131403

            Reviewed by Mark Rowe.

            * Configurations/WTF.xcconfig:
            * WTF.xcodeproj/project.pbxproj:

2014-04-09  Geoffrey Garen  <ggaren@apple.com>

        Put bmalloc headers in the right place
        https://bugs.webkit.org/show_bug.cgi?id=131464

        Reviewed by Mark Rowe.

        * wtf/FastMalloc.cpp: Use "<bmalloc/...>" syntax so we can find our
        headers in <header-root>/usr/local/include/bmalloc/.

2014-04-09  Geoffrey Garen  <ggaren@apple.com>

        Rolled back out r166972.

        The production buildbots are still broken because the build-root script
        doesn't build bmalloc.

        * WTF.xcodeproj/project.pbxproj:

2014-04-09  Geoffrey Garen  <ggaren@apple.com>

        Rolled back in r166972.

        The iOS buildbot's scripts have been updated to build bmalloc, so the
        build should now succeed on the bot.

        Also renamed "Frameworks" to "Libraries" as suggested in a review comment.

            WTF should link against bmalloc
            https://bugs.webkit.org/show_bug.cgi?id=131403

            Reviewed by Michael Saboff.

            This is required to build successfullly with bmalloc enabled.

            * WTF.xcodeproj/project.pbxproj:

2014-04-08  Geoffrey Garen  <ggaren@apple.com>

        Stop linking WTF against bmalloc.

        Reviewed by Enrica Casucci.

        This seems to have broken an iOS buildbot script. Disable it for now
        until we can fix the script.

        * WTF.xcodeproj/project.pbxproj:

2014-04-08  Geoffrey Garen  <ggaren@apple.com>

        WTF should link against bmalloc
        https://bugs.webkit.org/show_bug.cgi?id=131403

        Reviewed by Michael Saboff.

        This is required to build successfullly with bmalloc enabled.

        * WTF.xcodeproj/project.pbxproj:

2014-04-08  Geoffrey Garen  <ggaren@apple.com>

        Added a bmalloc back-end for FastMalloc
        https://bugs.webkit.org/show_bug.cgi?id=131387

        Reviewed by Andreas Kling.

        We'll need to rethink some things if we adopt this back-end. For example,
        fastMallocSize() and fastMallocGoodSize() are no longer real things. But,
        this is enough to test for now.

        * wtf/FastMalloc.cpp:
        (WTF::fastMalloc):
        (WTF::fastCalloc):
        (WTF::fastRealloc):
        (WTF::fastFree):
        (WTF::fastMallocSize):
        (WTF::fastMallocGoodSize):
        (WTF::tryFastMalloc):
        (WTF::tryFastRealloc):
        (WTF::tryFastCalloc):
        (WTF::releaseFastMallocFreeMemory):
        (WTF::fastMallocStatistics):

2014-04-08  Andres Gomez  <agomez@igalia.com>

        [GTK] [EFL] Build fails with GCC < 4.8.x
        https://bugs.webkit.org/show_bug.cgi?id=130585

        Reviewed by Martin Robinson.

        The behavior in lower versions of GCC seem to be related to
        http://www.open-std.org/jtc1/sc22/wg21/docs/lwg-active.html#2132.

        Provided explicit casts for the failing ambiguous overloads.

        * wtf/gtk/MainThreadGtk.cpp:
        (WTF::scheduleDispatchFunctionsOnMainThread):
        * wtf/gtk/RunLoopGtk.cpp:
        (WTF::RunLoop::wakeUp): Provided lambda with a RefPtr instead of
        ref and de-referring.

2014-04-04  Mark Lam  <mark.lam@apple.com>

        Date object needs to check for ES5 15.9.1.14 TimeClip limit.
        <https://webkit.org/b/131248>

        Reviewed by Mark Hahnenberg.

        * wtf/DateMath.cpp:
        - Moved the definition of maxECMAScriptTime to the .h file so that we
          can use it in other files as well.
        (WTF::msToYear):
        - Removed a stale comment for parseDateFromNullTerminatedCharacters().
        * wtf/DateMath.h:

2014-04-04  Mark Hahnenberg  <mhahnenberg@apple.com>

        Enhanced GC logging
        https://bugs.webkit.org/show_bug.cgi?id=131246

        Reviewed by Geoff Garen.

        Remove OBJECT_MARK_LOGGING

        * wtf/FeatureDefines.h:
        * wtf/Platform.h:

2014-04-03  Zsolt Borbely  <zsborbely.u-szeged@partner.samsung.com>

        [EFL] Enable CSS JIT again, it works fine after r166666.

        Reviewed by Csaba Osztrogonác.

        * wtf/Platform.h:

2014-04-03  Javier Fernandez  <jfernandez@igalia.com>

        [GTK][Cmake] Enable CSS JIT
        https://bugs.webkit.org/show_bug.cgi?id=131022

        Reviewed by Martin Robinson.

        * wtf/Platform.h: Enable CSS JIT for GTK port.

2014-04-02  Frédéric Wang  <fred.wang@free.fr>

        Operator stretching: read the Open Type MATH table
        https://bugs.webkit.org/show_bug.cgi?id=130324

        Reviewed by Chris Fleizach.

        * wtf/Platform.h: enable OPENTYPE_MATH on platforms that can read OpenType tables.

2014-04-02  Alex Christensen  <achristensen@webkit.org>

        [WinCairo] Build fix with GMainLoopSource.
        https://bugs.webkit.org/show_bug.cgi?id=131089

        Reviewed by Carlos Garcia Campos.

        * wtf/gobject/GMainLoopSource.cpp:
        Only compile if glib is used, which fixes compile errors with video disabled in WinCairo.
        * wtf/gobject/GMainLoopSource.h:
        Export the GMainLoopSource functions to WTF.dll to link with where they are called in the GStreamer code.
        Also removed spaces to appease style bot.

2014-04-01  Zsolt Borbely  <zsborbely.u-szeged@partner.samsung.com>

        [EFL] REGRESSION(166569): It made DoYouEvenBench/Full.html, CSS/QuerySelector.html and Dromaeo performance tests crash
        https://bugs.webkit.org/show_bug.cgi?id=131039

        Reviewed by Csaba Osztrogonác.

        * wtf/Platform.h: Disable CSS JIT on EFL until proper fix.

2014-04-01  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r166583.
        https://bugs.webkit.org/show_bug.cgi?id=131040

        It's causing frequent crashes when running Layout Tests
        (Requested by svillar on #webkit).

        Reverted changeset:

        "[GTK][Cmake] Enable CSS JIT"
        https://bugs.webkit.org/show_bug.cgi?id=131022
        http://trac.webkit.org/changeset/166583

2014-04-01  Javier Fernandez  <jfernandez@igalia.com>

        [GTK][Cmake] Enable CSS JIT
        https://bugs.webkit.org/show_bug.cgi?id=131022

        Reviewed by Martin Robinson.

        * wtf/Platform.h: Enable CSS JIT for GTK port.

2014-04-01  Gyuyoung Kim  <gyuyoung.kim@samsung.com>

        [CMake][EFL] Enable CSS JIT
        https://bugs.webkit.org/show_bug.cgi?id=131010

        Reviewed by Benjamin Poulain.

        * wtf/Platform.h: Enable CSS JIT for EFL port.

2014-03-31  Dean Jackson  <dino@apple.com>

        Remove WEB_ANIMATIONS
        https://bugs.webkit.org/show_bug.cgi?id=130989

        Reviewed by Simon Fraser.

        Remove this feature flag until we plan to implement.

        * wtf/FeatureDefines.h:

2014-03-31  Alex Christensen  <achristensen@webkit.org>

        Preparation for using Soup on Windows.
        https://bugs.webkit.org/show_bug.cgi?id=130615

        Reviewed by Carlos Garcia Campos.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        Add all gobject source files in WinCairo build.
        * wtf/gobject/GRefPtr.h:
        Export refGPtr and derefGPtr overloads in WTF.dll to fix linker errors with WebKit.dll when using soup.

2014-03-31  Zan Dobersek  <zdobersek@igalia.com>

        Use std::unique_ptr in WTF::CompressedVector, WTF::GenericCompressedData
        https://bugs.webkit.org/show_bug.cgi?id=130737

        Switch to using std::unique_ptr instead of OwnPtr and PassOwnPtr
        for the CompressedVector and GenericCompressedData classes.

        * wtf/Compression.cpp:
        (WTF::GenericCompressedData::create):
        * wtf/Compression.h:
        (WTF::CompressedVector::create):
        (WTF::CompressibleVector::decompressIfNecessary):

2014-03-28  Alexey Proskuryakov  <ap@apple.com>

        [Mac] Enable async text input implementation
        https://bugs.webkit.org/show_bug.cgi?id=130856

        Reviewed by Sam Weinig.

        * wtf/Platform.h: Added a USE macro definition.

2014-03-28  peavo@outlook.com  <peavo@outlook.com>

        Null pointer crash in String::append(UChar).
        https://bugs.webkit.org/show_bug.cgi?id=130900

        Reviewed by Michael Saboff.

        * wtf/text/WTFString.cpp:
        (WTF::String::append): Check and initialize m_impl member first, to avoid null pointer crash.

2014-03-27  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r166360.
        https://bugs.webkit.org/show_bug.cgi?id=130869

        Seems to have broken PLT (Requested by ap on #webkit).

        Reverted changeset:

        "Connection::dispatchOneMessage() can be re-entered while
        handling Cmd-key menu"
        https://bugs.webkit.org/show_bug.cgi?id=130767
        http://trac.webkit.org/changeset/166360

2014-03-27  Alexey Proskuryakov  <ap@apple.com>

        Connection::dispatchOneMessage() can be re-entered while handling Cmd-key menu
        equivalents, ASSERT(!_data->_keyDownEventBeingResent)
        https://bugs.webkit.org/show_bug.cgi?id=130767
        <rdar://problem/16307487>

        Reviewed by Darin Adler.

        Changed RunLoop to wake up and fire timers only in default run loop mode by default,
        and added an ability to add more modes (can't use AppKit symbols in WTF).

        In addition to this bug, the change also blocks modal alerts from appearing under
        menus during menu tracking.

        * wtf/RunLoop.h:
        * wtf/cf/RunLoopCF.cpp:
        (WTF::RunLoop::RunLoop):
        (WTF::RunLoop::addModeForWakeUpAndTimers):
        (WTF::RunLoop::TimerBase::start):

2014-03-26  Zan Dobersek  <zdobersek@igalia.com>

        Unreviewed. Removing the remaining Automake cruft.

        * GNUmakefile.list.am: Removed.

2014-03-25  Martin Robinson  <mrobinson@igalia.com>

        [GTK] Remove the autotools build
        https://bugs.webkit.org/show_bug.cgi?id=130717

        Reviewed by Anders Carlsson.

        * GNUmakefile.am: Removed.
        * config.h: Removed references to the autotools configure file.

2014-03-25  Gabor Rapcsanyi  <rgabor@webkit.org>

        [ARM64] GCC generates wrong code with -O2 flag in WTF::weakCompareAndSwap
        https://bugs.webkit.org/show_bug.cgi?id=130500

        Reviewed by Filip Pizlo.

        Set the first operand to the exact register in the inline assembly with GCC.

        * wtf/Atomics.h:
        (WTF::weakCompareAndSwap):

2014-03-25  Gabor Rapcsanyi  <rgabor@webkit.org>

        [EFL] Add ARM64 build support
        https://bugs.webkit.org/show_bug.cgi?id=130506

        Rubber stamped by Gyuyoung Kim.

        * wtf/Platform.h: Set WTF_CPU_ARM64 when __aarch64__ is defined.

2014-03-24  Andy Estes  <aestes@apple.com>

        Fix the iOS build.

        * wtf/ThreadingPthreads.cpp:
        (WTF::createThreadInternal):
        (WTF::setCurrentThreadQOSUtility):

2014-03-24  Gavin Barraclough  <barraclough@apple.com>

        Add support for thread QoS
        https://bugs.webkit.org/show_bug.cgi?id=130688

        Speculative EFL build fix.

        * wtf/ThreadingPthreads.cpp:
        (WTF::setCurrentThreadQOSUtility):

2014-03-24  Gavin Barraclough  <barraclough@apple.com>

        Add support for thread QoS
        https://bugs.webkit.org/show_bug.cgi?id=130688

        Reviewed by Andreas Kling.

        * wtf/FastMalloc.cpp:
        (WTF::TCMalloc_PageHeap::runScavengerThread):
            - block freeing is a utility activity.
        * wtf/Threading.h:
            - declaration.
        * wtf/ThreadingPthreads.cpp:
        (WTF::createThreadInternal):
            - default to interactive.
        (WTF::setCurrentThreadQOSUtility):
            - implementation.
        * wtf/ThreadingWin.cpp:
        (WTF::setCurrentThreadQOSUtility):
            - no-op implementation.

2014-03-23  Hyowon Kim  <hw1008.kim@samsung.com>

        Move all EFL typedefs into EflTypedefs.h.
        https://bugs.webkit.org/show_bug.cgi?id=130511

        Reviewed by Gyuyoung Kim.

        * wtf/Platform.h: include EflTypedefs.h.
        * wtf/efl/EflTypedefs.h: Added.
        * wtf/efl/RefPtrEfl.h: Remove EFL typedefs.

2014-03-22  Darin Adler  <darin@apple.com>

        Remove String::deprecatedCharacters
        https://bugs.webkit.org/show_bug.cgi?id=126854

        Reviewed by Sam Weinig.

        * wtf/text/StringBuilder.cpp:
        (WTF::StringBuilder::reifyString): Removed code to update 16-bit shadow.

        * wtf/text/StringBuilder.h: Removed deprecatedCharacters.
        (WTF::StringBuilder::StringBuilder): Removed m_valid16BitShadowLength.
        (WTF::StringBuilder::clear): Removed code to clear m_valid16BitShadowLength.
        (WTF::StringBuilder::swap): Removed code to swap m_valid16BitShadowLength.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::~StringImpl): Removed code to free m_copyData16.
        (WTF::StringImpl::upper): Use StringView::upconvertedCharacters for slow case.
        (WTF::StringImpl::lower): Ditto.
        (WTF::StringImpl::find): Use characters8/16 rather than deprecatedCharacters.
        Added an 8-bit code path to one of the overloads. Might want to revisit later
        to decide whether to use templates instead of copy/paste, or even use StringView
        to cut down on duplicate code paths.
        (WTF::StringImpl::findIgnoringCase): Ditto.
        (WTF::StringImpl::sizeInBytes): Remove code to handle has16BitShadow case.
        (WTF::equalIgnoringNullity): Added. To be called by the Vector template in the header.

        * wtf/text/StringImpl.h: Removed deprecatedCharacters, has16BitShadow,
        upconvertCharacters, getData16SlowCase, s_hashFlagHas16BitShadow, and m_copyData16.
        (WTF::equalIgnoringNullity): Changed the template function into an inline that calls
        a non-inline helper function. The non-inline function handles both 8-bit and 16-bit
        strings.

        * wtf/text/StringView.h:
        (WTF::StringView::StringView): Added an overload so we can make one of these directly
        from a StringImpl without first wrapping it in a string. Added an adapter so we can
        use StringView as part of string concatenation. Added an append function so we can
        append to a Vector<UChar>.

        * wtf/text/WTFString.cpp:
        (WTF::String::append): Use StringView::getCharactersWithUpconvert. Also changed
        single-character append so it won't always turn an 8-bit string into a 16-bit one.
        (WTF::String::insert): Removed one insert overload and changed the other to use
        StringView::getCharactersWithUpconvert.
        (WTF::String::truncate): Changed to use StringImpl::substring.
        (WTF::String::percentage): Added characters8/16 paths instead of using
        deprecatedCharacters.

        * wtf/text/WTFString.h: Removed deprecatedCharacters, getCharactersWithUpconvert,
        insert(UChar*, unsigned, unsigned), and the append overload for Vector<UChar>.

2014-03-20  Darin Adler  <darin@apple.com>

        Fix a header guard mistake (harmless but clearly wrong)
        https://bugs.webkit.org/show_bug.cgi?id=130559

        Reviewed by Andreas Kling.

        * wtf/text/StringConcatenate.h: Correct the macro name in the header guard.

2014-03-20  Hyowon Kim  <hw1008.kim@samsung.com>

        Move to using std::unique_ptr for EFL objects.
        https://bugs.webkit.org/show_bug.cgi?id=129853

        Reviewed by Gyuyoung Kim.

        EflUniquePtr is a template alias of std::unique_ptr
        with a custom deleter for each Efl Objects, which is motivated by GUniquePtr.
        This patch replaces uses of OwnPtr and PassOwnPtr for Efl objects with EflUniquePtr.

        * wtf/OwnPtrCommon.h:
        * wtf/PlatformEfl.cmake:
        * wtf/RunLoop.h:
        * wtf/efl/MainThreadEfl.cpp:
        (WTF::pipeObject):
        (WTF::initializeMainThreadPlatform):
        * wtf/efl/OwnPtrEfl.cpp: Removed.
        * wtf/efl/RunLoopEfl.cpp:
        (WTF::RunLoop::RunLoop):
        * wtf/efl/UniquePtrEfl.h: Added.
        (WTF::EflPtrDeleter::operator()):

2014-03-20  Gavin Barraclough  <barraclough@apple.com>

        Remove IdentifierTable typedef, isIdentifier()
        https://bugs.webkit.org/show_bug.cgi?id=130533

        Rubber stamped by Geoff Garen.

        Code should use AtomicStringTable, isAtomic() directly.

        * wtf/WTFThreadData.h:
        (WTF::WTFThreadData::setCurrentAtomicStringTable):
        (WTF::WTFThreadData::resetCurrentAtomicStringTable):
            - removed IdentifierTypedef.
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::flagIsAtomic):
            - renamed flagIsIdentfier -> flagIsAtomic.

2014-03-20  Gavin Barraclough  <barraclough@apple.com>

        Merge AtomicString, Identifier
        https://bugs.webkit.org/show_bug.cgi?id=128624

        Reviewed by Geoff Garen.

        WTF::StringImpl currently supports two uniquing mechanism - AtomicString and
        Identifer - that is one too many.

        Remove Identifier in favour of AtomicString. Identifier had two interesting
        mechanisms that we preserve.

        (1) JSC API VMs each get their own string table, switch the string table on
            API entry/exit.
        (2) JSC caches a pointer to the string table on the VM to avoid a thread
            specific access. Adds a new AtomicString::add method to support this.

        * wtf/WTFThreadData.cpp:
        (WTF::WTFThreadData::WTFThreadData):
            - remove allocation of IdentifierTable.
        (WTF::WTFThreadData::~WTFThreadData):
            - remove deletion of IdentifierTable.
        * wtf/WTFThreadData.h:
        (WTF::WTFThreadData::atomicStringTable):
            - table is now switched by JSC API, return the current table.
        (WTF::WTFThreadData::currentIdentifierTable):
            - now returns the current AtomicStringTable.
        (WTF::WTFThreadData::setCurrentIdentifierTable):
            - now sets the current AtomicStringTable.
        (WTF::WTFThreadData::resetCurrentIdentifierTable):
            - now resets the AtomicStringTable.
        * wtf/text/AtomicString.cpp:
        (WTF::AtomicString::addSlowCase):
            - add without thread-specific access to access string table.
        * wtf/text/AtomicString.h:
        (WTF::AtomicString::addWithStringTableProvider):
            - add without thread-specific access (used by JSC, string table provided by VM or ExecState).
        * wtf/text/AtomicStringTable.cpp:
        (WTF::AtomicStringTable::create):
            - renamed m_atomicStringTable -> m_defaultAtomicStringTable.
        (WTF::AtomicStringTable::~AtomicStringTable):
        (WTF::AtomicStringTable::destroy):
            - clearing of table moved from AtomicStringTable::destroy to destructor.
        * wtf/text/AtomicStringTable.h:
            - added destructor.
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::~StringImpl):
            - Identifers no longer exist; no need to remove them from IdentifierTable.
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::StringImpl):
            - removed s_hashFlagIsIdentifier.
        (WTF::StringImpl::flagIsIdentifier):
            - s_hashFlagIsIdentifier -> s_hashFlagIsAtomic.
        (WTF::StringImpl::isIdentifier):
            - now synonymous to isAtomic().
        * wtf/text/StringStatics.cpp:
        (WTF::StringImpl::hashAndFlagsForEmptyUnique):
            - removed s_hashFlagIsIdentifier.

2014-03-20  Zan Dobersek  <zdobersek@igalia.com>

        Unreviewed Clang build fix for the GTK port after r165952.

        * wtf/gobject/GMainLoopSource.h: Include the <functional> header for the std::function<> objects.

2014-03-18  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GLIB] Add GMainLoopSource class to wrap idle and timeout sources
        https://bugs.webkit.org/show_bug.cgi?id=130027

        Reviewed by Martin Robinson.

        GLib main loop sources like idle and timeouts are sometimes
        unconvenient to use and it's very common to forget canceling the
        source when the object is destroyed or reset the source ID in the
        callback when called. GMainLoopSource is a wrapper class to make it
        easier to handle sources and also to avoid those typical mistakes.
        It forces to create sources with a name and the user doesn't have
        to deal with the source ID anymore. The source is cancelled when
        the object is deleted or when a new source is scheduled. It uses
        std::function for callbacks so that we no longer need to use the
        "proxy" static callbacks either. We can use std::bind to use a
        function pointer or a member or even lambda functions. It also handles
        repeating sources automatically depending on whether the given
        function returns a bool or not.

        * GNUmakefile.list.am:
        * wtf/PlatformEfl.cmake:
        * wtf/PlatformGTK.cmake:
        * wtf/RunLoop.h:
        * wtf/gobject/GMainLoopSource.cpp: Added.
        (WTF::GMainLoopSource::createAndDeleteOnDestroy):
        (WTF::GMainLoopSource::GMainLoopSource):
        (WTF::GMainLoopSource::~GMainLoopSource):
        (WTF::GMainLoopSource::cancel):
        (WTF::GMainLoopSource::reset):
        (WTF::GMainLoopSource::scheduleIdleSource):
        (WTF::GMainLoopSource::schedule):
        (WTF::GMainLoopSource::scheduleTimeoutSource):
        (WTF::GMainLoopSource::scheduleAfterDelay):
        (WTF::GMainLoopSource::voidCallback):
        (WTF::GMainLoopSource::boolCallback):
        (WTF::GMainLoopSource::socketCallback):
        (WTF::GMainLoopSource::destroy):
        (WTF::GMainLoopSource::voidSourceCallback):
        (WTF::GMainLoopSource::boolSourceCallback):
        (WTF::GMainLoopSource::socketSourceCallback):
        * wtf/gobject/GMainLoopSource.h: Added.
        (WTF::GMainLoopSource::isScheduled):
        * wtf/gtk/MainThreadGtk.cpp:
        (WTF::scheduleDispatchFunctionsOnMainThread):
        * wtf/gtk/RunLoopGtk.cpp:
        (WTF::RunLoop::wakeUp):
        (WTF::RunLoop::TimerBase::TimerBase):
        (WTF::RunLoop::TimerBase::start):
        (WTF::RunLoop::TimerBase::stop):
        (WTF::RunLoop::TimerBase::isActive):

2014-03-19  Gavin Barraclough  <barraclough@apple.com>

        https://bugs.webkit.org/show_bug.cgi?id=130494
        EmptyUnique strings are Identifiers/Atomic

        Reviewed by Geoff Garen.

        EmptyUnique strings should set the Identifier/Atomic flag.

        * wtf/text/AtomicString.h:
        (WTF::AtomicString::add):
            - Previously we assumed the only StringImpl that was validly allowed to claim to be
              Atomic but not be in a table was the canonical empty string. Now that EmptyUniques
              are also marked Atomic, all empty strings may pass this condition.
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::~StringImpl):
            - EmptyUnique strings are not in the Atomic/Identfiier tabels, so don't need removing.
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::StringImpl):
            - Change EmptyUnique constructor to call hashAndFlagsForEmptyUnique.
        * wtf/text/StringStatics.cpp:
        (WTF::StringImpl::hashAndFlagsForEmptyUnique):
            - Allocate a sequential hash code (this should be just as good for distribution & better
              for debugging than the random value) and set flags, now including Atomic & Identifier.

2014-03-19  Gavin Barraclough  <barraclough@apple.com>

        Small cleanup of empty string
        https://bugs.webkit.org/show_bug.cgi?id=130438

        Reviewed by Anders Carlson.

        The empty string is weird becuase it is used as the impl for an AtomicString, but isAtomic()
        returns false.
        Also, we set a valid pointer for the characters pointer due to an old PCRE bug; remove this.
        Also, we currently only create one 'static' string, the empty string. Adding more might break
        assumtions, inhibit the constructor from being used to create other static strings for now.

        * wtf/text/AtomicString.h:
        (WTF::AtomicString::add):
            - update assert.
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::StringImpl):
            - Merge ConstructStaticString constructors, only allow the empty static string to be constructed.
        * wtf/text/StringStatics.cpp:
        (WTF::StringImpl::empty):
            - ConstructStaticString -> ConstructEmptyString, remove arguments, DEPRECATED_DEFINE_STATIC_LOCAL -> NeverDestroyed.

2014-03-18  Darin Adler  <darin@apple.com>

        Reduce use of deprecatedCharacters in WebCore
        https://bugs.webkit.org/show_bug.cgi?id=130318

        Reviewed by Andreas Kling.

        * wtf/text/WTFString.h: Export another overload of charactersToFloat since it's used
        in WebCore now.

        * wtf/text/cf/StringViewCF.cpp: Change so this can build on Windows.

        * WTF.vcxproj/WTF.vcxproj: Added StringViewCF.cpp.
        * WTF.vcxproj/WTF.vcxproj.filters: Added StringViewCF.cpp.

2014-03-18  Filip Pizlo  <fpizlo@apple.com>

        More FTL enabling.

        Rubber stamped by Dan Bernstein and Mark Hahnenberg.

        * wtf/Platform.h:

2014-03-17  Darin Adler  <darin@apple.com>

        Remove most uses of deprecatedCharacter in WTF
        https://bugs.webkit.org/show_bug.cgi?id=130317

        Reviewed by Andreas Kling.

        Re-landing after fixing the "80 instead of 0x80" typo in equalLatin1WithUTF8.

        * wtf/text/AtomicString.cpp:
        (WTF::HashAndUTF8CharactersTranslator::equal): Add an 8-bit code path to the
        non-ASCII path.
        (WTF::SubstringTranslator8::hash): Added.
        (WTF::SubstringTranslator8::equal): Added.
        (WTF::SubstringTranslator16::hash): Renamed class.
        (WTF::SubstringTranslator16::equal): Ditto.
        (WTF::AtomicString::add): Added an 8-bit code path to the substring case.

        * wtf/text/Base64.cpp:
        (WTF::base64Decode): Added an 8 bit code path.
        (WTF::base64URLDecode): Ditto.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::find): Fixed a case that was incorrectly using characters16
        without first using is8Bit. Need to return later to remove use of deprecatedCharacters.

        * wtf/unicode/UTF8.cpp:
        (WTF::Unicode::equalUTF16WithUTF8): Added a case for when the UTF-16 characters
        are ASCII. Also removed the aEnd argument, since the caller only calls this when the
        lengths are equal.
        (WTF::Unicode::equalLatin1WithUTF8): Added.
        * wtf/unicode/UTF8.h: Updated as described above.

2014-03-17  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r165721.
        https://bugs.webkit.org/show_bug.cgi?id=130367

        It makes the debug bots flaky (Requested by benjaminp on
        #webkit).

        Reverted changeset:

        "Remove most uses of deprecatedCharacter in WTF"
        https://bugs.webkit.org/show_bug.cgi?id=130317
        http://trac.webkit.org/changeset/165721

2014-03-17  Zan Dobersek  <zdobersek@igalia.com>

        Use RunLoop objects through references instead of pointers
        https://bugs.webkit.org/show_bug.cgi?id=130313

        Reviewed by Andreas Kling.

        Make RunLoop::current() and RunLoop::main() return a RunLoop reference instead
        of a pointer. RunLoop::Holder now uses a Ref<RunLoop> member. Timer and TimerBase
        constructors take in a RunLoop reference, with TimerBase now storing a RunLoop
        reference member instead of a pointer. Platform-specific bits of the RunLoop
        class are updated accordingly.

        * wtf/RunLoop.cpp:
        (WTF::RunLoop::Holder::Holder):
        (WTF::RunLoop::Holder::runLoop):
        (WTF::RunLoop::initializeMainRunLoop):
        (WTF::RunLoop::current):
        (WTF::RunLoop::main):
        (WTF::RunLoop::isMain):
        * wtf/RunLoop.h:
        (WTF::RunLoop::Timer::Timer):
        * wtf/cf/RunLoopCF.cpp:
        (WTF::RunLoop::run):
        (WTF::RunLoop::TimerBase::TimerBase):
        (WTF::RunLoop::TimerBase::start):
        * wtf/efl/RunLoopEfl.cpp:
        (WTF::RunLoop::TimerBase::TimerBase):
        * wtf/gtk/RunLoopGtk.cpp:
        (WTF::RunLoop::run):
        (WTF::RunLoop::TimerBase::TimerBase):
        (WTF::RunLoop::TimerBase::start):
        * wtf/win/RunLoopWin.cpp:
        (WTF::RunLoop::TimerBase::TimerBase):
        (WTF::RunLoop::TimerBase::start):
        (WTF::RunLoop::TimerBase::stop):
        (WTF::RunLoop::TimerBase::isActive):

2014-03-17  Tamas Gergely  <tgergely.u-szeged@partner.samsung.com>

        One more fix after r165725.

        Reviewed by Csaba Osztrogonác.

        * wtf/WTFThreadData.h:

2014-03-17  Tamas Gergely  <tgergely.u-szeged@partner.samsung.com>

        Buildfix after r165725 for non Mac platforms.

        Reviewed by Csaba Osztrogonác.

        * wtf/WTFThreadData.h:

2014-03-17  Andreas Kling  <akling@apple.com>

        [Mac] WTFThreadData should use _pthread_getspecific_direct().
        <https://webkit.org/b/130320>

        Hack WTFThreadData to use a direct key for TLS access when available.
        This mechanism uses a dedicated segment register and is the same way
        we implement the fast path in FastMalloc.

        Reviewed by Darin Adler.

        * wtf/FastMalloc.cpp:
        * wtf/WTFThreadData.cpp:
        (WTF::WTFThreadData::createAndRegisterForGetspecificDirect):
        * wtf/WTFThreadData.h:
        (WTF::wtfThreadData):

2014-03-16  Darin Adler  <darin@apple.com>

        Remove most uses of deprecatedCharacter in WTF
        https://bugs.webkit.org/show_bug.cgi?id=130317

        Reviewed by Andreas Kling.

        * wtf/text/AtomicString.cpp:
        (WTF::HashAndUTF8CharactersTranslator::equal): Add an 8-bit code path to the
        non-ASCII path.
        (WTF::SubstringTranslator8::hash): Added.
        (WTF::SubstringTranslator8::equal): Added.
        (WTF::SubstringTranslator16::hash): Renamed class.
        (WTF::SubstringTranslator16::equal): Ditto.
        (WTF::AtomicString::add): Added an 8-bit code path to the substring case.

        * wtf/text/Base64.cpp:
        (WTF::base64Decode): Added an 8 bit code path.
        (WTF::base64URLDecode): Ditto.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::find): Fixed a case that was incorrectly using characters16
        without first using is8Bit. Need to return later to remove use of deprecatedCharacters.

        * wtf/unicode/UTF8.cpp:
        (WTF::Unicode::equalUTF16WithUTF8): Added a case for when the UTF-16 characters
        are ASCII. Also removed the aEnd argument, since the caller only calls this when the
        lengths are equal.
        (WTF::Unicode::equalLatin1WithUTF8): Added.
        * wtf/unicode/UTF8.h: Updated as described above.

2014-03-16  David Kilzer  <ddkilzer@apple.com>

        Follow-up: Fix undefined behavior in WTF::equal() in StringImpl.h for i386/x86_64
        <http://webkit.org/b/130283>
        <rdar://problem/16281477>

        Reviewed by Darin Adler.

        * wtf/text/StringImpl.h:
        (WTF::loadUnaligned): Restore behavior prior to r165681 for
        compilers other than clang.

2014-03-16  Darin Adler  <darin@apple.com>

        Remove all uses of deprecatedCharacters from JavaScriptCore
        https://bugs.webkit.org/show_bug.cgi?id=130304

        Reviewed by Anders Carlsson.

        * wtf/dtoa.h:
        (WTF::parseDouble): Added an overload that takes a StringView.

2014-03-15  Darin Adler  <darin@apple.com>

        Remove all uses of deprecatedCharacters from WebKit2
        https://bugs.webkit.org/show_bug.cgi?id=130197

        Reviewed by Andreas Kling.

        * wtf/text/StringView.h: Added new getCharactersWithUpconvert and upconvertedCharacters
        functions. These are useful for callers that need UTF-16.

2014-03-15  Darin Adler  <darin@apple.com>

        Try to fix EFL build.

        * wtf/ThreadingPthreads.cpp: (WTF::changeThreadPriority): Code in this function
        was setting the priority of the current thread instead of the passed-in thread.
        That was triggering an unused variable warning in the compiler used to build for
        EFL. Fixed by using the thread handle instead of pthread_self.

2014-03-15  Michael Saboff  <msaboff@apple.com>

        It should be possible to adjust DFG and FTL compiler thread priorities
        https://bugs.webkit.org/show_bug.cgi?id=130288

        Reviewed by Filip Pizlo.

        Added ability to change thread priorities relative to its current priority.
        Created options to adjust the priority of the DFG and FTL compilation work thread
        pools.  For two core systems, there might be three runnable threads, the main thread,
        the DFG compilation thread and the FTL compilation thread.  With the same priority,
        the scheduler is free to schedule whatever thread it wants.  By lowering the
        compilation threads, the main thread can run.  Further tests may suggest better values
        for the new options, priorityDeltaOfDFGCompilerThreads and priorityDeltaOfFTLCompilerThreads.

        For a two-core device, this change has a net positive improvement of 1-3% across
        SunSpider, Octane, Kraken and AsmBench.

        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::changeThreadPriority):
        * wtf/ThreadingWin.cpp:
        (WTF::changeThreadPriority):

2014-03-15  David Kilzer  <ddkilzer@apple.com>

        Fix undefined behavior in WTF::equal() in StringImpl.h for i386/x86_64
        <http://webkit.org/b/130283>
        <rdar://problem/16281477>

        Reviewed by Geoff Garen.

        * wtf/text/StringImpl.h:
        (WTF::loadUnaligned): Add template method.
        (WTF::equal): Switch to using loadUnaligned<>().

2014-03-14  Mark Rowe  <mrowe@apple.com>

        Fix the production build.

        Don't rely on USE_INTERNAL_SDK being set for the Production configuration since UseInternalSDK.xcconfig won't
        be at the expected relative path when working from installed source.

        * Configurations/Base.xcconfig:

2014-03-14  Maciej Stachowiak  <mjs@apple.com>

        Replace "Apple Computer, Inc." with "Apple Inc." in copyright headers
        https://bugs.webkit.org/show_bug.cgi?id=130276
        <rdar://problem/16266927>
        
        Reviewed by Simon Fraser.

        * wtf/ASCIICType.h:
        * wtf/AVLTree.h:
        * wtf/Assertions.cpp:
        * wtf/Assertions.h:
        * wtf/Atomics.cpp:
        * wtf/Atomics.h:
        * wtf/AutodrainedPool.h:
        * wtf/AutodrainedPoolMac.mm:
        * wtf/BoundsCheckedPointer.h:
        * wtf/CryptographicUtilities.cpp:
        * wtf/CryptographicallyRandomNumber.h:
        * wtf/CurrentTime.h:
        * wtf/Deque.h:
        * wtf/DisallowCType.h:
        * wtf/ExportMacros.h:
        * wtf/FeatureDefines.h:
        * wtf/GetPtr.h:
        * wtf/HashIterators.h:
        * wtf/Locker.h:
        * wtf/MainThread.cpp:
        * wtf/MainThread.h:
        * wtf/MathExtras.h:
        * wtf/MediaTime.cpp:
        * wtf/MediaTime.h:
        * wtf/MessageQueue.h:
        * wtf/MetaAllocator.cpp:
        * wtf/MetaAllocator.h:
        * wtf/MetaAllocatorHandle.h:
        * wtf/OSRandomSource.cpp:
        * wtf/OSRandomSource.h:
        * wtf/Platform.h:
        * wtf/RandomNumber.cpp:
        * wtf/RandomNumber.h:
        * wtf/RandomNumberSeed.h:
        * wtf/RedBlackTree.h:
        * wtf/RunLoopTimer.h:
        * wtf/RunLoopTimerCF.cpp:
        * wtf/SchedulePair.h:
        * wtf/SchedulePairCF.cpp:
        * wtf/SchedulePairMac.mm:
        * wtf/SegmentedVector.h:
        * wtf/StackBounds.h:
        * wtf/StaticConstructors.h:
        * wtf/StringExtras.h:
        * wtf/ThreadFunctionInvocation.h:
        * wtf/ThreadSafeRefCounted.h:
        * wtf/ThreadSpecific.h:
        * wtf/Threading.h:
        * wtf/ThreadingPrimitives.h:
        * wtf/ThreadingPthreads.cpp:
        * wtf/ThreadingWin.cpp:
        * wtf/WTFThreadData.cpp:
        * wtf/WTFThreadData.h:
        * wtf/efl/OwnPtrEfl.cpp:
        * wtf/mac/MainThreadMac.mm:
        * wtf/text/AtomicStringHash.h:
        * wtf/text/AtomicStringImpl.h:
        * wtf/text/Base64.h:
        * wtf/text/CString.cpp:
        * wtf/text/CString.h:
        * wtf/text/LChar.h:
        * wtf/text/cf/StringCF.cpp:
        * wtf/text/mac/StringMac.mm:
        * wtf/unicode/CharacterNames.h:
        * wtf/unicode/Collator.h:
        * wtf/unicode/CollatorDefault.cpp:
        * wtf/unicode/UTF8.cpp:
        * wtf/unicode/UTF8.h:
        * wtf/unicode/icu/CollatorICU.cpp:
        * wtf/win/MainThreadWin.cpp:

2014-03-14  Byungseon Shin  <sun.shin@lge.com>

        Incorrect Date returned between March 1, 2034 and February 28, 2100.
        https://bugs.webkit.org/show_bug.cgi?id=130123

        Reviewed by Mark Lam.

        Fix logic by using predefined Date APIs.

        * wtf/DateMath.cpp:
        (WTF::ymdhmsToSeconds):

2014-03-12  Sergio Villar Senin  <svillar@igalia.com>

        Rename DEFINE_STATIC_LOCAL to DEPRECATED_DEFINE_STATIC_LOCAL
        https://bugs.webkit.org/show_bug.cgi?id=129612

        Reviewed by Darin Adler.

        For new code use static NeverDestroyed<T> instead.

        * wtf/RunLoop.cpp:
        (WTF::RunLoop::current):
        * wtf/StdLibExtras.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::threadMapMutex):
        (WTF::threadMap):
        * wtf/efl/MainThreadEfl.cpp:
        (WTF::pipeObject):
        * wtf/text/StringStatics.cpp:
        (WTF::StringImpl::empty):

2014-03-13  Radu Stavila  <stavila@adobe.com>

        Webkit not building on XCode 5.1 due to garbage collection no longer being supported
        https://bugs.webkit.org/show_bug.cgi?id=130087

        Reviewed by Mark Rowe.

        Disable garbage collection on macosx when not using internal SDK.

        * Configurations/Base.xcconfig:

2014-03-12  Ryuan Choi  <ryuan.choi@samsung.com>

        [EFL] Enable Parallel GC
        https://bugs.webkit.org/show_bug.cgi?id=130177

        Reviewed by Geoffrey Garen.

        * wtf/Platform.h: Turn on ENABLE_PARALLEL_GC for the EFL build.

2014-03-12  Joseph Pecoraro  <pecoraro@apple.com>

        Web Inspector: Disable REMOTE_INSPECTOR in earlier OS X releases
        https://bugs.webkit.org/show_bug.cgi?id=130118

        Reviewed by Timothy Hatcher.

        * wtf/FeatureDefines.h:

2014-03-11  Brent Fulgham  <bfulgham@apple.com>

        [Win] Unreviewed gardening.

        * wtf/MathExtras.h: VS2013 provides an lrint implementation. No need to implement
        our own.

2014-03-10  Jer Noble  <jer.noble@apple.com>

        Improve WeakPtr operators.
        https://bugs.webkit.org/show_bug.cgi?id=130053

        Reviewed by Andreas Kling.

        Replace the "operator!()" with an explicit bool operator.  Add an "operator->()".

        * wtf/WeakPtr.h:
        (WTF::WeakPtr::operator bool):
        (WTF::WeakPtr::operator->):

2014-03-10  Brent Fulgham  <bfulgham@apple.com>

        [Win] Pass environment to Pre-Build, Pre-Link, and Post-Build Stages.
        https://bugs.webkit.org/show_bug.cgi?id=130023.

        Reviewed by Dean Jackson.

        * WTF.vcxproj/WTF.proj: Avoid putting trailing slashes in system paths to avoid
        escaping during later string substitution.
        * WTF.vcxproj/build-generated-files.sh: Accept environment values passed by VS.

2014-03-10  Mark Hahnenberg  <mhahnenberg@apple.com>

        Turn on GenGC on other 64-bit platforms
        https://bugs.webkit.org/show_bug.cgi?id=129258

        Reviewed by Oliver Hunt.

        * wtf/Platform.h: 

2014-03-07  peavo@outlook.com  <peavo@outlook.com>

        [Win64] Compile error after r165128.
        https://bugs.webkit.org/show_bug.cgi?id=129807

        Reviewed by Mark Lam.

        * wtf/Platform.h: MSVC does not support computed goto.
        Also enabled COMPUTED_GOTO_OPCODES when !ENABLE(LLINT_C_LOOP). This is needed because the ASM LLINT operates like COMPUTED_GOTO_OPCODES,
        and relies on the related data structures being defined to support this. On Win32, the platform does not HAVE_COMPUTED_GOTO support,
        but does want ENABLE_COMPUTED_GOTO_OPCODES because it uses the ASM LLINT.

2014-03-06  Michael Saboff  <msaboff@apple.com>

        JSC should disable the JIT when building for ARMv7k
        https://bugs.webkit.org/show_bug.cgi?id=129829

        Reviewed by Oliver Hunt.

        Added WTF_CPU_APPLE_ARMV7K CPU define.  Disabled the JITs when
        that feature define is set.

        * wtf/Platform.h:

2014-03-06  Filip Pizlo  <fpizlo@apple.com>

        Use the LLVM disassembler on ARM64 if we are enabling the FTL
        https://bugs.webkit.org/show_bug.cgi?id=129785

        Reviewed by Geoffrey Garen.

        * wtf/Platform.h:

2014-03-05  peavo@outlook.com  <peavo@outlook.com>

        [Win32][LLINT] Crash when running JSC stress tests.
        https://bugs.webkit.org/show_bug.cgi?id=129429

        Reviewed by Geoffrey Garen.

        * wtf/Platform.h: Enable LLINT on Win32.

2014-03-04  Zan Dobersek  <zdobersek@igalia.com>

        [GTK] Build the Udis86 disassembler
        https://bugs.webkit.org/show_bug.cgi?id=129679

        Reviewed by Michael Saboff.

        * wtf/Platform.h: Also enable the Udis86 disassembler for the GTK port on Linux.

2014-03-02  Jaehun Lim  <ljaehun.lim@samsung.com>

        [EFL] Remove m_initEfl from RunLoop.
        https://bugs.webkit.org/show_bug.cgi?id=129568

        Reviewed by Gyuyoung Kim.

        We don't use m_initEfl except RunLoop constructor.

        * wtf/RunLoop.h:
        * wtf/efl/RunLoopEfl.cpp:
        (WTF::RunLoop::RunLoop):

2014-03-02  Darin Adler  <darin@apple.com>

        Cut down use of OwnPtr within WTF itself
        https://bugs.webkit.org/show_bug.cgi?id=129567

        Reviewed by Sam Weinig.

        * wtf/RefCounted.h: Removed OwnPtr includes.

        * wtf/StreamBuffer.h: Removed OwnPtr includes and switched to use
        std::make_unique and std::unique_ptr instead.

        * wtf/Threading.cpp: Removed OwnPtr includes.
        * wtf/ThreadingPthreads.cpp: Ditto.
        * wtf/Vector.h: Ditto.

2014-02-26  Gavin Barraclough  <barraclough@apple.com>

        FastMalloc should use vm_page_shift intead of PAGE_SHIFT.
        https://bugs.webkit.org/show_bug.cgi?id=129370

        Reviewed by Mark Rowe.

        "Doesn't this lead to the page map using fewer bits than it was before?
        It seems like this will cause some page addresses to no longer be
        representable in the map when using 4K pages. Am I missing something?"

        * wtf/FastMalloc.cpp:
            - bdash raises a valid point. This should make the TCMalloc_PageMap
              larger than absolutely necessary, rather than potentially too small.

2014-02-25  Gavin Barraclough  <barraclough@apple.com>

        FastMalloc should use vm_page_shift intead of PAGE_SHIFT.
        https://bugs.webkit.org/show_bug.cgi?id=129370

        Reviewed by Geoff Garen.

        Previously we used PAGE_SHIFT to initialize kPageShift.
        Since this was a constant, it could be used to calculate other
        contants used in the code. Some of these values are used in the
        definition of certain data structures (specifiying the length of
        some array members).

        Make kPageShift & dependent properties variables setup during
        initialization. Add upper bound values (K_PAGE_SHIFT_MAX,
        K_NUM_CLASSES_MAX) for use in cases where we need a constant.

        * wtf/FastMalloc.cpp:
        (WTF::InitSizeClasses):
            - initialize kPageShift, kNumClasses, kPageSize, kMaxValidPages.
        (WTF::pages):
            - added ASSERT.
        (WTF::AllocationSize):
            - added ASSERT.
        (WTF::TCMalloc_PageHeap::FreeBytes):
            - added ASSERT.
        (WTF::TCMalloc_PageHeap::init):
            - COMPILE_ASSERT -> ASSERT
        (WTF::TCMalloc_PageHeap::scavenge):
            - added ASSERT.
        (WTF::TCMalloc_PageHeap::Carve):
            - added ASSERT.
        (WTF::mergeDecommittedStates):
            - added ASSERT.
        (WTF::TCMalloc_PageHeap::IncrementalScavenge):
            - added ASSERT.
        (WTF::TCMalloc_PageHeap::ReturnedBytes):
            - added ASSERT.
        (WTF::PagesToMB):
            - added ASSERT.
        (WTF::TCMalloc_PageHeap::GrowHeap):
            - added ASSERT.
        (WTF::TCMalloc_PageHeap::ReleaseFreeList):
            - kNumClasses -> K_NUM_CLASSES_MAX
        (WTF::TCMalloc_ThreadCache::enumerateFreeObjects):
            - added ASSERT.
        (WTF::TCMalloc_Central_FreeList::Init):
            - added ASSERT.
        (WTF::TCMalloc_Central_FreeList::ReleaseToSpans):
            - added ASSERT.
        (WTF::TCMalloc_Central_FreeList::EvictRandomSizeClass):
            - added ASSERT.
        (WTF::TCMalloc_Central_FreeList::MakeCacheSpace):
            - added ASSERT.
        (WTF::TCMalloc_Central_FreeList::InsertRange):
            - added ASSERT.
        (WTF::TCMalloc_Central_FreeList::Populate):
            - added ASSERT.
        (WTF::TCMalloc_ThreadCache::Init):
            - added ASSERT.
        (WTF::TCMalloc_ThreadCache::Cleanup):
            - added ASSERT.
        (WTF::TCMalloc_ThreadCache::Scavenge):
            - added ASSERT.
        (WTF::TCMalloc_ThreadCache::CreateCacheIfNecessary):
            - added ASSERT.

2014-02-24  Alex Christensen  <achristensen@webkit.org>

        Disabled WebGL on WinCairo.

        Unreviewed.

        * wtf/FeatureDefines.h:
        Removed ENABLE_WEBGL definition for WinCairo port.
        WebGL has not worked on WinCairo since r163079
        and it was not compiling with a recent ANGLE update.

2014-02-24  Mark Hahnenberg  <mhahnenberg@apple.com>

        Turn GenGC on for 32-bit systems
        https://bugs.webkit.org/show_bug.cgi?id=128824

        Reviewed by Geoffrey Garen.

        * wtf/Platform.h:

2014-02-21  Benjamin Poulain  <benjamin@webkit.org>

        jsDocumentPrototypeFunctionGetElementById should not create an AtomicString for the function argument
        https://bugs.webkit.org/show_bug.cgi?id=128893

        Reviewed by Darin Adler.

        AtomicString::find() is a special case optimized for the JavaScript bindings. The method can only
        be called under specific conditions.
        The method is renamed to findStringWithHash().

        The new AtomicString::find is generic and does not require any propery on the input.

        * wtf/text/AtomicString.cpp:
        (WTF::AtomicString::findStringWithHash):
        (WTF::AtomicString::findSlowCase):
        * wtf/text/AtomicString.h:
        (WTF::AtomicString::find):

2014-02-20  Csaba Osztrogonác  <ossy@webkit.org>

        Add StackStats sources to cmake and autotools build files
        https://bugs.webkit.org/show_bug.cgi?id=129103

        Reviewed by Anders Carlsson.

        * GNUmakefile.list.am:
        * wtf/CMakeLists.txt:

2014-02-20  Csaba Osztrogonác  <ossy@webkit.org>

        Get rid of redundant Platform.h includes
        https://bugs.webkit.org/show_bug.cgi?id=128817

        Reviewed by Brent Fulgham.

        * wtf/Assertions.h:
        * wtf/Atomics.h:
        * wtf/ByteOrder.h:
        * wtf/DataLog.h:
        * wtf/DisallowCType.h:
        * wtf/DynamicAnnotations.h:
        * wtf/ExportMacros.h:
        * wtf/FastMalloc.h:
        * wtf/FlipBytes.h:
        * wtf/InlineASM.h:
        * wtf/PrintStream.h:
        * wtf/ProcessID.h:
        * wtf/Threading.h:
        * wtf/ThreadingPrimitives.h:

2014-02-19  Jon Honeycutt  <jhoneycutt@apple.com>

        Crash in WTF::StringBuilder::append()

        https://bugs.webkit.org/show_bug.cgi?id=125817
        <rdar://problem/15671883>

        Reviewed by Oliver Hunt.

        * wtf/text/StringBuilder.cpp:
        (WTF::expandedCapacity):
        Ensure that we return a new capacity of at least 'requiredLength' in
        the case where requiredLength is large. Also, use unsigned rather than
        size_t for the parameters and the return value, as callers pass
        unsigned arguments and treat the result as an unsigned int.

2014-02-19  Anders Carlsson  <andersca@apple.com>

        Add WTF_MAKE_FAST_ALLOCATED to more classes
        https://bugs.webkit.org/show_bug.cgi?id=129064

        Reviewed by Andreas Kling.

        * wtf/Bitmap.h:

2014-02-19  Zan Dobersek  <zdobersek@igalia.com>

        Make PrintStream::print() a variadic template
        https://bugs.webkit.org/show_bug.cgi?id=126388

        Reviewed by Brent Fulgham.

        PrintStream::print() can be converted into a variadic template, printing the value
        of the first parameter and recursively calling itself until the single parameter version
        is used for printing the last value.

        * wtf/DataLog.h:
        (WTF::dataLog): Convert the function to a variadic template as well.
        * wtf/PrintStream.h:
        (WTF::PrintStream::print):
        * wtf/StringPrintStream.h:
        (WTF::toCString): Ditto.
        (WTF::toString): Ditto.

2014-02-19  Zan Dobersek  <zdobersek@igalia.com>

        Use std::swap() in HashTable::swap()
        https://bugs.webkit.org/show_bug.cgi?id=128995

        Reviewed by Brent Fulgham.

        Use std::swap() to swap the member variable values of two HashTable objects in HashTable::swap().

        * wtf/HashTable.h:
        (WTF::KeyTraits>::swap):

2014-02-19  Zan Dobersek  <zdobersek@igalia.com>

        SegmentedVector::append() should take in rvalue reference, forward it to Vector::uncheckedAppend()
        https://bugs.webkit.org/show_bug.cgi?id=128996

        Reviewed by Brent Fulgham.

        * wtf/SegmentedVector.h:
        (WTF::SegmentedVector::append): Take in an rvalue reference of the object that's to be appended and
        then forward it to Vector::uncheckedAppend(). This avoids unnecessary copies in the current situation
        where a const lvalue is accepted and passed on.

2014-02-19  Dan Bernstein  <mitz@apple.com>

        Simplify PLATFORM(MAC) && !PLATFORM(IOS) and similar expressions
        https://bugs.webkit.org/show_bug.cgi?id=129029

        Reviewed by Mark Rowe.

        * wtf/FeatureDefines.h:
        * wtf/Platform.h:
        * wtf/Threading.cpp:
        * wtf/text/cf/StringImplCF.cpp:
        (garbageCollectionEnabled):

2014-02-18  Dan Bernstein  <mitz@apple.com>

        PLATFORM(MAC) is true when building for iOS
        https://bugs.webkit.org/show_bug.cgi?id=129025

        Reviewed by Mark Rowe.

        * wtf/Platform.h: Changed to define WTF_PLATFORM_MAC only on when building for OS X (but
        still not when WTF_PLATFORM_GTK or WTF_PLATFORM_EFL are defined).

2014-02-18  Joseph Pecoraro  <pecoraro@apple.com>

        [iOS] Web Inspector: JSContext inspection crashes in isMainThread, uninitialized WebCoreWebThreadIsLockedOrDisabled
        https://bugs.webkit.org/show_bug.cgi?id=128959

        Reviewed by David Kilzer.

        When JavaScriptCore is used without WebCore on iOS (e.g. JSContext)
        the WebCoreWebThread* functions will not be initialized. Avoid
        calling the function pointer if it is uninitialized. This was
        happening with remote inspection via StringImpl::createCFString
        for implicit NSString / WTFString conversion which uses isMainThread.

        * wtf/mac/MainThreadMac.mm:
        (WTF::webThreadIsUninitializedOrLockedOrDisabled):
        (WTF::isMainThread):
        (WTF::canAccessThreadLocalDataForThread):

2014-02-17  Filip Pizlo  <fpizlo@apple.com>

        More ARM FTL glue
        https://bugs.webkit.org/show_bug.cgi?id=128948

        Reviewed by Sam Weinig.

        * wtf/Platform.h:

2014-02-17  Anders Carlsson  <andersca@apple.com>

        Remove ENABLE_GLOBAL_FASTMALLOC_NEW
        https://bugs.webkit.org/show_bug.cgi?id=127067

        Reviewed by Geoffrey Garen.

        Remove the global operator new/operator delete overrides. Having ALWAYS_INLINE operators
        like we do is really undefined behavior according to the C++ standard and we've been lucky enough
        to get away with it so far, but any code that calls operator new/operator delete inside from the C++ standard
        library (not from headers that are included) will be mismatched and potentially crash. libc++ calls
        delete in it's std::thread implementation for example.
        
        The only supported way to override operator new and operator delete globally is to not use inline
        functions, but that would mean that any application using WebKit would not be able to provide custom
        operator new/operator delete functions so we'll just reuse the already existing infrastructure consisting
        of the WTF_MAKE_FAST_ALLOCATED macro.

        * wtf/FastMalloc.cpp:
        (WTF::TCMalloc_ThreadCache::CreateCacheIfNecessary):
        * wtf/FastMalloc.h:
        * wtf/Platform.h:

2014-02-17  Ryan Lortie  <desrt@desrt.ca>

        Enable DFG_JIT on FreeBSD
        https://bugs.webkit.org/show_bug.cgi?id=128898

        Reviewed by Csaba Osztrogonác.

        * wtf/Platform.h:

2014-02-15  Filip Pizlo  <fpizlo@apple.com>

        FTL should inline polymorphic heap accesses
        https://bugs.webkit.org/show_bug.cgi?id=128795

        Reviewed by Oliver Hunt.

        * wtf/PrintStream.h:
        (WTF::PointerDumpInContext::PointerDumpInContext):
        (WTF::PointerDumpInContext::dump):
        (WTF::pointerDumpInContext):

2014-02-16  Zan Dobersek  <zdobersek@igalia.com>

        Reintroduce const qualifiers for return types of (Filter|Transform)Iterator::operator*()
        https://bugs.webkit.org/show_bug.cgi?id=126875

        The const qualifiers for the return types of FilterIterator::operator*() and TransformIterator::operator*()
        were removed in r161797 and r161802 because of compilation failures when using GCC and having an Iterator
        type that already had the const qualifier. std::remove_const is now used to appease GCC and enforce the const
        qualifier on the return type, regardless of the Iterator type and its qualifiers.

        * wtf/IteratorAdaptors.h:
        (WTF::FilterIterator::operator*):
        (WTF::TransformIterator::operator*):

2014-02-15  Filip Pizlo  <fpizlo@apple.com>

        Vector with inline capacity should work with non-PODs
        https://bugs.webkit.org/show_bug.cgi?id=128864

        Reviewed by Michael Saboff.
        
        Previously, we would copy the inline storage of a vector as if it was a bag of bits.
        This presumed that the element type was relocatable. In general this is only true for
        PODs.
        
        This patch changes this by introducing a swap operation over inline storage. This swap
        operation requires being told about the size that is in use.
        
        Deques would have required some cleverness to make this work, because the swap
        operation needs to know which subset of elements are in-use and assumes that a size is
        sufficient for this. That's not true for deques. Instead of trying to do very clever
        things, I just removed the inline capacity option from Deque. I believe that this is
        fine since there are only two users of Deque with inline capacity, and both of them
        appear to be allocated rarely enough that inline capacity probably doesn't help much.

        * wtf/Deque.h:
        (WTF::DequeIterator::DequeIterator):
        (WTF::DequeConstIterator::DequeConstIterator):
        (WTF::Deque<T>::checkValidity):
        (WTF::Deque<T>::checkIndexValidity):
        (WTF::Deque<T>::invalidateIterators):
        (WTF::Deque<T>::Deque):
        (WTF::=):
        (WTF::Deque<T>::destroyAll):
        (WTF::Deque<T>::~Deque):
        (WTF::Deque<T>::swap):
        (WTF::Deque<T>::clear):
        (WTF::Deque<T>::expandCapacityIfNeeded):
        (WTF::Deque<T>::expandCapacity):
        (WTF::Deque<T>::append):
        (WTF::Deque<T>::prepend):
        (WTF::Deque<T>::removeFirst):
        (WTF::Deque<T>::removeLast):
        (WTF::Deque<T>::remove):
        (WTF::DequeIteratorBase<T>::checkValidity):
        (WTF::DequeIteratorBase<T>::addToIteratorsList):
        (WTF::DequeIteratorBase<T>::removeFromIteratorsList):
        (WTF::DequeIteratorBase<T>::DequeIteratorBase):
        (WTF::DequeIteratorBase<T>::~DequeIteratorBase):
        (WTF::DequeIteratorBase<T>::isEqual):
        (WTF::DequeIteratorBase<T>::increment):
        (WTF::DequeIteratorBase<T>::decrement):
        (WTF::DequeIteratorBase<T>::after):
        (WTF::DequeIteratorBase<T>::before):
        * wtf/Vector.h:
        (WTF::VectorBuffer::swap):
        (WTF::VectorBuffer::swapInlineBuffer):
        (WTF::VectorBuffer::swapInlineBuffers):
        (WTF::Vector::swap):

2014-02-15  Mikhail Pozdnyakov  <mikhail.pozdnyakov@intel.com>

        Remove 'static' specifier from free inline functions in StringImpl.h
        https://bugs.webkit.org/show_bug.cgi?id=118554

        Reviewed by Darin Adler.

        At first 'static' does not bring any use here, secondly static free
        inline functions in headers is a bad practice in general as each instance
        of function defined as inline is treated as a separate function and each
        instance has its own copy of static locals and string literals.

        * wtf/text/StringImpl.h:
        (WTF::codePointCompare):
        (WTF::codePointCompare8):
        (WTF::codePointCompare16):
        (WTF::codePointCompare8To16):
        (WTF::isSpaceOrNewline):

2014-02-14  Benjamin Poulain  <bpoulain@apple.com>

        Improve the performance on mobile of FTPDirectoryDocument
        https://bugs.webkit.org/show_bug.cgi?id=128778

        Reviewed by Antti Koivisto.

        * wtf/text/WTFString.h:
        (WTF::String::endsWith): add a missing overload.

2014-02-14  Wojciech Bielawski  <w.bielawski@samsung.com>

        (try)append and insert operations don't need new operator for PODs
        https://bugs.webkit.org/show_bug.cgi?id=128185

        Reviewed by Darin Adler.

        Vector's methods use VectorCopier to copy data.
        VectorCopier for PODs exteded to be used with different types. For different types placement new copy approach is applied. For the same types memcpy is applied.

        * wtf/Vector.h:
        (WTF::OverflowHandler>::append): use VectorCopier to copy data.
        (WTF::OverflowHandler>::tryAppend): use VectorCopier to copy data.
        (WTF::OverflowHandler>::insert): use VectorCopier to copy data.

2014-02-13  Daniel Bates  <dabates@apple.com>

        Fix the iOS build after <http://trac.webkit.org/changeset/164064

        * wtf/Platform.h:

2014-02-13  Daniel Bates  <dabates@apple.com>

        [iOS] Disable HAVE_ARM_NEON_INTRINSICS

        For now, disable HAVE_ARM_NEON_INTRINSICS when building for iOS. We want
        to audit the applicable code before we enable this define.

        * wtf/Platform.h:

2014-02-11  Filip Pizlo  <fpizlo@apple.com>

        Hoist and combine array bounds checks
        https://bugs.webkit.org/show_bug.cgi?id=125433

        Reviewed by Mark Hahnenberg.

        * GNUmakefile.list.am:
        * WTF.vcxproj/WTF.vcxproj:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/HashMethod.h: Added.
        (WTF::HashMethod::operator()):

2014-02-13  Tamas Gergely  <tgergely.u-szeged@partner.samsung.com>

        Code cleanup: remove gcc<4.7 guards.
        https://bugs.webkit.org/show_bug.cgi?id=128729

        Reviewed by Anders Carlsson.

        Remove GCC_VERSION_AT_LEAST guards when it checks for pre-4.7 versions,
        as WK does not compile with earlier gcc versions.

        * wtf/Assertions.cpp:
        * wtf/Platform.h:

2014-02-12  Mark Lam  <mark.lam@apple.com>

        No need to save reservedZoneSize when dropping the JSLock.
        <https://webkit.org/b/128719>

        Reviewed by Geoffrey Garen.

        * wtf/WTFThreadData.cpp:
        (WTF::WTFThreadData::WTFThreadData):
        * wtf/WTFThreadData.h:
        - removed unnneeded m_savedReservedZoneSize.

2014-02-11  Mark Hahnenberg  <mhahnenberg@apple.com>

        32-bit LLInt writeBarrierOnGlobalObject is wrong
        https://bugs.webkit.org/show_bug.cgi?id=128556

        Reviewed by Geoffrey Garen.

        * wtf/Platform.h: Removed OBJECT_MARK_LOGGING from Platform.h since it already exists in FeatureDefines.h

2014-02-11  peavo@outlook.com  <peavo@outlook.com>

        [WinCairo] Compile error, deleted file in WTF.
        https://bugs.webkit.org/show_bug.cgi?id=128601

        Reviewed by Csaba Osztrogonác.

        * WTF.vcxproj/WTF.vcxproj: Removed reference to deleted file.
        * WTF.vcxproj/WTF.vcxproj.filters: Ditto.

2014-02-10  Michael Saboff  <msaboff@apple.com>

        Re-enable ARM Thumb2 disassembler
        https://bugs.webkit.org/show_bug.cgi?id=128577

        Reviewed by Filip Pizlo.

        Added definition of WTF_USE_ARMV7_DISASSEMBLER back to Platform.h

        * wtf/Platform.h:

2014-02-10  Benjamin Poulain  <benjamin@webkit.org>

        Add the basic infrastructure to compile attributes matching in selectors
        https://bugs.webkit.org/show_bug.cgi?id=128484

        Reviewed by Gavin Barraclough.

        * wtf/Vector.h:
        (WTF::VectorBufferBase::bufferMemoryOffset):
        (WTF::Vector::sizeMemoryOffset):
        (WTF::Vector::dataMemoryOffset):
        Expose the memory offsets of Vector::size() and the memory buffer pointer for the JIT.

2014-02-10  Enrica Casucci  <enrica@apple.com>

        copyShortASCIIString crashes on iOS after r163793.
        https://bugs.webkit.org/show_bug.cgi?id=128548.

        Reviewed by Alexey Proskuryakov.

        Adding null check.

        * wtf/unicode/icu/CollatorICU.cpp:
        (WTF::copyShortASCIIString):

2014-02-10  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GLIB] Add GUniqueOutPtr and use it instead of GOwnPtr
        https://bugs.webkit.org/show_bug.cgi?id=127554

        Reviewed by Gustavo Noronha Silva.

        GUniqueOutPtr is a simplified version of GOwnPtr for the cases
        where we need the address of the contained pointer. GUniqueOutPtr
        uses GUniquePtr to free the contained object and to release the
        container pointer. The API is very simple to make sure this is
        only used when outPtr() is needed. It can't be constructed with a
        pointer, and there's not method to set a new pointer. Another
        difference with the old GOwnPtr is that outPtr() can be used
        multiple times, because it frees any pointer previously set.

        * GNUmakefile.list.am:
        * wtf/PlatformEfl.cmake:
        * wtf/PlatformGTK.cmake:
        * wtf/gobject/GOwnPtr.cpp: Removed.
        * wtf/gobject/GOwnPtr.h: Removed.
        * wtf/gobject/GUniquePtr.h:
        (WTF::GUniqueOutPtr::GUniqueOutPtr):
        (WTF::GUniqueOutPtr::~GUniqueOutPtr):
        (WTF::GUniqueOutPtr::outPtr):
        (WTF::GUniqueOutPtr::reset):
        (WTF::GUniqueOutPtr::release):
        (WTF::GUniqueOutPtr::operator*):
        (WTF::GUniqueOutPtr::operator->):
        (WTF::GUniqueOutPtr::get):
        (WTF::GUniqueOutPtr::operator!):
        (WTF::GUniqueOutPtr::operator UnspecifiedBoolType):

2014-02-10  Darin Adler  <darin@apple.com>

        Stop using String::deprecatedCharacters to call WTF::Collator
        https://bugs.webkit.org/show_bug.cgi?id=128517

        WTF passes ICU’s deprecated ULOC_REQUESTED_LOCALE to ucol_getLocaleByType()
        rdar://problem/15183390

        Reviewed by Alexey Proskuryakov.

        This patch fixes both bugs above by reworking WTF::Collator.

        * wtf/unicode/Collator.h: Fixed formatting. Got rid of the Collator::Result type,
        since the collator uses the same return value scheme as strcmp and as ICU; an int
        will do for the return type. Simplified the support for UCONFIG_NO_COLLATION by
        using a separate copy of the class definition. (We should check if anyone needs
        UCONFIG_NO_COLLATION support, and remove it if not.) Changed the lower-first flag
        from a separate function to a constructor argument. Changed the arguments to
        the collate function to StringView. Added a collate UTF8 function. Changed the
        m_collate data member to no longer be mutable since we no longer allocate it lazily.

        * wtf/unicode/CollatorDefault.cpp:
        (WTF::Collator::collate): Rewrote to be simpler.
        (WTF::Collator::collateUTF8): Added. Converts from UTF-8 to a String and then calls
        the collate function above.

        * wtf/unicode/icu/CollatorICU.cpp: Added a FIXME about the fact that this file
        has the wrong name and location. Since we always use ICU, there's no need to mention
        it in the file name.
        (WTF::copyASCIIString): Added.
        (WTF::copyDefaultLocale): Added.
        (WTF::resolveDefaultLocale): Added. Maps null locale to a default on Mac and iOS,
        since on those platforms ICU does not use the correct default locale when passed null.
        (WTF::localesMatch): Added.
        (WTF::Collator::Collator): Moved most of the code from createCollator here.
        Simplified it by storing the collator configuration along with the collator in globals.
        (WTF::Collator::~Collator): Moved most of the code from releaseCollator here.
        (WTF::getIndexLatin1): Added.
        (WTF::moveLatin1): Added.
        (WTF::hasNextLatin1): Added.
        (WTF::hasPreviousLatin1): Added.
        (WTF::currentLatin1): Added.
        (WTF::nextLatin1): Added.
        (WTF::previousLatin1): Added.
        (WTF::getStateLatin1): Added.
        (WTF::setStateLatin1): Added.
        (WTF::createLatin1Iterator): Added. Uses the functions above to make a UCharIterator
        that works for a WTF::StringView-style Latin-1 string.
        (WTF::createIterator): Added. Uses either createLatin1Iterator or uiter_setString to
        make a UCharIterator that works for a WTF::StringView.
        (WTF::Collator::collate): Changed to use ucol_strcollIter.
        (WTF::createIteratorUTF8): Added. Uses uiter_setUTF8.
        (WTF::Collator::collateUTF8): Added. Like collate, but for null-terminated UTF-8 strings.

2014-02-10  Tamas Gergely  <tgergely.u-szeged@partner.samsung.com>

        Code cleanup: Remove BUILDING_ON / TARGETING definitions.
        https://bugs.webkit.org/show_bug.cgi?id=128242

        Reviewed by Brent Fulgham.

        The BUILDING_ON_* and TARGETING_* macros have not been used for a while.
        According to the FIXME: they are removed.

        * wtf/Platform.h:

2014-02-09  Anders Carlsson  <andersca@apple.com>

        Add WTF_MAKE_FAST_ALLOCATED to more classes
        https://bugs.webkit.org/show_bug.cgi?id=128506

        Reviewed by Andreas Kling.

        * wtf/Bag.h:
        * wtf/ListHashSet.h:

2014-02-08  Anders Carlsson  <andersca@apple.com>

        Stop using getCharactersWithUpconvert in JavaScriptCore
        https://bugs.webkit.org/show_bug.cgi?id=128457

        Reviewed by Andreas Kling.

        * wtf/text/StringBuilder.h:
        (WTF::StringBuilder::append):
        Add a new overload that takes a StringView.

        * wtf/text/StringView.h:
        (WTF::StringView::find):
        Add new find member function.

2014-02-08  Darin Adler  <darin@apple.com>

        Change TextIterator to use StringView, preparing to wean it from deprecatedCharacters
        https://bugs.webkit.org/show_bug.cgi?id=128233

        Reviewed by Anders Carlsson.

        * WTF.xcodeproj/project.pbxproj: Added new source files.

        * wtf/text/StringView.h: Added operator[], createCFStringWithoutCopying, and
        createNSStringWithoutCopying.
        * wtf/text/cf/StringViewCF.cpp:
        (WTF::StringView::createCFStringWithoutCopying): Added.
        * wtf/text/mac/StringViewObjC.mm:
        (WTF::StringView::createNSString): Added.
        (WTF::StringView::createNSStringWithoutCopying): Added.

2014-02-06  Andreas Kling  <akling@apple.com>

        Remove unused ENABLE(REPAINT_THROTTLING) flag.
        <https://webkit.org/b/128329>

        Reviewed by Antti Koivisto.

        * wtf/FeatureDefines.h:

2014-02-06  Filip Pizlo  <fpizlo@apple.com>

        More FTL build scaffolding
        https://bugs.webkit.org/show_bug.cgi?id=128330

        Reviewed by Geoffrey Garen.

        * wtf/Platform.h:

2014-02-06  Anders Carlsson  <andersca@apple.com>

        Use std::chrono functions in dispatchFunctionsFromMainThread()
        https://bugs.webkit.org/show_bug.cgi?id=128308

        Reviewed by Antti Koivisto.

        * wtf/MainThread.cpp:
        (WTF::dispatchFunctionsFromMainThread):

2014-02-05  Zan Dobersek  <zdobersek@igalia.com>

        Remove the WTF_COMPILER_SUPPORTS_CXX_GENERALIZED_INITIALIZERS macro
        https://bugs.webkit.org/show_bug.cgi?id=128267

        Reviewed by Andreas Kling.

        Remove the WTF_COMPILER_SUPPORTS_CXX_GENERALIZED_INITIALIZERS macro that was manually defined for compilers
        that support the C++11 initializer lists. The feature is well supported in Clang, MSVC and also GCC. It
        was actually already used unguarded in HashSet.

        * wtf/Compiler.h:
        * wtf/HashMap.h:
        (WTF::HashMap::HashMap):
        * wtf/Vector.h:
        (WTF::Vector::Vector):

2014-02-05  Andreas Kling  <akling@apple.com>

        Remove ENABLE(DIRECTORY_UPLOAD).
        <https://webkit.org/b/128275>

        Rubber-stamped by Ryosuke Niwa.

        * wtf/FeatureDefines.h:

2014-02-05  Carlos Garcia Campos  <cgarcia@igalia.com>

        HashMap can't be used with std::unique_ptr as value when it has a custom deleter
        https://bugs.webkit.org/show_bug.cgi?id=128250

        Reviewed by Darin Adler.

        The problem is that the HashMap is using a unique_ptr with the
        default deleter, so that when trying to move the unique_ptr the
        deleters don't match.

        * wtf/HashTraits.h: Add the deleter also in the template
        definitation of the parent class for the HashTraits<std::unique_ptr<T, Deleter>>

2014-02-05  Csaba Osztrogonác  <ossy@webkit.org>

        Remove ENABLE(SVG) guards
        https://bugs.webkit.org/show_bug.cgi?id=127991

        Reviewed by Sam Weinig.

        * wtf/FeatureDefines.h:

2014-02-04  Mark Lam  <mark.lam@apple.com>

        The stack limit computation does not work for Windows.
        <https://webkit.org/b/128226>

        Reviewed by Geoffrey Garen.

        The current stack limit computation assumes that the stack is allocated
        in high memory. On Windows, the stack seems to be allocated very near
        address 0, and is smaller in size than our Options::maxPerThreadStackUsage().
        This combination triggers a bug where StackBounds::recursionLimit()
        underflows and computes a limit address that is ridiculously high in memory.
        The net effect is that the Windows port thinks its out of stack space all
        the time.

        We now check for potential underflows in StackBounds and return an
        appropriate limit address.

        * wtf/StackBounds.h:
        (WTF::StackBounds::recursionLimit):

2014-02-04  Andreas Kling  <akling@apple.com>

        Remove <iframe seamless> support.
        <https://webkit.org/b/128213>

        Rubber-stamped by Antti Koivisto.

        * wtf/FeatureDefines.h:

2014-02-04  Anders Carlsson  <andersca@apple.com>

        Store StringImpl substring backpointers as tail data
        https://bugs.webkit.org/show_bug.cgi?id=128220

        Reviewed by Geoffrey Garen.

        This lets us get rid of m_substringBuffer from the union.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::~StringImpl):
        (WTF::StringImpl::getData16SlowCase):
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::StringImpl):
        (WTF::StringImpl::createSubstringSharingImpl8):
        (WTF::StringImpl::createSubstringSharingImpl):
        (WTF::StringImpl::cost):
        (WTF::StringImpl::costDuringGC):
        (WTF::StringImpl::substringBuffer):

2014-02-04  Anders Carlsson  <andersca@apple.com>

        Rename the substring sharing StringImpl::create variants to better indicate what they do
        https://bugs.webkit.org/show_bug.cgi?id=128214

        Reviewed by Geoffrey Garen.

        * wtf/text/AtomicString.cpp:
        (WTF::SubstringTranslator::translate):
        * wtf/text/StringBuilder.cpp:
        (WTF::StringBuilder::reifyString):
        (WTF::StringBuilder::resize):
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::createSubstringSharingImpl8):
        (WTF::StringImpl::createSubstringSharingImpl):
        * wtf/text/WTFString.cpp:
        (WTF::String::substringSharingImpl):

2014-02-04  Alexey Proskuryakov  <ap@apple.com>

        WebCrypto HMAC verification uses a non-constant-time memcmp
        https://bugs.webkit.org/show_bug.cgi?id=128198
        <rdar://problem/15976961>

        Reviewed by Oliver Hunt.

        Added a "constant time" memcmp that doesn't depend on data. The name is somewhat
        strange, as the function is of course O(length) and not constant time at all,
        but apparently this is how everyone calls such functions.

        * GNUmakefile.list.am:
        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/CryptographicUtilities.cpp: Added. (WTF::constantTimeMemcmp):
        * wtf/CryptographicUtilities.h: Added.

2014-02-04  Anders Carlsson  <andersca@apple.com>

        Rename StringImpl::getCharacters to StringImpl::characters
        https://bugs.webkit.org/show_bug.cgi?id=128205

        Reviewed by Antti Koivisto.

        This lets us use StringImpl::getCharacters for the upconverting version.
        Also, change StringImpl::characters<UChar>() to call characters16() instead of deprecatedCharacters()
        and audit all call sites to make sure we weren't relying on upconversion anywhere.

        * wtf/text/AtomicString.cpp:
        (WTF::findString):
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::simplifyMatchedCharactersToSpace):
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::characters<LChar>):
        (WTF::StringImpl::characters<UChar>):

2014-02-04  Anders Carlsson  <andersca@apple.com>

        Rename equalNonNull to equal and make it take const StringImpl& instead
        https://bugs.webkit.org/show_bug.cgi?id=128206

        Reviewed by Andreas Kling.

        * wtf/text/StringHash.h:
        (WTF::StringHash::equal):
        * wtf/text/StringImpl.cpp:
        (WTF::stringImplContentEqual):
        (WTF::equal):
        * wtf/text/StringImpl.h:

2014-02-04  Anders Carlsson  <andersca@apple.com>

        Get rid of StringImpl::m_buffer
        https://bugs.webkit.org/show_bug.cgi?id=128200

        Reviewed by Michael Saboff.

        Trade one lousy hack for another by changing the CreateEmptyUnique StringImpl
        constructor to initialize its character buffer to point to m_length instead
        since it will always be null.

        Also change it to be an 8-bit string because why not.

        * wtf/text/StringImpl.h:
        (WTF::StringImpl::StringImpl):

2014-02-04  Anders Carlsson  <andersca@apple.com>

        Rename String::getCharacters to String::characters
        https://bugs.webkit.org/show_bug.cgi?id=128196

        Reviewed by Andreas Kling.

        This means String::characters() will end up calling either characters8() or characters16() which
        makes more logical sense. It also frees up the getCharacters name so we can use it for a new function
        that will do upconversion.
        
        * wtf/text/StringBuilder.cpp:
        (WTF::StringBuilder::appendUninitializedSlow):
        * wtf/text/WTFString.h:
        (WTF::String::characters<LChar>):
        (WTF::String::characters<UChar>):

2014-02-03  Anders Carlsson  <andersca@apple.com>

        Fix Windows build.

        * wtf/text/StringImpl.h:
        (WTF::StringImpl::tailOffset):

2014-02-03  Anders Carlsson  <andersca@apple.com>

        StringImpl::tailOffset() should return the offset right after m_hashAndFlags
        https://bugs.webkit.org/show_bug.cgi?id=128141

        Reviewed by Andreas Kling.

        * wtf/text/StringImpl.h:
        (WTF::StringImpl::tailOffset):

2014-02-03  Anders Carlsson  <andersca@apple.com>

        More tail pointer consolidation
        https://bugs.webkit.org/show_bug.cgi?id=128139

        Reviewed by Andreas Kling.

        Add a new tailOffset() function and reimplement allocationSize() and tailPointer()
        in terms of it. Use tailPointer() instead of reinterpret_cast-ing this + 1.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::createUninitializedInternalNonEmpty):
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::StringImpl):
        (WTF::StringImpl::requiresCopy):
        (WTF::StringImpl::allocationSize):
        (WTF::StringImpl::tailOffset):
        (WTF::StringImpl::tailPointer):

2014-02-03  Gustavo Noronha Silva  <gns@gnome.org>

        [GTK][CMake] Enable SUBPIXEL_LAYOUT in FeatureDefines.h like EFL does
        https://bugs.webkit.org/show_bug.cgi?id=128136

        Reviewed by Martin Robinson.

        * wtf/FeatureDefines.h: enable SUBPIXEL_LAYOUT if it's not set, for GTK+.

2014-02-03  Mark Hahnenberg  <mhahnenberg@apple.com>

        Turn GenGC on
        https://bugs.webkit.org/show_bug.cgi?id=128109

        Reviewed by Oliver Hunt.

        * wtf/Platform.h: Initially it will only be enabled for X86-64.

2014-02-03  Anders Carlsson  <andersca@apple.com>

        Consolidate StringImpl tail handling into two functions
        https://bugs.webkit.org/show_bug.cgi?id=128122

        Reviewed by Andreas Kling.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::createUninitializedInternalNonEmpty):
        (WTF::StringImpl::reallocateInternal):
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::tryCreateUninitialized):
        (WTF::StringImpl::allocationSize):
        (WTF::StringImpl::tailPointer):

2014-02-03  Darin Adler  <darin@apple.com>

        Remove Unicode.h
        https://bugs.webkit.org/show_bug.cgi?id=128106

        Reviewed by Anders Carlsson.

        * GNUmakefile.list.am: Removed files.
        * WTF.vcxproj/WTF.vcxproj: Ditto.
        * WTF.vcxproj/WTF.vcxproj.filters: Ditto.
        * WTF.xcodeproj/project.pbxproj: Ditto.
        * wtf/CMakeLists.txt: Ditto.

        * wtf/unicode/ScriptCodesFromICU.h: Removed.
        * wtf/unicode/Unicode.h: Removed.
        * wtf/unicode/UnicodeMacrosFromICU.h: Removed.
        * wtf/unicode/icu/UnicodeIcu.h: Removed.
        * wtf/unicode/wchar/UnicodeWchar.cpp: Removed.
        * wtf/unicode/wchar/UnicodeWchar.h: Removed.

2014-01-25  Darin Adler  <darin@apple.com>

        Stop using Unicode.h
        https://bugs.webkit.org/show_bug.cgi?id=127633

        Reviewed by Anders Carlsson.

        * wtf/StringHasher.h:
        * wtf/dtoa.h:
        * wtf/text/ASCIIFastPath.h:
        * wtf/text/LChar.h:
        * wtf/text/StringBuffer.h:
        * wtf/text/StringImpl.h:
        * wtf/text/WTFString.cpp:
        * wtf/unicode/CharacterNames.h:
        * wtf/unicode/Collator.h:
        * wtf/unicode/UTF8.h:
        Removed includes of <wtf/unicode/Unicode.h>, adding includes of
        ICU headers and <wtf/text/LChar.h> as needed to replace it.

2014-02-02  Darin Adler  <darin@apple.com>

        Obey "delete this" comments, including deleting String::characters and friends
        https://bugs.webkit.org/show_bug.cgi?id=126865

        Reviewed by Andreas Kling.

        * wtf/text/AtomicString.h: Deleted the characters function.
        * wtf/text/StringBuilder.h: Deleted the characters function, leaving behind the
        deprecatedCharacters function.
        * wtf/text/StringImpl.h: Ditto.
        * wtf/text/WTFString.h: Ditto. Also added a constructor that takes a StringImpl&,
        helpful for later string refactoring.

2014-02-02  Dan Bernstein  <mitz@apple.com>

        Stop using PLATFORM(MAC) in WTF except where it means “OS X but not iOS”
        https://bugs.webkit.org/show_bug.cgi?id=128089

        Reviewed by Darin Adler.

        Replaced all uses of PLATFORM(MAC) that weren’t accompanied by !PLATFORM(IOS) with
        equivalent(*) tests that are more idiomatic and will not change once PLATFORM(MAC) changes to
        be false when building for iOS.

        * - One exception noted below.

        * wtf/AutodrainedPool.h: Changed PLATFORM(MAC) to USE(FOUNDATION), because NSAutoreleasePool
        is a Foundation class.

        * wtf/CurrentTime.cpp:
        (WTF::monotonicallyIncreasingTime): Changed PLATFORM(MAC) to OS(DARWIN), because Mach is
        part of the Darwin kernel, but reordered such that the EFL and GLIB implementations continue
        to take precedence regardless of the OS.

        * wtf/MainThread.cpp: Changed PLATFORM(MAC) to OS(DARWIN) && !PLATFORM(EFL) && !PLATFORM(GTK).
        * wtf/MainThread.h: Ditto.

        * wtf/Platform.h: Changed USE(CG) and USE(CA) to depend on COCOA, rather than MAC or IOS.
        Ditto for USE(CFURLCACHE), HAVE(ACCESSIBILITY), USE(PROTECTION_SPACE_AUTH_CALLBACK),
        USE(ACCESSIBILITY_CONTEXT_MENUS), USE(EXPORT_MACROS), USE(AVFOUNDATION),
        USE(REQUEST_ANIMATION_FRAME_TIMER), USE(REQUEST_ANIMATION_FRAME_DISPLAY_MONITOR),
        USE(CONTENT_FILTERING), USE(UNIFIED_TEXT_CHECKING), USE(MARKER_REMOVAL_UPON_EDITING),
        USE(AUDIO_SESSION), USE(IOSURFACE), and ENABLE(CSS3_TEXT_DECORATION_SKIP_INK). Changed
        PLATFORM(MAC) to OS(DARWIN) && !PLATFORM(EFL) && !PLATFORM(GTK) in controlling various
        JavaScriptCore or JavaScriptCore-dependent behaviors.

        * wtf/RunLoop.h: Changed PLATFORM(MAC) to PLATFORM(COCOA).
        * wtf/RunLoopTimerCF.cpp: Ditto.

        * wtf/SchedulePair.h: Changed PLATFORM(MAC) to USE(FOUNDATION), since it was used to guard
        usage of Foundation API.

        * wtf/Threading.cpp: Added an explicit !PLATFORM(IOS) in a guard around something needed
        only on OS X and Windows.

2014-01-31  Benjamin Poulain  <bpoulain@apple.com>

        Remove LEGACY_VIEWPORT_ADAPTION
        https://bugs.webkit.org/show_bug.cgi?id=128028

        Reviewed by Anders Carlsson.

        * wtf/FeatureDefines.h:

2014-01-31  Tim Horton  <timothy_horton@apple.com>

        [wk2] PlatformCALayerRemoteCustom doesn't work on iOS
        https://bugs.webkit.org/show_bug.cgi?id=128025
        <rdar://problem/15950271>

        Reviewed by Simon Fraser.

        * wtf/Platform.h:
        Rename HAVE_LAYER_HOSTING_IN_WINDOW_SERVER to HAVE_OUT_OF_PROCESS_LAYER_HOSTING
        and make it true on iOS.

2014-01-31  Michael Saboff  <msaboff@apple.com>

        REGRESSION: Crash in sanitizeStackForVMImpl when scrolling @ lifehacker.com.au
        https://bugs.webkit.org/show_bug.cgi?id=128017

        Reviewed by Filip Pizlo.

        Moved the setting and saving of VM::stackPointerAtVMEntry and the corresponding stack limit
        to JSLock and JSLock::DropAllLocks.  The saved data is now stored in per-thread in
        WTFThreadData.

        * wtf/WTFThreadData.cpp:
        (WTF::WTFThreadData::WTFThreadData):
        * wtf/WTFThreadData.h:
        (WTF::WTFThreadData::savedStackPointerAtVMEntry):
        (WTF::WTFThreadData::setSavedStackPointerAtVMEntry):
        (WTF::WTFThreadData::savedLastStackTop):
        (WTF::WTFThreadData::setSavedLastStackTop):
        (WTF::WTFThreadData::savedReservedZoneSize):
        (WTF::WTFThreadData::setSavedReservedZoneSize):

2014-01-30  Andrei Bucur  <abucur@adobe.com>

        Remove the ACCELERATED_COMPOSITING flag
        https://bugs.webkit.org/show_bug.cgi?id=127833

        Reviewed by Antti Koivisto.

        Remove the USE(ACCELERATED_COMPOSITING) conditionals from the code base and make AC
        mandatory.

        * wtf/OwnPtrCommon.h:
        * wtf/Platform.h:
        * wtf/efl/OwnPtrEfl.cpp:
        (WTF::deleteOwnedPtr):

2014-01-28  Michael Saboff  <msaboff@apple.com>

        Merge the jsCStack branch
        https://bugs.webkit.org/show_bug.cgi?id=127763

        Reviewed by Mark Hahnenberg.

        Changes from http://svn.webkit.org/repository/webkit/branches/jsCStack
        up to changeset 162958.

2014-01-29  Csaba Osztrogonác  <ossy@webkit.org>

        Remove ENABLE(JAVASCRIPT_DEBUGGER) guards
        https://bugs.webkit.org/show_bug.cgi?id=127840

        Reviewed by Mark Lam.

        * wtf/FeatureDefines.h:

2014-01-28  Anders Carlsson  <andersca@apple.com>

        Actually turn stack stats back off.

        * wtf/StackStats.cpp:
        * wtf/StackStats.h:

2014-01-28  Anders Carlsson  <andersca@apple.com>

        Turn stack stats back off.

        * wtf/StackStats.cpp:

2014-01-28  Anders Carlsson  <andersca@apple.com>

        Use std::mutex instead of WTF::Mutex in WTF
        https://bugs.webkit.org/show_bug.cgi?id=127783

        Reviewed by Antti Koivisto.

        * wtf/CryptographicallyRandomNumber.cpp:
        * wtf/MainThread.cpp:
        (WTF::mainThreadFunctionQueueMutex):
        (WTF::functionQueue):
        (WTF::dispatchFunctionsFromMainThread):
        (WTF::callOnMainThread):
        (WTF::cancelCallOnMainThread):
        * wtf/StackStats.cpp:
        (WTF::StackStats::initialize):
        (WTF::StackStats::CheckPoint::CheckPoint):
        (WTF::StackStats::CheckPoint::~CheckPoint):
        (WTF::StackStats::probe):
        (WTF::StackStats::LayoutCheckPoint::LayoutCheckPoint):
        (WTF::StackStats::LayoutCheckPoint::~LayoutCheckPoint):
        * wtf/StackStats.h:

2014-01-27  Joseph Pecoraro  <pecoraro@apple.com>

        WebCore: Enable -Wimplicit-fallthrough and add FALLTHROUGH annotation where needed
        https://bugs.webkit.org/show_bug.cgi?id=127671

        Reviewed by Ryosuke Niwa.

        * wtf/text/WTFString.h:
        (WTF::appendNumber):

2014-01-27  Jer Noble  <jer.noble@apple.com>

        [WK2] callOnMainThread() from main thread sometimes results in ASSERTs.
        https://bugs.webkit.org/show_bug.cgi?id=127370

        Reviewed by Alexey Proskuryakov.

        When WEB_THREAD is enabled, and callOnMainThread() is called from the main
        thread, if the web thread is locked, a timer is set and the passed-in function
        is called on the next run-loop. However, by that time the web thread may have
        been unlocked, and isMainThread() will no longer return true, resulting in
        an assert.

        Instead, scheduleDispatchFunctionsOnMainThread() should check isWebThread(),
        which is equivalent to isMainThread() when the WEB_THREAD is disabled, but
        will do the correct thing when WEB_THREAD is enabled.

        * wtf/mac/MainThreadMac.mm:
        (WTF::scheduleDispatchFunctionsOnMainThread):

2014-01-27  Dan Bernstein  <mitz@apple.com>

        Build fix.

        * wtf/ThreadSafeRefCounted.h: Added a necessary #include.

2014-01-25  Sam Weinig  <sam@webkit.org>

        Remove unused support for DRAGGABLE_REGION
        https://bugs.webkit.org/show_bug.cgi?id=127642

        Reviewed by Simon Fraser.

        * wtf/FeatureDefines.h:

2014-01-25  Joseph Pecoraro  <pecoraro@apple.com>

        Add FALLTHROUGH and -Wimplicit-fallthrough to warn about unannotated implicit fallthroughs in switches
        https://bugs.webkit.org/show_bug.cgi?id=127637

        Reviewed by Darin Adler.

        For information about [[clang::fallthrough]], see:
        <http://clang.llvm.org/docs/LanguageExtensions.html#the-clang-fallthrough-attribute>

        * Configurations/Base.xcconfig:
        Enable -Wimplicit-fallthrough warnings.

        * wtf/Compiler.h:
        Define FALLTHROUGH on clang and fallback to outputing nothing when unsupported.

        * wtf/dtoa/fast-dtoa.cc:
        * wtf/unicode/UTF8.cpp:
        (WTF::Unicode::convertLatin1ToUTF8):
        (WTF::Unicode::convertUTF16ToUTF8):
        (WTF::Unicode::isLegalUTF8):
        (WTF::Unicode::readUTF8Sequence):
        Explicitly annotate implicit fallthroughs with FALLTHROUGH.

2014-01-25  Darin Adler  <darin@apple.com>

        Call deprecatedCharacters instead of characters at more call sites
        https://bugs.webkit.org/show_bug.cgi?id=127631

        Reviewed by Sam Weinig.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::replace):
        * wtf/text/WTFString.h:
        (WTF::String::isAllSpecialCharacters):
        Use the new name.

2014-01-25  Darin Adler  <darin@apple.com>

        Add a new separate LChar.h header file, to be used after we remove Unicode.h
        https://bugs.webkit.org/show_bug.cgi?id=127630

        Reviewed by Sam Weinig.

        * GNUmakefile.list.am: Added the new file
        * WTF.vcxproj/WTF.vcxproj: Ditto.
        * WTF.vcxproj/WTF.vcxproj.filters: Ditto.
        * WTF.xcodeproj/project.pbxproj: Ditto.
        * wtf/CMakeLists.txt: Ditto.
        * wtf/text/LChar.h: Added.

2014-01-25  Darin Adler  <darin@apple.com>

        Get rid of ICU_UNICODE and WCHAR_UNICODE remnants
        https://bugs.webkit.org/show_bug.cgi?id=127623

        Reviewed by Anders Carlsson.

        * wtf/CMakeLists.txt: Removed WTF_USE_ICU_UNICODE and
        WTF_USE_WCHAR_UNICODE since they are true and false respectively.

        * wtf/Platform.h: Removed code to set WTF_USE_ICU_UNICODE.

        * wtf/unicode/Collator.h: Removed ifdefs.
        * wtf/unicode/CollatorDefault.cpp: Ditto.
        * wtf/unicode/Unicode.h: Ditto.
        * wtf/unicode/icu/CollatorICU.cpp: Ditto.

2014-01-25  Anders Carlsson  <andersca@apple.com>

        Remove atomicIncrement/atomicDecrement
        https://bugs.webkit.org/show_bug.cgi?id=127625

        Reviewed by Andreas Kling.

        Replace atomicIncrement/atomicDecrement with std::atomic.

        * wtf/Atomics.h:
        * wtf/RefCountedLeakCounter.cpp:
        (WTF::RefCountedLeakCounter::~RefCountedLeakCounter):
        (WTF::RefCountedLeakCounter::increment):
        (WTF::RefCountedLeakCounter::decrement):
        * wtf/RefCountedLeakCounter.h:
        * wtf/ThreadSafeRefCounted.h:
        (WTF::ThreadSafeRefCountedBase::ref):
        (WTF::ThreadSafeRefCountedBase::refCount):
        (WTF::ThreadSafeRefCountedBase::derefBase):

2014-01-25  Anders Carlsson  <andersca@apple.com>

        Modernize HashTable threading code
        https://bugs.webkit.org/show_bug.cgi?id=127621

        Reviewed by Darin Adler.

        Use std::mutex and std::atomic instead of WTF threading primitives.

        * wtf/DynamicAnnotations.h:
        Include Platform.h here since this file relies on USE macros.

        * wtf/HashTable.cpp:
        (WTF::HashTableStats::recordCollisionAtCount):
        Change this to take an unsigned.

        (WTF::HashTableStats::dumpStats):
        * wtf/HashTable.h:
        (WTF::KeyTraits>::HashTable):
        (WTF::KeyTraits>::remove):
        (WTF::KeyTraits>::invalidateIterators):
        Use a single probe counter.

        (WTF::addIterator):
        (WTF::removeIterator):

2014-01-25  Darin Adler  <darin@apple.com>

        Restore alphabetical order in Compiler.h
        https://bugs.webkit.org/show_bug.cgi?id=127620

        Reviewed by Sam Weinig.

        * wtf/Compiler.h: Resorted some things into alphabetical order

2014-01-24  Brent Fulgham  <bfulgham@apple.com>

        [Win] Convert some NMake files to MSBuild project files
        https://bugs.webkit.org/show_bug.cgi?id=127579

        Reviewed by Tim Horton.

        * WTF.vcxproj/WTF.make: Removed.
        * WTF.vcxproj/WTF.proj: Added.

2014-01-24  Anders Carlsson  <andersca@apple.com>

        Get rid of monotonicallyIncreasingTimeMS and start using std::chrono instead
        https://bugs.webkit.org/show_bug.cgi?id=127571

        Reviewed by Antti Koivisto.

        * wtf/Compiler.h:
        Add a CONSTEXPR define so we can still use constexpr on compilers that don't support them (MSVC).

        * wtf/CurrentTime.h:
        Remove monotonicallyIncreasingTimeMS().

        * wtf/StdLibExtras.h:
        (std::literals::chrono_literals::operator _s):
        (std::literals::chrono_literals::operator _ms):
        Add _s and _ms literals. Once we switch over to C++14, we can drop them and just use the built-in ones.

2014-01-24  Anders Carlsson  <andersca@apple.com>

        The CXX_EXPLICIT_CONVERSIONS COMPILER_SUPPORTS macro has been removed, and all
        compilers support explicit conversions now so simply remove the #ifdef.

        * wtf/RetainPtr.h:

2014-01-24  Darin Adler  <darin@apple.com>

        Simplify Compiler.h
        https://bugs.webkit.org/show_bug.cgi?id=127491

        Reviewed by Anders Carlsson.

        * wtf/Assertions.h: Remove COMPILER_SUPPORTS(CXX_STATIC_ASSERT), since
        we now have that for all compilers that can build WebKit.

        * wtf/Compiler.h: Removed always true feature flags, including:
        COMPILER_SUPPORTS(CXX_VARIADIC_TEMPLATES), COMPILER_SUPPORTS(CXX_RVALUE_REFERENCES),
        COMPILER_SUPPORTS(CXX_DELETED_FUNCTIONS), COMPILER_SUPPORTS(CXX_NULLPTR),
        COMPILER_SUPPORTS(CXX_EXPLICIT_CONVERSIONS), COMPILER_SUPPORTS(CXX_STATIC_ASSERT),
        COMPILER_SUPPORTS(CXX_OVERRIDE_CONTROL), COMPILER_SUPPORTS(CXX_STRONG_ENUMS), and
        COMPILER_SUPPORTS(CXX_AUTO_TYPE). Sorted sections alphabetically. Separated out
        nested #if and #else into separate checks for greater readability. Removed obsolete
        check for COMPILER(RVCT). Removed unused COMPILER(GCCE) detection.

        * wtf/RefPtr.h: Remove COMPILER_SUPPORTS(CXX_NULLPTR), since we now have
        that for all compilers that can build WebKit.
        * wtf/RetainPtr.h: Ditto.

2014-01-23  Max Vujovic  <mvujovic@adobe.com>

        Remove CSS Custom Filters code and tests
        https://bugs.webkit.org/show_bug.cgi?id=127382

        Reviewed by Simon Fraser.

        * wtf/FeatureDefines.h:

2014-01-22  Brent Fulgham  <bfulgham@apple.com>

        [Win] Update project and solution files for 64-bit builds.
        https://bugs.webkit.org/show_bug.cgi?id=127457

        Reviewed by Eric Carlson.

        * WTF.vcxproj/WTF.submit.sln: Add x64 targets.
        * WTF.vcxproj/WTF.vcxproj: Update for VS2013

2014-01-22  Myles C. Maxfield  <mmaxfield@apple.com>

        Remove CSS3_TEXT_DECORATION define
        https://bugs.webkit.org/show_bug.cgi?id=127333

        Reviewed by Simon Fraser.

        This is required for unprefixing the text-decoration-* CSS properties.

        * wtf/Platform.h:

2014-01-22  Jae Hyun Park  <jae.park@company100.net>

        Remove unnecessary include in Noncopyable.h
        https://bugs.webkit.org/show_bug.cgi?id=127406

        Reviewed by Anders Carlsson.

        * wtf/Noncopyable.h: We don't need Compiler.h as of r162198.

2014-01-22  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Add GUniquePtr
        https://bugs.webkit.org/show_bug.cgi?id=127170

        Reviewed by Gustavo Noronha Silva.

        The idea is to replace GOwnPtr with a template alias of
        std:unique_ptr. Not everything can be replaced, though, because
        GOwnPtr::outPtr() doesn't seem to be possible to implement with
        unique_ptr. This smart pointer is more flexible than GOwnPtr and
        allows to transfer the ownership of the pointer using
        std::move().

        * GNUmakefile.list.am: Add new file to compilation.
        * wtf/gobject/GUniquePtr.h: Added.
        (WTF::GPtrDeleter::operator()):

2014-01-20  Anders Carlsson  <andersca@apple.com>

        Remove an unused member variable
        https://bugs.webkit.org/show_bug.cgi?id=127295

        Reviewed by Antti Koivisto.

        * wtf/MainThread.cpp:
        (WTF::FunctionWithContext::FunctionWithContext):
        (WTF::FunctionWithContext::operator == ):
        (WTF::dispatchFunctionsFromMainThread):

2014-01-20  Anders Carlsson  <andersca@apple.com>

        Remove MutexTryLocker
        https://bugs.webkit.org/show_bug.cgi?id=127294

        Reviewed by Antti Koivisto.

        MutexTryLocker has been replaced with std::unique_lock with std::try_to_lock everywhere now.

        * wtf/ThreadingPrimitives.h:

2014-01-19  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GLIB] GVariant floating references are not correctly handled by GRefPtr
        https://bugs.webkit.org/show_bug.cgi?id=127246

        Reviewed by Martin Robinson.

        GRefPtr should always use g_variant_ref_sink to deal with GVariant
        floating references. In case of full references,
        g_variant_ref_sink calls g_variant_ref, so it's safe to use it always.

        * wtf/gobject/GRefPtr.cpp:
        (WTF::refGPtr): Use g_variant_ref_sink().

2014-01-18  Anders Carlsson  <andersca@apple.com>

        Remove support for the viewsource attribute
        https://bugs.webkit.org/show_bug.cgi?id=127232

        Reviewed by Andreas Kling.

        * wtf/FeatureDefines.h:

2014-01-18  Anders Carlsson  <andersca@apple.com>

        Remove ENABLE_THREADED_HTML_PARSER defines everywhere
        https://bugs.webkit.org/show_bug.cgi?id=127225

        Reviewed by Andreas Kling.

        This concludes the removal of over 8.8 million lines of threaded parser code.

        * wtf/FeatureDefines.h:

2014-01-17  Anders Carlsson  <andersca@apple.com>

        Add a callOnMainThreadAndWait variant in SocketStreamHandle
        https://bugs.webkit.org/show_bug.cgi?id=127180

        Reviewed by Geoffrey Garen.

        Remove callOnMainThreadAndWait from WTF.

        * wtf/MainThread.cpp:
        * wtf/MainThread.h:

2014-01-17  Peter Molnar  <pmolnar.u-szeged@partner.samsung.com>

        Remove workaround for compilers not supporting deleted functions
        https://bugs.webkit.org/show_bug.cgi?id=127166

        Reviewed by Andreas Kling.

        * wtf/Compiler.h:
        * wtf/Noncopyable.h:
        * wtf/PassRefPtr.h:

2014-01-16  Benjamin Poulain  <bpoulain@apple.com>

        Remove Nix from WTF
        https://bugs.webkit.org/show_bug.cgi?id=127150

        Reviewed by Alexey Proskuryakov.

        * wtf/DisallowCType.h:
        * wtf/FeatureDefines.h:
        * wtf/Platform.h:
        * wtf/PlatformNix.cmake: Removed.
        * wtf/nix: Removed.

2014-01-16  Anders Carlsson  <andersca@apple.com>

        Remove FINAL macro
        https://bugs.webkit.org/show_bug.cgi?id=127149

        Reviewed by Tim Horton.

        * wtf/Compiler.h:

2014-01-16  Peter Molnar  <pmolnar.u-szeged@partner.samsung.com>

        Remove workaround for compilers not supporting explicit override control
        https://bugs.webkit.org/show_bug.cgi?id=127111

        Reviewed by Anders Carlsson.

        Now all compilers support explicit override control, this workaround can be removed.

        * wtf/Compiler.h:
        * wtf/FilePrintStream.h:
        * wtf/RunLoop.h:
        * wtf/StringPrintStream.h:

2014-01-16  Alberto Garcia  <berto@igalia.com>

        Source/WTF/wtf/Atomics.h:300: Error: bad register name `%bpl'
        https://bugs.webkit.org/show_bug.cgi?id=126985

        Reviewed by Csaba Osztrogonác.

        Use the 'q' constraint to force using a register that allows
        access to its lower byte.

        * wtf/Atomics.h:
        (WTF::weakCompareAndSwap):

2014-01-16  Peter Molnar  <pmolnar.u-szeged@partner.samsung.com>

        Fix unnecessary checks for Clang compiler if the compiler is MSVC.
        https://bugs.webkit.org/show_bug.cgi?id=127037

        Reviewed by Csaba Osztrogonác.

        Inside the #if defined(_MSC_VER) there's no need for checking whether the compiler is not Clang.

        * wtf/Compiler.h:

2014-01-16  Peter Molnar  <pmolnar.u-szeged@partner.samsung.com>

        Require at least GCC version 4.7
        https://bugs.webkit.org/show_bug.cgi?id=127049

        Reviewed by Csaba Osztrogonác.

        r161770 added a template alias, so the minimum GCC version is 4.7 now.

        Also fixed a typo in the error message about old MSVC version.

        * wtf/Compiler.h:

2014-01-15  Alberto Garcia  <berto@igalia.com>

        [GTK] v2.3.3 fails to build in Debian / FreeBSD
        https://bugs.webkit.org/show_bug.cgi?id=126502

        Reviewed by Mark Lam.

        * wtf/Platform.h: Add LLINT support to FreeBSD.

2014-01-15  Anders Carlsson  <andersca@apple.com>

        Get rid of RefCountedCustomAllocated
        https://bugs.webkit.org/show_bug.cgi?id=127051

        Reviewed by Antti Koivisto.

        It's not used anywhere anymore, get rid of it.

        * wtf/RefCounted.h:
        * wtf/SizeLimits.cpp:

2014-01-14  Anders Carlsson  <andersca@apple.com>

        And yet another build fix.

        * wtf/SizeLimits.cpp:

2014-01-14  Anders Carlsson  <andersca@apple.com>

        Another build fix.

        * wtf/SizeLimits.cpp:

2014-01-14  Daniel Bates  <dabates@apple.com>

        [iOS] Enable WTF_USE_UIKIT_EDITING

        * wtf/Platform.h:

2014-01-14  Daniel Bates  <dabates@apple.com>

        [iOS] Enable QuickLook
        https://bugs.webkit.org/show_bug.cgi?id=126954

        Reviewed by David Kilzer.

        * wtf/Platform.h:

2014-01-14  Anders Carlsson  <andersca@apple.com>

        Get rid of ThreadRestrictionVerifier
        https://bugs.webkit.org/show_bug.cgi?id=127004

        Reviewed by Sam Weinig.

        The ThreadRestrictionVerifier mechanism has been turned off for a while
        since it doesn't really have a good solution for objects that are passed between threads.
        Instead of having dead code in the tree, just get rid of it.
        
        * GNUmakefile.list.am:
        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/RefCounted.h:
        (WTF::RefCountedBase::ref):
        (WTF::RefCountedBase::hasOneRef):
        (WTF::RefCountedBase::refCount):
        (WTF::RefCountedBase::derefBase):
        * wtf/ThreadRestrictionVerifier.h: Removed.

2014-01-14  Benjamin Poulain  <benjamin@webkit.org>

        Enable the experimental selector code generator by default
        https://bugs.webkit.org/show_bug.cgi?id=126953

        Reviewed by Gavin Barraclough.

        * wtf/Platform.h:
        Enable CSS_SELECTOR_JIT on OS X x86_64 by default.
        The feature is not ready to ship but it is stable enough to enable
        for the bots and nightly.

2014-01-14  Brian J. Burg  <burg@cs.washington.edu>

        Add ENABLE(WEB_REPLAY) feature flag to the build system
        https://bugs.webkit.org/show_bug.cgi?id=126949

        Reviewed by Joseph Pecoraro.

        * wtf/FeatureDefines.h: for now, disable the flag by default.

2014-01-14  peavo@outlook.com  <peavo@outlook.com>

        [Win] Application name in user agent string is truncated.
        https://bugs.webkit.org/show_bug.cgi?id=126810

        Reviewed by Anders Carlsson.

        * wtf/text/StringConcatenate.h:
        (WTF::tryMakeString): Add missing 8 bit check for last argument. 

2014-01-13  Anders Carlsson  <andersca@apple.com>

        Move another deprecated symbol to DeprecatedSymbolsUsedBySafari.mm
        https://bugs.webkit.org/show_bug.cgi?id=126909

        Reviewed by Ryosuke Niwa.

        * wtf/MainThread.cpp:
        * wtf/MainThread.h:
        * wtf/mac/DeprecatedSymbolsUsedBySafari.mm:
        (WTF::callOnMainThread):

2014-01-13  Anders Carlsson  <andersca@apple.com>

        Fix Windows build.

        * wtf/ThreadingWin.cpp:
        (WTF::initializeThreading):

2014-01-13  Anders Carlsson  <andersca@apple.com>

        Remove AtomicallyInitializedStatic
        https://bugs.webkit.org/show_bug.cgi?id=126864

        Reviewed by Andreas Kling.

        Remove the lockAtomicallyInitializedStaticMutex and unlockAtomicallyInitializedStaticMutex functions
        everywhere except on Mac (where they unfortunately were used by Safari).
        
        On Mac, add them to a separate file which will hold functions and symbols that we would like
        to remove but that are used by Safari. Reimplement them in terms of std::call_once and std::mutex.

        * WTF.xcodeproj/project.pbxproj:
        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::initializeThreading):
        * wtf/ThreadingWin.cpp:
        (WTF::initializeThreading):
        * wtf/mac/DeprecatedSymbolsUsedBySafari.mm: Added.
        (WTF::atomicallyInitializedStaticMutex):
        (WTF::lockAtomicallyInitializedStaticMutex):
        (WTF::unlockAtomicallyInitializedStaticMutex):

2014-01-13  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r161855.
        http://trac.webkit.org/changeset/161855
        https://bugs.webkit.org/show_bug.cgi?id=126880

        Sister commit of r161852 (Requested by kling on #webkit).

        * wtf/ThreadingPthreads.cpp:
        (WTF::initializeThreading):

2014-01-13  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r161852.
        http://trac.webkit.org/changeset/161852
        https://bugs.webkit.org/show_bug.cgi?id=126877

        Broke ToT with system Safari (Requested by kling on #webkit).

        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::initializeThreading):
        (WTF::lockAtomicallyInitializedStaticMutex):
        (WTF::unlockAtomicallyInitializedStaticMutex):
        * wtf/ThreadingWin.cpp:
        (WTF::lockAtomicallyInitializedStaticMutex):
        (WTF::unlockAtomicallyInitializedStaticMutex):
        (WTF::initializeThreading):

2014-01-12  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r161840.
        http://trac.webkit.org/changeset/161840
        https://bugs.webkit.org/show_bug.cgi?id=126870

        Caused jsscore and layout test failures (Requested by smfr on
        #webkit).

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::replace):
        * wtf/text/WTFString.h:
        (WTF::String::isAllSpecialCharacters):

2014-01-12  Dan Bernstein  <mitz@apple.com>

        Fix an assertion failure in initializeDates() when launching Safari, which was introduced in r161852.

        Reviewed by Andy Estes.

        * wtf/ThreadingPthreads.cpp:
        (WTF::initializeThreading): Set isInitialized to true.

2014-01-12  Darin Adler  <darin@apple.com>

        Add PLATFORM(COCOA) and USE(FOUNDATION)
        https://bugs.webkit.org/show_bug.cgi?id=126859

        Reviewed by Anders Carlsson.

        * wtf/Platform.h: Added PLATFORM(COCOA), which for now is set at exactly the same
        times that PLATFORM(MAC) is. Added USE(FOUNDATION), which is set at the same times
        that PLATFORM(COCOA) is. Re-organize the PLATFORM(MAC) and PLATFORM(IOS) settings
        in the header so they are a bit easier to read. Put HAVE_LANGINFO_H in with the
        rest of the OS(UNIX) settings and put HAVE_READLINE in with the rest of the
        OS(DARWIN) settings. Tweak formatting a bit.

2014-01-12  Anders Carlsson  <andersca@apple.com>

        Remove AtomicallyInitializedStatic
        https://bugs.webkit.org/show_bug.cgi?id=126864

        Reviewed by Darin Adler.

        * wtf/Threading.h:
        * wtf/ThreadingPthreads.cpp:
        (WTF::initializeThreading):
        * wtf/ThreadingWin.cpp:
        (WTF::initializeThreading):

2014-01-12  Darin Adler  <darin@apple.com>

        Add deprecatedCharacters as a synonym for characters and convert most call sites
        https://bugs.webkit.org/show_bug.cgi?id=126858

        Reviewed by Anders Carlsson.

        * wtf/text/AtomicString.cpp:
        (WTF::HashAndUTF8CharactersTranslator::equal):
        (WTF::SubstringTranslator::hash):
        (WTF::SubstringTranslator::equal):
        * wtf/text/AtomicString.h:
        (WTF::AtomicString::characters):
        * wtf/text/Base64.cpp:
        (WTF::base64Decode):
        (WTF::base64URLDecode):
        * wtf/text/StringBuilder.h:
        (WTF::StringBuilder::characters):
        (WTF::StringBuilder::deprecatedCharacters):
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::getData16SlowCase):
        (WTF::StringImpl::upper):
        (WTF::StringImpl::lower):
        (WTF::StringImpl::find):
        (WTF::StringImpl::findIgnoringCase):
        * wtf/text/StringImpl.h:
        (WTF::StringImpl::characters):
        (WTF::StringImpl::deprecatedCharacters):
        (WTF::StringImpl::getCharacters<UChar>):
        (WTF::equalIgnoringNullity):
        * wtf/text/WTFString.cpp:
        (WTF::String::append):
        (WTF::String::appendInternal):
        (WTF::String::insert):
        (WTF::String::truncate):
        (WTF::String::percentage):
        * wtf/text/WTFString.h:
        (WTF::String::characters):
        (WTF::String::deprecatedCharacters):
        (WTF::String::getCharactersWithUpconvert<UChar>):
        (WTF::append):
        Use deprecatedCharacters instead of characters.

2014-01-12  Anders Carlsson  <andersca@apple.com>

        Remove the last remaining uses of AtomicallyInitializedStatic
        https://bugs.webkit.org/show_bug.cgi?id=126863

        Reviewed by Darin Adler.

        * wtf/HashTable.cpp:
        (WTF::hashTableStatsMutex):
        (WTF::HashTableStats::recordCollisionAtCount):
        (WTF::HashTableStats::dumpStats):
        * wtf/unicode/icu/CollatorICU.cpp:
        (WTF::cachedCollatorMutex):
        (WTF::Collator::createCollator):
        (WTF::Collator::releaseCollator):

2014-01-12  Darin Adler  <darin@apple.com>

        Reduce use of String::characters
        https://bugs.webkit.org/show_bug.cgi?id=126854

        Reviewed by Sam Weinig.

        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::replace): Use characters16 here since is8Bit was already checked.
        * wtf/text/WTFString.h:
        (WTF::String::isAllSpecialCharacters): Use characters16 here since is8Bit was
        already checked. Also renamed "len" to "length".

2014-01-12  Anders Carlsson  <andersca@apple.com>

        Replace more uses of AtomicallyInitializedStatic with std::call_once
        https://bugs.webkit.org/show_bug.cgi?id=126847

        Reviewed by Sam Weinig.

        * wtf/Forward.h:
        Forward declare NeverDestroyed.

2014-01-11  Zan Dobersek  <zdobersek@igalia.com>

        Unreviewed build fix for ports using GCC after r161770.

        * wtf/IteratorAdaptors.h:
        (WTF::FilterIterator::operator*): Replicating r161797, the const qualifier for
        FilterIterator::operator*() is removed since it clashes with some iterator types
        that are also const, causing compilation failures with GCC.

2014-01-11  Anders Carlsson  <andersca@apple.com>

        Use std::call_once instead of AtomicallyInitializedStatic when creating a HTTP header set
        https://bugs.webkit.org/show_bug.cgi?id=126837

        Reviewed by Sam Weinig.

        * wtf/HashSet.h:
        (WTF::HashSet::HashSet):
        Add a HashSet constructor that takes an initializer list.

2014-01-11  Sam Weinig  <sam@webkit.org>

        Fix the EFL build.

        * wtf/IteratorAdaptors.h:
        (WTF::TransformIterator::operator*):

2014-01-11  Sam Weinig  <sam@webkit.org>

        Add support for null StringViews
        https://bugs.webkit.org/show_bug.cgi?id=126827

        Reviewed by Anders Carlsson.

        - Do some style cleanup while in the neighborhood.

        * wtf/text/StringView.h:
        (WTF::StringView::StringView):
        Add default constructor to create a null StringView.

        (WTF::StringView::isNull):
        Add isNull(), matching the semantics of String.

        (WTF::StringView::operator bool):
        Add an explicit operator bool() to allow use in if-statements. 

2014-01-11  Sam Weinig  <sam@webkit.org>

        Clean up iterator filter / iterator range code
        https://bugs.webkit.org/show_bug.cgi?id=126817

        Reviewed by Anders Carlsson.

        - Renames IteratorPair to IteratorRange.
        - Splits FilterIterator into FilterIterator (which now only filters) and
          TransformIterator (which does the transform part of the old FilterIterator).
          Move both of these to IteratorAdaptors.h

        * GNUmakefile.list.am:
        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/FilterIterator.h: Removed.
        Add/remove files.

        * wtf/HashMap.h:
        (WTF::HashMap::keys):
        (WTF::HashMap::values):
        * wtf/RefPtrHashMap.h:
        Update for rename to IteratorRange. Simplify by using makeIteratorRange().

        * wtf/IteratorAdaptors.h: Copied from wtf/FilterIterator.h.
        (WTF::FilterIterator::FilterIterator):
        (WTF::FilterIterator::operator*):
        (WTF::makeFilterIterator):
        (WTF::TransformIterator::TransformIterator):
        (WTF::TransformIterator::operator++):
        (WTF::TransformIterator::operator*):
        (WTF::TransformIterator::operator==):
        (WTF::TransformIterator::operator!=):
        (WTF::makeTransformIterator):
        Split up filtering and transforming. Add makeFilterIterator() and makeTransformIterator()
        helpers.

        * wtf/IteratorPair.h: Removed.
        * wtf/IteratorRange.h: Copied from wtf/IteratorPair.h.
        (WTF::IteratorRange::IteratorRange):
        (WTF::makeIteratorRange):
        Renamed to IteratorRange and adds makeIteratorRange() helper.

2014-01-10  David Kilzer  <ddkilzer@apple.com>

        Clean up architectures in xcconfig files
        <http://webkit.org/b/126794>

        Reviewed by Andy Estes.

        * Configurations/Base.xcconfig:
        - Add new arch.

2014-01-10  Tamas Gergely  <tgergely.u-szeged@partner.samsung.com>

        [EFL][JSC] Enable udis86 disassembler on efl.
        https://bugs.webkit.org/show_bug.cgi?id=125502

        Reviewed by Michael Saboff.

        Enable udis86 disassembler on efl and fix build warnings.

        * wtf/Platform.h:
          Enable udis86 disassembler on EFL.

2014-01-10  Hunseop Jeong  <hs85.jeong@samsung.com>

        [EFL] Enable the DFG_JIT on ARMv7
        https://bugs.webkit.org/show_bug.cgi?id=126742

        Reviewed by Gyuyoung Kim.

        Turn on ENABLE_DFG_JIT on ARMv7 for EFL.

        * wtf/Platform.h:

2014-01-07  Mark Hahnenberg  <mhahnenberg@apple.com>

        Marking should be generational
        https://bugs.webkit.org/show_bug.cgi?id=126552

        Reviewed by Geoffrey Garen.

        * wtf/Bitmap.h:
        (WTF::WordType>::count): Added a cast that became necessary when Bitmap
        is used with smaller types than int32_t.

2014-01-09  Simon Fraser  <simon.fraser@apple.com>

        Enable async scrolling for iOS
        https://bugs.webkit.org/show_bug.cgi?id=126730

        Reviewed by Tim Horton.
        
        Turn on ENABLE_ASYNC_SCROLLING for iOS.

        * wtf/FeatureDefines.h:

2014-01-09  Anders Carlsson  <andersca@apple.com>

        Remove Blackberry and QNX bits from WTF
        https://bugs.webkit.org/show_bug.cgi?id=126726

        Reviewed by Benjamin Poulain.

        * wtf/Assertions.cpp:
        * wtf/Atomics.h:
        * wtf/CurrentTime.cpp:
        (WTF::currentCPUTime):
        * wtf/DateMath.cpp:
        * wtf/DisallowCType.h:
        * wtf/FeatureDefines.h:
        * wtf/InlineASM.h:
        * wtf/MathExtras.h:
        * wtf/NumberOfCores.cpp:
        (WTF::numberOfProcessorCores):
        * wtf/OSAllocatorPosix.cpp:
        (WTF::OSAllocator::reserveUncommitted):
        (WTF::OSAllocator::commit):
        (WTF::OSAllocator::decommit):
        * wtf/Platform.h:
        * wtf/PlatformBlackBerry.cmake: Removed.
        * wtf/RAMSize.cpp:
        (WTF::computeRAMSize):
        * wtf/StackBounds.cpp:
        * wtf/ThreadingPthreads.cpp:
        (WTF::initializeThreading):
        (WTF::initializeCurrentThreadInternal):
        * wtf/blackberry/MainThreadBlackBerry.cpp: Removed.
        * wtf/blackberry/RunLoopBlackBerry.cpp: Removed.
        * wtf/text/AtomicString.h:
        * wtf/text/StringImpl.h:
        * wtf/text/WTFString.h:

2014-01-09  Daniel Bates  <dabates@apple.com>

        [iOS] Upstream WebCore/platform changes
        https://bugs.webkit.org/show_bug.cgi?id=126654

        Rubber-stamped by David Kilzer.

        * wtf/MainThread.cpp:
        (WTF::canAccessThreadLocalDataForThread):
        * wtf/MainThread.h:

2014-01-09  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r161540.
        http://trac.webkit.org/changeset/161540
        https://bugs.webkit.org/show_bug.cgi?id=126704

        Caused assertion failures on multiple tests (Requested by ap
        on #webkit).

        * wtf/Bitmap.h:
        (WTF::WordType>::count):

2014-01-07  Mark Hahnenberg  <mhahnenberg@apple.com>

        Marking should be generational
        https://bugs.webkit.org/show_bug.cgi?id=126552

        Reviewed by Geoffrey Garen.

        * wtf/Bitmap.h:
        (WTF::WordType>::count): Added a cast that became necessary when Bitmap
        is used with smaller types than int32_t.

2014-01-08  Anders Carlsson  <andersca@apple.com>

        Add WTF::StringView and use it for grammar checking
        https://bugs.webkit.org/show_bug.cgi?id=126644

        Reviewed by Antti Koivisto.

        Add a new StringView class which is an immutable reference to either an 8-bit or a 16-bit string.

        This makes it easier to pass substrings around without having to either copy string data
        or upconvert and use UChar pointers.

        The StringView class is very loosely based on the std::string_view class which is proposed for a future version of C++,
        see http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3609.html for more details.

        * GNUmakefile.list.am:
        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Forward.h:
        * wtf/text/StringView.h: Added.
        (WTF::StringView::StringView):
        (WTF::StringView::empty):
        (WTF::StringView::characters8):
        (WTF::StringView::characters16):
        (WTF::StringView::isEmpty):
        (WTF::StringView::length):
        (WTF::StringView::is8Bit):
        (WTF::StringView::substring):
        (WTF::StringView::toString):
        (WTF::StringView::toStringWithoutCopying):
        (WTF::StringView::encodedCharacters):

2014-01-07  David Farler  <dfarler@apple.com>

        [ASAN] Building with trunk clang corrupts sandbox profile with comment from Compiler.h
        https://bugs.webkit.org/show_bug.cgi?id=124532

        Reviewed by David Kilzer.

        * wtf/Compiler.h:
        Remove this quirk - it does nothing.

2014-01-06  Filip Pizlo  <fpizlo@apple.com>

        Get rid of ENABLE(VALUE_PROFILER). It's on all the time now.

        Rubber stamped by Mark Hahnenberg.

        * wtf/Platform.h:

2014-01-06  Zan Dobersek  <zdobersek@igalia.com>

        Remove using directives for the std namespace from WTF
        https://bugs.webkit.org/show_bug.cgi?id=126524

        Reviewed by Alexey Proskuryakov.

        Remove the using directives for the std namespace throughout the WTF code.
        The more explicit std:: nested name specifier should be used instead.

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::createWithFloat):
        (WTF::MediaTime::createWithDouble):
        * wtf/text/StringImpl.cpp:
        (WTF::StringImpl::create):
        (WTF::StringImpl::lower):
        (WTF::StringImpl::upper):
        (WTF::StringImpl::foldCase):
        (WTF::StringImpl::find):
        (WTF::StringImpl::findIgnoringCase):
        (WTF::reverseFindInner):
        (WTF::StringImpl::reverseFind):
        (WTF::reverseFindIgnoringCaseInner):
        (WTF::StringImpl::reverseFindIgnoringCase):
        (WTF::StringImpl::replace):
        (WTF::StringImpl::utf8ForCharacters):
        (WTF::StringImpl::utf8ForRange):
        * wtf/text/WTFString.cpp:
        (WTF::String::append):
        (WTF::String::appendInternal):
        (WTF::String::insert):
        (WTF::String::substringSharingImpl):
        (WTF::String::fromUTF8):
        (WTF::toIntegralType):
        * wtf/win/RunLoopWin.cpp:

2014-01-03  Mark Hahnenberg  <mhahnenberg@apple.com>

        DoublyLinkedLists can't be concatenated
        https://bugs.webkit.org/show_bug.cgi?id=125976

        Reviewed by Filip Pizlo.

        * wtf/DoublyLinkedList.h:
        (WTF::DoublyLinkedList<T>::append):

2014-01-04  Zan Dobersek  <zdobersek@igalia.com>

        Explicitly use the std:: nested name specifier when using std::pair, std::make_pair
        https://bugs.webkit.org/show_bug.cgi?id=126439

        Reviewed by Andreas Kling.

        * wtf/VectorTraits.h: Stop bringing std::pair into the current scope.

2014-01-02  Gavin Barraclough  <barraclough@apple.com>

        Refactor NSActivity handling code from ChildProcess to UserActivity
        https://bugs.webkit.org/show_bug.cgi?id=126330

        Reviewed by Sam Weinig.

        UserActivity is a mechanism to express to the operating system (where appropriate)
        that a user initiated activity is taking place, and as such that resources should be
        made available to the process accordingly.

        Currently we hold a single NSActivity, at the WebKit layer. This refactoring allows us
        to hold different activity tokens for different user actions (which simplifies the
        handling, and aides debugging since the token can more accurately express the activity
        taking place), and also will allow us to avoid the layering difficulty of calling back
        up the stack to WebKit to register that an activity is taking place.

        * wtf/Platform.h:
            - added HAVE_NS_ACTIVITY.

2013-12-30  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r161157, r161158, r161160, r161161,
        r161163, and r161165.
        http://trac.webkit.org/changeset/161157
        http://trac.webkit.org/changeset/161158
        http://trac.webkit.org/changeset/161160
        http://trac.webkit.org/changeset/161161
        http://trac.webkit.org/changeset/161163
        http://trac.webkit.org/changeset/161165
        https://bugs.webkit.org/show_bug.cgi?id=126332

        Broke WebKit2 on Mountain Lion (Requested by ap on #webkit).

        * GNUmakefile.list.am:
        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Forward.h:
        * wtf/PlatformWin.cmake:
        * wtf/threads/BinarySemaphore.cpp: Added.
        (WTF::BinarySemaphore::BinarySemaphore):
        (WTF::BinarySemaphore::~BinarySemaphore):
        (WTF::BinarySemaphore::signal):
        (WTF::BinarySemaphore::wait):
        * wtf/threads/BinarySemaphore.h: Added.
        (WTF::BinarySemaphore::event):
        * wtf/threads/win/BinarySemaphoreWin.cpp: Added.
        (WTF::BinarySemaphore::BinarySemaphore):
        (WTF::BinarySemaphore::~BinarySemaphore):
        (WTF::BinarySemaphore::signal):
        (WTF::BinarySemaphore::wait):

2013-12-30  Anders Carlsson  <andersca@apple.com>

        Replace yield() and pauseBriefly() with std::this_thread::yield()
        https://bugs.webkit.org/show_bug.cgi?id=126105

        Reviewed by Sam Weinig.

        * wtf/ByteSpinLock.h:
        (WTF::ByteSpinLock::lock):
        * wtf/Threading.h:
        * wtf/ThreadingPrimitives.h:
        * wtf/ThreadingPthreads.cpp:
        * wtf/ThreadingWin.cpp:

2013-12-30  Sam Weinig  <sam@webkit.org>

        Remove unnecessary non-const overload in IteratorPair
        https://bugs.webkit.org/show_bug.cgi?id=126314

        Reviewed by Anders Carlsson.

        * wtf/IteratorPair.h:

2013-12-30  Sam Weinig  <sam@webkit.org>

        Remove WTF's BinarySemaphore
        https://bugs.webkit.org/show_bug.cgi?id=126310

        Reviewed by Anders Carlsson.

        It's unused. Also remove the now empty wtf/threads directory.

        * GNUmakefile.list.am:
        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/Forward.h:
        * wtf/PlatformWin.cmake:
        * wtf/threads: Removed.
        * wtf/threads/BinarySemaphore.cpp: Removed.
        * wtf/threads/BinarySemaphore.h: Removed.
        * wtf/threads/win: Removed.
        * wtf/threads/win/BinarySemaphoreWin.cpp: Removed.

2013-12-30  Roger Fong  <roger_fong@apple.com>

        [Windows] Unreviewed build fix following r160959.

        * wtf/Platform.h:

2013-12-30  Anders Carlsson  <andersca@apple.com>

        Replace WTF::ThreadingOnce with std::call_once
        https://bugs.webkit.org/show_bug.cgi?id=126215

        Reviewed by Sam Weinig.

        * GNUmakefile.list.am:
        * wtf/CompilationThread.cpp:
        (WTF::initializeCompilationThreads):
        * wtf/ThreadingOnce.h: Removed.

2013-12-26  Sam Weinig  <sam@webkit.org>

        Move FilterIterator and IteratorPair to WTF and reimplement HashMap::keys() and HashMap::values() using IteratorPair
        https://bugs.webkit.org/show_bug.cgi?id=126253

        Reviewed by Anders Carlsson.

        * GNUmakefile.list.am:
        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        Add new files.

        * wtf/HashMap.h:
        * wtf/RefPtrHashMap.h:
        Remove the old implementation of keys() and values() and replace it with one
        that uses IteratorPair.
        
        * wtf/FilterIterator.h: Copied from Source/WebKit2/Shared/FilterIterator.h.
        * wtf/IteratorPair.h: Copied from Source/WebKit2/Shared/IteratorPair.h.

2013-12-27  Daniel Bates  <dabates@apple.com>

        [iOS] Upstream WebCore/page changes
        https://bugs.webkit.org/show_bug.cgi?id=126180

        Reviewed by Darin Adler.

        * wtf/FeatureDefines.h: Define ENABLE_IOS_TOUCH_EVENTS to be enabled by default
        when building iOS with ENABLE(TOUCH_EVENTS).

2013-12-25  Thiago de Barros Lacerda  <thiago.lacerda@openbossa.org>

        [Nix] Building with DRAG_SUPPORT enabled
        https://bugs.webkit.org/show_bug.cgi?id=126233

        Reviewed by Daniel Bates.

        * wtf/nix/FeatureDefinesNix.h:

2013-12-24  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r160959.
        http://trac.webkit.org/changeset/160959
        https://bugs.webkit.org/show_bug.cgi?id=126222

        Caused Windows build to fail (Requested by rfong on #webkit).

        * wtf/ByteSpinLock.h:
        (WTF::ByteSpinLock::lock):
        * wtf/Threading.h:
        * wtf/ThreadingPrimitives.h:
        (WTF::pauseBriefly):
        * wtf/ThreadingPthreads.cpp:
        (WTF::yield):
        * wtf/ThreadingWin.cpp:
        (WTF::yield):

2013-12-23  Benjamin Poulain  <bpoulain@apple.com>

        Fix the build after r161031

        I enabled ENABLE_CSS_SELECTOR_JIT by accident.

        * wtf/Platform.h:

2013-12-23  Zan Dobersek  <zdobersek@igalia.com>

        [GTK] Clean up compiler optimizations flags for libWTF, libJSC
        https://bugs.webkit.org/show_bug.cgi?id=126157

        Reviewed by Gustavo Noronha Silva.

        * GNUmakefile.am: Remove the -fstrict-aliasing and -O3 compiler flags for libWTF.la. -O3 gets
        overridden by -O2 that's listed in CXXFLAGS (or -O0 in case of debug builds) and -fstrict-aliasing
        is enabled when -O2 is used (and shouldn't be enabled in debug builds anyway).

2013-12-20  Anders Carlsson  <andersca@apple.com>

        Replace yield() and pauseBriefly() with std::this_thread::yield()
        https://bugs.webkit.org/show_bug.cgi?id=126105

        Reviewed by Sam Weinig.

        * wtf/ByteSpinLock.h:
        (WTF::ByteSpinLock::lock):
        * wtf/Threading.h:
        * wtf/ThreadingPrimitives.h:
        * wtf/ThreadingPthreads.cpp:
        * wtf/ThreadingWin.cpp:

2013-12-20  Anders Carlsson  <andersca@apple.com>

        Speed up case folding for 8-bit strings
        https://bugs.webkit.org/show_bug.cgi?id=126098

        Reviewed by Geoffrey Garen.

        Add a case folding lookup table for 8-bit strings and use it instead of calling down to u_foldCase.
        On a simple microbenchmark using a lookup table is about 15x faster.

        * wtf/text/StringHash.h:
        (WTF::CaseFoldingHash::foldCase):
        * wtf/text/StringImpl.cpp:
        (WTF::equalIgnoringCase):
        * wtf/text/StringImpl.h:

2013-12-20  Myles C. Maxfield  <mmaxfield@apple.com>

        Faster implementation of text-decoration-skip: ink
        https://bugs.webkit.org/show_bug.cgi?id=125718

        Reviewed by Simon Fraser.

        This creates a new preprocessor define, CSS3_TEXT_DECORATION_SKIP_INK,
        which enables the use of the text-decoration-skip: ink CSS value.
        Creating this new value simplifies the logic about when to enable the
        codepath for this CSS value.

        * wtf/Platform.h:

2013-12-20  Simon Fraser  <simon.fraser@apple.com>

        Change "threaded scrolling" terminology to "asynchronous scrolling"
        https://bugs.webkit.org/show_bug.cgi?id=126094

        Reviewed by Tim Horton.

        Rename ENABLE_THREADED_SCROLLING to ENABLE_ASYNC_SCROLLING.

        * wtf/FeatureDefines.h:

2013-12-20  Tamas Gergely  <tgergely.u-szeged@partner.samsung.com>

        Build fails in debug mode after r160834.
        https://bugs.webkit.org/show_bug.cgi?id=126059

        Reviewed by Csaba Osztrogonác.

        Debug mode build failed due to comparing signed and unsigned in
        ASSERT(). Now both values are unsigned.

        * wtf/dtoa/double-conversion.cc:

2013-12-19  Alex Christensen  <achristensen@webkit.org>

        Final preparations for GStreamer on Windows.
        https://bugs.webkit.org/show_bug.cgi?id=125958

        Reviewed by Benjamin Poulain.

        * WTF.vcxproj/WTFDebugWinCairo.props:
        * WTF.vcxproj/WTFReleaseWinCairo.props:
        Include WinCairo.props.
        * wtf/Platform.h:
        Use GLib and GStreamer on WinCairo with video.

2013-12-18  Daniel Bates  <dabates@apple.com>

        WTF, JavaScriptCore fails to build with trunk clang: operators new, new[],
        delete, delete[] cannot be declared inline
        https://bugs.webkit.org/show_bug.cgi?id=124186
        <rdar://problem/15644039>

        Reviewed by Geoffrey Garen and Anders Carlsson.

        Following <http://llvm.org/viewvc/llvm-project?view=revision&revision=193044>
        (http://llvm.org/bugs/show_bug.cgi?id=17591>), Clang emits warnings when
        operator new, delete are inlined. Such definitions cannot be inline per
        replacement.functions (17.6.4.6/3) of the C++ standard. For now,
        disable these warnings instead of exporting these functions.

        * wtf/FastMalloc.h:

2013-12-19  Hugo Parente Lima  <hugo.lima@openbossa.org>

        WTF fails to compile with gcc 4.8.2 and -Werror=array-bounds
        https://bugs.webkit.org/show_bug.cgi?id=125936

        Reviewed by Anders Carlsson.

        * wtf/dtoa/double-conversion.cc: Use a unsigned instead of int on buffer_pos type.

2013-12-19  Peter Szanka  <h868064@stud.u-szeged.hu>

        Delete RVCT related code parts.
        https://bugs.webkit.org/show_bug.cgi?id=125626

        Reviewed by Csaba Osztrogonác.

        * wtf/Compiler.h: follow-up fix for r160648, remove an unnecessary comment.

2013-12-18  Alex Christensen  <achristensen@webkit.org>

        [WinCairo] Preparation for GStreamer on Windows.
        https://bugs.webkit.org/show_bug.cgi?id=125946

        Reviewed by Brent Fulgham.

        * WTF.vcxproj/WTF.vcxproj:
        Use new GStreamer property sheets for WinCairo.

2013-12-18  Mark Hahnenberg  <mhahnenberg@apple.com>

        DFG should have a separate StoreBarrier node
        https://bugs.webkit.org/show_bug.cgi?id=125530

        Reviewed by Filip Pizlo.

        * wtf/Platform.h: Added an #define for ENABLE(GGC) which will be used for landing things related to GenGC.

2013-12-16  Daniel Bates  <dabates@apple.com>

        [iOS] Upstream WebCore/html changes
        https://bugs.webkit.org/show_bug.cgi?id=125765

        Reviewed by Darin Adler.

        Defined ENABLE_IOS_AUTOCORRECT_AND_AUTOCAPITALIZE, enabled by default on iOS.

        * wtf/FeatureDefines.h:

2013-12-17  Alex Christensen  <achristensen@webkit.org>

        Compile fix for WebGL on Windows without GRAPHICS_SURFACE.
        https://bugs.webkit.org/show_bug.cgi?id=125867

        Reviewed by Martin Robinson.

        * wtf/FeatureDefines.h:
        Removed unused ENABLE_GLIB_SUPPORT macro.
        * wtf/Platform.h:
        Don't use GRAPHICS_SURFACE for WebGL on Windows.

2013-12-17  Alex Christensen  <achristensen@webkit.org>

        [Win] Fixed linker error with GStreamer.
        https://bugs.webkit.org/show_bug.cgi?id=124861

        Reviewed by Martin Robinson.

        * wtf/gobject/GOwnPtr.cpp:
        (WTF::GError):
        * wtf/gobject/GOwnPtr.h:
        Added WTF_EXPORT_PRIVATE to freeOwnedGPtr<GError> declaration and definition.

2013-12-17  Benjamin Poulain  <benjamin@webkit.org>

        Add a simple register allocator to WebCore for x86_64
        https://bugs.webkit.org/show_bug.cgi?id=125771

        Reviewed by Geoffrey Garen.

        * wtf/Platform.h: Add a new flag "CSS_SELECTOR_JIT" to guard
        an experimental JIT compiler in WebCore.

2013-12-16  Anders Carlsson  <andersca@apple.com>

        Remove EnumClass.h from WTF
        https://bugs.webkit.org/show_bug.cgi?id=125820

        Reviewed by Darin Adler.

        All compilers we build on now support real strongly typed enums, so we can remove the ENUM_CLASS version.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CheckedArithmetic.h:
        * wtf/EnumClass.h: Removed.

2013-12-16  Brent Fulgham  <bfulgham@apple.com>

        [Win] Remove dead code after conversion to VS2013
        https://bugs.webkit.org/show_bug.cgi?id=125795

        Reviewed by Darin Adler.

        * wtf/Assertions.h: Include <inttypes.h> now that it exists.
        * wtf/Compiler.h: Update compiler checks for VS2013, and
        enable support for NEVER_INLINE
        * wtf/HashFunctions.h:
        (WTF::PtrHash::hash): Remove compiler workaround.
        * wtf/MathExtras.h: Remove C99 functions that are now supplied
        by the MS runtime library.
        * wtf/Platform.h: Remove old MSVC support flags.
        * wtf/StdLibExtras.h: Remove old MSVC workaround code.

2013-12-16  Alex Christensen  <achristensen@webkit.org>

        Fixed Win64 build on VS2013.
        https://bugs.webkit.org/show_bug.cgi?id=125753

        Reviewed by Brent Fulgham.

        * WTF.vcxproj/WTF.vcxproj:
        Added correct PlatformToolset for 64-bit builds.

2013-12-16  Peter Szanka  <h868064@stud.u-szeged.hu>

        Delete RVCT related code parts.
        https://bugs.webkit.org/show_bug.cgi?id=125626

        Reviewed by Darin Adler.

        * wtf/Assertions.h:
        * wtf/Compiler.h:
        * wtf/FastMalloc.h:
        * wtf/Platform.h:

2013-12-13  Brent Fulgham  <bfulgham@apple.com>

        [Win] Remove Pre-VS2013 support code.
        https://bugs.webkit.org/show_bug.cgi?id=125693

        Reviewed by Darin Adler.

        * wtf/StringPrintStream.cpp:
        (WTF::StringPrintStream::vprintf): Use va_copy, like a civilized person.

2013-12-12  Darin Adler  <darin@apple.com>

        Incorrect handling of non-ASCII characters in WTF::base64DecodeInternal
        https://bugs.webkit.org/show_bug.cgi?id=125658

        Reviewed by Alexey Proskuryakov.

        * wtf/text/Base64.cpp:
        (WTF::base64EncodeInternal): Use a reference to an array instead of a pointer
        for the table argument type so we check the size of the array at the call site.
        (WTF::base64DecodeInternal): Ditto. Also added an bounds check before using the
        table so we don't load some random value for non-ASCII characters.

2013-12-13  Brent Fulgham  <bfulgham@apple.com>

        [Win] Unreviewed build fix after r160548

        * WTF.vcxproj/WTFGenerated.vcxproj: Specify that we are using
        the vs12_xp target for Makefile-based projects.

2013-12-13  Anders Carlsson  <andersca@apple.com>

        Require variadic templates to build WebKit
        https://bugs.webkit.org/show_bug.cgi?id=125701

        Reviewed by Andreas Kling.

        * wtf/Compiler.h:
        Add an #error if variadic templates are disabled.

        * wtf/NeverDestroyed.h:
        * wtf/PassRef.h:
        * wtf/StdLibExtras.h:
        Remove a bunch of COMPILER_SUPPORTS(CXX_VARIADIC_TEMPLATES) #ifdefs.

2013-12-13  Peter Szanka  <h868064@stud.u-szeged.hu>

        Delete INTEL C compiler related code parts.
        https://bugs.webkit.org/show_bug.cgi?id=125625

        Reviewed by Darin Adler.

        * wtf/Assertions.h:
        * wtf/Compiler.h:

2013-12-13  Brent Fulgham  <bfulgham@apple.com>

        [Win] Switch WebKit solution to Visual Studio 2013
        https://bugs.webkit.org/show_bug.cgi?id=125192

        Reviewed by Anders Carlsson.

        * WTF.vcxproj/WTF.vcxproj: Update for VS2013
        * WTF.vcxproj/WTF.vcxproj.filters: Ditto

2013-12-12  Brady Eidson  <beidson@apple.com>

        DatabaseProcess IndexedDB: Establish a metadata backing store on disk
        https://bugs.webkit.org/show_bug.cgi?id=125258

        Reviewed by Alexey Proskuryakov, Anders Carlsson, and Tim Horton.

        * wtf/text/WTFString.h: Export toUInt64Strict().

2013-12-12  Sam Weinig  <sam@webkit.org>

        Replace uses of WTF::BitArray with std::bitset
        https://bugs.webkit.org/show_bug.cgi?id=125642

        Reviewed by Anders Carlsson.

        * GNUmakefile.list.am:
        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/BitArray.h: Removed.
        * wtf/CMakeLists.txt:

2013-12-11  David Kilzer  <ddkilzer@apple.com>

        Define m_hasBadParent in InlineBox if defined(ADDRESS_SANITIZER)
        <http://webkit.org/b/125329>

        Reviewed by Darin Adler.

        * wtf/Assertions.h: Define macro
        ASSERT_WITH_SECURITY_IMPLICATION_DISABLED based on whether
        ASSERT_WITH_SECURITY_IMPLICATION() is enabled.

2013-12-11  Brendan Long  <b.long@cablelabs.com>

        Type punning error in MD5.cpp
        https://bugs.webkit.org/show_bug.cgi?id=125412

        Reviewed by Darin Adler.

        * wtf/MD5.cpp:
        (WTF::toLittleEndian): Renamed, and use memcpy instead of casting.
        (WTF::MD5::addBytes): Renamed reverseBytes to toLittleEndian.
        (WTF::MD5::checksum): Same, and use memcpy instead of casting to prevent type punning error.

2013-12-11  Laszlo Vidacs  <lac@inf.u-szeged.hu>

        Store SHA1 hash in std::array
        https://bugs.webkit.org/show_bug.cgi?id=125446

        Reviewed by Darin Adler.

        Change Vector to std::array and use typedef.

        * wtf/SHA1.cpp:
        (WTF::SHA1::computeHash):
        (WTF::SHA1::hexDigest):
        (WTF::SHA1::computeHexDigest):
        * wtf/SHA1.h:

2013-12-11  Oliver Hunt  <oliver@apple.com>

        Give Unique StringImpls a meaningful data pointer
        https://bugs.webkit.org/show_bug.cgi?id=125598

        Reviewed by Michael Saboff.

        Found by code inspection.  If there is a collision in an Identifier
        table when comparing to a string literal we attempt to use the data
        pointer (essentially this ends up being a null termination check).

        Previously unique pointers just used the literal 1 as the data address
        but this obviously fails when dereferenced.  Instead we now make the
        data pointer point to the location of the buffer pointer itself.  As
        the buffer pointer is initialised to 0, this satisfies the requirement
        that the 0-length unique string is null terminated.

        * wtf/text/StringImpl.h:
        (WTF::StringImpl::StringImpl):

2013-12-10  Anders Carlsson  <andersca@apple.com>

        Add a HashMap constructor that takes an initializer list
        https://bugs.webkit.org/show_bug.cgi?id=125551

        Reviewed by Dan Bernstein.

        * wtf/HashMap.h:
        (WTF::HashMap::HashMap):

2013-12-10  Laszlo Vidacs  <lac@inf.u-szeged.hu>

        Use std::array when computing MD5 checksum
        https://bugs.webkit.org/show_bug.cgi?id=125509

        Reviewed by Anders Carlsson.

        Added MD5::Digest type and MD5::hashSize for computing MD5 checksum.

        * wtf/MD5.cpp:
        (WTF::MD5::checksum):
        * wtf/MD5.h:

2013-12-10  Martin Robinson  <mrobinson@igalia.com>

        Various fixes for the CMake GTK+ build

        Reviewed by Gustavo Noronha.

        * wtf/PlatformGTK.cmake: Add Zlib library to the WTF build.

2013-12-09  Sam Weinig  <sam@webkit.org>

        Remove FixedArray
        https://bugs.webkit.org/show_bug.cgi?id=125478

        Reviewed by Anders Carlsson.

        * GNUmakefile.list.am:
        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/FixedArray.h: Removed.

2013-12-09  Sam Weinig  <sam@webkit.org>

        Replace use of WTF::FixedArray with std::array
        https://bugs.webkit.org/show_bug.cgi?id=125475

        Reviewed by Anders Carlsson.

        * wtf/AVLTree.h:
        * wtf/Bitmap.h:
        * wtf/SixCharacterHash.cpp:
        (WTF::integerToSixCharacterHashString):
        * wtf/SixCharacterHash.h:

2013-12-06  Roger Fong <roger_fong@apple.com> and Brent Fulgham  <bfulgham@apple.com>

        [Win] Support compiling with VS2013
        https://bugs.webkit.org/show_bug.cgi?id=125353

        Reviewed by Anders Carlsson.

        * wtf/Compiler.h: Show proper features for VS2012 and VS2013.
        * wtf/MathExtras.h: Don't implement common C99 routines when
        they are available through the runtime libraries.
        * wtf/RetainPtr.h:
        (WTF::RetainPtr::operator bool): Added.
        * wtf/StdLibExtras.h: Use Microsoft's version of make_unique
        when it exists.

2013-12-06  Laszlo Vidacs  <lac@inf.u-szeged.hu>

        Define SHA1 hash size in SHA1.h and use it at various places.
        https://bugs.webkit.org/show_bug.cgi?id=125345

        Reviewed by Darin Adler.

        Use SHA1::hashSize instead of local variables.

        * wtf/SHA1.h: define SHA1 hash size

2013-12-05  Iain Lane  <iain.lane@canonical.com>

        Remove USE(LOCKFREE_THREADSAFEREFCOUNTED) from Atomics.cpp since it is
        no longer defined.
        https://bugs.webkit.org/show_bug.cgi?id=124502

        Reviewed by Anders Carlsson.

        * wtf/Atomics.cpp:

2013-12-04  Ryosuke Niwa  <rniwa@webkit.org>

        Enable HTMLTemplateElement by default
        https://bugs.webkit.org/show_bug.cgi?id=123851

        Reviewed by Antti Koivisto.

        * wtf/FeatureDefines.h:

2013-12-04  Dan Bernstein  <mitz@apple.com>

        Replace USE(SECURITY_FRAMEWORK) with finer-grained defines
        https://bugs.webkit.org/show_bug.cgi?id=125242

        Reviewed by Sam Weinig.

        * wtf/Platform.h: Removed definitions of WTF_USE_SECURITY_FRAMEWORK, and defined
        HAVE_SEC_IDENTITY and HAVE_SEC_KEYCHAIN.

2013-12-03  Joseph Pecoraro  <pecoraro@apple.com>

        Web Inspector: Push Remote Inspector debugging connection management into JavaScriptCore
        https://bugs.webkit.org/show_bug.cgi?id=124613

        Reviewed by Timothy Hatcher.

        * wtf/ios/WebCoreThread.cpp:
        * wtf/ios/WebCoreThread.h:
        Expose WebThreadRun/WebThreadRunSync iOS methods defined in WebCore through
        WTF so that JavaScriptCore can use it. Another such method already existed.

2013-12-03  Mark Lam  <mark.lam@apple.com>

        testapi test crashes on Windows in WTF::Vector<wchar_t,64,WTF::UnsafeVectorOverflow>::size().
        https://bugs.webkit.org/show_bug.cgi?id=121972.

        Reviewed by Brent Fulgham.

        * wtf/OSAllocatorWin.cpp:
        (WTF::OSAllocator::decommit):
        (WTF::OSAllocator::releaseDecommitted):
        - Added a check to ensure that the bytes to decommit / release is not 0.
          On Windows, a 0 length passed to VirtualFree() has a special meaning,
          and it's not "decommit / release nothing" as one would expect. Adding
          this check makes OSAllocatorWin consistent with OSAllocatorPosix for
          these 2 functions.

2013-12-02  Mark Lam  <mark.lam@apple.com>

        Build failure when disabling JIT, YARR_JIT, and ASSEMBLER.
        https://bugs.webkit.org/show_bug.cgi?id=123809.

        Reviewed by Geoffrey Garen.

        * wtf/Platform.h:
        - Ensure that the ASSEMBLER is enabled when the DISASSEMBLER is enabled.

2013-11-30  peavo@outlook.com  <peavo@outlook.com>

        [Win] Some JavaScript date tests are failing.
        https://bugs.webkit.org/show_bug.cgi?id=124946

        Reviewed by Brent Fulgham.

        Use native Win32 api functions to compute Daylight saving time offset.

        * wtf/DateMath.cpp:
        (WTF::UnixTimeToFileTime): Added method to calculate Win32 specific struct FILETIME from time_t value.
        (WTF::calculateDSTOffset): Use native Win32 api functions to compute Daylight saving time offset.

2013-11-28  Thiago de Barros Lacerda  <thiago.lacerda@openbossa.org>

        Nix Upstream: Updating Nix WTF files
        https://bugs.webkit.org/show_bug.cgi?id=124980

        Reviewed by Csaba Osztrogonác.

        Just to sync our private repo files and the trunk, as part of the upstream process.

        * wtf/DisallowCType.h:
        * wtf/PlatformNix.cmake:
        * wtf/nix/FeatureDefinesNix.h:
        * wtf/nix/PlatformNix.h:
        * wtf/nix/RunLoopNix.cpp: Added.

2013-11-28  Antti Koivisto  <antti@apple.com>

        Remove feature: CSS variables
        https://bugs.webkit.org/show_bug.cgi?id=114119

        Reviewed by Andreas Kling.

        * wtf/FeatureDefines.h:

2013-11-26  Filip Pizlo  <fpizlo@apple.com>

        Do bytecode validation as part of testing
        https://bugs.webkit.org/show_bug.cgi?id=124913

        Reviewed by Oliver Hunt.

        * GNUmakefile.list.am:
        * WTF.vcxproj/WTF.vcxproj:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/FastBitVector.cpp: Added.
        (WTF::FastBitVector::dump):
        * wtf/FastBitVector.h:
        (WTF::FastBitVector::resize):
        (WTF::FastBitVector::bitCount):
        (WTF::FastBitVector::arrayLength):

2013-11-27  Tamas Gergely  <tgergely.u-szeged@partner.samsung.com>

        Remove Sparc specific code.
        https://bugs.webkit.org/show_bug.cgi?id=124941

        Reviewed by Michael Saboff.

        Sparc is not supported, remove leftover code.

        * wtf/Platform.h:
        * wtf/dtoa/utils.h:

2013-11-26  Marcelo Lira  <marcelo.lira@openbossa.org>

        Nix upstreaming - Adding build files and supporting scripts
        https://bugs.webkit.org/show_bug.cgi?id=118367

        Reviewed by Ryosuke Niwa.

        * wtf/FeatureDefines.h:
        * wtf/Platform.h:
        * wtf/PlatformNix.cmake: Added.

2013-11-26  Drew Yao  <ayao@apple.com>

        ASSERT_WITH_SECURITY_IMPLICATION should crash in a distinct way.
        https://bugs.webkit.org/show_bug.cgi?id=124757

        Change ASSERT_WITH_SECURITY_IMPLICATION to access a different address from CRASH()
        in order to help screen fuzzing bugs.

        Reviewed by Brent Fulgham.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h:

2013-11-24  Tim Horton  <timothy_horton@apple.com>

        Upstream USE(IOSURFACE) from the iOS port
        https://bugs.webkit.org/show_bug.cgi?id=124814

        Reviewed by Sam Weinig.

        Some code guarded by USE(IOSURFACE) was recently upstreamed,
        but not the definition of WTF_USE_IOSURFACE itself.

        * wtf/Platform.h:

2013-11-23  Xabier Rodriguez Calvar  <calvaris@igalia.com>

        [GStreamer] Remove 0.10 codepath
        https://bugs.webkit.org/show_bug.cgi?id=124534

        Reviewed by Philippe Normand.

        * wtf/Platform.h: Removed macro for GStreamer 1.0 as it is the
        only codepath now.

2013-11-21  Peter Molnar  <pmolnar.u-szeged@partner.samsung.com>

        Remove ENABLE_WORKERS
        https://bugs.webkit.org/show_bug.cgi?id=105784

        Reviewed by Darin Adler.

        * wtf/FeatureDefines.h:
        * wtf/nix/FeatureDefinesNix.h:

2013-11-21  Mark Rowe  <mrowe@apple.com>

        <https://webkit.org/b/124701> Fix an error in a few Xcode configuration setting files.

        Reviewed by Alexey Proskuryakov.

        * Configurations/Base.xcconfig:

2013-11-20  Mark Lam  <mark.lam@apple.com>

        Introducing VMEntryScope to update the VM stack limit.
        https://bugs.webkit.org/show_bug.cgi?id=124634.

        Reviewed by Geoffrey Garen.

        * wtf/Platform.h:
        * wtf/StackBounds.h:
        (WTF::StackBounds::StackBounds):

2013-11-18  Filip Pizlo  <fpizlo@apple.com>

        Allow the FTL debug dumps to include the new size field
        https://bugs.webkit.org/show_bug.cgi?id=124479

        Reviewed by Mark Hahnenberg.

        * wtf/PrintStream.cpp:
        (WTF::printInternal):
        * wtf/PrintStream.h:

2013-11-17  Jer Noble  <jer.noble@apple.com>

        [WTF] Media time should not have a constructor which accepts a single int or float.
        https://bugs.webkit.org/show_bug.cgi?id=124470

        Having a constructor taking a single number value, as it's very easy to accidentially mis-
        initialize a MediaTime with a double (automatically casted to a int64_t).

        Reviewed by Eric Carlson.

        * wtf/MediaTime.h:

2013-11-18  Csaba Osztrogonác  <ossy@webkit.org>

        URTBF after r159432 to make WinCairo build happy.

        * wtf/text/WTFString.h:

2013-11-18  Carlos Garcia Campos  <cgarcia@igalia.com>

        Unreviewed. Fix make distcheck.

        * GNUmakefile.list.am: Add missing header file.

2013-11-16  Alexey Proskuryakov  <ap@apple.com>

        Use uint8_t vectors for WebCrypto data
        https://bugs.webkit.org/show_bug.cgi?id=124466

        Reviewed by Sam Weinig.

        Binary data can be UTF-8, in which case "char*" is idiomatic, or it can be arbitrary
        binary data, in which case "uint8_t*" is more common.

        Changed encode functions that took "const char *" to "const void*", and decode
        functions that took "Vector<char>&" now take an adapter class.

        The adapter relies on Vector<char> and Vector<uint8_t> classes having an identical layout.

        * wtf/text/Base64.cpp:
        (WTF::base64Encode):
        (WTF::base64URLEncode):
        (WTF::base64DecodeInternal):
        (WTF::base64Decode):
        (WTF::base64URLDecode):
        * wtf/text/Base64.h:
        (WTF::SignedOrUnsignedCharVectorAdapter):
        (WTF::ConstSignedOrUnsignedCharVectorAdapter):
        (WTF::base64Encode):
        (WTF::base64URLEncode):

2013-11-15  Alexey Proskuryakov  <ap@apple.com>

        Support exporting symmetric keys as JWK
        https://bugs.webkit.org/show_bug.cgi?id=124442

        Reviewed by Sam Weinig.

        Base64URL encoding doesn't use '=' padding, and doesn't need any other options.
        Added this mode for encode, and removed policy arguments from exposed functions.

        * wtf/text/Base64.cpp:
        (WTF::base64EncodeInternal):
        (WTF::base64URLEncode):
        (WTF::base64URLDecode):
        * wtf/text/Base64.h:
        (WTF::base64URLEncode):

2013-11-15  Mark Hahnenberg  <mhahnenberg@apple.com>

        Remove VTableSpectrum
        https://bugs.webkit.org/show_bug.cgi?id=124427

        Reviewed by Filip Pizlo.

        * wtf/Platform.h:

2013-11-15  Jer Noble  <jer.noble@apple.com>

        MediaTime addition and subtraction operators have errors when the rhs is infinite.
        https://bugs.webkit.org/show_bug.cgi?id=124413

        Reviewed by Eric Carlson.

        Correctly account for infinities that can occur on the right-hand side of addition or
        subtraction operators.

        * wtf/MediaTime.cpp:
        (WTF::MediaTime::operator+):
        (WTF::MediaTime::operator-):

2013-11-14  Oliver Hunt  <oliver@apple.com>

        Make CLoop easier to build, and make it work
        https://bugs.webkit.org/show_bug.cgi?id=124359

        Reviewed by Geoffrey Garen.

        Make building with the CLoop forcibly enabled manually
        disable the JITs

        * wtf/Platform.h:

2013-11-14  Andreas Kling  <akling@apple.com>

        FontDescription copies should share families list, not duplicate it.
        <https://webkit.org/b/124338>

        Add RefCountedArray::operator==.

        Reviewed by Antti Koivisto.

2013-11-13  Anders Carlsson  <andersca@apple.com>

        Add a Vector constructor that takes an std::initializer_list
        https://bugs.webkit.org/show_bug.cgi?id=124287

        Reviewed by Antti Koivisto.

        * wtf/Compiler.h:
        * wtf/Vector.h:
        (WTF::Vector::Vector):

2013-11-12  Brent Fulgham  <bfulgham@apple.com>

        [Win] Unreviewed gardening.

        * WTF.vcxproj/WTF.vcxproj.filters: Tidy up filters so files show up
        in their proper directories.

2013-11-12  Alex Christensen  <achristensen@webkit.org>

        Build GStreamer files on Windows.
        https://bugs.webkit.org/show_bug.cgi?id=124180

        Reviewed by Brent Fulgham.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.vcxproj/copy-files.cmd:
        Include gobject files in WinCairo build.

2013-11-09  Filip Pizlo  <fpizlo@apple.com>

        Switch FTL GetById/PutById IC's over to using AnyRegCC
        https://bugs.webkit.org/show_bug.cgi?id=124094

        Reviewed by Sam Weinig.
        
        I needed to add another set operation, namely filter(), which is an in-place set
        intersection.

        * wtf/BitVector.cpp:
        (WTF::BitVector::filterSlow):
        * wtf/BitVector.h:
        (WTF::BitVector::filter):

2013-11-10  Ryuan Choi  <ryuan.choi@samsung.com>

        [EFL] Build break on Ubuntu 13.10
        https://bugs.webkit.org/show_bug.cgi?id=124131

        Reviewed by Gyuyoung Kim.

        Turned DisallowCType macros off on EFL port because gtest-internal.h uses isspace().

        * wtf/DisallowCType.h: Added !PLATFORM(EFL) guard.

2013-11-09  Patrick Gansterer  <paroga@webkit.org>

        Move RunLoop from WebCore to WTF
        https://bugs.webkit.org/show_bug.cgi?id=116606

        Reviewed by Anders Carlsson.

        With this change RunLoop can be used in JavaScriptCore too.

        * GNUmakefile.list.am:
        * WTF.vcxproj/WTF.vcxproj:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/CMakeLists.txt:
        * wtf/PlatformBlackBerry.cmake:
        * wtf/PlatformEfl.cmake:
        * wtf/PlatformGTK.cmake:
        * wtf/PlatformWin.cmake:
        * wtf/RunLoop.cpp: Renamed from Source/WebCore/platform/RunLoop.cpp.
        (WTF::RunLoop::Holder::Holder):
        (WTF::RunLoop::Holder::runLoop):
        (WTF::RunLoop::initializeMainRunLoop):
        (WTF::RunLoop::current):
        (WTF::RunLoop::main):
        (WTF::RunLoop::isMain):
        (WTF::RunLoop::performWork):
        (WTF::RunLoop::dispatch):
        * wtf/RunLoop.h: Renamed from Source/WebCore/platform/RunLoop.h.
        (WTF::RunLoop::TimerBase::startRepeating):
        (WTF::RunLoop::TimerBase::startOneShot):
        (WTF::RunLoop::TimerBase::isRepeating):
        (WTF::RunLoop::Timer::Timer):
        (WTF::RunLoop::Timer::fired):
        * wtf/blackberry/RunLoopBlackBerry.cpp: Renamed from Source/WebCore/platform/blackberry/RunLoopBlackBerry.cpp.
        (WTF::RunLoop::RunLoop):
        (WTF::RunLoop::~RunLoop):
        (WTF::RunLoop::wakeUp):
        * wtf/cf/RunLoopCF.cpp: Renamed from Source/WebCore/platform/cf/RunLoopCF.cpp.
        (WTF::RunLoop::performWork):
        (WTF::RunLoop::RunLoop):
        (WTF::RunLoop::~RunLoop):
        (WTF::RunLoop::runForDuration):
        (WTF::RunLoop::wakeUp):
        (WTF::RunLoop::run):
        (WTF::RunLoop::stop):
        (WTF::RunLoop::TimerBase::timerFired):
        (WTF::RunLoop::TimerBase::TimerBase):
        (WTF::RunLoop::TimerBase::~TimerBase):
        (WTF::RunLoop::TimerBase::start):
        (WTF::RunLoop::TimerBase::stop):
        (WTF::RunLoop::TimerBase::isActive):
        * wtf/efl/RunLoopEfl.cpp: Renamed from Source/WebCore/platform/efl/RunLoopEfl.cpp.
        (WTF::RunLoop::RunLoop):
        (WTF::RunLoop::~RunLoop):
        (WTF::RunLoop::run):
        (WTF::RunLoop::stop):
        (WTF::RunLoop::wakeUpEvent):
        (WTF::RunLoop::wakeUp):
        (WTF::RunLoop::TimerBase::TimerBase):
        (WTF::RunLoop::TimerBase::~TimerBase):
        (WTF::RunLoop::TimerBase::timerFired):
        (WTF::RunLoop::TimerBase::start):
        (WTF::RunLoop::TimerBase::stop):
        (WTF::RunLoop::TimerBase::isActive):
        * wtf/gtk/RunLoopGtk.cpp: Renamed from Source/WebCore/platform/gtk/RunLoopGtk.cpp.
        (WTF::RunLoop::RunLoop):
        (WTF::RunLoop::~RunLoop):
        (WTF::RunLoop::run):
        (WTF::RunLoop::innermostLoop):
        (WTF::RunLoop::pushNestedMainLoop):
        (WTF::RunLoop::popNestedMainLoop):
        (WTF::RunLoop::stop):
        (WTF::RunLoop::queueWork):
        (WTF::RunLoop::wakeUp):
        (WTF::RunLoop::TimerBase::TimerBase):
        (WTF::RunLoop::TimerBase::~TimerBase):
        (WTF::RunLoop::TimerBase::clearTimerSource):
        (WTF::RunLoop::TimerBase::timerFiredCallback):
        (WTF::RunLoop::TimerBase::start):
        (WTF::RunLoop::TimerBase::stop):
        (WTF::RunLoop::TimerBase::isActive):
        * wtf/win/RunLoopWin.cpp: Renamed from Source/WebCore/platform/win/RunLoopWin.cpp.
        (WTF::RunLoop::RunLoopWndProc):
        (WTF::RunLoop::wndProc):
        (WTF::RunLoop::run):
        (WTF::RunLoop::stop):
        (WTF::RunLoop::registerRunLoopMessageWindowClass):
        (WTF::RunLoop::RunLoop):
        (WTF::RunLoop::~RunLoop):
        (WTF::RunLoop::wakeUp):
        (WTF::RunLoop::TimerBase::timerFired):
        (WTF::generateTimerID):
        (WTF::RunLoop::TimerBase::TimerBase):
        (WTF::RunLoop::TimerBase::~TimerBase):
        (WTF::RunLoop::TimerBase::start):
        (WTF::RunLoop::TimerBase::stop):
        (WTF::RunLoop::TimerBase::isActive):

2013-11-08  Alexey Proskuryakov  <ap@apple.com>

        Make base64url decoding actually work
        https://bugs.webkit.org/show_bug.cgi?id=124050

        Reviewed by Sam Weinig.

        * wtf/text/Base64.cpp: (WTF::base64DecodeInternal): Don't hardcode knowledge about
        alphabet, put it into the map.

2013-11-07  Denis Nomiyama  <d.nomiyama@samsung.com>

        [GTK] Glyphs in vertical text tests are rotated 90 degrees clockwise
        https://bugs.webkit.org/show_bug.cgi?id=50619

        Reviewed by Martin Robinson.

        Enabled OPENTYPE_VERTICAL by default on GTK+ and EFL ports, which are
        currently using Freetype.

        * wtf/Platform.h:

2013-11-06  Daniel Bates  <dabates@apple.com>

        [iOS] Upstream Letterpress effect
        https://bugs.webkit.org/show_bug.cgi?id=123932

        Reviewed by Sam Weinig.

        Add feature define ENABLE_LETTERPRESS disabled by default. We only enable
        letterpress on iOS.

        * wtf/FeatureDefines.h:

2013-11-06  Nick Diego Yamane  <nick.yamane@openbossa.org>

        Disable "unused local typedefs" warning for GCC 4.7
        https://bugs.webkit.org/show_bug.cgi?id=123913

        Reviewed by Martin Robinson.

        That warning was actually introduced in gcc 4.7.0.
        See: http://gcc.gnu.org/gcc-4.7/changes.html

        * wtf/Compiler.h:

2013-11-06  Daniel Bates  <dabates@apple.com>

        Add ENABLE(TEXT_SELECTION)
        https://bugs.webkit.org/show_bug.cgi?id=123827

        Reviewed by Ryosuke Niwa.

        Enable selection painting by default on all ports except iOS.

        * wtf/FeatureDefines.h:

2013-11-04  Alexey Proskuryakov  <ap@apple.com>

        Implement base64url encoding from RFC 4648
        https://bugs.webkit.org/show_bug.cgi?id=123767

        Reviewed by Sam Weinig.

        No tests yet, will be covered by JWK tests for WebCrypto.

        * wtf/text/Base64.cpp:
        (WTF::base64EncodeInternal):
        (WTF::base64Encode):
        (WTF::base64URLEncode):
        (WTF::base64DecodeInternal):
        (WTF::base64Decode):
        (WTF::base64URLDecode):
        * wtf/text/Base64.h:
        (WTF::base64URLEncode):

2013-11-04  Brent Fulgham  <bfulgham@apple.com>

        [Win] User VersionStamper for official builds
        https://bugs.webkit.org/show_bug.cgi?id=123758

        Reviewed by Tim Horton.

        * WTF.vcxproj/WTFPostBuild.cmd: Add missing command to run VersionStamper.exe.

2013-11-01  Jer Noble  <jer.noble@apple.com>

        [PluginProxy] Add a setting to disable video plugin proxy support in HTMLMediaElement.
        https://bugs.webkit.org/show_bug.cgi?id=123621

        Reviewed by Eric Carlson.

        Enable WTF_USE_AVFOUNDATION and add some HAVE_AVFOUNDATION_* defines
        to replace the existing __MAC_OS_X_VERSION_MIN_REQUIRED macros in
        MediaPlayerPrivateAVFoundationObjC.mm.

        * wtf/Platform.h:

2013-11-02  Patrick Gansterer  <paroga@webkit.org>

        Fix compilation of DateMath.cpp with MSVC
        https://bugs.webkit.org/show_bug.cgi?id=123680

        Reviewed by Darin Adler.

        * wtf/DateMath.cpp:
        (WTF::appendTwoDigitNumber): Help the compiler finding the
        correct overload by casting the characters to LChar.

2013-11-02  Filip Pizlo  <fpizlo@apple.com>

        LLVM assertion failures should funnel into WTF's crash handling
        https://bugs.webkit.org/show_bug.cgi?id=123682

        Reviewed by Geoffrey Garen.
        
        Give JSC some new toys to play with for crash handling.

        * wtf/Assertions.cpp:
        * wtf/Assertions.h:

2013-11-02  Patrick Gansterer  <paroga@webkit.org>

        Fix UnicodeWchar after r157330.
        https://bugs.webkit.org/show_bug.cgi?id=123668

        Reviewed by Darin Adler.

        * wtf/unicode/wchar/UnicodeWchar.cpp:
        (unorm_normalize):
        (u_strFoldCase):
        (u_strToLower):
        (u_strToUpper):
        * wtf/unicode/wchar/UnicodeWchar.h:
        (u_foldCase):
        (u_isprint):
        (u_isspace):

2013-11-02  Andreas Kling  <akling@apple.com>

        Make remaining StringImpl functions return PassRef.
        <https://webkit.org/b/123683>

        Okay, this seems to work well! Let's go all in and convert the
        remaining StringImpl functions to return PassRef<StringImpl> instead
        of PassRefPtr where we know that null is never returned.

        Reviewed by Anders Carlsson.

2013-11-02  Andreas Kling  <akling@apple.com>

        StringImpl::upper() should return PassRef.
        <https://webkit.org/b/123655>

        Make upper() return PassRef<StringImpl>. Spotted and removed some
        ref churning in implementations.

        Reviewed by Darin Adler.

2013-11-01  Alexey Proskuryakov  <ap@apple.com>

        Add WebCrypto AES-CBC
        https://bugs.webkit.org/show_bug.cgi?id=123647

        Reviewed by Anders Carlsson.

        * wtf/FixedArray.h: (WTF::FixedArray::data): Added a const version of the function.

        * wtf/Vector.h: Added a comment to Vector constructor about how it is different
        from std::vector.

2013-11-01  Joseph Pecoraro  <pecoraro@apple.com>

        Unreviewed extended attempt at Windows build fix after r158471.

        * wtf/text/cf/AtomicStringCF.cpp:
        * wtf/text/cf/StringCF.cpp:
        * wtf/text/cf/StringImplCF.cpp:

2013-11-01  Joseph Pecoraro  <pecoraro@apple.com>

        Unreviewed attempt at Windows build fix after r158471.

        * wtf/text/cf/AtomicStringCF.cpp:
        * wtf/text/cf/StringCF.cpp:
        * wtf/text/cf/StringImplCF.cpp:

2013-11-01  Andreas Kling  <akling@apple.com>

        Make more StringImpl construction helpers return PassRef.
        <https://webkit.org/b/123652>

        Tweak another handful of StringImpl constructor functions to return
        PassRef<StringImpl> instead of PassRefPtr.

        Reviewed by Anders Carlsson.

2013-11-01  Andreas Kling  <akling@apple.com>

        Neuter WTF_MAKE_FAST_ALLOCATED in GLOBAL_FASTMALLOC_NEW builds.
        <https://webkit.org/b/123639>

        When building with GLOBAL_FASTMALLOC_NEW, we don't need to expand
        operator new/delete overrides in every class.

        This change makes allocations group up nicely in Instruments,
        instead of being split between "WTF::fastMalloc" and "operator new"
        depending on whether the class had WTF_MAKE_FAST_ALLOCATED.

        Reviewed by Anders Carlsson.

2013-11-01  Joseph Pecoraro  <pecoraro@apple.com>

        Move CF/Mac WTF String implementations down into WTF
        https://bugs.webkit.org/show_bug.cgi?id=123635

        Reviewed by Sam Weinig.

        * WTF.vcxproj/WTF.vcxproj:
        * WTF.vcxproj/WTF.vcxproj.filters:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/text/AtomicString.h:
        * wtf/text/StringImpl.h:
        * wtf/text/WTFString.h:
        * wtf/text/cf/AtomicStringCF.cpp: Renamed from Source/WebCore/platform/text/cf/AtomicStringCF.cpp.
        (WTF::AtomicString::add):
        * wtf/text/cf/StringCF.cpp: Renamed from Source/WebCore/platform/text/cf/StringCF.cpp.
        (WTF::String::String):
        (WTF::String::createCFString):
        * wtf/text/cf/StringImplCF.cpp: Renamed from Source/WebCore/platform/text/cf/StringImplCF.cpp.
        (garbageCollectionEnabled):
        (WTF::StringWrapperCFAllocator::retain):
        (WTF::StringWrapperCFAllocator::release):
        (WTF::StringWrapperCFAllocator::copyDescription):
        (WTF::StringWrapperCFAllocator::allocate):
        (WTF::StringWrapperCFAllocator::reallocate):
        (WTF::StringWrapperCFAllocator::deallocateOnMainThread):
        (WTF::StringWrapperCFAllocator::deallocate):
        (WTF::StringWrapperCFAllocator::preferredSize):
        (WTF::StringWrapperCFAllocator::create):
        (WTF::StringWrapperCFAllocator::allocator):
        (WTF::StringImpl::createCFString):
        * wtf/text/mac/StringImplMac.mm: Renamed from Source/WebCore/platform/text/mac/StringImplMac.mm.
        (WTF::StringImpl::operator NSString *):
        * wtf/text/mac/StringMac.mm: Renamed from Source/WebCore/platform/text/mac/StringMac.mm.
        (WTF::String::String):

2013-11-01  Emilio Pozuelo Monfort  <pochu27@gmail.com>

        HPPA build fixes
        https://bugs.webkit.org/show_bug.cgi?id=123625

        Original patch from John David Anglin <dave.anglin@bell.net>

        Reviewed by Darin Adler.

        * wtf/Platform.h:
        * wtf/dtoa/utils.h:

2013-11-01  Patrick Gansterer  <paroga@webkit.org>

        Buildfix for !USE(ICU_UNICODE) after 156968.

        * wtf/unicode/CollatorDefault.cpp:
        (WTF::Collator::userDefault):

2013-10-30  Oliver Hunt  <oliver@apple.com>

        Implement basic ES6 Math functions
        https://bugs.webkit.org/show_bug.cgi?id=123536

        Reviewed by Michael Saboff.

        Add basic implementations of necessary methods to MathExtras to
        deal with MSVC not supplying them

        * wtf/MathExtras.h:
        (asinh):
        (acosh):
        (atanh):
        (expm1):
        (log1p):
        (cbrt):

2013-10-30  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r158299.
        http://trac.webkit.org/changeset/158299
        https://bugs.webkit.org/show_bug.cgi?id=123558

        caused assertion failures in fast/canvas/canvas-color-
        serialization.html and fast/forms/input-text-paste-
        maxlength.html (Requested by rniwa on #webkit).

        * wtf/text/StringStatics.cpp:
        (WTF::StringImpl::empty):

2013-10-30  Ryosuke Niwa  <rniwa@webkit.org>

        Remove code for Mac Lion
        https://bugs.webkit.org/show_bug.cgi?id=123542

        Reviewed by Anders Carlsson.

        * wtf/Platform.h:

2013-10-30  Peter Molnar  <pmolnar.u-szeged@partner.samsung.com>

        Remove PCRE workaround.
        https://bugs.webkit.org/show_bug.cgi?id=123265

        Reviewed by Brent Fulgham.

        * wtf/text/StringStatics.cpp:
        (WTF::StringImpl::empty):

2013-10-30  peavo@outlook.com  <peavo@outlook.com>

        [Win] Compile errors when enabling DFG JIT.
        https://bugs.webkit.org/show_bug.cgi?id=120998

        Reviewed by Brent Fulgham.

        * wtf/CompilationThread.cpp: Use new ThreadingOnce class instead of pthread_once.
        (WTF::initializeCompilationThreads):
        * wtf/ThreadingOnce.h: Added ThreadingOnce class encapsulating pthread_once functionality.
        (WTF::ThreadingOnce::ThreadingOnce):
        (WTF::ThreadingOnce::~ThreadingOnce):
        (WTF::ThreadingOnce::callOnce):
        * wtf/text/CString.h: Export needed symbols.

2013-10-30  Alex Christensen  <achristensen@webkit.org>

        Disabled JIT on Win64.
        https://bugs.webkit.org/show_bug.cgi?id=122472

        Reviewed by Geoffrey Garen.

        * wtf/Platform.h:
        Disabled JIT on Win64.

2013-10-29  Andreas Kling  <akling@apple.com>

        StringImpl::isolatedCopy() should return PassRef.
        <https://webkit.org/b/123484>

        Make isolatedCopy() return a PassRef<StringImpl>.

        Reviewed by Anders Carlsson.

2013-10-29  Jer Noble  <jer.noble@apple.com>

        [MSE] [Mac] Enable MediaSource on the Mac
        https://bugs.webkit.org/show_bug.cgi?id=122484

        Reviewed by Darin Adler.

        Enable ENABLE_MEDIA_SOURCE.

        * wtf/FeatureDefines.h:
        * wtf/Platform.h: Force a clean build.

2013-10-29  Andreas Kling  <akling@apple.com>

        StringImpl::adopt() should return PassRef.
        <https://webkit.org/b/123456>

        Make the StringImpl::adopt() functions return a PassRef<StringImpl>.

        Reviewed by Anders Carlsson.

2013-10-29  Jinwoo Song  <jinwoo7.song@samsung.com>

        Re-enable simple line layout for EFL
        https://bugs.webkit.org/show_bug.cgi?id=123402

        Reviewed by Antti Koivisto.

        * wtf/FeatureDefines.h: Enable 8-bit TextRun support for EFL port.

2013-10-28  Anders Carlsson  <andersca@apple.com>

        RunLoop::dispatch should take an std::function
        https://bugs.webkit.org/show_bug.cgi?id=123407

        Reviewed by Andreas Kling.

        * wtf/FunctionDispatcher.h:

2013-10-28  Andreas Kling  <akling@apple.com>

        RenderElement::m_style should be a Ref.
        <https://webkit.org/b/123401>

        Added a Ref::replace() so we can Indiana Jones the new style in
        RenderElement::setStyle() while keeping a handle on the old style
        for a while longer.

        Reviewed by Antti Koivisto.

2013-10-28  Carlos Garcia Campos  <cgarcia@igalia.com>

        Unreviewed. Fix make distcheck.

        * GNUmakefile.list.am: Remove unexistent file from compilation.

2013-10-28  Bastien Nocera <hadess@hadess.net>

        Replace 0 timeouts g_timeout_add() by g_idle_add()
        https://bugs.webkit.org/show_bug.cgi?id=123260

        Reviewed by Carlos Garcia Campos.

        A zero timeout should be equivalent to using g_idle_add_full(G_PRIORITY_DEFAULT, ...)
        without the nagging feeling that the wrong API was used.

        * wtf/gtk/MainThreadGtk.cpp: Use g_idle_add() instead
        of 0-timer.
        (WTF::scheduleDispatchFunctionsOnMainThread):

2013-10-28  Zan Dobersek  <zdobersek@igalia.com>

        Re-enable simple line layout for GTK
        https://bugs.webkit.org/show_bug.cgi?id=123388

        Reviewed by Andreas Kling.

        * wtf/FeatureDefines.h: Enable the 8-bit TextRun support for the GTK port.

2013-10-25  Joseph Pecoraro  <pecoraro@apple.com>

        Upstream ENABLE(REMOTE_INSPECTOR) and enable on iOS and Mac
        https://bugs.webkit.org/show_bug.cgi?id=123111

        Reviewed by Timothy Hatcher.

        * wtf/FeatureDefines.h:

2013-10-25  Jer Noble  <jer.noble@apple.com>

        [WTF] Add a multiplication operator (and a few others) to MediaTime
        https://bugs.webkit.org/show_bug.cgi?id=123137

        Reviewed by Eric Carlson.

        Add a multiplication operator and an inequality operator to the
        MediaTime class for use by MSE.

        * wtf/MediaTime.cpp:
        (WTF::signum): Moved to top of file.
        (WTF::MediaTime::operator*): Added.
        (WTF::MediaTime::operator!=): Added.
        * wtf/MediaTime.h:
        (WTF::operator*): Added non-class version of operator*.

2013-10-24  Jer Noble  <jer.noble@apple.com>

        [Mac] Add helper methods to convert CMTime <--> MediaTime
        https://bugs.webkit.org/show_bug.cgi?id=123285

        Reviewed by Eric Carlson.

        Add a #ifdef header_h protector.

        * wtf/MediaTime.h:

2013-10-24  Mark Rowe  <mrowe@apple.com>

        Remove references to OS X 10.7 from Xcode configuration settings.

        Now that we're not building for OS X 10.7 they're no longer needed.

        Reviewed by Anders Carlsson.

        * Configurations/Base.xcconfig:
        * Configurations/DebugRelease.xcconfig:

2013-10-24  Mark Rowe  <mrowe@apple.com>

        <rdar://problem/15312643> Prepare for the mysterious future.

        Reviewed by David Kilzer.

        * Configurations/Base.xcconfig:
        * Configurations/DebugRelease.xcconfig:

2013-10-24  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r157931.
        http://trac.webkit.org/changeset/157931
        https://bugs.webkit.org/show_bug.cgi?id=123284

        Seems to have caused a lot of assertions on debug bots
        (Requested by ap on #webkit).

        * wtf/text/StringStatics.cpp:
        (WTF::StringImpl::empty):

2013-10-24  Peter Molnar  <pmolnar.u-szeged@partner.samsung.com>

        Remove PCRE workaround.
        https://bugs.webkit.org/show_bug.cgi?id=123265

        Reviewed by Darin Adler.

        * wtf/text/StringStatics.cpp:
        (WTF::StringImpl::empty):

2013-10-24  Peter Molnar  <pmolnar.u-szeged@partner.samsung.com>

        Remove Clang workaround.
        https://bugs.webkit.org/show_bug.cgi?id=123262

        Reviewed by Anders Carlsson.

        * wtf/CheckedArithmetic.h:
        (WTF::Checked::Checked):

2013-10-24  Ryuan Choi  <ryuan.choi@samsung.com>

        [EFL] Build break with latest EFL 1.8 libraries.
        https://bugs.webkit.org/show_bug.cgi?id=123245

        Reviewed by Gyuyoung Kim.

        After fixed build break on EFL 1.8 at r138326, EFL libraries are changed
        Eo typedef and splitted header files which contain version macro.

        * wtf/OwnPtrCommon.h: Changed Eo typedef.
        * wtf/efl/RefPtrEfl.h: Ditto.

2013-10-24  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GObject bindings] Make EventTarget interface introspectable
        https://bugs.webkit.org/show_bug.cgi?id=77835

        Reviewed by Gustavo Noronha Silva.

        Add support for use GRefPtr with GClosure.

        * wtf/gobject/GRefPtr.cpp:
        (WTF::refGPtr):
        (WTF::derefGPtr):
        * wtf/gobject/GRefPtr.h:
        * wtf/gobject/GTypedefs.h:

2013-10-23  Anders Carlsson  <andersca@apple.com>

        Remove USE(LOCKFREE_THREADSAFEREFCOUNTED)
        https://bugs.webkit.org/show_bug.cgi?id=123228

        Reviewed by Geoffrey Garen.

        All ports support USE(LOCKFREE_THREADSAFEREFCOUNTED) now and taking a lock on every ref/deref seems bad.

        * wtf/Atomics.h:
        * wtf/ThreadSafeRefCounted.h:
        (WTF::ThreadSafeRefCountedBase::ref):
        (WTF::ThreadSafeRefCountedBase::refCount):
        (WTF::ThreadSafeRefCountedBase::derefBase):

2013-10-23  Anders Carlsson  <andersca@apple.com>

        Remove HAVE_XPC
        https://bugs.webkit.org/show_bug.cgi?id=123226

        Reviewed by Dan Bernstein.

        HAVE_XPC has been true on Mac since Lion, so remove it.

        * wtf/Platform.h:

2013-10-23  Andreas Kling  <akling@apple.com>

        Make more StringImpl construction functions return PassRef.
        <https://webkit.org/b/123203>

        Knock out a couple more of the StringImpl construction helpers that
        always return a non-null StringImpl.

        Reviewed by Antti Koivisto.

2013-10-22  Filip Pizlo  <fpizlo@apple.com>

        FTL should be able to do some simple inline caches using LLVM patchpoints
        https://bugs.webkit.org/show_bug.cgi?id=123164

        Reviewed by Mark Hahnenberg.
        
        This needed some better bitvector support, like merging (|=), excluding (&=~),
        hashing, and bit counting.

        * wtf/BitVector.cpp:
        (WTF::BitVector::setSlow):
        (WTF::BitVector::excludeSlow):
        (WTF::BitVector::bitCountSlow):
        (WTF::BitVector::equalsSlowCase):
        (WTF::BitVector::hashSlowCase):
        (WTF::BitVector::dump):
        * wtf/BitVector.h:
        (WTF::BitVector::merge):
        (WTF::BitVector::exclude):
        (WTF::BitVector::bitCount):
        (WTF::BitVector::BitVector):
        (WTF::BitVector::isEmptyValue):
        (WTF::BitVector::isDeletedValue):
        (WTF::BitVector::isEmptyOrDeletedValue):
        (WTF::BitVector::operator==):
        (WTF::BitVector::hash):
        (WTF::BitVectorHash::hash):
        (WTF::BitVectorHash::equal):
        * wtf/HashTraits.h:
        (WTF::CustomHashTraits::constructDeletedValue):
        (WTF::CustomHashTraits::isDeletedValue):
        (WTF::CustomHashTraits::emptyValue):
        (WTF::CustomHashTraits::isEmptyValue):
        * wtf/StdLibExtras.h:
        (WTF::bitCount):

2013-10-23  Allan Sandfeld Jensen  <allan.jensen@digia.com>

        Clean-up in Atomics.h
        https://bugs.webkit.org/show_bug.cgi?id=123207

        Reviewed by Anders Carlsson.

        Atomics.h has two confusing and bit-rotted ifdefs with comments.

        The first about CPU(SPARC64) was rendered obsolete when we switched
        from __exchange_and_add to __sync_add_and_fetch.

        The second was caused by a wrong definition that apparently only
        caused trouble on GCC.

        * wtf/Atomics.h:

2013-10-22  Andreas Kling  <akling@apple.com>

        StringImpl::lower() should return a PassRef.
        <https://webkit.org/b/123190>

        Test the waters and hack enough of StringImpl to be able to return
        a PassRef<StringImpl> from lower().

        Also gave String a constructor that takes a PassRef<StringImpl>.

        Reviewed by Antti Koivisto.

2013-10-22  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r157835.
        http://trac.webkit.org/changeset/157835
        https://bugs.webkit.org/show_bug.cgi?id=123192

        broke 32-bit builds (Requested by smfr on #webkit).

        * wtf/MediaTime.cpp:
        (WTF::signum):
        * wtf/MediaTime.h:

2013-10-22  Jer Noble  <jer.noble@apple.com>

        [WTF] Add a multiplication operator (and a few others) to MediaTime
        https://bugs.webkit.org/show_bug.cgi?id=123137

        Reviewed by Eric Carlson.

        Add a multiplication operator and an inequality operator to the
        MediaTime class for use by MSE.

        * wtf/MediaTime.cpp:
        (WTF::signum): Moved to top of file.
        (WTF::MediaTime::operator*): Added.
        (WTF::MediaTime::operator!=): Added.
        * wtf/MediaTime.h:
        (WTF::operator*): Added non-class version of operator*.

2013-10-21  Gyuyoung Kim  <gyuyoung.kim@samsung.com>

        Make TYPE_CASTS_BASE more flexible
        https://bugs.webkit.org/show_bug.cgi?id=122951

        Reviewed by Andreas Kling.

        TYPE_CASTS_BASE is being used by node|element type casts. However, it is difficult
        to be used by other type casts. For instance, CSSValue, Accessibility and so on.
        This patch modifies TYPE_CASTS_BASE which can support other type casts.

        Besides TYPE_CASTS_BASE body is moved from node.h to Assertions.h.

        * wtf/Assertions.h:

2013-10-20  Filip Pizlo  <fpizlo@apple.com>

        StructureStubInfo's usedRegisters set should be able to track all registers, not just the ones that our JIT's view as temporaries
        https://bugs.webkit.org/show_bug.cgi?id=123076

        Reviewed by Sam Weinig.
        
        Teach BitVector how to efficiently merge (i.e. bitvector |=).

        * wtf/BitVector.cpp:
        (WTF::BitVector::mergeSlow):
        * wtf/BitVector.h:
        (WTF::BitVector::merge):
        (WTF::BitVector::cleanseInlineBits):

2013-10-19  Jer Noble  <jer.noble@apple.com>

        Unreviewed roll out of r157695; broke Mac builds.

        * wtf/FeatureDefines.h:

2013-10-07  Jer Noble  <jer.noble@apple.com>

        [MSE] [Mac] Enable MediaSource on the Mac
        https://bugs.webkit.org/show_bug.cgi?id=122484

        Reviewed by Darin Adler.

        Enable ENABLE_MEDIA_SOURCE.

        * wtf/FeatureDefines.h:

2013-10-19  Andreas Kling  <akling@apple.com>

        RefPtr::releaseNonNull() incorrectly increments the refcount.
        <https://webkit.org/b/123063>

        Make releaseNonNull() use adoptRef(T&), mirroring release().

        Reviewed by Anders Carlsson.

2013-10-18  Andreas Kling  <akling@apple.com>

        Start passing RenderStyle around with PassRef.
        <https://webkit.org/b/123051>

        Added some new PassRef tricks to make this patch possible.

        Reviewed by Darin Adler.

        * wtf/PassRef.h:
        (WTF::PassRef::get):

            Added a get() helper to facilitate writing functions that
            construct a new object and call some functions on it before
            returning it.

        (WTF::PassRef::dropRef):

            This will deref() the referenced object and mark the PassRef
            as "passed." This is used in code paths where the PassRef is
            going to go out of scope with nobody to take it over.

        (WTF::PassRef::leakRef):

            Renamed takeReference() to leakRef() and made it public so
            we don't have to awkwardly sink the PassRef into a Ref for
            e.g static locals.

        * wtf/RefPtr.h:
        (WTF::RefPtr::releaseNonNull):

            Added RefPtr::releaseNonNull() for a convenient way of creating
            a PassRef<T> from a RefPtr<T>. This function may only be called
            if the RefPtr is known to be non-null.

2013-10-18  Filip Pizlo  <fpizlo@apple.com>

        A CodeBlock's StructureStubInfos shouldn't be in a Vector that we search using code origins and machine code PCs
        https://bugs.webkit.org/show_bug.cgi?id=122940

        Reviewed by Oliver Hunt.

        * GNUmakefile.list.am:
        * WTF.vcxproj/WTF.vcxproj:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/BagToHashMap.h: Added.
        (WTF::toHashMap):
        * wtf/CMakeLists.txt:

2013-10-18  Anders Carlsson  <andersca@apple.com>

        Remove spaces between template angle brackets
        https://bugs.webkit.org/show_bug.cgi?id=123040

        Reviewed by Andreas Kling.

        * wtf/AVLTree.h:
        * wtf/CheckedArithmetic.h:
        * wtf/Compression.h:
        * wtf/Functional.h:
        (WTF::R):
        * wtf/HashFunctions.h:
        * wtf/HashIterators.h:
        * wtf/HashSet.h:
        (WTF::::contains):
        * wtf/ListHashSet.h:
        (WTF::::contains):
        * wtf/RefCountedLeakCounter.cpp:
        * wtf/RetainPtr.h:
        * wtf/SentinelLinkedList.h:
        (WTF::::remove):
        * wtf/SizeLimits.cpp:
        * wtf/StreamBuffer.h:
        * wtf/Vector.h:
        * wtf/VectorTraits.h:
        * wtf/WeakPtr.h:
        (WTF::WeakReference::create):
        (WTF::WeakReference::createUnbound):
        (WTF::WeakPtr::WeakPtr):
        (WTF::WeakPtrFactory::WeakPtrFactory):
        * wtf/text/AtomicString.cpp:
        (WTF::AtomicString::add):
        (WTF::findString):
        * wtf/text/StringConcatenate.h:
        * wtf/text/StringImpl.h:
        * wtf/text/StringOperators.h:
        (WTF::operator+):

2013-10-18  Brendan Long  <b.long@cablelabs.com>

        [GStreamer][GTK] Add GRefPtr::outPtr()
        https://bugs.webkit.org/show_bug.cgi?id=122996

        Reviewed by Philippe Normand.

        * wtf/gobject/GRefPtr.h:
        (WTF::GRefPtr::outPtr): Added.

2013-10-17  Geoffrey Garen  <ggaren@apple.com>

        Tidied up the Vector<T> move constructor
        https://bugs.webkit.org/show_bug.cgi?id=122998

        Reviewed by Anders Carlsson.

        * wtf/Vector.h:
        (WTF::::Vector): Don't call swap() "weird". It's the way most std types
        implement move constructors.

        Do inline this function, so the compiler can optimize away a logical
        move into a physical no-op.

2013-10-16  Filip Pizlo  <fpizlo@apple.com>

        Introduce WTF::Bag and start using it for InlineCallFrameSet
        https://bugs.webkit.org/show_bug.cgi?id=122941

        Reviewed by Geoffrey Garen.
        
        Introduce WTF::Bag, which is basically an allocation pool. No POD restrictions. Does one
        malloc per entry. No need to shrink afterwards.

        * GNUmakefile.list.am:
        * WTF.vcxproj/WTF.vcxproj:
        * WTF.xcodeproj/project.pbxproj:
        * wtf/Bag.h: Added.
        (WTF::Bag::Bag):
        (WTF::Bag::~Bag):
        (WTF::Bag::add):
        (WTF::Bag::iterator::iterator):
        (WTF::Bag::iterator::operator!):
        (WTF::Bag::iterator::operator*):
        (WTF::Bag::iterator::operator++):
        (WTF::Bag::iterator::operator==):
        (WTF::Bag::begin):
        (WTF::Bag::end):
        (WTF::Bag::isEmpty):
        * wtf/CMakeLists.txt:

2013-10-17  Andreas Kling  <akling@apple.com>

        Make it possible to assign a PassRef to a RefPtr.
        <https://webkit.org/b/122943>

        We have to use std::move when constructing a RefPtr from a PassRef
        since there is no copy constructor for the latter.

        Reviewed by Antti Koivisto.

2013-10-16  Ryuan Choi  <ryuan.choi@samsung.com>

        Unreviewed build fix attempt on EFL port after r157520 and r157523

        * wtf/PassRef.h: includes <utility>

2013-10-16  Darin Adler  <darin@apple.com>

        Add PassRef and createRefCounted so we can improve creation of RefCounted objects
        https://bugs.webkit.org/show_bug.cgi?id=122904

        Reviewed by Anders Carlsson.

        * GNUmakefile.list.am: Added PassRef.h.
        * WTF.vcxproj/WTF.vcxproj: Ditto.
        * WTF.vcxproj/WTF.vcxproj.filters: Ditto.
        * WTF.xcodeproj/project.pbxproj: Ditto.
        * wtf/CMakeLists.txt: Ditto.

        * wtf/Forward.h: Added PassRef. Also re-sorted and un-indented to match what
        the style-checking script expects.

        * wtf/PassRef.h: Added. Includes the createRefCounted function template, which
        is analogous to make_unique, but is for reference counted objects, and also
        assumes that new will never return null. Also includes an overload of adoptRef
        that takes a reference rather than a pointer.

        * wtf/PassRefPtr.h: Include "PassRef.h" so we can share the adopted function.
        Got rid of declarations that duplicate ones in there.
        (WTF::refIfNotNull): Use nullptr.
        (WTF::derefIfNotNull): Use nullptr.
        (WTF::PassRefPtr::PassRefPtr): Use nullptr. Added an overload that takes a PassRef.
        (WTF::PassRefPtr::operator UnspecifiedBoolType): Use nullptr.
        (WTF::PassRefPtr::operator=): Made this deleted instead of compile time assertion.
        (WTF::PassRefPtr::PassRefPtr): Made adopting constructor use an adopt tag instead
        of an unused boolean.
        (WTF::PassRefPtr::leakRef): Use nullptr.
        (WTF::adoptRef): Use the adopt tag.

        * wtf/Ref.h: Use Noncopyable instead of rolling our own.
        (WTF::Ref::Ref): Add an overload that takes a PassRef.
        (WTF::Ref::operator=): Ditto.

        * wtf/RefPtr.h: Removed unneeded forward declaration of PassRefPtr.
        (WTF::RefPtr::RefPtr): Use nullptr. Added overload that takes a PassRef.
        (WTF::RefPtr::release): Use nullptr.
        (WTF::RefPtr::operator UnspecifiedBoolType): Use nullptr.
        (WTF::RefPtr::operator=): Added overload that takes a PassRef.
        (WTF::RefPtr::clear): Use nullptr.

        * wtf/StdLibExtras.h: Added inline keyword to isPointerTypeAlignmentOkay,
        reinterpret_cast_ptr, and make_unique. Seems like a simple oversight that these
        were missing before.

2013-10-15  Dean Jackson  <dino@apple.com>

        Add ENABLE_WEB_ANIMATIONS flag
        https://bugs.webkit.org/show_bug.cgi?id=122871

        Reviewed by Tim Horton.

        Eventually might be http://dev.w3.org/fxtf/web-animations/
        but this is just engine-internal work at the moment.

        * wtf/FeatureDefines.h:

2013-10-15  Daniel Bates  <dabates@apple.com>

        [iOS] Upstream JavaScriptCore support for ARM64
        https://bugs.webkit.org/show_bug.cgi?id=122762

        Reviewed by Oliver Hunt.

        * Configurations/Base.xcconfig:
        * wtf/Atomics.h:
        (WTF::weakCompareAndSwap):
        (WTF::armV7_dmb):
        * wtf/FastMalloc.cpp:
        * wtf/Platform.h:
        * wtf/dtoa.cpp:
        * wtf/dtoa/utils.h:
        * wtf/text/ASCIIFastPath.h:
        (WTF::copyLCharsFromUCharSource):
        * wtf/text/StringImpl.h:

2013-10-14  Zan Dobersek  <zdobersek@igalia.com>

        Static assertions in WTF::adoptPtr should point to using adoptRef for ref-counted objects
        https://bugs.webkit.org/show_bug.cgi?id=122745

        Reviewed by Anders Carlsson.

        * wtf/PassOwnPtr.h:
        (WTF::adoptPtr): When the object's type is convertible to the RefCountedBase or ThreadSafeRefCountedBase type,
        the static assertion should note that adoptRef should be used instead.

2013-10-14  Anders Carlsson  <andersca@apple.com>

        WebKit Nightlies broken by r157374
        https://bugs.webkit.org/show_bug.cgi?id=122736

        Reviewed by Andreas Kling.

        Add back a callOnMainThread overload that Safari is using.

        * wtf/MainThread.cpp:
        (WTF::callOnMainThread):
        * wtf/MainThread.h:

2013-10-13  Darin Adler  <darin@apple.com>

        Deprecate or remove deleteAllValues functions; there are only a few call sites left
        https://bugs.webkit.org/show_bug.cgi?id=122738

        Reviewed by Anders Carlsson.

        * wtf/Deque.h: Deleted deleteAllValues.
        * wtf/HashMap.h: Ditto.
        * wtf/HashSet.h: Ditto.
        * wtf/ListHashSet.h: Ditto.
        * wtf/Vector.h: Renamed deleteAllValues to deprecatedDeleteAllValues.

== Rolled over to ChangeLog-2013-10-13 ==
